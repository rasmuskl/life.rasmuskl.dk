(this.webpackJsonplife=this.webpackJsonplife||[]).push([[0],{52:function(e,t,n){e.exports=n(75)},58:function(e,t,n){},64:function(e,t,n){},71:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){"use strict";n.r(t),n.d(t,"history",(function(){return In}));var r=n(0),a=n.n(r),c=n(44),i=n.n(c),o=n(1),s=n.n(o),u=n(2),l=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function d(){return(d=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=6;break}if(new URL("",window.location.href).origin===window.location.origin){e.next=4;break}return e.abrupt("return");case 4:window.addEventListener("load",Object(u.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="".concat("","/service-worker.js"),!l){e.next=8;break}return m(n,t),e.next=5,navigator.serviceWorker.ready;case 5:console.log("This web app is being served cache-first by a service worker."),e.next=10;break;case 8:return e.next=10,p(n,t);case 10:case"end":return e.stop()}}),e)})))),self.addEventListener("message",(function(e){e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting()}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return f.apply(this,arguments)}function f(){return(f=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.serviceWorker.register(t);case 2:(r=e.sent).onupdatefound=function(){var e=r.installing;null!=e&&(e.onstatechange=function(){"installed"===e.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed."),n&&n.onUpdate&&n.onUpdate(r)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(r)))})};case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return v.apply(this,arguments)}function v(){return(v=Object(u.a)(s.a.mark((function e(t,n){var r,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{"Service-Worker":"script"}});case 2:if(r=e.sent,a=r.headers.get("content-type"),404!==r.status&&(null==a||-1!==a.indexOf("javascript"))){e.next=13;break}return e.next=7,navigator.serviceWorker.ready;case 7:return c=e.sent,e.next=10,c.unregister();case 10:window.location.reload(),e.next=14;break;case 13:p(t,n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=n(20),b=n(3),x=(n(58),n(4)),g=n(7),y=n(10),k=n(12),E=n(13),w=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={installEvent:null},r}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),e.setState({installEvent:t})}))}},{key:"onInstallClick",value:function(){null!==this.state.installEvent&&(this.state.installEvent.prompt(),this.state.installEvent.userChoice.then((function(e){"accepted"===e.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt")})))}},{key:"render",value:function(){var e=this;return this.state.installEvent?r.createElement("div",{className:"button",onClick:function(){return e.onInstallClick()}},"Install app"):null}}]),n}(r.Component),j=n(5),O="hover-glow",I=Object(j.a)({cursor:"pointer"});Object(j.a)({display:"flex",alignItems:"center"});function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".3rem",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(j.a)({paddingLeft:t?e:void 0,paddingRight:t?e:void 0,"&":{"& > *:first-child":{marginLeft:0},"& > *":{marginRight:e},"& > *:last-child":{marginRight:0}}})}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".3rem",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(j.a)({paddingTop:t?e:void 0,paddingBottom:t?e:void 0,"&":{"& > *":{marginBottom:e},"& > *:last-child":{marginBottom:0}}})}var S=n(6),D=n(15),A=n(11),T=n(16),L=n(9),P=n.n(L),F=function(){function e(){Object(g.a)(this,e),this.listeners=[]}return Object(y.a)(e,[{key:"register",value:function(e){var t=this;return this.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))}}},{key:"trigger",value:function(e){var t,n=Object(S.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}}]),e}(),R=function(){function e(t){Object(g.a)(this,e),this.store=void 0,this.type=void 0,this.changeListener=void 0,this.type=t,this.store=Object(T.createInstance)({name:"store-".concat(t)}),this.changeListener=new F}return Object(y.a)(e,[{key:"createUnsaved",value:function(e){var t=(new Date).toISOString();return Object(A.a)({id:this.uuid(),versionId:this.uuid(),type:this.type,parentVersionIds:[],createdAt:t,updatedAt:t},e)}},{key:"create",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new Date).toISOString(),r=Object(A.a)({id:this.uuid(),versionId:this.uuid(),type:this.type,parentVersionIds:[],createdAt:n,updatedAt:n},t),e.next=4,this.store.setItem(this.getKey(r),r);case 4:return this.changeListener&&this.changeListener.trigger(r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(e){if(e.id||(e.id=this.uuid()),e.type!==this.type)throw new Error("Invalid type: ".concat(e.type," - expected ").concat(this.type));var t=(new Date).toISOString();e.createdAt||(e.createdAt=t),e.updatedAt=t,e.versionId&&(e.parentVersionId1=e.versionId),e.versionId=this.uuid(),this.store.setItem(this.getKey(e),e),this.changeListener&&this.changeListener.trigger(e)}},{key:"import",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.type!==this.type)throw new Error("Invalid type ".concat(e.type," - expected ").concat(this.type));this.store.setItem(this.getKey(e),e),!t&&this.changeListener&&this.changeListener.trigger(e)}},{key:"get",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r,a,c,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=14;break}return e.next=3,this.getLeafNodes("".concat(t,"/"));case 3:if(!((r=e.sent).length>1)){e.next=9;break}console.warn("Found ".concat(r.length," leaf nodes for entity ").concat(this.type,"/").concat(t," - expected 1: ").concat(r.map((function(e){return e.versionId})))),a=Object(S.a)(r);try{for(a.s();!(c=a.n()).done;)i=c.value,console.log("leaf node",i)}catch(s){a.e(s)}finally{a.f()}return e.abrupt("return",L.orderBy(r,(function(e){return e.updatedAt}),"desc")[0]);case 9:if(0!==r.length){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",r[0]);case 14:return e.next=16,this.getKeysPrefixed("".concat(t,"/").concat(n));case 16:return o=e.sent,e.next=19,this.store.getItem(o[0]);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLeafNodes();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getKeysPrefixed",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.keys();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e.startsWith(t)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSyncKeys",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.keys();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return"".concat(n.type,"/").concat(e.split("/")[0],"/").concat(e.split("/")[1])})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLeafNodes",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r,a,c,i,o,u,l,d,p,f,m,v,h,b,x=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=x.length>0&&void 0!==x[0]?x[0]:"",e.next=3,this.getKeysPrefixed(t);case 3:n=e.sent,r=n.map((function(e){var t=e.split("/"),n=null,r=null;if(t[2].length>0){var a=t[2].split("+");if(a.length>2)throw new Error("ParentVersionIds length > 2");n=a[0],r=a.length>1?a[1]:null}return{id:t[0],versionId:t[1],parentVersionId1:n,parentVersionId2:r}})),a=L.groupBy(r,(function(e){return e.id})),c=Object.keys(a).map((function(e){var t,n=a[e],r={},c=Object(S.a)(n);try{for(c.s();!(t=c.n()).done;){var i=t.value;i.parentVersionId1&&(r[i.parentVersionId1]=!0),i.parentVersionId2&&(r[i.parentVersionId2]=!0)}}catch(o){c.e(o)}finally{c.f()}return n.filter((function(e){return!r[e.versionId]}))})),i=[],o=Object(S.a)(c),e.prev=9,o.s();case 11:if((u=o.n()).done){e.next=37;break}l=u.value,d=[],p=Object(S.a)(l),e.prev=15,p.s();case 17:if((f=p.n()).done){e.next=26;break}return m=f.value,e.t0=d,e.next=22,this.store.getItem(this.getKey(m));case 22:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t2=e.catch(15),p.e(e.t2);case 31:return e.prev=31,p.f(),e.finish(31);case 34:if(1!==d.length){console.warn("Found ".concat(d.length," leaf nodes for entity ").concat(this.type,"/").concat(l[0].id," - expected 1: ").concat(d.map((function(e){return e.versionId})))),v=Object(S.a)(d);try{for(v.s();!(h=v.n()).done;)b=h.value,console.log("leaf node",b)}catch(s){v.e(s)}finally{v.f()}i.push(L.orderBy(d,(function(e){return e.updatedAt}),"desc")[0])}else i.push(d[0]);case 35:e.next=11;break;case 37:e.next=42;break;case 39:e.prev=39,e.t3=e.catch(9),o.e(e.t3);case 42:return e.prev=42,o.f(),e.finish(42);case 45:return e.abrupt("return",i);case 46:case"end":return e.stop()}}),e,this,[[9,39,42,45],[15,28,31,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"registerChangeListener",value:function(e){this.changeListener.register(e)}},{key:"dropInstance",value:function(){this.store.dropInstance()}},{key:"getKey",value:function(e){var t=[];return e.parentVersionId1&&t.push(e.parentVersionId1),e.parentVersionId2&&t.push(e.parentVersionId2),"".concat(e.id,"/").concat(e.versionId,"/").concat(t.join("+"))}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}]),e}(),U=new R("context"),B=new R("task"),K=new R("note"),M=new R("project"),Y=new R("person");function V(){return(V=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=D.a,e.next=4,U.getSyncKeys();case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=D.a,e.next=9,B.getSyncKeys();case 9:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t7=D.a,e.next=14,K.getSyncKeys();case 14:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t10=D.a,e.next=19,M.getSyncKeys();case 19:return e.t11=e.sent,e.t12=(0,e.t10)(e.t11),e.t13=D.a,e.next=24,Y.getSyncKeys();case 24:return e.t14=e.sent,e.t15=(0,e.t13)(e.t14),t=e.t0.concat.call(e.t0,e.t3,e.t6,e.t9,e.t12,e.t15),e.abrupt("return",t);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return H.apply(this,arguments)}function H(){return(H=Object(u.a)(s.a.mark((function e(t){var n,r,a,c,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.split("/"),r=Object(b.a)(n,3),a=r[0],c=r[1],i=r[2],e.t0=a,e.next="context"===e.t0?4:"task"===e.t0?5:"note"===e.t0?6:"project"===e.t0?7:"person"===e.t0?8:9;break;case 4:return e.abrupt("return",U.get(c,i));case 5:return e.abrupt("return",B.get(c,i));case 6:return e.abrupt("return",K.get(c,i));case 7:return e.abrupt("return",M.get(c,i));case 8:return e.abrupt("return",Y.get(c,i));case 9:throw new Error("Unknown type: "+a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=Object(u.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(S.a)(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=21;break}a=r.value,e.t0=a.type,e.next="context"===e.t0?8:"task"===e.t0?10:"note"===e.t0?12:"project"===e.t0?14:"person"===e.t0?16:18;break;case 8:return U.import(a),e.abrupt("break",19);case 10:return B.import(a),e.abrupt("break",19);case 12:return K.import(a),e.abrupt("break",19);case 14:return M.import(a),e.abrupt("break",19);case 16:return Y.import(a),e.abrupt("break",19);case 18:throw new Error("Unknown type: "+a.type);case 19:e.next=3;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(1),n.e(e.t1);case 26:return e.prev=26,n.f(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[1,23,26,29]])})))).apply(this,arguments)}function z(){return(z=Object(u.a)(s.a.mark((function e(t){var n,r,a,c,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(S.a)(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=30;break}a=r.value,c=a.data,(i=JSON.parse(c)).id=a.id,i.versionId=a.versionId,i.type=a.type,i.parentVersionId1=a.parentVersionId1,i.parentVersionId2=a.parentVersionId2,i.createdAt=a.createdAt,i.updatedAt=a.updatedAt,e.t0=a.type,e.next="context"===e.t0?17:"task"===e.t0?19:"note"===e.t0?21:"project"===e.t0?23:"person"===e.t0?25:27;break;case 17:return U.import(i,!0),e.abrupt("break",28);case 19:return B.import(i,!0),e.abrupt("break",28);case 21:return K.import(i,!0),e.abrupt("break",28);case 23:return M.import(i,!0),e.abrupt("break",28);case 25:return Y.import(i,!0),e.abrupt("break",28);case 27:throw new Error("Unknown type: "+i.type);case 28:e.next=3;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(1),n.e(e.t1);case 35:return e.prev=35,n.f(),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[1,32,35,38]])})))).apply(this,arguments)}function _(){return(_=Object(u.a)(s.a.mark((function e(t){var n,r,a,c,i,o,u,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=Object(S.a)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=25;break}return c=a.value,e.next=8,W(c);case 8:if(null!==(i=e.sent)){e.next=12;break}return console.warn("Entity with key not found: "+c),e.abrupt("continue",23);case 12:delete(o=Object(A.a)({},i)).createdAt,delete o.updatedAt,delete o.id,delete o.versionId,delete o.type,delete o.parentVersionId1,delete o.parentVersionId2,u=JSON.stringify(o),l={id:i.id,versionId:i.versionId,type:i.type,parentVersionId1:i.parentVersionId1,parentVersionId2:i.parentVersionId2,createdAt:i.createdAt,updatedAt:i.updatedAt,data:u},n.push(l);case 23:e.next=4;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(2),r.e(e.t0);case 30:return e.prev=30,r.f(),e.finish(30);case 33:return e.abrupt("return",n);case 34:case"end":return e.stop()}}),e,null,[[2,27,30,33]])})))).apply(this,arguments)}var G={contexts:U,tasks:B,notes:K,projects:M,people:Y,getSyncKeys:function(){return V.apply(this,arguments)},importEntites:function(e){return J.apply(this,arguments)},importServerEntites:function(e){return z.apply(this,arguments)},exportServerEntities:function(e){return _.apply(this,arguments)}},q=function(e){return r.createElement("div",{style:{display:"flex",height:"100%",justifyContent:"center",alignItems:"center"}},r.createElement("div",{style:{border:"1px solid #555",padding:"1rem 2rem",background:"#2e2e2e"}},"Loading..."))},$=function e(t,n,r,a,c){Object(g.a)(this,e),this.notes=void 0,this.tasks=void 0,this.contexts=void 0,this.projects=void 0,this.people=void 0,this.notes=t,this.tasks=n,this.contexts=r,this.projects=a,this.people=c},X=a.a.createContext({data:null}),Q=function(e){var t=a.a.useState(null),n=Object(b.a)(t,2),c=n[0],i=n[1];Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ae.registerDataListener(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=i,e.next=4,Ae.getData();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),e.next=8,Ae.startServerSync();case 8:return e.next=10,Ae.ensureServerSyncEnqueued();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var o={data:c};return c?a.a.createElement(X.Provider,{value:o},e.children):a.a.createElement(q,null)},Z=function(){return Object(r.useContext)(X)},ee=n(28),te=(n(36),Object(T.createInstance)({name:"store-dropbox"})),ne="life.rasmuskl.dk"!==window.location.host,re=ne?"jh9cnt92wi5e5my":"li12ai4q2cs3dkc";!function(){he.apply(this,arguments)}();var ae=window.fetch;function ce(){return ie.apply(this,arguments)}function ie(){return(ie=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.getItem("token");case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(){return se.apply(this,arguments)}function se(){return(se=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.getItem("snapshot");case 2:return t=e.sent,e.abrupt("return",t||{cursor:null,files:new Set});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return le.apply(this,arguments)}function le(){return(le=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return e.next=3,te.removeItem("snapshot");case 3:e.next=7;break;case 5:return e.next=7,te.setItem("snapshot",t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(){return pe.apply(this,arguments)}function pe(){return(pe=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue(null);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(){return me.apply(this,arguments)}function me(){return(me=Object(u.a)(s.a.mark((function e(){var t,n,r,a,c,i,o,u,l,d,p,f,m,v,h=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(h.length>0&&void 0!==h[0])||h[0],e.next=3,ce();case 3:if(e.sent){e.next=5;break}throw new Error("Not authenticated");case 5:return e.t0=ee.Dropbox,e.next=8,ke();case 8:if(e.t1=e.sent,e.t2=ae,e.t3={accessToken:e.t1,fetch:e.t2},n=new e.t0(e.t3),r={cursor:null,files:new Set},!t){e.next=17;break}return e.next=16,oe();case 16:r=e.sent;case 17:a=!0;case 18:if(!a){e.next=42;break}if(!r.cursor){e.next=30;break}return e.next=22,n.filesListFolderContinue({cursor:r.cursor});case 22:c=e.sent,i=c.entries.filter((function(e){return"file"===e[".tag"]})).map((function(e){var t;return null===(t=e.path_lower)||void 0===t?void 0:t.substring(1)})).filter((function(e){return e})),r.cursor=c.cursor,o=Object(S.a)(i);try{for(o.s();!(u=o.n()).done;)l=u.value,r.files.add(l)}catch(s){o.e(s)}finally{o.f()}a=c.has_more,e.next=38;break;case 30:return e.next=32,n.filesListFolder({path:"",recursive:!0});case 32:d=e.sent,p=d.entries.filter((function(e){return"file"===e[".tag"]})).map((function(e){var t;return null===(t=e.path_lower)||void 0===t?void 0:t.substring(1)})).filter((function(e){return e})),r.cursor=d.cursor,f=Object(S.a)(p);try{for(f.s();!(m=f.n()).done;)v=m.value,r.files.add(v)}catch(s){f.e(s)}finally{f.f()}a=d.has_more;case 38:return e.next=40,ue(r);case 40:e.next=18;break;case 42:return e.abrupt("return",r.files);case 43:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(){return function(e){var t={};if("string"!==typeof e)return t;if(!(e=e.trim().replace(/^(\?|#|&)/,"")))return t;return e.split("&").forEach((function(e){var n=e.replace(/\+/g," ").split("="),r=n.shift(),a=n.length>0?n.join("="):null;r=decodeURIComponent(r),a=a?decodeURIComponent(a):null;var c=t[r];void 0===t[r]?t[r]=a:Array.isArray(c)?c.push(a):t[r]=[t[r],a]})),t}(window.location.hash).access_token}function he(){return(he=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=ve())){e.next=4;break}return e.next=4,te.setItem("token",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e,t){return xe.apply(this,arguments)}function xe(){return(xe=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce();case 2:if(e.sent){e.next=4;break}throw new Error("Not authenticated");case 4:return e.t0=ee.Dropbox,e.next=7,ke();case 7:return e.t1=e.sent,e.t2=ae,e.t3={accessToken:e.t1,fetch:e.t2},r=new e.t0(e.t3),e.next=13,r.filesUpload({path:"/".concat(t),contents:n});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e){return ye.apply(this,arguments)}function ye(){return(ye=Object(u.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce();case 2:if(e.sent){e.next=4;break}throw new Error("Not authenticated");case 4:return e.t0=ee.Dropbox,e.next=7,ke();case 7:return e.t1=e.sent,e.t2=ae,e.t3={accessToken:e.t1,fetch:e.t2},n=new e.t0(e.t3),e.next=13,n.filesDownload({path:"/".concat(t)});case 13:return r=e.sent,e.abrupt("return",new Promise((function(e){var t=r.fileBlob,n=new FileReader;n.addEventListener("loadend",(function(){var t=n.result;e(JSON.parse(t))})),n.readAsText(t)})));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.getItem("token");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var we=n(45),je=n.n(we);function Oe(){var e,t,n,r=null===(e=window.chrome)||void 0===e||null===(t=e.webview)||void 0===t||null===(n=t.hostObjects)||void 0===n?void 0:n.dotnet,a=window.AndroidBridge;return r||a||null}function Ie(){return(Ie=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,Oe().getNotes();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(){return(Ne=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,Oe().getNote(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(){return(Ce=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,Oe().getContext(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se,De={hasBridge:function(){return!!Oe()},getEntity:function(e){return Oe().getEntity(e)},sendEntity:function(e,t){return Oe().sendEntity(e,t)},getSyncKeys:function(){return Oe().getSyncKeys()},getNotes:function(){return Ie.apply(this,arguments)},getNote:function(e){return Ne.apply(this,arguments)},getContext:function(e){return Ce.apply(this,arguments)}};!function(e){e[e.Idle=0]="Idle",e[e.Syncing=1]="Syncing",e[e.Failed=2]="Failed"}(Se||(Se={}));var Ae=new(function(){function e(){var t=this;Object(g.a)(this,e),this.status=Se.Idle,this.results=[],this.data=null,this.intervalHandle=null,this.syncListener=new F,this.dataListener=new F,G.notes.changeListener.register((function(e){if(t.data){var n=L.orderBy(t.data.notes.filter((function(t){return t.id!==e.id})).concat(e),(function(e){return e.updatedAt}));t.data=new $(n,t.data.tasks,t.data.contexts,t.data.projects,t.data.people),t.dataListener.trigger(t.data),t.startServerSync()}})),G.tasks.changeListener.register((function(e){if(t.data){var n=t.data.tasks.filter((function(t){return t.id!==e.id})).concat(e);t.data=new $(t.data.notes,n,t.data.contexts,t.data.projects,t.data.people),t.dataListener.trigger(t.data),t.startServerSync()}})),G.contexts.changeListener.register((function(e){if(t.data){var n=t.data.contexts.filter((function(t){return t.id!==e.id})).concat(e);t.data=new $(t.data.notes,t.data.tasks,n,t.data.projects,t.data.people),t.dataListener.trigger(t.data),t.startServerSync()}})),G.projects.changeListener.register((function(e){if(t.data){var n=t.data.projects.filter((function(t){return t.id!==e.id})).concat(e);t.data=new $(t.data.notes,t.data.tasks,t.data.contexts,n,t.data.people),t.dataListener.trigger(t.data),t.startServerSync()}})),G.people.changeListener.register((function(e){if(t.data){var n=t.data.people.filter((function(t){return t.id!==e.id})).concat(e);t.data=new $(t.data.notes,t.data.tasks,t.data.contexts,t.data.projects,n),t.dataListener.trigger(t.data),t.startServerSync()}}))}return Object(y.a)(e,[{key:"registerSyncListener",value:function(e){this.syncListener.register(e)}},{key:"registerDataListener",value:function(e){this.dataListener.register(e)}},{key:"getResults",value:function(){return this.results}},{key:"getData",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data){e.next=4;break}return e.next=3,this.loadData();case 3:this.data=e.sent;case 4:return e.abrupt("return",this.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureServerSyncEnqueued",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.intervalHandle){e.next=2;break}return e.abrupt("return");case 2:this.intervalHandle=setInterval(Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startServerSync();case 2:case"end":return e.stop()}}),e)}))),6e4);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startServerSync",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status!==Se.Syncing){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ce();case 4:if(!e.sent){e.next=7;break}return e.next=7,this.runDropboxSync();case 7:return e.next=9,this.runBridgeSync();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runBridgeSync",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r,a,c,i,o,u,l,d,p,f,m,v,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e,t){var n,r=new Set(e),a=Object(S.a)(t);try{for(a.s();!(n=a.n()).done;){var c=n.value;r.delete(c)}}catch(i){a.e(i)}finally{a.f()}return r},De.hasBridge()){e.next=3;break}return e.abrupt("return");case 3:return t=new Date,e.prev=4,e.next=7,De.getSyncKeys();case 7:return r=e.sent,e.t0=Set,e.next=11,G.getSyncKeys();case 11:e.t1=e.sent,a=new e.t0(e.t1),c=n(a,new Set(r)),i=n(new Set(r),a),(c.size||i.size)&&(this.status=Se.Syncing,this.syncListener.trigger(this.status)),o=Object(S.a)(c),e.prev=17,o.s();case 19:if((u=o.n()).done){e.next=28;break}return l=u.value,e.next=23,G.exportServerEntities([l]);case 23:return d=e.sent,e.next=26,De.sendEntity(l,JSON.stringify(d[0]));case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t2=e.catch(17),o.e(e.t2);case 33:return e.prev=33,o.f(),e.finish(33);case 36:p=Object(S.a)(i),e.prev=37,p.s();case 39:if((f=p.n()).done){e.next=49;break}return m=f.value,e.next=43,De.getEntity(m);case 43:return v=e.sent,h=JSON.parse(v),e.next=47,G.importServerEntites([h]);case 47:e.next=39;break;case 49:e.next=54;break;case 51:e.prev=51,e.t3=e.catch(37),p.e(e.t3);case 54:return e.prev=54,p.f(),e.finish(54);case 57:this.results.push({type:"desktop",startAt:t,endAt:new Date,error:null,fetch:i.size,send:c.size}),this.status=Se.Idle,this.syncListener.trigger(this.status),e.next=67;break;case 62:e.prev=62,e.t4=e.catch(4),this.status=Se.Failed,this.results.push({type:"desktop",startAt:t,endAt:new Date,error:e.t4&&e.t4.message?e.t4.message:e.t4,fetch:0,send:0}),this.syncListener.trigger(this.status);case 67:case"end":return e.stop()}}),e,this,[[4,62],[17,30,33,36],[37,51,54,57]])})));return function(){return e.apply(this,arguments)}}()},{key:"runDropboxSync",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r,a,c,i,o,l,d,p,f,m,v,h,b,x;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e,t){var n,r=new Set(e),a=Object(S.a)(t);try{for(a.s();!(n=a.n()).done;){var c=n.value;r.delete(c)}}catch(i){a.e(i)}finally{a.f()}return r},t=new Date,e.prev=2,e.next=5,fe();case 5:return r=e.sent,e.t0=Set,e.next=9,G.getSyncKeys();case 9:e.t1=e.sent,a=new e.t0(e.t1),c=n(a,r),i=n(r,a),(c.size||i.size)&&(this.status=Se.Syncing,this.syncListener.trigger(this.status)),o=Object(S.a)(c),e.prev=15,o.s();case 17:if((l=o.n()).done){e.next=26;break}return d=l.value,e.next=21,G.exportServerEntities([d]);case 21:return p=e.sent,e.next=24,be(d,JSON.stringify(p[0]));case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t2=e.catch(15),o.e(e.t2);case 31:return e.prev=31,o.f(),e.finish(31);case 34:f=je()(10),m=[],v=Object(S.a)(i);try{for(b=function(){var e=h.value;m.push(f(Object(u.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ge(e);case 2:return n=t.sent,t.next=5,G.importServerEntites([n]);case 5:case"end":return t.stop()}}),t)})))))},v.s();!(h=v.n()).done;)b()}catch(g){v.e(g)}finally{v.f()}return e.next=40,Promise.all(m);case 40:if(!(i.size>0)){e.next=45;break}return e.next=43,this.loadData();case 43:x=e.sent,this.dataListener.trigger(x);case 45:this.results.push({type:"dropbox",startAt:t,endAt:new Date,error:null,fetch:i.size,send:c.size}),this.status=Se.Idle,this.syncListener.trigger(this.status),e.next=55;break;case 50:e.prev=50,e.t3=e.catch(2),this.status=Se.Failed,this.results.push({type:"dropbox",startAt:t,endAt:new Date,error:e.t3&&e.t3.message?e.t3.message:e.t3,fetch:0,send:0}),this.syncListener.trigger(this.status);case 55:case"end":return e.stop()}}),e,this,[[2,50],[15,28,31,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=G.contexts.getAll(),e.next=3,G.tasks.getAll();case 3:return n=e.sent,r=G.projects.getAll(),a=G.people.getAll(),e.t0=L,e.next=9,G.notes.getAll();case 9:return e.t1=e.sent,e.t2=function(e){return e.updatedAt},c=e.t0.orderBy.call(e.t0,e.t1,e.t2),e.t3=$,e.t4=c,e.next=16,n;case 16:return e.t5=e.sent,e.next=19,t;case 19:return e.t6=e.sent,e.next=22,r;case 22:return e.t7=e.sent,e.next=25,a;case 25:return e.t8=e.sent,e.abrupt("return",new e.t3(e.t4,e.t5,e.t6,e.t7,e.t8));case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}());function Te(){var e=r.useState(null),t=Object(b.a)(e,2),n=t[0],a=t[1];if(r.useEffect((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.serviceWorker.ready;case 2:t=e.sent,a(t.waiting),t.addEventListener("updatefound",(function(){var e;null===(e=t.installing)||void 0===e||e.addEventListener("statechange",(function(e){"installed"===e.target.state&&a(e.target)}))})),t.update();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}navigator.serviceWorker&&(!function(){e.apply(this,arguments)}(),setInterval(Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.serviceWorker.ready;case 2:e.sent.update();case 4:case"end":return e.stop()}}),e)}))),36e5))}),[]),!n)return null;return r.createElement("div",{className:"button",onClick:function(){navigator.serviceWorker&&(n.addEventListener("statechange",(function(e){"activated"===e.target.state&&window.location.reload()})),n.postMessage({type:"SKIP_WAITING"}))}},"Update")}var Le=Object(T.createInstance)({name:"theme"}),Pe=new F,Fe="dark-theme";function Re(){return(Re=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.getItem("theme");case 2:Fe=(Fe=e.sent)||"dark-theme",Pe.trigger(Fe);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){return Be.apply(this,arguments)}function Be(){return(Be=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Fe=t,e.next=3,Le.setItem("theme",Fe);case 3:Pe.trigger(Fe);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(e){return getComputedStyle(document.documentElement).getPropertyValue(e)}function Me(){return"dark-theme"===Fe}function Ye(){return window.matchMedia("(max-width: 768px)").matches}!function(){Re.apply(this,arguments)}();var Ve,We=function(e){var t=r.useState((function(){return!Ye()})),n=Object(b.a)(t,2),a=n[0],c=n[1],i=r.useState(0),o=Object(b.a)(i,2),s=o[0],u=o[1],l=r.useState(null),d=Object(b.a)(l,2),p=d[0],f=d[1];function m(){Ye()&&c(!1)}return r.useEffect((function(){Ae.registerSyncListener((function(){return u((function(e){return e+1}))}))}),[]),r.useEffect((function(){var e;e=function(e){document.documentElement.className=e,f(e)},Pe.register(e)}),[]),null==p?r.createElement(r.Fragment,null):r.createElement(r.Fragment,null,r.createElement("section",{style:{display:"flex",overflow:"hidden",height:"100%"},className:p},r.createElement(r.Fragment,{key:s}),r.createElement("div",{className:Object(j.b)("navbar")},r.createElement("div",{className:Object(j.b)(N("1rem"))},!a&&r.createElement(r.Fragment,null,r.createElement(x.b,{className:Object(j.b)("button","hover-glow"),to:"/",onClick:m,exact:!0,activeClassName:"is-active"},"Notes"),r.createElement(x.b,{className:Object(j.b)("button","hover-glow"),to:"/tasks",onClick:m,exact:!0,activeClassName:"is-active"},"Tasks"))),r.createElement("div",{className:Object(j.b)(N("1rem"))},Ae.status!==Se.Idle&&r.createElement(x.b,{className:"button",to:"/sync"},"Sync: ",Se[Ae.status]),r.createElement(Te,null),r.createElement(w,null),r.createElement("button",{className:"button",onClick:function(){return c(!a)}},"Menu"))),r.createElement("div",{className:Object(j.b)("sidebar","list"),style:{overflowY:"auto",paddingTop:52,height:"100%",width:a?void 0:0,overflowX:"hidden"}},r.createElement(x.b,{className:Object(j.b)("item","hover-glow"),to:"/",onClick:m,exact:!0,activeClassName:"is-active"},"Notes"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/notes/daily",onClick:m,exact:!0,activeClassName:"is-active"},"Daily Notes"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/tasks",onClick:m,exact:!0,activeClassName:"is-active"},"Tasks"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/projects",onClick:m,exact:!0,activeClassName:"is-active"},"Projects"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/contexts",onClick:m,exact:!0,activeClassName:"is-active"},"Contexts"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/people",onClick:m,exact:!0,activeClassName:"is-active"},"People"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/playground",onClick:m,exact:!0,activeClassName:"is-active"},"Playground"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/stats",onClick:m,exact:!0,activeClassName:"is-active"},"Stats"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/settings",onClick:m,exact:!0,activeClassName:"is-active"},"Settings"),r.createElement(x.b,{className:Object(j.b)("item",O),to:"/sync",onClick:m,exact:!0,activeClassName:"is-active"},"Sync Status")),r.createElement("div",{className:"main",style:{paddingTop:52}},e.children)))},He=function(e){var t=e.verticalAround;return void 0===t&&(t=!0),r.createElement("div",{className:Object(j.b)(N("8px",!0),C("8px",t))},e.children)};function Je(e){var t=L.groupBy(e.contexts,(function(e){return e.contextId})),n=L.countBy(e.tasks.filter((function(e){return"active"===e.state})),(function(e){return e.contextId}));return{topContexts:e.contexts.filter((function(e){return!e.contextId})),nestedContexts:t,taskCounts:n}}function ze(e,t){var n=Je(t);if(e){for(var r=[e],a=[e];a.length;){var c=a.pop();if(!c)break;var i,o=Object(S.a)(n.nestedContexts[c]||[]);try{for(o.s();!(i=o.n()).done;){var s=i.value;r.push(s.id),a.push(s.id)}}catch(u){o.e(u)}finally{o.f()}}return r}return t.contexts.map((function(e){return e.id}))}!function(e){e.Active="Active",e.Incubated="Incubated",e.Completed="Completed",e.Dropped="Dropped"}(Ve||(Ve={}));var _e,Ge=n(8),qe=n.n(Ge),$e=function(e,t){var n=r.useState((function(){return new URLSearchParams(window.location.search).get(t)||e})),a=Object(b.a)(n,2),c=a[0],i=a[1];return[c,function(n){var r=new URLSearchParams(window.location.search);i(n),n&&n!==e?r.set(t,n):r.delete(t);var a=r.toString();a.length?window.history.replaceState(null,"","?".concat(a)):window.history.replaceState(null,"",window.location.pathname),window.dispatchEvent(new window.CustomEvent("popstate"))}]},Xe=function(e,t,n,a){var c=r.useState((function(){var r=new URLSearchParams(window.location.search);return n(r.get(t))||e})),i=Object(b.a)(c,2),o=i[0],s=i[1];return[o,function(n){var r=new URLSearchParams(window.location.search);if(s(n),n&&n!==e){var c=a(n);c?r.set(t,c):r.delete(t)}else r.delete(t);var i=r.toString();i.length?window.history.replaceState(null,"","?".concat(i)):window.history.replaceState(null,"",window.location.pathname),window.dispatchEvent(new window.CustomEvent("popstate"))}]},Qe=function(e){var t=r.useState(!1),n=Object(b.a)(t,2),a=n[0],c=n[1],i=e.alwaysVisible?e.alwaysVisible():null;if(!Ye())return r.createElement("div",{style:Object(A.a)({display:"flex",alignItems:"center"},e.wideStyle),className:N(".3rem")},i,e.children);var o=e.mobileOnly?e.mobileOnly():null;return a?r.createElement("div",{style:{display:"flex",flexDirection:"column"},className:C(".3rem")},r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},i,r.createElement("div",{className:"button",onClick:function(){return c(!1)}},"S")),r.createElement("div",{className:Object(j.b)(C(".3rem"),e.className)},e.children)):r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},i,o,r.createElement("div",{className:"button",onClick:function(){return c(!0)}},"S"))},Ze=function(e){var t=Z().data;if(!e.contextId)return null;var n=t.contexts.find((function(t){return t.id===e.contextId}));return n?r.createElement("div",{className:"tag is-context"},n.title):null};!function(e){e.Active="Active",e.Inactive="Inactive"}(_e||(_e={}));var et=function(e){var t=Je(Z().data);return r.createElement("div",{style:{borderRight:"1px solid #666",width:200}},r.createElement("div",{className:"list"},r.createElement("div",{className:Object(j.b)("item",O,I),style:{paddingLeft:10,background:null===e.contextId?Ke("--active-context-background"):void 0},onClick:function(){return e.onChange(null)}},"All"),t.topContexts.map((function(n){return function t(n,a){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.state&&n.state===_e.Inactive?r.createElement(r.Fragment,{key:n.id}):r.createElement(r.Fragment,{key:n.id},r.createElement("div",{onClick:function(){return e.onChange(n.id)},style:{paddingLeft:10+10*c,background:e.contextId===n.id?Ke("--active-context-background"):void 0},className:Object(j.b)("item",O,I)},n.title," ",e.showTaskCount&&r.createElement("span",{style:{color:"#999"}},a.taskCounts[n.id])),a.nestedContexts[n.id]&&a.nestedContexts[n.id].map((function(e){return t(e,a,c+1)})))}(n,t)}))))},tt=[{id:"1",title:"All",groupedProject:!1,groupedContext:!1},{id:"2",title:"Grouped",groupedProject:!1,groupedContext:!0},{id:"3",title:"Grouped Project",groupedProject:!0,groupedContext:!1}],nt=tt[1],rt=function(e){var t=Z().data,n=r.useState(""),a=Object(b.a)(n,2),c=a[0],i=a[1],o=r.useState({showCompleted:!1,showDeferred:!1,showIncubated:!1,showContextBar:!Ye(),includeNested:!0}),l=Object(b.a)(o,2),d=l[0],p=l[1],f=$e(null,"context"),m=Object(b.a)(f,2),v=m[0],h=m[1],g=$e(null,"project"),y=Object(b.a)(g,2),k=y[0],E=y[1],w=$e("2","perspective"),I=Object(b.a)(w,2),N=I[0],C=I[1],D=function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return e.next=3,G.tasks.create({title:c,contextId:v,projectId:k,content:null,state:"active",stateChangedAt:(new Date).toISOString(),noteId:null});case 3:i("");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state="completed"===t.state?"active":"completed",t.stateChangedAt=(new Date).toISOString(),e.next=4,G.tasks.save(t);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),L=function(e){var n=t.projects.find((function(t){return t.id===e.projectId}));return n?r.createElement("div",{className:"tag is-info"},n.title):null},F=function(e){return e.deferredUntil&&new Date(e.deferredUntil)>new Date?r.createElement("div",{className:"tag is-primary",title:"".concat(qe()(e.deferredUntil).format("YYYY-MM-DD"))},"deferred ",qe()(e.deferredUntil).fromNow(!0)):null},R=function(e){return e.noteId?r.createElement("div",{className:"tag is-primary"},"N"):null},U=function(e){var t=/(https?:\/\/[^\s]+)/;return e.split(t).map((function(e,n){if(e.match(t)){var a=e.replace(/https?:\/\//,"");return a=a.replace(/\/.*/,"/..."),r.createElement("a",{key:n,href:e,onClick:function(e){e.stopPropagation()},target:"_blank",rel:"noopener noreferrer",className:"button is-small is-link",style:{display:"inline-block",marginLeft:"5px",marginRight:"5px"}},a)}return r.createElement("span",{key:n},e)}))},B=function(e,n){var r=t.tasks;if(r=e?r.filter((function(e){return"completed"===e.state})):r.filter((function(e){return"completed"!==e.state})),k&&(r=r.filter((function(e){return e.projectId===k}))),d.showDeferred||(r=r.filter((function(e){return null==e.deferredUntil||new Date(e.deferredUntil)<new Date}))),!d.showIncubated){r=r.filter((function(e){return"incubated"!==e.state}));var a=t.projects.filter((function(e){return e.state===Ve.Incubated})).map((function(e){return e.id}));r=r.filter((function(e){return!e.projectId||-1===a.indexOf(e.projectId)}))}if(v){var c=ze(v,t);r=r.filter((function(e){return e.contextId&&-1!==c.indexOf(e.contextId)}))}return r.sort((function(e,t){return t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:0}))},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(window.location.search.length){var a=new URLSearchParams(window.location.search);n="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(a.toString())))}return r.createElement(x.b,{key:e.id,to:"/tasks/".concat(e.id).concat(n||""),className:Object(j.b)("item","task",O)},r.createElement("div",{className:"task-checkbox"},r.createElement("input",{type:"checkbox",style:{display:"block",padding:10},checked:"completed"===e.state,onClick:function(e){return e.preventDefault()},onChange:function(t){return T(e,t)}})),r.createElement("div",{className:"task-title",style:{color:"incubated"===e.state?"#999":void 0}},"completed"===e.state?r.createElement("span",{style:{textDecoration:"line-through"}},U(e.title)):U(e.title),"incubated"===e.state?r.createElement("span",null," [Incubated]"):null),r.createElement("div",{className:"task-details"},r.createElement("div",{className:"tags"},R(e),F(e),!t&&r.createElement(Ze,{contextId:e.contextId}),!t&&L(e))))},M=tt.find((function(e){return e.id===N}))||nt,Y=(Je(t),[]);if(M.groupedContext)!function(){var e=ze(v,t);v||e.push(null);var n,a=Object(S.a)(e);try{var c=function(){var a=n.value,c=t.contexts.find((function(e){return e.id===a})),i=B(!1);if(a){if(!c)return"continue";if(!(i=i.filter((function(e){return e.contextId===a}))).length)return"continue";Y.push(r.createElement("div",{key:a,style:{display:"flex",justifyContent:"space-between",padding:".6rem",background:Ke("--task-context-background"),cursor:"pointer"},onClick:function(){return h(c.id)}},c.title,r.createElement(x.b,{className:"button small",to:"/contexts/".concat(c.id)},"Edit")))}else{if(!(i=i.filter((function(e){return e.contextId===a}))).length)return"continue";Y.push(r.createElement("div",{key:"no-context",style:{padding:".6rem",background:Ke("--task-context-background")}},"No Context"))}var o=[Ve.Active,Ve.Incubated,Ve.Completed,Ve.Dropped],s=[],u=t.projects;null!==k&&(u=u.filter((function(e){return e.id===k}))),u.sort((function(e,t){return o.indexOf(e.state)-o.indexOf(t.state)})).forEach((function(t){var n=i.filter((function(e){return e.projectId===t.id}));n.length?Y.push(r.createElement(r.Fragment,{key:"p-".concat(t.id)},r.createElement("div",{className:"header link",onClick:function(){E(t.id),h(t.contextId)},style:{background:Ke("--task-project-background")}},t.title," ",t.state!==Ve.Active?"[".concat(t.state,"]"):"",r.createElement("div",{style:{display:"flex"}},r.createElement(x.b,{className:"button small",to:"/projects/".concat(t.id)},"Edit"))),n.map((function(e){return K(e,!0)})))):t.state===Ve.Active&&(a?t.contextId&&-1!==e.indexOf(t.contextId)&&s.push(t):s.push(t))}));var l=i.filter((function(e){return null===e.projectId}));l.length&&Y.push(r.createElement(r.Fragment,{key:"no-p-".concat(a)},r.createElement("div",{className:"header",style:{background:Ke("--task-project-background")}},"No Project"),l.map((function(e){return K(e,!0)}))));for(var d=function(){var e=f[p];if(e.contextId!==a)return"continue";Y.push(r.createElement("div",{key:e.id,className:"header link",style:{background:Ke("--task-project-background")},onClick:function(){E(e.id),h(e.contextId)}},e.title," ",e.state!==Ve.Active?"[".concat(e.state,"]"):""," [Empty]",r.createElement("div",{style:{display:"flex"}},r.createElement("div",{className:"tags"},r.createElement(Ze,{contextId:e.contextId})),r.createElement(x.b,{className:"button small",to:"/projects/".concat(e.id)},"Edit"))))},p=0,f=s;p<f.length;p++)d()};for(a.s();!(n=a.n()).done;)c()}catch(i){a.e(i)}finally{a.f()}d.showCompleted&&Y.push(r.createElement(r.Fragment,{key:"completed"},r.createElement("div",{className:"header"},"Completed"),P.a.orderBy(B(!0),(function(e){return e.stateChangedAt}),"desc").map((function(e){return K(e)}))))}();else if(M.groupedProject){var V=B(!1),W=[Ve.Active,Ve.Incubated,Ve.Completed,Ve.Dropped],H=[],J=t.projects;null!==k&&(J=J.filter((function(e){return e.id===k})));var z=ze(v,t);J.sort((function(e,t){return W.indexOf(e.state)-W.indexOf(t.state)})).forEach((function(e){var t=V.filter((function(t){return t.projectId===e.id}));t.length?Y.push(r.createElement(r.Fragment,{key:"p-".concat(e.id)},r.createElement("div",{className:"header link",onClick:function(){E(e.id),h(e.contextId)}},e.title," ",e.state!==Ve.Active?"[".concat(e.state,"]"):"",r.createElement("div",{style:{display:"flex"}},r.createElement("div",{className:"tags"},r.createElement(Ze,{contextId:e.contextId})),r.createElement(x.b,{className:"button small",to:"/projects/".concat(e.id)},"Edit"))),t.map((function(e){return K(e)})))):e.state===Ve.Active&&(v?e.contextId&&-1!==z.indexOf(e.contextId)&&H.push(e):H.push(e))}));var _=V.filter((function(e){return null===e.projectId}));_.length&&Y.push(r.createElement(r.Fragment,{key:"no-p"},r.createElement("div",{className:"header"},"No Project"),_.map((function(e){return K(e)}))));for(var q=function(){var e=X[$];Y.push(r.createElement(r.Fragment,{key:"p-".concat(e.id)},r.createElement("div",{className:"header link",onClick:function(){E(e.id),h(e.contextId)}},e.title," ",e.state!==Ve.Active?"[".concat(e.state,"]"):""," [Empty]",r.createElement("div",{style:{display:"flex"}},r.createElement("div",{className:"tags"},r.createElement(Ze,{contextId:e.contextId})),r.createElement(x.b,{className:"button small",to:"/projects/".concat(e.id)},"Edit")))))},$=0,X=H;$<X.length;$++)q();d.showCompleted&&Y.push(r.createElement(r.Fragment,{key:"completed"},r.createElement("div",{className:"header"},"Completed"),B(!0).map((function(e){return K(e)}))))}else Y.push(r.createElement(r.Fragment,{key:"tasks"},B(!1).map((function(e){return K(e)})),d.showCompleted&&r.createElement(r.Fragment,null,r.createElement("div",{className:"header"},"Completed"),B(!0).map((function(e){return K(e)})))));return r.createElement("div",{style:{display:"flex",height:"100%"}},d.showContextBar&&r.createElement(et,{contextId:v,onChange:h,showTaskCount:!0}),r.createElement("div",{style:{width:"100%"}},r.createElement(He,null,r.createElement(Qe,{alwaysVisible:function(){return r.createElement("div",{className:"button",onClick:function(){h(null),E(null)}},"R")},mobileOnly:function(){return r.createElement("div",{className:"button",style:{marginLeft:"auto",marginRight:8},onClick:function(){return p(Object(A.a)({},d,{showContextBar:!d.showContextBar}))}},"C")}},r.createElement("select",{style:{padding:"0.3rem",display:"block"},value:v||"",onChange:function(e){return h(""===e.target.value?null:e.target.value)}},r.createElement("option",{value:""},"All contexts"),t.contexts.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("select",{style:{padding:"0.3rem",display:"block"},value:k||"",onChange:function(e){return E(""===e.target.value?null:e.target.value)}},r.createElement("option",{value:""},"All projects"),t.projects.filter((function(e){return e.state===Ve.Active})).map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("select",{style:{padding:"0.3rem",display:"block"},value:N||"",onChange:function(e){return C(""===e.target.value?null:e.target.value)}},r.createElement("option",{value:""},"Select Perspective"),tt.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,r.createElement("input",{id:"completed-box",type:"checkbox",checked:d.showCompleted,onChange:function(){return p(Object(A.a)({},d,{showCompleted:!d.showCompleted}))}}),r.createElement("label",{htmlFor:"completed-box"},"Show completed")),r.createElement("div",null,r.createElement("input",{id:"deferred-box",type:"checkbox",checked:d.showDeferred,onChange:function(){return p(Object(A.a)({},d,{showDeferred:!d.showDeferred}))}}),r.createElement("label",{htmlFor:"deferred-box"},"Show deferred")),r.createElement("div",null,r.createElement("input",{id:"incubated-box",type:"checkbox",checked:d.showIncubated,onChange:function(){return p(Object(A.a)({},d,{showIncubated:!d.showIncubated}))}}),r.createElement("label",{htmlFor:"incubated-box"},"Show incubated")),r.createElement("div",null,r.createElement("input",{id:"context-box",type:"checkbox",checked:d.showContextBar,onChange:function(){return p(Object(A.a)({},d,{showContextBar:!d.showContextBar}))}}),r.createElement("label",{htmlFor:"context-box"},"Show context bar")),r.createElement("div",null,r.createElement("input",{id:"include-nested-box",type:"checkbox",checked:d.includeNested,onChange:function(){return p(Object(A.a)({},d,{includeNested:!d.includeNested}))}}),r.createElement("label",{htmlFor:"include-nested-box"},"Include nested contexts"))),r.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add task...",value:c,onChange:function(e){return i(e.target.value)},onKeyPress:D})),r.createElement("div",{className:"list"},Y)))},at=n(48),ct=n.n(at);n(64);function it(e){if(e.dailyDate)return"Daily - ".concat(qe()(e.dailyDate).format("MMMM Do, YYYY"));if(e.title&&e.title.length)return e.title;var t=/# (.+)/.exec(e.content);return t&&t.length>1?t[1]:""}function ot(e){if(e.dailyDate)return"daily";if(e.title&&e.title.length)return"title";var t=/# (.+)/.exec(e.content);return t&&t.length>1?"parsed":"none"}var st=/\[\[([^\]]+)\]\]/gi;function ut(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function lt(e){return new RegExp("\\[\\[".concat(ut(e),"\\]\\]"),"i")}function dt(e){return new RegExp("\\B@".concat(ut(e)),"i")}function pt(e){if(!e)return[];var t,n=[],r=Object(S.a)(e.matchAll(/\[\[([^\]]+)\]\]/gi));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a[1])}}catch(c){r.e(c)}finally{r.f()}return n}function ft(e){var t={};function n(e,t){return"".concat(t,"-").concat(e.toLowerCase())}var r,a=new Set(e.filter((function(e){return e.title})).map((function(e){return n(e.title,e.contextId)}))),c=Object(S.a)(e);try{for(c.s();!(r=c.n()).done;){var i,o=r.value,s=pt(o.content),u=Object(S.a)(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,d=n(l,o.contextId);if(!a.has(d)){var p=t[d];p&&p.updatedAt>new Date(o.updatedAt)||(t[d]={title:l,contextId:o.contextId,updatedAt:new Date(o.updatedAt)})}}}catch(f){u.e(f)}finally{u.f()}}}catch(f){c.e(f)}finally{c.f()}return Object.values(t)}var mt=/\B(@[^\s()[\].,!:]+)/g;function vt(e){return"".concat(e.alias||((t=e.name)?t.toLowerCase().replace(/ /g,"_"):null));var t}var ht,bt=function(e){var t=Object(h.g)(),n=Z().data;window.lifeNavigate=function(e){return t.push(e),!1};var a=e.markdown.replace(st,(function(t,r){var a=e.contextId,c=r,i=n.contexts.find((function(e){return(t=e.title,new RegExp("^".concat(ut(t),"/"),"i")).test(r);var t}));i&&(c=c.substring(i.title.length+1),a=i.id);var o=new RegExp("^".concat(ut(c),"$"),"i"),s=n.notes.find((function(e){return e.contextId===a&&o.test(e.title)}));if(s){var u="/notes/".concat(s.id);return'<span style="color: #444">[[ </span><a onclick="return lifeNavigate(\''.concat(u,'\')" href="').concat(u,'">').concat(r,'</a><span style="color: #444"> ]]</span>')}var l="/notes/virtual?title=".concat(encodeURIComponent(r)).concat(e.contextId?"&context=".concat(e.contextId):"","&source=").concat(encodeURIComponent("".concat(window.location.pathname)));return'<span style="color: #444">[[ </span><a onclick="return lifeNavigate(\''.concat(l,'\')" href="').concat(l,'">').concat(r,'</a><span style="color: #444"> ? ]]</span>')}));a=a.replace(mt,(function(e,t){var r=n.people.find((function(e){return"@".concat(vt(e))===t}));if(r){var a="/people/".concat(r.id,"?source=").concat(encodeURIComponent("".concat(window.location.pathname)));return"<a onclick=\"return lifeNavigate('".concat(a,'\')" href="').concat(a,'" style="background: #333; padding: 0px 4px; border-radius: 4px">').concat(r.name,"</a>")}var c="/people/virtual?alias=".concat(encodeURIComponent(t),"&source=").concat(encodeURIComponent("".concat(window.location.pathname)));return"<a onclick=\"return lifeNavigate('".concat(c,'\')" href="').concat(c,'" style="background: #333; padding: 0px 4px; border-radius: 4px">').concat(t,'</a><span style="color: #444"> ?</span>')}));var c=ct()(a);return r.createElement("div",{className:"marked-viewer note markdown-body",dangerouslySetInnerHTML:{__html:c}})},xt=n(27),gt=n.n(xt),yt=n(21);n(30),n(31),n(43);!function(e){e[e.Split=0]="Split",e[e.Editor=1]="Editor",e[e.Preview=2]="Preview"}(ht||(ht={}));var kt=function(e){return r.createElement("div",{className:Object(j.b)(N(".5rem"))},r.createElement("button",{className:"button",style:{background:e.mode&&"markdown"===e.mode?void 0:"#444"},onClick:function(){return e.onModeChange("markdown")}},"Markdown"),r.createElement("button",{className:"button",style:{background:"tree"!==e.mode?"#444":void 0},onClick:function(){return e.onModeChange("tree")}},"Tree"))},Et=function(e){return r.createElement("div",{className:Object(j.b)(N(".5rem"))},r.createElement("button",{className:"button",style:{background:e.mode!==ht.Split?"#444":void 0},onClick:function(){return e.onModeChange(ht.Split)}},"Split"),r.createElement("button",{className:"button",style:{background:e.mode!==ht.Editor?"#444":void 0},onClick:function(){return e.onModeChange(ht.Editor)}},"Editor"),r.createElement("button",{className:"button",style:{background:e.mode!==ht.Preview?"#444":void 0},onClick:function(){return e.onModeChange(ht.Preview)}},"Preview"))},wt=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this,t={};this.props.expand&&(t.width="100%",t.height="100%",t.zIndex=100,t.display="flex",t.maxHeight="100%");var n="1px solid #666",a=[],c={flexGrow:1,minWidth:"50%",borderTop:n,height:"100%"},i={flexGrow:1,minWidth:"50%",background:"transparent",padding:"1rem",borderTop:n};return this.props.mode===ht.Split&&(c.borderRight=n,i.overflowY="scroll"),this.props.mode!==ht.Editor&&this.props.mode!==ht.Split||a.push(r.createElement(gt.a,{key:"editor",value:this.props.text,fontSize:18,style:c,onChange:function(t){return e.props.onTextChanged(t)},mode:"markdown",theme:Me()?"monokai":"textmate",showGutter:!1,showPrintMargin:!1,wrapEnabled:!0,enableBasicAutocompletion:[yt.snippetCompleter,yt.textCompleter,yt.keyWordCompleter],enableLiveAutocompletion:!0,enableSnippets:!0})),this.props.mode!==ht.Preview&&this.props.mode!==ht.Split||a.push(r.createElement("div",{key:"2",style:i},r.createElement(bt,{markdown:this.props.text,contextId:this.props.contextId}))),r.createElement("div",{style:t},a)}}]),n}(r.Component),jt=n(49),Ot=n.n(jt),It=function(e){var t=Z().data,n=Object(r.useState)((function(){if(!e.text||""===e.text)return!1;try{return JSON.parse(e.text),!1}catch(t){return!0}})),a=Object(b.a)(n,1)[0],c=Object(r.useState)(!1),i=Object(b.a)(c,2),o=i[0],s=i[1],u=Object(r.useState)([]),l=Object(b.a)(u,2),d=l[0],p=l[1],f=Object(r.useState)((function(){return a?[]:e.text&&""!==e.text?JSON.parse(e.text):[{text:"",nodes:[]}]})),m=Object(b.a)(f,2),v=m[0],h=m[1],x=Object(r.useRef)(null),g=Object(r.useState)(v[0]),y=Object(b.a)(g,2),k=y[0],E=y[1],w=r.useState(),I=Object(b.a)(w,2),C=I[0],A=I[1];r.useEffect((function(){var e=t.notes.map((function(e){var n,r=pt(e.content);e.title&&e.title.length&&r.push(e.title);var a=(null===(n=t.contexts.find((function(t){return t.id===e.contextId})))||void 0===n?void 0:n.title)||null;return r.map((function(e){return{title:e,context:a}}))})).flat().filter((function(e){return null!==e.title}));A(e)}),[e.contextId,t.contexts,t.notes]);var T=r.useState(),L=Object(b.a)(T,2),P=L[0],F=L[1];if(r.useEffect((function(){var e=t.people.map((function(e){return vt(e)})).filter((function(e){return null!==e}));F(e)}),[t.people]),a)return r.createElement("div",null,"Invalid tree content (not valid JSON).");if(!C||!P)return r.createElement(q,null);var R=function(t,n){t.text=n,h(Object(D.a)(v)),e.onTextChanged(JSON.stringify(v))},U=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=Object(S.a)(r);try{for(c.s();!(n=c.n()).done;){var i=n.value;if(i===t)return a;var o=e(t,i.nodes,i);if(o)return o}}catch(s){c.e(s)}finally{c.f()}return null},B=function(){for(var e=[],t=Object(D.a)(v).reverse();t.length;){var n=t.pop();if(!n)return e;e.push(n);var r,a=Object(S.a)(Object(D.a)(n.nodes).reverse());try{for(a.s();!(r=a.n()).done;){var c=r.value;t.push(c)}}catch(i){a.e(i)}finally{a.f()}}return e};var K=function(e){e.text.length||e.nodes.length||function(e){var t=U(e),n=t?t.nodes:v,r=n.findIndex((function(t){return t===e}));n.splice(r,1),h(Object(D.a)(v))}(e)},M=function(e){var t=U(e),n=t?t.nodes:v,r=n.findIndex((function(t){return t===e}));0!==r&&(n.splice(r,1),n[r-1].nodes.push(e),h(Object(D.a)(v)))},Y=function(e){var t=U(e);if(null!==t){var n=U(t),r=n?n.nodes:v,a=r.findIndex((function(e){return e===t}));r.splice(a+1,0,e);var c=t.nodes.findIndex((function(t){return t===e}));t.nodes.splice(c,1),h(Object(D.a)(v))}},V=[{name:"indent",bindKey:{win:"tab",mac:"tab"},exec:function(){return setTimeout((function(){M(k)}),0),!0}},{name:"unindent",bindKey:{win:"shift+tab",mac:"shift+tab"},exec:function(){return setTimeout((function(){Y(k)}),0),!0}},{name:"enter",bindKey:{win:"enter",mac:"enter"},exec:function(){if(""!==k.text){var e=x.current&&0===x.current.editor.getCursorPosition().row&&0===x.current.editor.getCursorPosition().column;return setTimeout((function(){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=U(e),r=n?n.nodes:v,a=r.findIndex((function(t){return t===e})),c={text:"",nodes:[]};return r.splice(a+(t?0:1),0,c),h(Object(D.a)(v)),c}(k,!!e);E(t)}),0),!0}}},{name:"up",bindKey:{win:"up",mac:"up"},exec:function(){if(!(x.current&&0===x.current.editor.getCursorPosition().row))return!1;var e=B(),t=e.findIndex((function(e){return e===k}));return t=Math.max(0,t-1),setTimeout((function(){E(e[t]),K(k)}),0),!0}},{name:"down",bindKey:{win:"down",mac:"down"},exec:function(){if(!(x.current&&x.current.editor.getCursorPosition().row+1===x.current.editor.getSession().doc.getLength()))return!1;var e=B(),t=e.findIndex((function(e){return e===k}));return t=Math.min(e.length-1,t+1),setTimeout((function(){E(e[t]),K(k)}),0),!0}},{name:"space",bindKey:{win:"space",mac:"space"},exec:function(){return!(!x.current||0!==x.current.editor.getCursorPosition().row||0!==x.current.editor.getCursorPosition().column)&&(setTimeout((function(){M(k)}),0),!0)}},{name:"backspace",bindKey:{win:"backspace",mac:"backspace"},exec:function(){return!(!x.current||0!==x.current.editor.getCursorPosition().row||0!==x.current.editor.getCursorPosition().column)&&(setTimeout((function(){Y(k)}),0),!0)}}],W={getCompletions:function(e,t,n,r,a){var c=t.getTokenAt(n.row,n.column);if(c)if(i("[["))a(null,C.map((function(e){return{caption:e.title,snippet:e.title,meta:e.context||"note"}})));else if(i("@")){a(null,P.map((function(e){return{caption:e,snippet:e,meta:"person"}})))}function i(e){return c.value.substring(n.column-r.length-e.length).startsWith(e)}}};function H(e){d.includes(e)?p(d.filter((function(t){return t!==e}))):p(d.concat(e))}var J=function t(n,a,c,i){var s=n===k,u=i.includes(n);return r.createElement(r.Fragment,{key:"".concat(c,"-").concat(a)},r.createElement("div",{style:{display:"flex",background:u?"#003838":!o&&s?Ke("--active-tree-editor-background"):void 0,padding:".6rem .8rem"},className:O,onClick:function(){return function(e){o?H(e):e!==k&&E(e)}(n)}},o&&r.createElement("div",{style:{lineHeight:1.5,marginRight:8}},r.createElement("input",{type:"checkbox",checked:u,onChange:function(){return H(n)}})),!o&&r.createElement("div",{style:{letterSpacing:".5rem",color:s?"#078263":"#777",lineHeight:1.5}},"\u2022"),!o&&s?r.createElement(gt.a,{key:"editor",ref:x,value:n.text,fontSize:16,style:{background:"transparent",width:"100%",lineHeight:1.5,marginLeft:-4},onChange:function(e){return R(n,e)},mode:"markdown",theme:Me()?"monokai":"textmate",focus:!0,highlightActiveLine:!1,showGutter:!1,showPrintMargin:!1,wrapEnabled:!0,maxLines:1/0,commands:V,enableBasicAutocompletion:[W,yt.snippetCompleter,yt.textCompleter,yt.keyWordCompleter],enableLiveAutocompletion:!0,enableSnippets:!0}):r.createElement(bt,{markdown:n.text,contextId:e.contextId})),r.createElement("div",{style:{borderLeft:"1px solid #555",marginLeft:16,paddingLeft:16}},n.nodes.map((function(e,n){return t(e,n,c+1,i)}))))};return r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",background:"#444",position:"fixed",height:36,bottom:0,left:0,right:0},className:Object(j.b)(N(".5rem"))},r.createElement("div",{className:"button",onClick:function(){o?(s(!1),p([])):s(!0)}},"Select"),o?r.createElement(r.Fragment,null,r.createElement("div",{className:"button",onClick:function(){return p(B())}},"All"),r.createElement("div",{className:"button",onClick:function(){var e="";!function(e){for(var t=v.map((function(e,t){return{node:e,depth:0,index:t}})).reverse(),n=function(){var n=t.pop();if(!n)return{v:void 0};e(n.node,n.depth,n.index);var r,a=n.depth,c=Object(S.a)(n.node.nodes.map((function(e,t){return{node:e,depth:a+1,index:t}})).reverse());try{for(c.s();!(r=c.n()).done;){var i=r.value;t.push(i)}}catch(o){c.e(o)}finally{c.f()}};t.length;){var r=n();if("object"===typeof r)return r.v}}((function(t,n,r){d.includes(t)&&(console.log(t,n),e+="".concat("  ".repeat(n),"- ").concat(t.text,"\n"))})),Ot()(e)}},"Copy")):r.createElement(r.Fragment,null,r.createElement("div",{className:"button",onClick:function(e){Y(k),x.current&&x.current.editor.focus()}},"\u2190"),r.createElement("div",{className:"button",onClick:function(e){M(k),x.current&&x.current.editor.focus()}},"\u2192"),r.createElement("div",{className:"button",onClick:function(e){x.current&&(x.current.editor.session.insert(x.current.editor.getCursorPosition(),"[["),x.current.editor.focus())}},"[["),r.createElement("div",{className:"button",onClick:function(e){x.current&&(x.current.editor.session.insert(x.current.editor.getCursorPosition(),"]]"),x.current.editor.focus())}},"]]"))),r.createElement("div",{style:{height:"100%",marginBottom:36}},v.map((function(e,t){return J(e,t,0,d)}))))},Nt=(n(71),function(e){var t=P.a.orderBy(e.data.contexts.filter((function(e){return e.state===_e.Active})),(function(e){return e.title})),n=P.a.orderBy(e.data.contexts.filter((function(e){return e.state!==_e.Active})),(function(e){return e.title}));return r.createElement("select",{className:"input is-large",value:e.contextId||"",onChange:function(t){return e.onChange(t.target.value)}},r.createElement("option",{value:""},"Not set"),t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)})),r.createElement("option",{value:"--inactive--",disabled:!0},"-- Inactive"),n.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)})))});function Ct(e){var t=r.useState(!1),n=Object(b.a)(t,2),a=n[0],c=n[1],i=r.useState(new St(e.availableTags,e.tags&&e.tags.length>0?e.tags.split(" "):[])),o=Object(b.a)(i,2),s=o[0],u=o[1],l=r.useRef(void 0),d=r.useRef();function p(e){f(s.withText(e.target.value))}function f(t){u(t),e.onChange(t.getTags())}return r.createElement("div",{className:"tag-input",onFocus:function(){return clearTimeout(l.current),void(a||c(!0))},onBlur:function(){a&&(l.current=setTimeout((function(){c(!1)}),100))}},r.createElement("div",{className:"tags"},s.selectedTags.map((function(e,t){return r.createElement(Dt,{key:"tag-".concat(e,"-").concat(t),name:e})})),r.createElement("input",{ref:d,placeholder:"Tag",type:"text",className:"",onChange:function(e){return p(e)},onKeyDown:function(e){return function(e){"ArrowUp"===e.key?f(s.decrementIndex()):"ArrowDown"===e.key?f(s.incrementIndex()):"Enter"===e.key?""===s.text?f(s.addSelectedTag()):f(s.addText()):"Tab"===e.key?(f(s.addSelectedTag()),e.preventDefault()):"Backspace"===e.key&&""===s.text&&f(s.reopenLastTag())}(e)},value:s.text})),a&&s.getFilteredAvailableTags().length>0&&r.createElement("div",{className:"panel"},s.getFilteredAvailableTags().slice(0,10).map((function(e,t){return r.createElement("div",{key:"available-tag-".concat(e),style:s.index===t?{background:"#078263"}:{},onClick:function(){return t=e,f(s.addTag(t)),void d.current.focus();var t}},e)}))))}var St=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(g.a)(this,e),this.availableTags=void 0,this.selectedTags=void 0,this.text=void 0,this.index=void 0,this.availableTags=t,this.selectedTags=n,this.text=r,this.index=a}return Object(y.a)(e,[{key:"withText",value:function(t){return new e(this.availableTags,this.selectedTags,t,this.index)}},{key:"withAvailableTags",value:function(t){return new e(t,this.selectedTags,this.text,this.index)}},{key:"withSelectedTags",value:function(t){return new e(this.availableTags,t,this.text,this.index)}},{key:"decrementIndex",value:function(){return new e(this.availableTags,this.selectedTags,this.text,Math.max(0,this.index-1))}},{key:"incrementIndex",value:function(){return new e(this.availableTags,this.selectedTags,this.text,Math.max(0,Math.min(this.availableTags.length-1,this.index+1)))}},{key:"addSelectedTag",value:function(){return new e(this.availableTags,this.selectedTags.concat([this.getFilteredAvailableTags()[this.index]]),"",0)}},{key:"addTag",value:function(t){return new e(this.availableTags,this.selectedTags.concat([t]),"",0)}},{key:"addText",value:function(){return new e(this.availableTags,this.selectedTags.concat([this.text]),"",0)}},{key:"reopenLastTag",value:function(){var t=this.selectedTags[this.selectedTags.length-1];return new e(this.availableTags,this.selectedTags.slice(0,this.selectedTags.length-1),t,0)}},{key:"getFilteredAvailableTags",value:function(){var e=this;return this.availableTags.filter((function(t){return-1===e.selectedTags.indexOf(t)})).filter((function(t){return-1!==t.toLowerCase().indexOf(e.text)}))}},{key:"getTags",value:function(){return this.selectedTags.join(" ")}}]),e}(),Dt=function(e){return r.createElement("div",{className:"tag is-dark"},e.name)},At=function(e){return r.createElement("div",{className:"tags",style:{marginBottom:0}},e.tags&&e.tags.split(" ").map((function(e,t){return r.createElement(Dt,{key:t,name:e})})))};function Tt(e){var t=r.useState(Ye()?ht.Editor:ht.Split),n=Object(b.a)(t,2),a=n[0],c=n[1];return r.createElement("div",{style:{width:"100%",flex:1,display:"flex",flexDirection:"column"}},r.createElement(He,{verticalAround:!1},r.createElement(Qe,{wideStyle:{justifyContent:"space-between"},alwaysVisible:function(){return r.createElement(r.Fragment,null,r.createElement(Nt,{contextId:e.note.contextId,data:e.data,onChange:function(t){return e.updateNote({contextId:t})}}),r.createElement("input",{type:"date",className:"input is-large",value:e.note.dailyDate&&qe()(e.note.dailyDate).format("YYYY-MM-DD")||"",onChange:function(t){var n;""===(n=t.target.value)?e.updateNote({dailyDate:null}):e.updateNote({dailyDate:new Date(n).toISOString()})}}))}},r.createElement(kt,{mode:e.note.mode||"tree",onModeChange:function(t){return e.updateNote({mode:t})}}),r.createElement(Et,{mode:a,onModeChange:function(e){return c(e)}}))),r.createElement(He,null,!e.note.noteFor&&!e.note.dailyDate&&r.createElement(r.Fragment,null,r.createElement("input",{type:"text",placeholder:"Title",className:"input is-large is-wide",value:e.note.title,onChange:function(t){return e.updateNote({title:t.target.value})}}),r.createElement(Ct,{availableTags:e.availableTags,tags:e.note.tags,onChange:function(t){return e.updateNote({tags:t})}})),e.note.dailyDate&&r.createElement("h1",null,it({dailyDate:e.note.dailyDate,title:e.note.title,content:e.note.content}))),r.createElement("div",{style:{flex:1}},"markdown"===e.note.mode?r.createElement(wt,{text:e.note.content,expand:!0,onTextChanged:function(t){return e.updateNote({content:t})},mode:a,data:e.data,contextId:e.note.contextId}):r.createElement(It,{text:e.note.content,onTextChanged:function(t){return e.updateNote({content:t})},contextId:e.note.contextId})))}var Lt=!1;function Pt(){Lt||(In.listen(Kt),Lt=!0)}var Ft=Object(T.createInstance)({name:"staging-note"});function Rt(){return(Rt=Object(u.a)(s.a.mark((function e(){var t,n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=S.a,e.next=3,Ft.keys();case 3:e.t1=e.sent,t=(0,e.t0)(e.t1),e.prev=5,t.s();case 7:if((n=t.n()).done){e.next=18;break}return r=n.value,e.next=11,Ft.getItem(r);case 11:return a=e.sent,e.next=14,G.notes.save(a);case 14:return e.next=16,Ft.removeItem(a.id);case 16:e.next=7;break;case 18:e.next=23;break;case 20:e.prev=20,e.t2=e.catch(5),t.e(e.t2);case 23:return e.prev=23,t.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[5,20,23,26]])})))).apply(this,arguments)}!function(){Rt.apply(this,arguments)}();var Ut=null,Bt=null;function Kt(e,t){return Mt.apply(this,arguments)}function Mt(){return(Mt=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Bt){e.next=2;break}return e.abrupt("return");case 2:if(Ut!==t.pathname){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,G.notes.save(Bt);case 6:return e.next=8,Ft.removeItem(Bt.id);case 8:Bt=null;case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(){return(Yt=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Pt(),!n){e.next=8;break}return Bt=t,Ut=window.location.pathname,e.next=6,Ft.setItem(t.id,t);case 6:e.next=12;break;case 8:return Bt=null,Ut=null,e.next=12,Ft.removeItem(t.id);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vt(e){var t=r.useState(e),n=Object(b.a)(t,1)[0],a=r.useState(Object(A.a)({},e)),c=Object(b.a)(a,2),i=c[0],o=c[1],s=r.useState(!1),u=Object(b.a)(s,2),l=u[0],d=u[1];return[i,function(e){var t=Object(A.a)({},i,{},e),r=JSON.stringify(n)!==JSON.stringify(t);d(r),o(t),function(e,t){Yt.apply(this,arguments)}(t,r)},l]}var Wt=function(e){var t=Z().data,n={},a=r.useState(!1),c=Object(b.a)(a,2),i=c[0],o=c[1],s=$e(null,"source"),u=Object(b.a)(s,1)[0],l=new URLSearchParams(window.location.search),d=l.get("title"),p=l.get("context"),f=l.has("daily"),m=Vt(t.notes.find((function(t){return t.id===e.id}))||G.notes.createUnsaved({title:d||"",content:"",mode:"tree",contextId:p,dailyDate:f&&qe()().format("YYYY-MM-DD")||null,noteFor:null,tags:""})),v=Object(b.a)(m,2),g=v[0],y=v[1];if(i)return r.createElement(h.a,{to:u?decodeURIComponent(u):"/"});var k,E=Object(S.a)(t.notes||[]);try{for(E.s();!(k=E.n()).done;){var w=k.value;if(w.tags&&w.tags.length){var O,I=Object(S.a)(w.tags.split(" "));try{for(I.s();!(O=I.n()).done;){var C=O.value;n[C]||(n[C]=0),n[C]+=1}}catch(A){I.e(A)}finally{I.f()}}}}catch(A){E.e(A)}finally{E.f()}var D=Object.keys(n).sort((function(e,t){return n[t]-n[e]}));return e.id?r.createElement(r.Fragment,null,r.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.createElement(He,null,r.createElement("div",{className:Object(j.b)(N(".5rem"))},r.createElement(x.b,{to:u?decodeURIComponent(u):"/",className:"button"},"Back"),!g.noteFor&&r.createElement(x.b,{to:"/notes/".concat(g.id),className:"button"},"Show"))),r.createElement(Tt,Object.assign({note:g,updateNote:y},g,{data:t,availableTags:D,onNoteAdded:function(){o(!0)}})))):r.createElement(r.Fragment,null,r.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.createElement(He,null,r.createElement(x.b,{to:"/",className:"button"},"Back")),r.createElement(Tt,{note:g,updateNote:y,availableTags:D,data:t,onNoteAdded:function(){o(!0)}})))},Ht=function(e){var t=Object(r.useState)(null),n=Object(b.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!1),o=Object(b.a)(i,2),s=o[0],u=o[1];if(r.useEffect((function(){try{var t=[];e.json&&(t=JSON.parse(e.json)),c(t)}catch(n){u(!0)}}),[e.json]),s)return r.createElement("div",null,"Invalid json");if(!a)return r.createElement(q,null);var l=e.referenceTitle?lt(e.referenceTitle):null;return e.personAlias&&(l=dt(e.personAlias)),r.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}},r.createElement("div",{style:{width:"100%"}},a.map((function(t,n){return function t(n,a,c,i){var o=[];if(i){if(!i.test(n.text))return r.createElement(r.Fragment,{key:"".concat(c,"-").concat(a)},n.nodes.map((function(e,n){return t(e,n,c+1,i)})));i=null,c>0&&o.push(r.createElement("div",{key:"extra-".concat(a,"-").concat(c),style:{paddingTop:8,color:"#aaa"}},"... > ".repeat(c)))}return r.createElement(r.Fragment,{key:"".concat(c,"-").concat(a)},o,r.createElement("div",{style:{display:"flex",padding:".6rem .8rem"}},r.createElement("div",{style:{letterSpacing:".5rem",color:"#777",lineHeight:1.5}},"\u2022"),r.createElement(bt,{markdown:n.text,contextId:e.contextId})),r.createElement("div",{style:{borderLeft:"1px solid #555",paddingLeft:16,marginLeft:16}},n.nodes.map((function(e,n){return t(e,n,c+1,i)}))))}(t,n,0,l)}))))},Jt=function(e){var t=Z().data,n=lt(e.title),a=L.orderBy(t.notes.filter((function(t){return t.contextId===e.contextId&&n.test(t.content)})),(function(e){return e.updatedAt}),"desc");return 0===a.length?null:r.createElement("div",{style:{paddingTop:32}},r.createElement("div",{style:{fontWeight:"bold"}},a.length,' linked references for "',e.title,'"'),a.map((function(t){return r.createElement("div",{key:t.id,style:{marginTop:16}},r.createElement(x.a,{to:"/notes/".concat(t.id),style:{color:"#078263"}},it(t)),r.createElement("div",{style:{paddingLeft:16,background:"#222",marginTop:8}},"markdown"===t.mode?r.createElement(bt,{markdown:t.content,contextId:t.contextId}):r.createElement(Ht,{json:t.content,contextId:t.contextId,referenceTitle:e.title})))})))},zt=function(e){var t=Z().data,n=dt(e.alias),a=L.orderBy(t.notes.filter((function(e){return n.test(e.content)})),(function(e){return e.updatedAt}),"desc");return 0===a.length?null:r.createElement("div",{style:{paddingTop:32}},r.createElement("div",{style:{fontWeight:"bold"}},a.length,' linked references for "',e.alias,'"'),a.map((function(t){return r.createElement("div",{key:t.id,style:{marginTop:16}},r.createElement(x.a,{to:"/notes/".concat(t.id),style:{color:"#078263"}},it(t)),r.createElement("div",{style:{paddingLeft:16,background:"#222",marginTop:8}},"markdown"===t.mode?r.createElement(bt,{markdown:t.content,contextId:t.contextId}):r.createElement(Ht,{json:t.content,contextId:t.contextId,personAlias:e.alias})))})))},_t=function(e){var t=Z().data,n=$e(null,"source"),a=Object(b.a)(n,1)[0],c=t.notes.find((function(t){return t.id===e.id}));if(!c)return r.createElement("div",null,"Note not found.");var i=null;return i=c.mode&&"markdown"!==c.mode?r.createElement(Ht,{json:c.content,contextId:c.contextId}):r.createElement(bt,{markdown:c.content,contextId:c.contextId}),r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:a?decodeURIComponent(a):"/",className:"button"},"Back"),r.createElement(x.b,{to:"/notes/".concat(c.id,"/edit"),className:"button"},"Edit")),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,it(c)),r.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.createElement(At,{tags:c.tags}),r.createElement(Ze,{contextId:c.contextId})),i,r.createElement(Jt,{title:it(c),contextId:c.contextId}))))},Gt=function(e){var t=$e(null,"source"),n=Object(b.a)(t,1)[0],a=new URLSearchParams(window.location.search),c=a.get("title"),i=a.get("context");return c?r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:n?decodeURIComponent(n):"/",className:"button"},"Back"),r.createElement(x.b,{to:"/notes/new?title=".concat(encodeURIComponent(c)).concat(i?"&context=".concat(i):"","&source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:"button"},"Create")),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,c),r.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.createElement(Ze,{contextId:i})),r.createElement(Jt,{title:c,contextId:i})))):r.createElement("div",null,"Note not found.")},qt=n(50),$t=n.n(qt),Xt=n(51);function Qt(e){return r.createElement("div",{className:"list"},e.items.map(e.renderItem))}function Zt(){var e,t=Z().data,n=$e(null,"search"),a=Object(b.a)(n,2),c=a[0],i=a[1],o=Xe([],"tags",(function(e){return null!==e?e.split("|"):[]}),(function(e){return e.join("|")})),s=Object(b.a)(o,2),u=s[0],l=s[1],d=r.useState(!Ye()),p=Object(b.a)(d,2),f=p[0],m=p[1],v=r.useState(null),h=Object(b.a)(v,2),g=h[0],y=h[1],k=r.useState(null),E=Object(b.a)(k,2),w=E[0],I=E[1],N=r.useState(!1),C=Object(b.a)(N,2),D=C[0],A=C[1],T=Xe(e=!1,"no-context",(function(e){return"true"===e}),(function(t){return t===e?null:t.toString()})),L=Object(b.a)(T,2),F=L[0],R=L[1],U=r.useState(),B=Object(b.a)(U,2),K=B[0],M=B[1],Y=r.useState([]),V=Object(b.a)(Y,2),W=V[0],H=V[1];r.useEffect((function(){var e=ft(t.notes);M(e)}),[t.notes]),r.useEffect((function(){H(t.contexts.filter((function(e){return e.state===_e.Inactive})).map((function(e){return e.id})))}),[t.contexts]);var J,z=Object(Xt.a)(100,(function(e){if(e&&e.length)if(null!==w){var n=w.search(e);y(n.map((function(e){return{id:e.ref,score:e.score}})))}else{var r=$t()((function(){this.field("title"),this.field("text");var e,n=Object(S.a)(t.notes);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.add({id:r.id,title:r.title,text:r.content})}}catch(a){n.e(a)}finally{n.f()}}));I(r);var a=r.search(e);y(a.map((function(e){return{id:e.ref,score:e.score}})))}else y(null)})),_=t.notes||[],G={},$=Object(S.a)(u);try{var X=function(){var e=J.value;_=_.filter((function(t){return-1!==t.tags.split(" ").indexOf(e)}))};for($.s();!(J=$.n()).done;)X()}catch(de){$.e(de)}finally{$.f()}D||(_=_.filter((function(e){return!e.noteFor}))),F&&(_=_.filter((function(e){return!e.contextId}))),_=_.filter((function(e){return!e.contextId||-1===W.indexOf(e.contextId)})),g&&(_=g.map((function(e){var t=_.findIndex((function(t){return t.id===e.id}));return _[t]})).filter((function(e){return e})));var Q,ee=Object(S.a)(_);try{for(ee.s();!(Q=ee.n()).done;){var te=Q.value;if(te.tags){var ne,re=Object(S.a)(te.tags.split(" "));try{for(re.s();!(ne=re.n()).done;){var ae=ne.value;G[ae]||(G[ae]=0),G[ae]+=1}}catch(de){re.e(de)}finally{re.f()}}}}catch(de){ee.e(de)}finally{ee.f()}var ce=Object.keys(G).map((function(e){return{key:e,count:G[e],active:-1!==u.indexOf(e)}})).sort((function(e,t){return t.count-e.count})),ie=null;if(window.location.search.length){var oe=new URLSearchParams(window.location.search);ie="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(oe.toString())))}if(!K)return r.createElement(q,null);var se=_.map((function(e){return{id:e.id,title:it(e),tags:e.tags,contextId:e.contextId,updatedAt:new Date(e.updatedAt),url:"/notes/".concat(e.id).concat(ie||""),isRef:!1}})),ue=[];g||(ue=K.map((function(e){return{id:null,title:e.title,tags:null,contextId:e.contextId,updatedAt:e.updatedAt,url:"/notes/virtual?title=".concat(encodeURIComponent(e.title)).concat(e.contextId?"&context=".concat(e.contextId):"","&source=").concat(encodeURIComponent("".concat(window.location.pathname))),isRef:!0}}))),ue=ue.filter((function(e){return!e.contextId||-1===W.indexOf(e.contextId)}));var le=P.a.orderBy(se.concat(ue),(function(e){return e.updatedAt}),"desc");return r.createElement("div",{style:{display:"flex",height:"100%"}},f&&r.createElement("div",{style:{borderRight:"1px solid #666",width:200}},r.createElement(Qt,{items:ce,renderItem:function(e){return r.createElement("div",{key:e.key,style:{background:e.active?"#444":void 0},onClick:function(){return function(e){-1===u.indexOf(e)?l(u.concat([e])):l(u.filter((function(t){return t!==e})))}(e.key)},className:Object(j.b)("item",O)},e.key," ",r.createElement("span",{style:{color:"#999"}},e.count))}})),r.createElement("div",{style:{width:"100%"}},r.createElement(He,null,r.createElement(Qe,{alwaysVisible:function(){return r.createElement(r.Fragment,null,r.createElement(x.b,{to:"/notes/new",className:"button"},"New Note"))}},r.createElement("div",null,r.createElement("input",{id:"tags-box",type:"checkbox",checked:f,onChange:function(){return m(!f)}}),r.createElement("label",{htmlFor:"tags-box"},"Show tags bar")),r.createElement("div",null,r.createElement("input",{id:"show-notes-for-box",type:"checkbox",checked:D,onChange:function(){return A(!D)}}),r.createElement("label",{htmlFor:"show-notes-for-box"},"Show notes for")),r.createElement("div",null,r.createElement("input",{id:"show-no-context-box",type:"checkbox",checked:F,onChange:function(){return R(!F)}}),r.createElement("label",{htmlFor:"show-no-context-box"},"Show no context"))),r.createElement("input",{style:{fontSize:16,padding:".3rem",width:"100%"},placeholder:"Search...",type:"text",value:c||"",onChange:function(e){i(e.target.value),z(e.target.value)}})),r.createElement("div",{className:"list"},le.map((function(e,t){return r.createElement(r.Fragment,{key:t},r.createElement(x.b,{to:e.url,className:Object(j.b)("item","note",O),style:{color:e.isRef?"#aaa":void 0}},r.createElement("div",{className:"note-title"},r.createElement("div",null,e.title)),r.createElement("div",{className:"note-details"},r.createElement(At,{tags:e.tags||""}),r.createElement("div",{className:"tags"},r.createElement(Ze,{contextId:e.contextId})),r.createElement("div",{className:"note-date"},qe()(e.updatedAt).format("ddd MMM Do HH:mm")))))})))))}var en=function(e){var t=Z().data,n=r.useState(""),a=Object(b.a)(n,2),c=a[0],i=a[1];function o(){return(o=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return e.next=3,G.contexts.create({title:c,state:_e.Active,contextId:null});case 3:i("");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return r.createElement(x.b,{key:e.id,to:"/contexts/".concat(e.id),className:Object(j.b)("item",O)},r.createElement("div",null,e.title))}return r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add context...",value:c,onChange:function(e){return i(e.target.value)},onKeyPress:function(e){return o.apply(this,arguments)}})),r.createElement("div",{className:"list"},r.createElement("div",{className:"header",style:{background:Ke("--task-context-background")}},"Active"),t.contexts.filter((function(e){return!e.state||e.state===_e.Active})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(e){return l(e)})),r.createElement("div",{className:"header",style:{background:Ke("--task-context-background")}},"Not Active"),t.contexts.filter((function(e){return e.state===_e.Inactive})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(e){return l(e)}))))},tn=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={text:""},r}return Object(y.a)(n,[{key:"onKeyPress",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return e.next=3,G.projects.create({title:this.state.text,state:Ve.Active,contextId:null});case 3:this.setState({text:""},this.props.refreshData);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderProject",value:function(e){return r.createElement(x.b,{key:e.id,to:"/projects/".concat(e.id),className:Object(j.b)("item",O)},r.createElement("div",null,e.title),r.createElement("div",{className:"tags"},r.createElement("div",{className:"tag"},e.state),r.createElement(Ze,{contextId:e.contextId})))}},{key:"render",value:function(){var e=this;return r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add project...",value:this.state.text,onChange:function(t){return e.setState({text:t.target.value})},onKeyPress:this.onKeyPress.bind(this)})),r.createElement("div",{className:"list"},r.createElement("div",{className:"header",style:{background:Ke("--task-project-background")}},"Active"),this.props.data.projects.filter((function(e){return!e.state||e.state===Ve.Active})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)})),r.createElement("div",{className:"header",style:{background:Ke("--task-project-background")}},"Incubated"),this.props.data.projects.filter((function(e){return!e.state||e.state===Ve.Incubated})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)})),r.createElement("div",{className:"header",style:{background:Ke("--task-project-background")}},"Not Active"),this.props.data.projects.filter((function(e){return e.state!==Ve.Active&&e.state!==Ve.Incubated})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)}))))}}]),n}(r.Component),nn=function(e){var t=Z().data;if(!e.targetEntity)return null;var n=e.targetEntity.noteId,a=function(){var t=Object(u.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.targetEntity){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,G.notes.create({title:"",content:"",tags:"",contextId:null,noteFor:{type:e.targetEntity.type,id:e.targetEntity.id},mode:"tree",dailyDate:null});case 4:if(n=t.sent,"person"!==e.targetEntity.type){t.next=9;break}return e.targetEntity.noteId=n.id,t.next=9,G.people.save(e.targetEntity);case 9:if("task"!==e.targetEntity.type){t.next=13;break}return e.targetEntity.noteId=n.id,t.next=13,G.tasks.save(e.targetEntity);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(!n)return r.createElement("div",null,r.createElement("div",{className:"button",onClick:a},"Add note"));var c=t.notes.find((function(e){return e.id===n}));return c?r.createElement("div",null,r.createElement(x.b,{to:"/notes/".concat(c.id,"/edit?source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:"button"},"Edit note"),c.mode&&"markdown"!==c.mode?r.createElement(Ht,{json:c.content,contextId:c.contextId}):r.createElement(bt,{markdown:c.content,contextId:c.contextId})):null},rn=function(e){var t=Z().data;if(!e.targetEntity)return null;var n=e.targetEntity.noteId;if(!n)return null;var a=t.notes.find((function(e){return e.id===n}));return a?r.createElement("div",null,a.mode&&"markdown"!==a.mode?r.createElement(Ht,{json:a.content,contextId:a.contextId}):r.createElement(bt,{markdown:a.content,contextId:a.contextId})):null},an=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={title:"",source:"/tasks"},r}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=new URLSearchParams(window.location.search),n=this.props.data.tasks.find((function(t){return t.id===e.props.id}));this.setState({title:n.title},(function(){t.has("source")&&e.setState({source:decodeURIComponent(t.get("source"))})}))}},{key:"setContext",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(r=n.target.value)&&(r=null),t.contextId=r,e.next=5,G.tasks.save(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setProject",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(r=n.target.value)&&(r=null),t.projectId=r,e.next=5,G.tasks.save(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setDefer",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.value,t.deferredUntil=""===r?null:new Date(r).toISOString(),e.next=4,G.tasks.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onKeyDown",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.tasks.find((function(e){return e.id===r.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,G.tasks.save(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setTaskState",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.data.tasks.find((function(e){return e.id===r.props.id}))){e.next=3;break}return e.abrupt("return");case 3:if(n.state!==t){e.next=5;break}return e.abrupt("return");case 5:return n.state=t,n.stateChangedAt=(new Date).toISOString(),e.next=9,G.tasks.save(n);case 9:this.props.refreshData();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.data.tasks.find((function(t){return t.id===e.props.id}));if(!t)return r.createElement("div",null,"Task not found.");var n=!1;return t.title!==this.state.title&&(n=!0),r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:this.state.source,className:"button"},"Back")),r.createElement(He,null,r.createElement("div",null,"Task"),r.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),r.createElement("div",null,"State"),r.createElement("div",{className:Object(j.b)(N(".5rem"))},r.createElement("div",{className:Object(j.b)("button","active"!==t.state?"inactive":null),onClick:function(){return e.setTaskState("active")}},"Active"),r.createElement("div",{className:Object(j.b)("button","incubated"!==t.state?"inactive":null),onClick:function(){return e.setTaskState("incubated")}},"Incubated"),r.createElement("div",{className:Object(j.b)("button","completed"!==t.state?"inactive":null),onClick:function(){return e.setTaskState("completed")}},"Completed")),r.createElement("div",null,"Context"),r.createElement("select",{className:"input is-large",value:t.contextId||"",onChange:function(n){return e.setContext(t,n)}},r.createElement("option",{value:""},"Not set"),this.props.data.contexts.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,"Project"),r.createElement("select",{className:"input is-large",value:t.projectId||"",onChange:function(n){return e.setProject(t,n)}},r.createElement("option",{value:""},"Not set"),this.props.data.projects.filter((function(e){return e.state===Ve.Active||e.id===t.projectId})).map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,"Defer"),r.createElement("input",{type:"date",className:"input is-large",value:t.deferredUntil&&qe()(t.deferredUntil).format("YYYY-MM-DD")||"",onChange:function(n){return e.setDefer(t,n)}})),r.createElement(He,null,r.createElement(nn,Object.assign({targetEntity:t},this.props))))}}]),n}(r.Component),cn=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={title:""},r}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.data.projects.find((function(t){return t.id===e.props.id}));this.setState({title:t.title})}},{key:"setContext",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===n&&(n=null),t.contextId=n,e.next=4,G.projects.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setProjectState",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.value,t.state=r,e.next=4,G.projects.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onKeyDown",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.projects.find((function(e){return e.id===r.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,G.projects.save(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(null===this.props.data)return r.createElement(q,null);var t=this.props.data.projects.find((function(t){return t.id===e.props.id}));if(!t)return r.createElement("div",null,"Project not found.");var n=!1;return t.title!==this.state.title&&(n=!0),r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:"/projects",className:"button"},"Back")),r.createElement(He,null,r.createElement("div",null,"Project"),r.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),r.createElement("div",null,"Context"),r.createElement(Nt,{contextId:t.contextId,onChange:function(n){return e.setContext(t,n)},data:this.props.data}),r.createElement("div",null,"State"),r.createElement("select",{className:"input is-large",value:t.state||Ve.Active,onChange:function(n){return e.setProjectState(t,n)}},Object.keys(Ve).map((function(e){return r.createElement("option",{key:e,value:e},e)})))))}}]),n}(r.Component),on=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={title:""},r}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.data.contexts.find((function(t){return t.id===e.props.id}));this.setState({title:t.title})}},{key:"onKeyDown",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.contexts.find((function(e){return e.id===r.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,G.contexts.save(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setContext",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(r=n.target.value)&&(r=null),t.contextId=r,e.next=5,G.contexts.save(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setContextState",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.value,t.state=r,e.next=4,G.contexts.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.data.contexts.find((function(t){return t.id===e.props.id}));if(!t)return r.createElement("div",null,"Context not found.");var n=!1;return t.title!==this.state.title&&(n=!0),r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:"/contexts",className:"button"},"Back")),r.createElement(He,null,r.createElement("div",null,"Context"),r.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),r.createElement("div",null,"Parent Context"),r.createElement("select",{className:"input is-large",value:t.contextId||"",onChange:function(n){return e.setContext(t,n)}},r.createElement("option",{value:""},"Not set"),this.props.data.contexts.filter((function(e){return e.id!==t.id})).map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,"State"),r.createElement("select",{className:"input is-large",value:t.state||_e.Active,onChange:function(n){return e.setContextState(t,n)}},Object.keys(_e).map((function(e){return r.createElement("option",{key:e,value:e},e)})))))}}]),n}(r.Component),sn=n(25),un=function(e){Object(E.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={error:null,data:null},r.refreshData=r.refreshData.bind(Object(sn.a)(r)),r}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ae.registerDataListener((function(e){return t.setState({data:e})})),e.t0=this,e.next=4,Ae.getData();case 4:e.t1=e.sent,e.t2={data:e.t1},e.t3=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ae.startServerSync();case 2:return e.next=4,Ae.ensureServerSyncEnqueued();case 4:case"end":return e.stop()}}),e)}))),e.t0.setState.call(e.t0,e.t2,e.t3);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshData",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Ae.getData();case 3:e.t1=e.sent,e.t2={data:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.error?r.createElement(r.Fragment,null,r.createElement("div",null,this.state.error),r.createElement(He,null,r.createElement("div",{className:"button",onClick:function(){return e.refreshData()}},"Retry"),r.createElement("div",{className:"button",onClick:function(){return window.location.reload()}},"Reload"),r.createElement("div",{className:"button",onClick:function(){return window.location.reload(!0)}},"Force Reload"),r.createElement("a",{className:"button",href:"/login"},"Login"))):this.state.data?this.props.render({data:this.state.data,refreshData:this.refreshData}):r.createElement(q,null)}}]),n}(r.Component),ln=(n(34),Object(T.createInstance)({name:"lifekeystore"}));Object(T.createInstance)({name:"privatekeystore"}),new Uint8Array([1,0,1]);function dn(){return pn.apply(this,arguments)}function pn(){return(pn=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ln.keys();case 2:if(0!==(t=e.sent).length){e.next=5;break}throw new Error("No key found");case 5:if(!(t.length>1)){e.next=7;break}throw new Error("More than 1 key found!");case 7:return e.next=9,ln.getItem(t[0]);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fn=Object(T.createInstance)({name:"filesystem"}),mn=null,vn=null;function hn(e,t){return bn.apply(this,arguments)}function bn(){return(bn=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r.mode="readwrite"),e.next=4,t.queryPermission(r);case 4:if(e.t0=e.sent,"granted"!==e.t0){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}fn.getItem("directory").then(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mn=t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,hn(mn,!0);case 5:vn=e.sent;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var xn=function(e){var t=Z().data;return r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:"/people/new",className:"button"},"New Person")),r.createElement("div",{className:"list"},t.people.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return t=e,r.createElement(x.b,{key:t.id,to:"/people/".concat(t.id),className:Object(j.b)("item",O)},r.createElement("div",null,t.name));var t}))))},gn=n(26),yn=function(e){var t=Z().data,n=Object(r.useState)(null),a=Object(b.a)(n,2),c=a[0],i=a[1],o=function(e){var t=Object(r.useState)(e),n=Object(b.a)(t,2),a=n[0],c=n[1];return{values:a,handleChange:function(e){e.persist(),c((function(t){return Object(A.a)({},t,Object(gn.a)({},e.target.name,e.target.value))}))}}}((function(){var n=e.id?t.people.find((function(t){return t.id===e.id})):null;return{name:n?n.name:"",alias:n?n.alias:"",birthday:n?n.birthday:null}})),l=o.values,d=o.handleChange,p=function(){var t=Object(u.a)(s.a.mark((function t(){var n,r,a,c,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.id||null)){t.next=15;break}return t.next=4,G.people.get(n);case 4:if(null!==(a=t.sent)){t.next=7;break}throw new Error("Person is null?");case 7:return a.name=l.name,a.alias=(null===(r=l.alias)||void 0===r?void 0:r.length)&&l.alias||null,a.birthday=l.birthday,t.next=12,G.people.save(a);case 12:i(a.id),t.next=19;break;case 15:return t.next=17,G.people.create({name:l.name,alias:(null===(c=l.alias)||void 0===c?void 0:c.length)&&l.alias||null,birthday:l.birthday,noteId:null});case 17:o=t.sent,i(o.id);case 19:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),f=e.id&&t.people.find((function(t){return t.id===e.id}))||null;return r.createElement(r.Fragment,null,c&&r.createElement(h.a,{to:"/people/".concat(c)}),r.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.createElement(He,null,r.createElement(x.b,{to:"/people",className:"button"},"Back"),e.id&&r.createElement(x.b,{to:"/people/".concat(e.id),className:"button"},"Show")),r.createElement(He,null,void 0===e.id?r.createElement("button",{type:"button",className:"button is-primary",onClick:p},"Add person"):r.createElement("button",{type:"button",className:"button is-primary",onClick:p},"Update person")),r.createElement(He,null,r.createElement("div",null,"Name"),r.createElement("input",{type:"text",name:"name",className:"input is-large is-wide",value:l.name,onChange:d}),r.createElement("div",null,"Alias"),r.createElement("input",{type:"text",name:"alias",className:"input is-large is-wide",value:l.alias||"",onChange:d}),r.createElement("div",null,"Birthday"),r.createElement("input",{type:"date",name:"birthday",className:"input is-large",value:l.birthday||"",onChange:d})),r.createElement(He,null,r.createElement(nn,{targetEntity:f}))))},kn=function(e){var t=Z().data.people.find((function(t){return t.id===e.id}));return t?r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement(x.b,{to:"/people",className:"button"},"Back"),r.createElement(x.b,{to:"/people/".concat(t.id,"/edit"),className:"button"},"Edit")),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,t.name," (@",vt(t),")"),t.birthday&&r.createElement("div",null,"Birthday: ",qe()(t.birthday).format("YYYY-MM-DD")),r.createElement(rn,Object.assign({targetEntity:t},e)),r.createElement(zt,{alias:vt(t)})))):r.createElement("div",null,"Person not found.")},En=function(e){var t=Z().data,n=r.useState(null),a=Object(b.a)(n,2),c=a[0],i=a[1],o=r.useState(null),s=Object(b.a)(o,2),u=s[0],l=s[1],d=r.useState(null),p=Object(b.a)(d,2),f=p[0],m=p[1],v=r.useState(null),h=Object(b.a)(v,2),x=h[0],g=h[1],y=r.useState(null),k=Object(b.a)(y,2),E=k[0],w=k[1];return r.useEffect((function(){G.notes.getSyncKeys().then((function(e){return i(e.length)})),G.tasks.getSyncKeys().then((function(e){return l(e.length)})),G.people.getSyncKeys().then((function(e){return m(e.length)})),G.projects.getSyncKeys().then((function(e){return g(e.length)})),G.contexts.getSyncKeys().then((function(e){return w(e.length)}))})),r.createElement(r.Fragment,null,r.createElement(He,null),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,"Stats"),r.createElement("ul",null,r.createElement("li",null,"Notes: ",t.notes.length,", versions: ",c||"..."),r.createElement("li",null,"Tasks: ",t.tasks.length,", versions: ",u||"..."),r.createElement("li",null,"People: ",t.people.length,", versions: ",f||"..."),r.createElement("li",null,"Projects: ",t.projects.length,", versions: ",x||"..."),r.createElement("li",null,"Contexts: ",t.contexts.length,", versions: ",E||"...")))))},wn=function(e){var t=$e(null,"context"),n=Object(b.a)(t,2),a=n[0],c=n[1],i=Z().data,o=qe()().add(-30,"d"),s=ze(a,i),u=P.a.orderBy(i.notes.filter((function(e){return e.dailyDate&&qe()(e.dailyDate)>o&&(!a||-1!==s.indexOf(e.contextId))})),(function(e){return e.dailyDate}),"desc");var l=P.a.countBy(i.notes.filter((function(e){return e.dailyDate})),(function(e){return e.contextId})),d=P.a.orderBy(Object.keys(l).map((function(e){return{contextId:e,count:l[e],context:i.contexts.find((function(t){return t.id===e}))}})),(function(e){return e.count}),"desc"),p=new URLSearchParams(window.location.search),f="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(p.toString())));return r.createElement("div",{style:{display:"flex",height:"100%"}},r.createElement(et,{contextId:a,onChange:c}),r.createElement("div",{style:{width:"100%"}},r.createElement(He,null,d.map((function(e){return r.createElement(x.b,{key:e.contextId,to:"/notes/new?context=".concat(e.contextId,"&daily"),className:"button"},"New Note",e.context?" - ".concat(e.context.title):"")}))),r.createElement("div",{className:"panel"},u.map((function(e){return r.createElement("div",{key:e.id,className:"content",style:{padding:"1rem"}},r.createElement("h1",null,it(e)),r.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.createElement("div",{className:N("8px")},r.createElement("a",{className:"button small",href:"/notes/".concat(e.id).concat(f)},"Show"),r.createElement("a",{className:"button small",href:"/notes/".concat(e.id,"/edit").concat(f)},"Edit")),r.createElement(Ze,{contextId:e.contextId})),(t=e).mode&&"markdown"!==t.mode?r.createElement(Ht,{json:t.content,contextId:t.contextId}):r.createElement(bt,{markdown:t.content,contextId:t.contextId}));var t})))))},jn=(n(74),r.createElement(We,null,r.createElement(Q,null,r.createElement(h.d,null,r.createElement(h.b,{exact:!0,path:"/",render:function(e){return r.createElement(Zt,null)}}),r.createElement(h.b,{exact:!0,path:"/notes/new",render:function(e){return r.createElement(Wt,null)}}),r.createElement(h.b,{exact:!0,path:"/notes/daily",render:function(e){return r.createElement(wn,null)}}),r.createElement(h.b,{exact:!0,path:"/notes/virtual",render:function(e){return r.createElement(Gt,null)}}),r.createElement(h.b,{exact:!0,path:"/notes/:id",render:function(e){return r.createElement(_t,{id:e.match.params.id})}}),r.createElement(h.b,{exact:!0,path:"/notes/:id/edit",render:function(e){return r.createElement(Wt,{id:e.match.params.id})}}),r.createElement(h.b,{exact:!0,path:"/tasks",render:function(e){return r.createElement(rt,null)}}),r.createElement(h.b,{exact:!0,path:"/tasks/:id",render:function(e){return r.createElement(un,{render:function(t){return r.createElement(an,Object.assign({},t,{id:e.match.params.id}))}})}}),r.createElement(h.b,{exact:!0,path:"/contexts",render:function(e){return r.createElement(en,null)}}),r.createElement(h.b,{exact:!0,path:"/contexts/:id",render:function(e){return r.createElement(un,{render:function(t){return r.createElement(on,Object.assign({},t,{id:e.match.params.id}))}})}}),r.createElement(h.b,{exact:!0,path:"/projects",render:function(e){return r.createElement(un,{render:function(e){return r.createElement(tn,e)}})}}),r.createElement(h.b,{exact:!0,path:"/projects/:id",render:function(e){return r.createElement(un,{render:function(t){return r.createElement(cn,Object.assign({},t,{id:e.match.params.id}))}})}}),r.createElement(h.b,{exact:!0,path:"/people",render:function(e){return r.createElement(xn,null)}}),"} />",r.createElement(h.b,{exact:!0,path:"/people/new",render:function(e){return r.createElement(yn,null)}}),r.createElement(h.b,{exact:!0,path:"/people/:id",render:function(e){return r.createElement(kn,{id:e.match.params.id})}}),r.createElement(h.b,{exact:!0,path:"/people/:id/edit",render:function(e){return r.createElement(yn,{id:e.match.params.id})}}),r.createElement(h.b,{path:"/playground",component:function(){var e=Z().data;return console.log(ft(e.notes)),r.createElement("div",{style:{height:"100%"}},r.createElement(He,null))}}),r.createElement(h.b,{path:"/sync",component:function(e){var t=a.a.useState(0),n=Object(b.a)(t,2),r=n[0],c=n[1];return a.a.useEffect((function(){Ae.registerSyncListener((function(){c((function(e){return e+1}))}))}),[]),a.a.createElement(a.a.Fragment,null,a.a.createElement(a.a.Fragment,{key:r}),a.a.createElement(He,null,a.a.createElement("div",null,"Status: ",Se[Ae.status]),a.a.createElement("div",{className:"button",onClick:function(){return Ae.startServerSync()}},"Sync Now")),a.a.createElement("div",{className:"list"},Ae.getResults().slice(0).reverse().map((function(e,t){return a.a.createElement(a.a.Fragment,{key:t},a.a.createElement("div",{className:"item"},e.type," - ",e.endAt.getTime()-e.startAt.getTime()," ms - start: ",qe()(e.startAt).format("HH:mm:ss"),", end: ",qe()(e.endAt).format("HH:mm:ss"),", fetch: ",e.fetch,", send: ",e.send,e.error?", error: ".concat(e.error):null))}))))}}),r.createElement(h.b,{path:"/stats",render:function(e){return r.createElement(En,null)}}),r.createElement(h.b,{path:"/settings",component:function(){var e=r.useState(null),t=Object(b.a)(e,2),n=(t[0],t[1]),a=r.useState("none"),c=Object(b.a)(a,2),i=c[0],o=c[1],l=r.useState(null),d=Object(b.a)(l,2),p=(d[0],d[1],r.useState(null)),f=Object(b.a)(p,2);f[0],f[1];function m(){return v.apply(this,arguments)}function v(){return(v=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Clear all local data?")){e.next=2;break}return e.abrupt("return");case 2:G.contexts.dropInstance(),G.tasks.dropInstance(),G.notes.dropInstance(),G.projects.dropInstance(),G.people.dropInstance();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=r.useState(null),x=Object(b.a)(h,2),g=x[0],y=x[1];function k(){return E.apply(this,arguments)}function E(){return(E=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,dn();case 3:t=e.sent,n(t),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(t+="".concat(n,"- ").concat(e.text,"\n"),e.nodes){var r,a=Object(S.a)(e.nodes);try{for(a.s();!(r=a.n()).done;){var c=r.value;t=w(c,t,n+"\t")}}catch(i){a.e(i)}finally{a.f()}}return t}function j(e){return O.apply(this,arguments)}function O(){return(O=Object(u.a)(s.a.mark((function e(t){var n,r,a,c,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.people.getAll();case 2:if(n=e.sent,"tree"!==t.mode||!t.content){e.next=10;break}r=JSON.parse(t.content),a="",c=Object(S.a)(r);try{for(c.s();!(i=c.n()).done;)o=i.value,a=w(o,a)}catch(s){c.e(s)}finally{c.f()}return a=a.replace(mt,(function(e,t){var r=n.find((function(e){return"@".concat(vt(e))===t}));return r?"[[".concat(r.name,"]]"):"[[Missing Person]]: ".concat(t)})),e.abrupt("return",a);case 10:return e.abrupt("return",t.content);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=Object(u.a)(s.a.mark((function e(){var t,n,r,a,c,i,o,u,l,d,p,f,m,v,h,b,x,g,y,k;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mn){e.next=5;break}return e.next=3,window.showDirectoryPicker();case 3:mn=e.sent,fn.setItem("directory",mn);case 5:return e.next=7,N(mn,!0);case 7:if(e.sent){e.next=10;break}vn=!1,console.error("permission denied");case 10:return vn=!0,e.next=13,mn.getDirectoryHandle("dump-test",{create:!0});case 13:return t=e.sent,e.t0=S.a,e.next=17,G.notes.getAll();case 17:e.t1=e.sent,n=(0,e.t0)(e.t1),e.prev=19,n.s();case 21:if((r=n.n()).done){e.next=64;break}if(!(a=r.value).noteFor){e.next=25;break}return e.abrupt("continue",62);case 25:if(c=it(a),i="".concat(c,".md"),o=t,!a.contextId){e.next=36;break}return e.next=31,G.contexts.get(a.contextId);case 31:if(!(u=e.sent)){e.next=36;break}return e.next=35,o.getDirectoryHandle(u.title,{create:!0});case 35:o=e.sent;case 36:if(!a.dailyDate){e.next=41;break}return e.next=39,o.getDirectoryHandle("Daily",{create:!0});case 39:o=e.sent,i="".concat(qe()(a.dailyDate).format("YYYY-MM-DD"),".md");case 41:return console.log("writing ",i),e.next=44,o.getFileHandle(i,{create:!0});case 44:return l=e.sent,e.next=47,l.createWritable({keepExistingData:!1});case 47:return d=e.sent,p=[],"title"===ot(a)&&p.push("# ".concat(a.title)),a.tags&&a.tags.length&&p.push("tags: ".concat(a.tags.split(" ").map((function(e){return"#".concat(e)})).join(", "))),p.length&&p.push(""),e.t2=d,e.t3="".concat(p.join("\n"),"\n"),e.next=56,j(a);case 56:return e.t4=e.sent,e.t5=e.t3.concat.call(e.t3,e.t4),e.next=60,e.t2.write.call(e.t2,e.t5);case 60:return e.next=62,d.close();case 62:e.next=21;break;case 64:e.next=69;break;case 66:e.prev=66,e.t6=e.catch(19),n.e(e.t6);case 69:return e.prev=69,n.f(),e.finish(69);case 72:return e.next=74,t.getDirectoryHandle("People",{create:!0});case 74:return f=e.sent,e.t7=S.a,e.next=78,G.people.getAll();case 78:e.t8=e.sent,m=(0,e.t7)(e.t8),e.prev=80,m.s();case 82:if((v=m.n()).done){e.next=111;break}return h=v.value,b="".concat(h.name,".md"),console.log("writing ",b),e.next=88,f.getFileHandle(b,{create:!0});case 88:return x=e.sent,e.next=91,x.createWritable({keepExistingData:!1});case 91:if(g=e.sent,y=[],h.birthday&&y.push("birthday: ".concat(qe()(h.birthday).format("YYYY-MM-DD"))),y.length&&y.push(""),!h.noteId){e.next=105;break}return e.next=98,G.notes.get(h.noteId);case 98:if(!(k=e.sent)){e.next=105;break}return e.t9=y,e.next=103,j(k);case 103:e.t10=e.sent,e.t9.push.call(e.t9,e.t10);case 105:return e.next=107,g.write(y.join("\n"));case 107:return e.next=109,g.close();case 109:e.next=82;break;case 111:e.next=116;break;case 113:e.prev=113,e.t11=e.catch(80),m.e(e.t11);case 116:return e.prev=116,m.f(),e.finish(116);case 119:case"end":return e.stop()}}),e,null,[[19,66,69,72],[80,113,116,119]])})))).apply(this,arguments)}function N(e,t){return C.apply(this,arguments)}function C(){return(C=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r.mode="readwrite"),e.next=4,t.queryPermission(r);case 4:if(e.t0=e.sent,"granted"!==e.t0){e.next=7;break}return e.abrupt("return",!0);case 7:return e.next=9,t.requestPermission(r);case 9:if(e.t1=e.sent,"granted"!==e.t1){e.next=12;break}return e.abrupt("return",!0);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.useEffect((function(){ce().then((function(e){y(e)}))}),[]),r.useEffect((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.serviceWorker){e.next=6;break}return e.next=3,navigator.serviceWorker.ready;case 3:t=e.sent,n=[t.active?"active":null,t.waiting?"waiting":null,t.installing?"installing":null],o(n.filter((function(e){return null!=e})).join(", "));case 6:return e.next=8,k();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),r.createElement(r.Fragment,null,r.createElement(He,null,r.createElement("div",{className:"button",onClick:function(){return Ue("dark-theme")}},"Dark theme"),r.createElement("div",{className:"button",onClick:function(){return Ue("light-theme")}},"Light theme")),r.createElement(He,null,r.createElement("div",{className:"button",onClick:function(){return window.location.reload()}},"Reload"),r.createElement("div",{className:"button",onClick:function(){return window.location.reload(!0)}},"Force Reload")),r.createElement(He,null,r.createElement("div",{className:"button",onClick:function(){return I.apply(this,arguments)}},"Export to Obsidian"),mn&&r.createElement("div",{style:{display:"inline-block",background:Ke("--settings-info-background"),padding:".5rem"}},mn.name," - Access Status: ",vn?"granted":"not granted")),r.createElement(He,null,g?r.createElement("div",{className:"button",onClick:Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de();case 2:case"end":return e.stop()}}),e)})))},"Refresh Dropbox"):r.createElement("div",{className:"button",onClick:Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,void window.location.assign("https://www.dropbox.com/oauth2/authorize?client_id=".concat(re,"&response_type=token&redirect_uri=").concat(window.location.toString()));case 2:return e.t0=y,e.next=5,ce();case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})))},"Connect Dropbox"),r.createElement("div",{style:{display:"inline-block",background:Ke("--settings-info-background"),padding:".5rem"}},"Status: ",null===g?"unknown":g?"connected":"not connected"),ne&&r.createElement("div",{style:{display:"inline-block",background:Ke("--settings-info-background"),padding:".5rem"}},"Local [ ",window.location.host," ]")),r.createElement(He,null,r.createElement("div",{className:"button",onClick:Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},"Clear Entities"),r.createElement("div",{className:"button",onClick:function(){navigator.serviceWorker&&navigator.serviceWorker.ready.then(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.update();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},"Update Service Worker"),r.createElement("div",{style:{display:"inline-block",background:Ke("--settings-info-background"),padding:".5rem"}},"Service Workers [ ",i," ]")),!1)}}))))),On=n(14),In=Object(On.a)();i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(h.c,{children:jn,history:In})),document.getElementById("root")),function(e){d.apply(this,arguments)}()}},[[52,1,2]]]);
//# sourceMappingURL=main.facec0c3.chunk.js.map