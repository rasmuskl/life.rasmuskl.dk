(this.webpackJsonplife=this.webpackJsonplife||[]).push([[0],{54:function(e,t,n){e.exports=n(79)},59:function(e,t,n){e.exports={test:"#078263"}},72:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(47),i=n.n(c),s=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function o(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var u=n(4),l=n(21),d=n(3),p=(n(59),n(5)),f=n(7),m=n(8),h=n(9),v=n(10),g=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={installEvent:null},r}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeinstallprompt",(function(t){t.preventDefault(),e.setState({installEvent:t})}))}},{key:"onInstallClick",value:function(){null!==this.state.installEvent&&(this.state.installEvent.prompt(),this.state.installEvent.userChoice.then((function(e){"accepted"===e.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt")})))}},{key:"render",value:function(){var e=this;return this.state.installEvent?r.createElement("div",{className:"button",onClick:function(){return e.onInstallClick()}},"Install app"):null}}]),n}(r.Component),y=n(13),x=Object(y.style)({$nest:{"&:hover":{background:"#3f3f3f"}}}),b=Object(y.style)({cursor:"pointer"});Object(y.style)({display:"flex",alignItems:"center"});function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".3rem",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(y.style)({paddingLeft:t?e:void 0,paddingRight:t?e:void 0,$nest:{"& > *:first-child":{marginLeft:0},"& > *":{marginRight:e},"& > *:last-child":{marginRight:0}}})}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".3rem",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(y.style)({paddingTop:t?e:void 0,paddingBottom:t?e:void 0,$nest:{"& > *":{marginBottom:e},"& > *:last-child":{marginBottom:0}}})}var w=n(6),j=n(1),O=n.n(j),S=n(2),C=n(12),I=n(14),N=n(18),D=n(15),A=n.n(D),T=n(32),L=Object(N.createInstance)({name:"lifekeystore"}),P=Object(N.createInstance)({name:"privatekeystore"}),K={name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},F={name:"AES-GCM",length:256};function M(){return U.apply(this,arguments)}function U(){return(U=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.generateKey(K,!0,["encrypt","decrypt"]);case 3:return t=e.sent,e.next=6,crypto.subtle.exportKey("pkcs8",t.privateKey);case 6:return n=e.sent,r=Q(n),e.next=10,crypto.subtle.exportKey("spki",t.publicKey);case 10:return a=e.sent,c=Q(a),i=T.hex(a),e.abrupt("return",{fingerprint:i,privateKey:r,publicKey:c});case 16:throw e.prev=16,e.t0=e.catch(0),console.error("generateKey",e.t0,e.t0.message),e.t0;case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function R(e){return B.apply(this,arguments)}function B(){return(B=Object(S.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.exportKey("jwk",t);case 2:return delete(n=e.sent).d,delete n.dp,delete n.dq,delete n.q,delete n.qi,n.key_ops=["encrypt","wrapKey"],e.next=11,crypto.subtle.importKey("jwk",n,K,!0,["encrypt","wrapKey"]);case 11:return r=e.sent,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return W.apply(this,arguments)}function W(){return(W=Object(S.a)(O.a.mark((function e(t){var n,r,a,c,i,s,o,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Z(t),e.next=3,crypto.subtle.importKey("pkcs8",n,K,!0,["decrypt","unwrapKey"]);case 3:return r=e.sent,e.next=6,R(r);case 6:return a=e.sent,e.next=9,crypto.subtle.exportKey("spki",a);case 9:return c=e.sent,i=Q(c),s=T.hex(c),e.next=14,crypto.subtle.importKey("pkcs8",n,K,!1,["decrypt","unwrapKey"]);case 14:o=e.sent,P.setItem(s,o),u={fingerprint:s,publicKey:i,createdAt:(new Date).toISOString()},L.setItem(u.fingerprint,u);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return H.apply(this,arguments)}function H(){return(H=Object(S.a)(O.a.mark((function e(t,n){var r,a,c,i,s,o,u,l,d,p,f;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.getItem(t);case 3:if(r=e.sent){e.next=6;break}throw new Error("Key with fingerprint ".concat(t," not found"));case 6:return a=Z(r.publicKey),e.next=9,crypto.subtle.importKey("spki",a,K,!0,["encrypt","wrapKey"]);case 9:return c=e.sent,e.next=12,_();case 12:return i=e.sent,s=crypto.getRandomValues(new Uint8Array(12)),e.next=16,crypto.subtle.encrypt({name:"AES-GCM",length:256,iv:s},i,X(n));case 16:return o=e.sent,u=Q(o),e.next=20,crypto.subtle.wrapKey("raw",i,c,K);case 20:return l=e.sent,d=Q(l),p=Q(s),f={payload:u,key:d,fingerprint:t,iv:p},e.abrupt("return",f);case 27:throw e.prev=27,e.t0=e.catch(0),console.error("encryptAndWrap",e.t0,e.t0.message),e.t0;case 31:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function J(e,t,n,r){return G.apply(this,arguments)}function G(){return(G=Object(S.a)(O.a.mark((function e(t,n,r,a){var c,i,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.getItem(t);case 3:if(c=e.sent){e.next=6;break}throw new Error("Key with fingerprint ".concat(t," not found"));case 6:return e.next=8,crypto.subtle.unwrapKey("raw",Z(n),c,K,F,!1,["decrypt"]);case 8:return i=e.sent,e.next=11,crypto.subtle.decrypt({name:"AES-GCM",length:256,iv:Z(a)},i,Z(r));case 11:return s=e.sent,e.abrupt("return",ee(s));case 15:throw e.prev=15,e.t0=e.catch(0),console.error("unwrapAndDecrypt",e.t0,e.t0.message),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function _(){return q.apply(this,arguments)}function q(){return(q=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.generateKey(F,!0,["encrypt","decrypt"]);case 3:return t=e.sent,e.abrupt("return",t);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("generateKey",e.t0,e.t0.message),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function $(){return z.apply(this,arguments)}function z(){return(z=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.keys();case 2:if(0!==(t=e.sent).length){e.next=5;break}throw new Error("No key found");case 5:if(!(t.length>1)){e.next=7;break}throw new Error("More than 1 key found!");case 7:return e.next=9,L.getItem(t[0]);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return window.btoa(t)}function Z(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r.buffer}function X(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return t}function ee(e){return String.fromCharCode.apply(null,new Uint16Array(e))}var te=function(){function e(){Object(f.a)(this,e),this.listeners=[]}return Object(m.a)(e,[{key:"register",value:function(e){var t=this;return this.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))}}},{key:"trigger",value:function(e){var t,n=Object(w.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}}]),e}(),ne=(Object.keys({id:"test",versionId:"test",parentVersionId1:null,parentVersionId2:null,type:"task",createdAt:"now",updatedAt:"now",deferredUntil:null}),function(){function e(t){Object(f.a)(this,e),this.store=void 0,this.type=void 0,this.changeListener=void 0,this.type=t,this.store=Object(N.createInstance)({name:"store-".concat(t)}),this.changeListener=new te}return Object(m.a)(e,[{key:"create",value:function(){var e=Object(S.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new Date).toISOString(),r=Object(I.a)({id:this.uuid(),versionId:this.uuid(),type:this.type,parentVersionIds:[],createdAt:n,updatedAt:n},t),e.next=4,this.store.setItem(this.getKey(r),r);case 4:return this.changeListener&&this.changeListener.trigger(r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(e){if(e.id||(e.id=this.uuid()),e.type!==this.type)throw"Invalid type: ".concat(e.type," - expected ").concat(this.type);var t=(new Date).toISOString();e.createdAt||(e.createdAt=t),e.updatedAt=t,e.versionId&&(e.parentVersionId1=e.versionId),e.versionId=this.uuid(),this.store.setItem(this.getKey(e),e),this.changeListener&&this.changeListener.trigger(e)}},{key:"import",value:function(e){if(e.type!==this.type)throw"Invalid type ".concat(e.type," - expected ").concat(this.type);this.store.setItem(this.getKey(e),e),this.changeListener&&this.changeListener.trigger(e)}},{key:"get",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r,a,c,i,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=14;break}return e.next=3,this.getLeafNodes("".concat(t,"/"));case 3:if(!((r=e.sent).length>1)){e.next=9;break}console.warn("Found ".concat(r.length," leaf nodes for entity ").concat(this.type,"/").concat(t," - expected 1: ").concat(r.map((function(e){return e.versionId})))),a=Object(w.a)(r);try{for(a.s();!(c=a.n()).done;)i=c.value,console.log("leaf node",i)}catch(o){a.e(o)}finally{a.f()}return e.abrupt("return",D.orderBy(r,(function(e){return e.updatedAt}),"desc")[0]);case 9:if(0!==r.length){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",r[0]);case 14:return e.next=16,this.getKeysPrefixed("".concat(t,"/").concat(n));case 16:return s=e.sent,e.next=19,this.store.getItem(s[0]);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLeafNodes();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getKeysPrefixed",value:function(){var e=Object(S.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.keys();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e.startsWith(t)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSyncKeys",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.keys();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return"".concat(n.type,"/").concat(e.split("/")[0],"/").concat(e.split("/")[1])})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLeafNodes",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c,i,s,o,u,l,d,p,f,m,h,v,g=arguments;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.length>0&&void 0!==g[0]?g[0]:"",e.next=3,this.getKeysPrefixed(t);case 3:n=e.sent,r=n.map((function(e){var t=e.split("/"),n=null,r=null;if(t[2].length>0){var a=t[2].split("+");if(a.length>2)throw"ParentVersionIds length > 2";n=a[0],r=a.length>1?a[1]:null}return{id:t[0],versionId:t[1],parentVersionId1:n,parentVersionId2:r}})),a=D.groupBy(r,(function(e){return e.id})),c=Object.keys(a).map((function(e){var t,n=a[e],r={},c=Object(w.a)(n);try{for(c.s();!(t=c.n()).done;){var i=t.value;i.parentVersionId1&&(r[i.parentVersionId1]=!0),i.parentVersionId2&&(r[i.parentVersionId2]=!0)}}catch(s){c.e(s)}finally{c.f()}return n.filter((function(e){return!r[e.versionId]}))})),i=[],s=Object(w.a)(c),e.prev=9,s.s();case 11:if((o=s.n()).done){e.next=37;break}u=o.value,l=[],d=Object(w.a)(u),e.prev=15,d.s();case 17:if((p=d.n()).done){e.next=26;break}return f=p.value,e.t0=l,e.next=22,this.store.getItem(this.getKey(f));case 22:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t2=e.catch(15),d.e(e.t2);case 31:return e.prev=31,d.f(),e.finish(31);case 34:if(1!==l.length){console.warn("Found ".concat(l.length," leaf nodes for entity ").concat(this.type,"/").concat(u[0].id," - expected 1: ").concat(l.map((function(e){return e.versionId})))),m=Object(w.a)(l);try{for(m.s();!(h=m.n()).done;)v=h.value,console.log("leaf node",v)}catch(y){m.e(y)}finally{m.f()}i.push(D.orderBy(l,(function(e){return e.updatedAt}),"desc")[0])}else i.push(l[0]);case 35:e.next=11;break;case 37:e.next=42;break;case 39:e.prev=39,e.t3=e.catch(9),s.e(e.t3);case 42:return e.prev=42,s.f(),e.finish(42);case 45:return e.abrupt("return",i);case 46:case"end":return e.stop()}}),e,this,[[9,39,42,45],[15,28,31,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"registerChangeListener",value:function(e){this.changeListener.register(e)}},{key:"dropInstance",value:function(){this.store.dropInstance()}},{key:"getKey",value:function(e){var t=[];return e.parentVersionId1&&t.push(e.parentVersionId1),e.parentVersionId2&&t.push(e.parentVersionId2),"".concat(e.id,"/").concat(e.versionId,"/").concat(t.join("+"))}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}]),e}()),re=new ne("context"),ae=new ne("task"),ce=new ne("note"),ie=new ne("project"),se=new ne("person");function oe(){return(oe=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=C.a,e.next=4,re.getSyncKeys();case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=C.a,e.next=9,ae.getSyncKeys();case 9:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t7=C.a,e.next=14,ce.getSyncKeys();case 14:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t10=C.a,e.next=19,ie.getSyncKeys();case 19:return e.t11=e.sent,e.t12=(0,e.t10)(e.t11),e.t13=C.a,e.next=24,se.getSyncKeys();case 24:return e.t14=e.sent,e.t15=(0,e.t13)(e.t14),t=e.t0.concat.call(e.t0,e.t3,e.t6,e.t9,e.t12,e.t15),e.abrupt("return",t);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return le.apply(this,arguments)}function le(){return(le=Object(S.a)(O.a.mark((function e(t){var n,r,a,c,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.split("/"),r=Object(d.a)(n,3),a=r[0],c=r[1],i=r[2],e.t0=a,e.next="context"===e.t0?4:"task"===e.t0?5:"note"===e.t0?6:"project"===e.t0?7:"person"===e.t0?8:9;break;case 4:return e.abrupt("return",re.get(c,i));case 5:return e.abrupt("return",ae.get(c,i));case 6:return e.abrupt("return",ce.get(c,i));case 7:return e.abrupt("return",ie.get(c,i));case 8:return e.abrupt("return",se.get(c,i));case 9:throw"Unknown type: "+a;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(){return(de=Object(S.a)(O.a.mark((function e(t){var n,r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(w.a)(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=21;break}a=r.value,e.t0=a.type,e.next="context"===e.t0?8:"task"===e.t0?10:"note"===e.t0?12:"project"===e.t0?14:"person"===e.t0?16:18;break;case 8:return re.import(a),e.abrupt("break",19);case 10:return ae.import(a),e.abrupt("break",19);case 12:return ce.import(a),e.abrupt("break",19);case 14:return ie.import(a),e.abrupt("break",19);case 16:return se.import(a),e.abrupt("break",19);case 18:throw"Unknown type: "+a.type;case 19:e.next=3;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(1),n.e(e.t1);case 26:return e.prev=26,n.f(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[1,23,26,29]])})))).apply(this,arguments)}function pe(){return(pe=Object(S.a)(O.a.mark((function e(t){var n,r,a,c,i,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(w.a)(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=33;break}return a=r.value,c=JSON.parse(a.encryption),e.next=8,J(c.fingerprint,c.key,a.data,c.iv);case 8:i=e.sent,(s=JSON.parse(i)).id=a.id,s.versionId=a.versionId,s.type=a.type,s.parentVersionId1=a.parentVersionId1,s.parentVersionId2=a.parentVersionId2,s.createdAt=a.createdAt,s.updatedAt=a.updatedAt,e.t0=a.type,e.next="context"===e.t0?20:"task"===e.t0?22:"note"===e.t0?24:"project"===e.t0?26:"person"===e.t0?28:30;break;case 20:return re.import(s),e.abrupt("break",31);case 22:return ae.import(s),e.abrupt("break",31);case 24:return ce.import(s),e.abrupt("break",31);case 26:return ie.import(s),e.abrupt("break",31);case 28:return se.import(s),e.abrupt("break",31);case 30:throw"Unknown type: "+s.type;case 31:e.next=3;break;case 33:e.next=38;break;case 35:e.prev=35,e.t1=e.catch(1),n.e(e.t1);case 38:return e.prev=38,n.f(),e.finish(38);case 41:case"end":return e.stop()}}),e,null,[[1,35,38,41]])})))).apply(this,arguments)}function fe(){return(fe=Object(S.a)(O.a.mark((function e(t){var n,r,a,c,i,s,o,u,l,d,p;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=Object(w.a)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=35;break}return c=a.value,e.next=8,ue(c);case 8:if(null!==(i=e.sent)){e.next=12;break}return console.warn("Entity with key not found: "+c),e.abrupt("continue",33);case 12:return delete(s=Object(I.a)({},i)).createdAt,delete s.updatedAt,delete s.id,delete s.versionId,delete s.type,delete s.parentVersionId1,delete s.parentVersionId2,o=JSON.stringify(s),e.t0=Y,e.next=24,$();case 24:return e.t1=e.sent.fingerprint,e.t2=o,e.next=28,(0,e.t0)(e.t1,e.t2);case 28:u=e.sent,l={fingerprint:u.fingerprint,key:u.key,iv:u.iv},d=JSON.stringify(l),p={id:i.id,versionId:i.versionId,type:i.type,parentVersionId1:i.parentVersionId1,parentVersionId2:i.parentVersionId2,createdAt:i.createdAt,updatedAt:i.updatedAt,data:u.payload,encryption:d},n.push(p);case 33:e.next=4;break;case 35:e.next=40;break;case 37:e.prev=37,e.t3=e.catch(2),r.e(e.t3);case 40:return e.prev=40,r.f(),e.finish(40);case 43:return e.abrupt("return",n);case 44:case"end":return e.stop()}}),e,null,[[2,37,40,43]])})))).apply(this,arguments)}var me={contexts:re,tasks:ae,notes:ce,projects:ie,people:se,getSyncKeys:function(){return oe.apply(this,arguments)},importEntites:function(e){return de.apply(this,arguments)},importServerEntites:function(e){return pe.apply(this,arguments)},exportServerEntities:function(e){return fe.apply(this,arguments)}},he=(n(65),function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,null,[{key:"getSyncStatus",value:function(e){return fetch("/api/entity/getsyncstatus",{method:"POST",headers:this.getHeaders(),body:JSON.stringify({entites:e||[]})}).then((function(e){var t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json"))return e.json();throw new TypeError("Oops, we haven't got JSON!")}))}},{key:"serverSyncFetch",value:function(e){return fetch("/api/entity/serversyncfetch",{method:"POST",headers:this.getHeaders(),body:JSON.stringify({ids:e||[]})}).then((function(e){var t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json"))return e.json();throw new TypeError("Oops, we haven't got JSON!")}))}},{key:"serverSyncSend",value:function(e){return fetch("/api/entity/serversyncsend",{method:"POST",headers:this.getHeaders(),body:JSON.stringify({entities:e||[]})}).then((function(e){}))}},{key:"testPush",value:function(e){return fetch("/api/push/test",{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)}).then((function(e){console.log(e)}))}},{key:"getHeaders",value:function(){var e=new Headers;return e.set("Content-Type","application/json"),e.set("Accept","application/json"),e}}]),e}()),ve=function(e){return r.createElement("div",{style:{display:"flex",height:"100%",justifyContent:"center",alignItems:"center"}},r.createElement("div",{style:{border:"1px solid #555",padding:"1rem 2rem",background:"#2e2e2e"}},"Loading..."))},ge=function e(t,n,r,a,c){Object(f.a)(this,e),this.notes=void 0,this.tasks=void 0,this.contexts=void 0,this.projects=void 0,this.people=void 0,this.notes=t,this.tasks=n,this.contexts=r,this.projects=a,this.people=c},ye=a.a.createContext({data:null,refreshData:function(){}}),xe=function(e){var t=a.a.useState(null),n=Object(d.a)(t,2),c=n[0],i=n[1];Object(r.useEffect)((function(){function e(){return(e=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Je.registerDataListener((function(e){return i(e)})),e.t0=i,e.next=4,Je.getData();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),e.next=8,Je.startServerSync();case 8:return e.next=10,Je.ensureServerSyncEnqueued();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s={data:c,refreshData:a.a.useCallback(Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Je.startServerSync();case 1:case"end":return e.stop()}}),e)}))),[])};return c?a.a.createElement(ye.Provider,{value:s},e.children):a.a.createElement(ve,null)},be=function(){return Object(r.useContext)(ye)},Ee=n(28),ke=Object(N.createInstance)({name:"store-dropbox"}),we="life.rasmuskl.dk"!==window.location.host,je=we?"jh9cnt92wi5e5my":"li12ai4q2cs3dkc";function Oe(){var e=new Ee.Dropbox({clientId:je,fetch:fetch});window.location.assign(e.getAuthenticationUrl(window.location.toString()))}function Se(){return Ce.apply(this,arguments)}function Ce(){return(Ce=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke.getItem("token");case 2:return e.abrupt("return",!!e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke.getItem("snapshot");case 2:return t=e.sent,e.abrupt("return",t||{cursor:null,files:new Set});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return e.next=3,ke.removeItem("snapshot");case 3:e.next=7;break;case 5:return e.next=7,ke.setItem("snapshot",t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(){return Le.apply(this,arguments)}function Le(){return(Le=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c,i,s,o,u,l,d,p,f,m,h=arguments;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(h.length>0&&void 0!==h[0])||h[0],e.next=3,Se();case 3:if(e.sent){e.next=5;break}throw"Not authenticated";case 5:return e.t0=Ee.Dropbox,e.next=8,Be();case 8:if(e.t1=e.sent,e.t2=fetch,e.t3={accessToken:e.t1,fetch:e.t2},n=new e.t0(e.t3),r={cursor:null,files:new Set},!t){e.next=17;break}return e.next=16,Ie();case 16:r=e.sent;case 17:a=!0;case 18:if(!a){e.next=42;break}if(!r.cursor){e.next=30;break}return e.next=22,n.filesListFolderContinue({cursor:r.cursor});case 22:c=e.sent,i=c.entries.filter((function(e){return"file"===e[".tag"]})).map((function(e){var t;return null===(t=e.path_lower)||void 0===t?void 0:t.substring(1)})).filter((function(e){return e})),r.cursor=c.cursor,s=Object(w.a)(i);try{for(s.s();!(o=s.n()).done;)u=o.value,r.files.add(u)}catch(v){s.e(v)}finally{s.f()}a=c.has_more,e.next=38;break;case 30:return e.next=32,n.filesListFolder({path:"",recursive:!0});case 32:l=e.sent,d=l.entries.filter((function(e){return"file"===e[".tag"]})).map((function(e){var t;return null===(t=e.path_lower)||void 0===t?void 0:t.substring(1)})).filter((function(e){return e})),r.cursor=l.cursor,p=Object(w.a)(d);try{for(p.s();!(f=p.n()).done;)m=f.value,r.files.add(m)}catch(v){p.e(v)}finally{p.f()}a=l.has_more;case 38:return e.next=40,De(r);case 40:e.next=18;break;case 42:return e.abrupt("return",r.files);case 43:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(){return function(e){var t={};if("string"!==typeof e)return t;if(!(e=e.trim().replace(/^(\?|#|&)/,"")))return t;return e.split("&").forEach((function(e){var n=e.replace(/\+/g," ").split("="),r=n.shift(),a=n.length>0?n.join("="):null;r=decodeURIComponent(r),a=a?decodeURIComponent(a):null;var c=t[r];void 0===t[r]?t[r]=a:Array.isArray(c)?c.push(a):t[r]=[t[r],a]})),t}(window.location.hash).access_token}function Ke(){return(Ke=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=Pe())){e.next=4;break}return e.next=4,ke.setItem("token",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e,t){return Me.apply(this,arguments)}function Me(){return(Me=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se();case 2:if(e.sent){e.next=4;break}throw new Error("Not authenticated");case 4:return e.t0=Ee.Dropbox,e.next=7,Be();case 7:return e.t1=e.sent,e.t2=fetch,e.t3={accessToken:e.t1,fetch:e.t2},r=new e.t0(e.t3),e.next=13,r.filesUpload({path:"/".concat(t),contents:n});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){return Re.apply(this,arguments)}function Re(){return(Re=Object(S.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se();case 2:if(e.sent){e.next=4;break}throw new Error("Not authenticated");case 4:return e.t0=Ee.Dropbox,e.next=7,Be();case 7:return e.t1=e.sent,e.t2=fetch,e.t3={accessToken:e.t1,fetch:e.t2},n=new e.t0(e.t3),e.next=13,n.filesDownload({path:"/".concat(t)});case 13:return r=e.sent,e.abrupt("return",new Promise((function(e){var t=r.fileBlob,n=new FileReader;n.addEventListener("loadend",(function(){var t=n.result;e(JSON.parse(t))})),n.readAsText(t)})));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(){return Ve.apply(this,arguments)}function Ve(){return(Ve=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke.getItem("token");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){Ke.apply(this,arguments)}();var We,Ye=n(48),He=n.n(Ye);!function(e){e[e.Idle=0]="Idle",e[e.Syncing=1]="Syncing",e[e.Failed=2]="Failed"}(We||(We={}));var Je=new(function(){function e(){var t=this;Object(f.a)(this,e),this.status=We.Idle,this.results=[],this.data=null,this.intervalHandle=null,this.syncListener=new te,this.dataListener=new te,me.notes.changeListener.register((function(e){if(t.data){var n=D.orderBy(t.data.notes.filter((function(t){return t.id!==e.id})).concat(e),(function(e){return e.updatedAt}));t.data=new ge(n,t.data.tasks,t.data.contexts,t.data.projects,t.data.people),t.dataListener.trigger(t.data)}})),me.tasks.changeListener.register((function(e){if(t.data){var n=t.data.tasks.filter((function(t){return t.id!==e.id})).concat(e);t.data=new ge(t.data.notes,n,t.data.contexts,t.data.projects,t.data.people),t.dataListener.trigger(t.data)}})),me.contexts.changeListener.register((function(e){if(t.data){var n=t.data.contexts.filter((function(t){return t.id!==e.id})).concat(e);t.data=new ge(t.data.notes,t.data.tasks,n,t.data.projects,t.data.people),t.dataListener.trigger(t.data)}})),me.projects.changeListener.register((function(e){if(t.data){var n=t.data.projects.filter((function(t){return t.id!==e.id})).concat(e);t.data=new ge(t.data.notes,t.data.tasks,t.data.contexts,n,t.data.people),t.dataListener.trigger(t.data)}})),me.people.changeListener.register((function(e){if(t.data){var n=t.data.people.filter((function(t){return t.id!==e.id})).concat(e);t.data=new ge(t.data.notes,t.data.tasks,t.data.contexts,t.data.projects,n),t.dataListener.trigger(t.data)}}))}return Object(m.a)(e,[{key:"registerSyncListener",value:function(e){this.syncListener.register(e)}},{key:"registerDataListener",value:function(e){this.dataListener.register(e)}},{key:"getResults",value:function(){return this.results}},{key:"getData",value:function(){var e=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data){e.next=4;break}return e.next=3,this.loadData();case 3:this.data=e.sent;case 4:return e.abrupt("return",this.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureServerSyncEnqueued",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.intervalHandle){e.next=2;break}return e.abrupt("return");case 2:this.intervalHandle=setInterval(Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startServerSync();case 2:case"end":return e.stop()}}),e)}))),6e4);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startServerSync",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c,i,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status!==We.Syncing){e.next=2;break}return e.abrupt("return");case 2:return t=new Date,this.status=We.Syncing,this.syncListener.trigger(this.status),e.next=7,this.startDropboxServerSync();case 7:return e.abrupt("return");case 11:return n=e.sent,e.next=14,he.getSyncStatus(n);case 14:return r=e.sent,e.next=17,he.serverSyncFetch(r.fetch);case 17:return a=e.sent,e.next=20,me.importServerEntites(a);case 20:c=r.send.splice(0,100),i=0;case 22:if(!c.length){e.next=32;break}return e.next=25,me.exportServerEntities(c);case 25:return s=e.sent,e.next=28,he.serverSyncSend(s);case 28:i+=s.length,c=r.send.splice(0,100),e.next=22;break;case 32:this.results.push({startAt:t,endAt:new Date,error:null,fetch:r.fetch.length,send:i}),this.status=We.Idle,this.syncListener.trigger(this.status),e.next=42;break;case 37:e.prev=37,e.t0=e.catch(8),this.status=We.Failed,this.results.push({startAt:t,endAt:new Date,error:e.t0&&e.t0.message?e.t0.message:e.t0,fetch:0,send:0}),this.syncListener.trigger(this.status);case 42:case"end":return e.stop()}}),e,this,[[8,37]])})));return function(){return e.apply(this,arguments)}}()},{key:"startDropboxServerSync",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c,i,s,o,u,l,d,p,f,m,h;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e,t){var n,r=new Set(e),a=Object(w.a)(t);try{for(a.s();!(n=a.n()).done;){var c=n.value;r.delete(c)}}catch(i){a.e(i)}finally{a.f()}return r},Se()){e.next=3;break}return e.abrupt("return");case 3:return t=new Date,e.prev=4,e.next=7,Te();case 7:return r=e.sent,e.t0=Set,e.next=11,me.getSyncKeys();case 11:e.t1=e.sent,a=new e.t0(e.t1),c=n(a,r),i=n(r,a),s=Object(w.a)(c),e.prev=16,s.s();case 18:if((o=s.n()).done){e.next=27;break}return u=o.value,e.next=22,me.exportServerEntities([u]);case 22:return l=e.sent,e.next=25,Fe(u,JSON.stringify(l[0]));case 25:e.next=18;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(16),s.e(e.t2);case 32:return e.prev=32,s.f(),e.finish(32);case 35:d=He()(10),p=[],f=Object(w.a)(i);try{for(h=function(){var e=m.value;p.push(d(Object(S.a)(O.a.mark((function t(){var n;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ue(e);case 2:return n=t.sent,t.next=5,me.importServerEntites([n]);case 5:case"end":return t.stop()}}),t)})))))},f.s();!(m=f.n()).done;)h()}catch(v){f.e(v)}finally{f.f()}return e.next=41,Promise.all(p);case 41:this.results.push({startAt:t,endAt:new Date,error:null,fetch:i.size,send:c.size}),this.status=We.Idle,this.syncListener.trigger(this.status),e.next=51;break;case 46:e.prev=46,e.t3=e.catch(4),this.status=We.Failed,this.results.push({startAt:t,endAt:new Date,error:e.t3&&e.t3.message?e.t3.message:e.t3,fetch:0,send:0}),this.syncListener.trigger(this.status);case 51:case"end":return e.stop()}}),e,this,[[4,46],[16,29,32,35]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=me.contexts.getAll(),e.next=3,me.tasks.getAll();case 3:return n=e.sent,r=me.projects.getAll(),a=me.people.getAll(),e.t0=D,e.next=9,me.notes.getAll();case 9:return e.t1=e.sent,e.t2=function(e){return e.updatedAt},c=e.t0.orderBy.call(e.t0,e.t1,e.t2),e.t3=ge,e.t4=c,e.next=16,n;case 16:return e.t5=e.sent,e.next=19,t;case 19:return e.t6=e.sent,e.next=22,r;case 22:return e.t7=e.sent,e.next=25,a;case 25:return e.t8=e.sent,e.abrupt("return",new e.t3(e.t4,e.t5,e.t6,e.t7,e.t8));case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}());function Ge(){return window.matchMedia("(max-width: 768px)").matches}var _e,qe,$e=function(e){var t=r.useState((function(){return!Ge()})),n=Object(d.a)(t,2),a=n[0],c=n[1],i=r.useState(0),s=Object(d.a)(i,2),o=(s[0],s[1]);function l(){Ge()&&c(!1)}return r.useEffect((function(){Je.registerSyncListener((function(){return o((function(e){return e+1}))}))}),[]),r.createElement(r.Fragment,null,r.createElement("section",{style:{display:"flex",overflow:"hidden",height:"100%"}},r.createElement("div",{className:Object(p.a)("navbar")},r.createElement("div",{className:Object(p.a)(E("1rem"))},!a&&r.createElement(r.Fragment,null,r.createElement(u.c,{className:Object(p.a)("button",x),to:"/",onClick:l,exact:!0,activeClassName:"is-active"},"Notes"),r.createElement(u.c,{className:Object(p.a)("button",x),to:"/tasks",onClick:l,exact:!0,activeClassName:"is-active"},"Tasks"))),r.createElement("div",{className:Object(p.a)(E("1rem"))},r.createElement(u.c,{className:"button",to:"/sync"},"Sync: ",We[Je.status]),r.createElement(g,null),r.createElement("a",{className:"button",onClick:function(){return c(!a)}},"Menu"))),r.createElement("div",{className:Object(p.a)("sidebar","list"),style:{overflowY:"auto",paddingTop:52,height:"100%",width:a?void 0:0,overflowX:"hidden"}},r.createElement(u.c,{className:Object(p.a)("item",x),to:"/",onClick:l,exact:!0,activeClassName:"is-active"},"Notes"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/tasks",onClick:l,exact:!0,activeClassName:"is-active"},"Tasks"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/projects",onClick:l,exact:!0,activeClassName:"is-active"},"Projects"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/contexts",onClick:l,exact:!0,activeClassName:"is-active"},"Contexts"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/people",onClick:l,exact:!0,activeClassName:"is-active"},"People"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/playground",onClick:l,exact:!0,activeClassName:"is-active"},"Playground"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/stats",onClick:l,exact:!0,activeClassName:"is-active"},"Stats"),r.createElement(u.c,{className:Object(p.a)("item",x),to:"/settings",onClick:l,exact:!0,activeClassName:"is-active"},"Settings")),r.createElement("div",{className:"main",style:{paddingTop:52}},e.children)))},ze=function(e){var t=e.verticalAround;return void 0===t&&(t=!0),r.createElement("div",{className:Object(p.a)(E(".5rem",!0),k(".5rem",t))},e.children)};function Qe(e){return r.createElement("div",{className:"list"},e.items.map(e.renderItem))}!function(e){e.Active="Active",e.Inactive="Inactive"}(_e||(_e={})),function(e){e.Active="Active",e.Incubated="Incubated",e.Completed="Completed",e.Dropped="Dropped"}(qe||(qe={}));var Ze=n(11),Xe=n.n(Ze),et=function(e,t){var n=r.useState((function(){return new URLSearchParams(window.location.search).get(t)||e})),a=Object(d.a)(n,2),c=a[0],i=a[1];return[c,function(n){var r=new URLSearchParams(window.location.search);i(n),n&&n!==e?r.set(t,n):r.delete(t);var a=r.toString();a.length?window.history.replaceState(null,"","?".concat(a)):window.history.replaceState(null,"",window.location.pathname),window.dispatchEvent(new window.CustomEvent("popstate"))}]},tt=function(e,t,n,a){var c=r.useState((function(){var r=new URLSearchParams(window.location.search);return n(r.get(t))||e})),i=Object(d.a)(c,2),s=i[0],o=i[1];return[s,function(n){var r=new URLSearchParams(window.location.search);if(o(n),n&&n!==e){var c=a(n);c?r.set(t,c):r.delete(t)}else r.delete(t);var i=r.toString();i.length?window.history.replaceState(null,"","?".concat(i)):window.history.replaceState(null,"",window.location.pathname),window.dispatchEvent(new window.CustomEvent("popstate"))}]},nt=function(e){var t=r.useState(!1),n=Object(d.a)(t,2),a=n[0],c=n[1],i=e.alwaysVisible?e.alwaysVisible():null;if(!Ge())return r.createElement("div",{style:Object(I.a)({display:"flex",alignItems:"center"},e.wideStyle),className:E(".3rem")},i,e.children);var s=e.mobileOnly?e.mobileOnly():null;return a?r.createElement("div",{style:{display:"flex",flexDirection:"column"},className:k(".3rem")},r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},i,r.createElement("div",{className:"button",onClick:function(){return c(!1)}},"S")),r.createElement("div",{className:Object(p.a)(k(".3rem"),e.className)},e.children)):r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},i,s,r.createElement("div",{className:"button",onClick:function(){return c(!0)}},"S"))},rt=function(e){var t=be().data;if(!e.contextId)return null;var n=t.contexts.find((function(t){return t.id===e.contextId}));return n?r.createElement("div",{className:"tag is-context"},n.title):null},at=[{id:"1",title:"All",groupedProject:!1,groupedContext:!1},{id:"2",title:"Grouped",groupedProject:!1,groupedContext:!0},{id:"3",title:"Grouped Project",groupedProject:!0,groupedContext:!1}],ct=at[1],it=function(e){var t=be(),n=t.data,a=t.refreshData,c=r.useState(""),i=Object(d.a)(c,2),s=i[0],o=i[1],l=r.useState({showCompleted:!1,showDeferred:!1,showIncubated:!1,showContextBar:!Ge(),includeNested:!0}),p=Object(d.a)(l,2),f=p[0],m=p[1],h=et(null,"context"),v=Object(d.a)(h,2),g=v[0],E=v[1],k=et(null,"project"),j=Object(d.a)(k,2),C=j[0],N=j[1],A=et("2","perspective"),T=Object(d.a)(A,2),L=T[0],P=T[1],K=function(){var e=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=5;break}return e.next=3,me.tasks.create({title:s,contextId:g,projectId:C,content:null,state:"active",stateChangedAt:(new Date).toISOString(),noteId:null});case 3:o(""),a();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(S.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state="completed"===t.state?"active":"completed",t.stateChangedAt=(new Date).toISOString(),e.next=4,me.tasks.save(t);case 4:a();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=function(e){var t=n.projects.find((function(t){return t.id===e.projectId}));return t?r.createElement("div",{className:"tag is-info"},t.title):null},U=function(e){return e.deferredUntil&&new Date(e.deferredUntil)>new Date?r.createElement("div",{className:"tag is-primary",title:"".concat(Xe()(e.deferredUntil).format("YYYY-MM-DD"))},"deferred ",Xe()(e.deferredUntil).fromNow(!0)):null},R=function(e){return e.noteId?r.createElement("div",{className:"tag is-primary"},"N"):null},B=function(e){var t=/(https?:\/\/[^\s]+)/;return e.split(t).map((function(e,n){if(e.match(t)){var a=e.replace(/https?:\/\//,"");return a=a.replace(/\/.*/,"/..."),r.createElement("a",{key:n,href:e,onClick:function(e){e.stopPropagation()},target:"_blank",className:"button is-small is-link",style:{display:"inline-block",marginLeft:"5px",marginRight:"5px"}},a)}return r.createElement("span",{key:n},e)}))},V=function(e){if(g){for(var t=[g],r=[g];r.length&&f.includeNested;){var a=r.pop();if(!a)break;var c,i=Object(w.a)(e.nestedContexts[a]||[]);try{for(i.s();!(c=i.n()).done;){var s=c.value;t.push(s.id),r.push(s.id)}}catch(o){i.e(o)}finally{i.f()}}return t}return n.contexts.map((function(e){return e.id}))},W=function(e,t){var r=n.tasks;if(r=e?r.filter((function(e){return"completed"===e.state})):r.filter((function(e){return"completed"!==e.state})),C&&(r=r.filter((function(e){return e.projectId===C}))),f.showDeferred||(r=r.filter((function(e){return null==e.deferredUntil||new Date(e.deferredUntil)<new Date}))),!f.showIncubated){r=r.filter((function(e){return"incubated"!==e.state}));var a=n.projects.filter((function(e){return e.state===qe.Incubated})).map((function(e){return e.id}));r=r.filter((function(e){return!e.projectId||-1===a.indexOf(e.projectId)}))}if(g){var c=V(t);r=r.filter((function(e){return e.contextId&&-1!==c.indexOf(e.contextId)}))}return r.sort((function(e,t){return t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:0}))},Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(window.location.search.length){var a=new URLSearchParams(window.location.search);n="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(a.toString())))}return r.createElement(u.c,{key:e.id,to:"/tasks/".concat(e.id).concat(n||""),className:Object(y.classes)("item","task",x)},r.createElement("div",{className:"task-checkbox"},r.createElement("input",{type:"checkbox",style:{display:"block",padding:10},checked:"completed"===e.state,onClick:function(e){return e.preventDefault()},onChange:function(t){return F(e,t)}})),r.createElement("div",{className:"task-title",style:{color:"incubated"===e.state?"#999":void 0}},"completed"===e.state?r.createElement("span",{style:{textDecoration:"line-through"}},B(e.title)):B(e.title),"incubated"===e.state?r.createElement("span",null," [Incubated]"):null),r.createElement("div",{className:"task-details"},r.createElement("div",{className:"tags"},R(e),U(e),!t&&r.createElement(rt,{contextId:e.contextId}),!t&&M(e))))},H=at.find((function(e){return e.id==L}))||ct,J=function(e){var t=D.groupBy(e.contexts,(function(e){return e.contextId})),n=D.countBy(e.tasks.filter((function(e){return"active"===e.state})),(function(e){return e.contextId}));return{topContexts:e.contexts.filter((function(e){return!e.contextId})),nestedContexts:t,taskCounts:n}}(n),G=[];if(H.groupedContext)!function(){var e=V(J);g||e.push(null);var t,a=Object(w.a)(e);try{var c=function(){var a=t.value,c=n.contexts.find((function(e){return e.id===a})),i=W(!1,J);if(a){if(!c)return"continue";if(!(i=i.filter((function(e){return e.contextId===a}))).length)return"continue";G.push(r.createElement("div",{style:{padding:".6rem",background:"#00503C"}},c.title))}else{if(!(i=i.filter((function(e){return e.contextId===a}))).length)return"continue";G.push(r.createElement("div",{style:{padding:".6rem",background:"#00503C"}},"No Context"))}var s=[qe.Active,qe.Incubated,qe.Completed,qe.Dropped],o=[],l=n.projects;null!==C&&(l=l.filter((function(e){return e.id===C}))),l.sort((function(e,t){return s.indexOf(e.state)-s.indexOf(t.state)})).map((function(t){var n=i.filter((function(e){return e.projectId===t.id}));if(!n.length)return t.state===qe.Active&&(a?t.contextId&&-1!==e.indexOf(t.contextId)&&o.push(t):o.push(t)),null;G.push(r.createElement(r.Fragment,{key:"p-".concat(t.id)},r.createElement("div",{className:"header link",onClick:function(){N(t.id),E(t.contextId)}},t.title," ",t.state!==qe.Active?"[".concat(t.state,"]"):"",r.createElement("div",{style:{display:"flex"}},r.createElement(u.c,{className:"button small",to:"/projects/".concat(t.id)},"Edit"))),n.map((function(e){return Y(e,!0)}))))}));var d=i.filter((function(e){return null===e.projectId}));d.length&&G.push(r.createElement(r.Fragment,{key:"no-p-".concat(a)},r.createElement("div",{className:"header"},"No Project"),d.map((function(e){return Y(e,!0)}))));for(var p=function(){var e=h[m];if(e.contextId!==a)return"continue";G.push(r.createElement(r.Fragment,{key:"p-".concat(e.id)},r.createElement("div",{className:"header link",onClick:function(){N(e.id),E(e.contextId)}},e.title," ",e.state!==qe.Active?"[".concat(e.state,"]"):""," [Empty]",r.createElement("div",{style:{display:"flex"}},r.createElement("div",{className:"tags"},r.createElement(rt,{contextId:e.contextId})),r.createElement(u.c,{className:"button small",to:"/projects/".concat(e.id)},"Edit")))))},m=0,h=o;m<h.length;m++)p();f.showCompleted&&G.push(r.createElement(r.Fragment,{key:"completed"},r.createElement("div",{className:"header"},"Completed"),W(!0,J).map((function(e){return Y(e)}))))};for(a.s();!(t=a.n()).done;)c()}catch(i){a.e(i)}finally{a.f()}}();else if(H.groupedProject){var _=W(!1,J),q=[qe.Active,qe.Incubated,qe.Completed,qe.Dropped],$=[],z=n.projects;null!==C&&(z=z.filter((function(e){return e.id===C})));var Q=V(J);z.sort((function(e,t){return q.indexOf(e.state)-q.indexOf(t.state)})).map((function(e){var t=_.filter((function(t){return t.projectId===e.id}));if(!t.length)return e.state===qe.Active&&(g?e.contextId&&-1!==Q.indexOf(e.contextId)&&$.push(e):$.push(e)),null;G.push(r.createElement(r.Fragment,{key:"p-".concat(e.id)},r.createElement("div",{className:"header link",onClick:function(){N(e.id),E(e.contextId)}},e.title," ",e.state!==qe.Active?"[".concat(e.state,"]"):"",r.createElement("div",{style:{display:"flex"}},r.createElement("div",{className:"tags"},r.createElement(rt,{contextId:e.contextId})),r.createElement(u.c,{className:"button small",to:"/projects/".concat(e.id)},"Edit"))),t.map((function(e){return Y(e)}))))}));var Z=_.filter((function(e){return null===e.projectId}));Z.length&&G.push(r.createElement(r.Fragment,{key:"no-p"},r.createElement("div",{className:"header"},"No Project"),Z.map((function(e){return Y(e)}))));for(var X=function(){var e=te[ee];G.push(r.createElement(r.Fragment,{key:"p-".concat(e.id)},r.createElement("div",{className:"header link",onClick:function(){N(e.id),E(e.contextId)}},e.title," ",e.state!==qe.Active?"[".concat(e.state,"]"):""," [Empty]",r.createElement("div",{style:{display:"flex"}},r.createElement("div",{className:"tags"},r.createElement(rt,{contextId:e.contextId})),r.createElement(u.c,{className:"button small",to:"/projects/".concat(e.id)},"Edit")))))},ee=0,te=$;ee<te.length;ee++)X();f.showCompleted&&G.push(r.createElement(r.Fragment,{key:"completed"},r.createElement("div",{className:"header"},"Completed"),W(!0,J).map((function(e){return Y(e)}))))}else G.push(r.createElement(r.Fragment,{key:"tasks"},W(!1,J).map((function(e){return Y(e)})),f.showCompleted&&r.createElement(r.Fragment,null,r.createElement("div",{className:"header"},"Completed"),W(!0,J).map((function(e){return Y(e)})))));return r.createElement("div",{style:{display:"flex",height:"100%"}},f.showContextBar&&r.createElement("div",{style:{borderRight:"1px solid #666",width:200}},r.createElement(Qe,{items:J.topContexts,renderItem:function(e){return function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.state&&t.state===_e.Inactive?r.createElement(r.Fragment,{key:t.id}):r.createElement(r.Fragment,{key:t.id},r.createElement("div",{onClick:function(){return E(t.id)},style:{paddingLeft:10+10*a},className:Object(y.classes)("item",x,b)},t.title," ",r.createElement("span",{style:{color:"#999"}},n.taskCounts[t.id])),n.nestedContexts[t.id]&&n.nestedContexts[t.id].map((function(t){return e(t,n,a+1)})))}(e,J)}})),r.createElement("div",{style:{width:"100%"}},r.createElement(ze,null,r.createElement(nt,{alwaysVisible:function(){return r.createElement("div",{className:"button",onClick:function(){E(null),N(null)}},"R")},mobileOnly:function(){return r.createElement("div",{className:"button",style:{marginLeft:"auto",marginRight:8},onClick:function(){return m(Object(I.a)({},f,{showContextBar:!f.showContextBar}))}},"C")}},r.createElement("select",{style:{padding:"0.3rem",display:"block"},value:g||"",onChange:function(e){return E(""===e.target.value?null:e.target.value)}},r.createElement("option",{value:""},"All contexts"),n.contexts.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("select",{style:{padding:"0.3rem",display:"block"},value:C||"",onChange:function(e){return N(""===e.target.value?null:e.target.value)}},r.createElement("option",{value:""},"All projects"),n.projects.filter((function(e){return e.state===qe.Active})).map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("select",{style:{padding:"0.3rem",display:"block"},value:L||"",onChange:function(e){return P(""===e.target.value?null:e.target.value)}},r.createElement("option",{value:""},"Select Perspective"),at.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,r.createElement("input",{id:"completed-box",type:"checkbox",checked:f.showCompleted,onChange:function(){return m(Object(I.a)({},f,{showCompleted:!f.showCompleted}))}}),r.createElement("label",{htmlFor:"completed-box"},"Show completed")),r.createElement("div",null,r.createElement("input",{id:"deferred-box",type:"checkbox",checked:f.showDeferred,onChange:function(){return m(Object(I.a)({},f,{showDeferred:!f.showDeferred}))}}),r.createElement("label",{htmlFor:"deferred-box"},"Show deferred")),r.createElement("div",null,r.createElement("input",{id:"incubated-box",type:"checkbox",checked:f.showIncubated,onChange:function(){return m(Object(I.a)({},f,{showIncubated:!f.showIncubated}))}}),r.createElement("label",{htmlFor:"incubated-box"},"Show incubated")),r.createElement("div",null,r.createElement("input",{id:"context-box",type:"checkbox",checked:f.showContextBar,onChange:function(){return m(Object(I.a)({},f,{showContextBar:!f.showContextBar}))}}),r.createElement("label",{htmlFor:"context-box"},"Show context bar")),r.createElement("div",null,r.createElement("input",{id:"include-nested-box",type:"checkbox",checked:f.includeNested,onChange:function(){return m(Object(I.a)({},f,{includeNested:!f.includeNested}))}}),r.createElement("label",{htmlFor:"include-nested-box"},"Include nested contexts"))),r.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add task...",value:s,onChange:function(e){return o(e.target.value)},onKeyPress:K})),r.createElement("div",{className:"list"},G)))},st=n(24),ot=Object(N.createInstance)({name:"drafts"});function ut(e){return e?"draft-".concat(e):"draft-new"}function lt(){return(lt=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot.keys();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.replace("draft-","")})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e){return pt.apply(this,arguments)}function pt(){return(pt=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot.getItem(ut(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ft(){return(ft=Object(S.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot.setItem(ut(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mt(e){return ht.apply(this,arguments)}function ht(){return(ht=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot.removeItem(ut(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vt(e){var t=r.useState(!1),n=Object(d.a)(t,2),a=n[0],c=n[1],i=r.useRef(void 0),s=r.useRef();return r.createElement("div",{className:"tag-input",onFocus:function(){return clearTimeout(i.current),void(a||c(!0))},onBlur:function(){a&&(i.current=setTimeout((function(){c(!1)}),100))}},r.createElement("div",{className:"tags"},e.tagState.selectedTags.map((function(e,t){return r.createElement(yt,{key:"tag-".concat(e,"-").concat(t),name:e})})),r.createElement("input",{ref:s,placeholder:"Tag",type:"text",className:"",onChange:function(t){return function(t){e.onChange(e.tagState.withText(t.target.value))}(t)},onKeyDown:function(t){return function(t){"ArrowUp"===t.key?e.onChange(e.tagState.decrementIndex()):"ArrowDown"===t.key?e.onChange(e.tagState.incrementIndex()):"Enter"===t.key?""===e.tagState.text?e.onChange(e.tagState.addSelectedTag()):e.onChange(e.tagState.addText()):"Tab"===t.key?(e.onChange(e.tagState.addSelectedTag()),t.preventDefault()):"Backspace"===t.key&&""===e.tagState.text&&e.onChange(e.tagState.reopenLastTag())}(t)},value:e.tagState.text})),a&&e.tagState.getFilteredAvailableTags().length>0&&r.createElement("div",{className:"panel"},e.tagState.getFilteredAvailableTags().slice(0,10).map((function(t,n){return r.createElement("div",{key:"available-tag-".concat(t),style:e.tagState.index===n?{background:"#078263"}:{},onClick:function(){return n=t,e.onChange(e.tagState.addTag(n)),void s.current.focus();var n}},t)}))))}var gt=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(f.a)(this,e),this.availableTags=void 0,this.selectedTags=void 0,this.text=void 0,this.index=void 0,this.availableTags=t,this.selectedTags=n,this.text=r,this.index=a}return Object(m.a)(e,[{key:"withText",value:function(t){return new e(this.availableTags,this.selectedTags,t,this.index)}},{key:"withAvailableTags",value:function(t){return new e(t,this.selectedTags,this.text,this.index)}},{key:"withSelectedTags",value:function(t){return new e(this.availableTags,t,this.text,this.index)}},{key:"decrementIndex",value:function(){return new e(this.availableTags,this.selectedTags,this.text,Math.max(0,this.index-1))}},{key:"incrementIndex",value:function(){return new e(this.availableTags,this.selectedTags,this.text,Math.max(0,Math.min(this.availableTags.length-1,this.index+1)))}},{key:"addSelectedTag",value:function(){return new e(this.availableTags,this.selectedTags.concat([this.getFilteredAvailableTags()[this.index]]),"",0)}},{key:"addTag",value:function(t){return new e(this.availableTags,this.selectedTags.concat([t]),"",0)}},{key:"addText",value:function(){return new e(this.availableTags,this.selectedTags.concat([this.text]),"",0)}},{key:"reopenLastTag",value:function(){var t=this.selectedTags[this.selectedTags.length-1];return new e(this.availableTags,this.selectedTags.slice(0,this.selectedTags.length-1),t,0)}},{key:"getFilteredAvailableTags",value:function(){var e=this;return this.availableTags.filter((function(t){return-1===e.selectedTags.indexOf(t)})).filter((function(t){return-1!==t.toLowerCase().indexOf(e.text)}))}},{key:"getTags",value:function(){return this.selectedTags.join(" ")}}]),e}(),yt=function(e){return r.createElement("div",{className:"tag is-dark"},e.name)},xt=function(e){return r.createElement("div",{className:"tags",style:{marginBottom:0}},e.tags&&e.tags.split(" ").map((function(e,t){return r.createElement(yt,{key:t,name:e})})))},bt=n(51),Et=n.n(bt);n(72);function kt(e){if(e.dailyDate)return"Daily - ".concat(Xe()(e.dailyDate).format("MMMM Do, YYYY"));if(e.title&&e.title.length)return e.title;var t=/# (.+)/.exec(e.content);return t&&t.length>1?t[1]:""}function wt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function jt(e){return new RegExp("\\[\\[".concat(wt(e),"\\]\\]"),"i")}var Ot,St=/\[\[([^\]]+)\]\]/gi,Ct=function(e){var t=Object(l.g)(),n=be().data;window.lifeNavigate=function(e){return t.push(e),!1};var a=e.markdown.replace(St,(function(t,r){var a=e.contextId,c=r,i=n.contexts.find((function(e){return(t=e.title,new RegExp("^".concat(wt(t),"/"),"i")).test(r);var t}));i&&(c=c.substring(i.title.length+1),a=i.id);var s=new RegExp("^".concat(wt(c),"$"),"i"),o=n.notes.find((function(e){return e.contextId===a&&s.test(e.title)}));if(o){var u="/notes/".concat(o.id);return'<span style="color: #444">[[ </span><a onclick="return lifeNavigate(\''.concat(u,'\')" href="').concat(u,'">').concat(r,'</a><span style="color: #444"> ]]</span>')}var l="/notes/new?title=".concat(encodeURIComponent(r)).concat(e.contextId?"&context=".concat(e.contextId):"");return'<span style="color: #444">[[ </span><a onclick="return lifeNavigate(\''.concat(l,'\')" href="').concat(l,'">').concat(r,'</a><span style="color: #444"> ? ]]</span>')})),c=Et()(a);return r.createElement("div",{className:"marked-viewer note markdown-body",dangerouslySetInnerHTML:{__html:c}})},It=n(30),Nt=n.n(It),Dt=n(22);n(45),n(46);!function(e){e[e.Split=0]="Split",e[e.Editor=1]="Editor",e[e.Preview=2]="Preview"}(Ot||(Ot={}));var At=function(e){return r.createElement("div",{className:Object(p.a)(E(".5rem"))},r.createElement("button",{className:"button",style:{background:e.mode&&"markdown"===e.mode?void 0:"#444"},onClick:function(){return e.onModeChange("markdown")}},"Markdown"),r.createElement("button",{className:"button",style:{background:"tree"!==e.mode?"#444":void 0},onClick:function(){return e.onModeChange("tree")}},"Tree"))},Tt=function(e){return r.createElement("div",{className:Object(p.a)(E(".5rem"))},r.createElement("button",{className:"button",style:{background:e.mode!==Ot.Split?"#444":void 0},onClick:function(){return e.onModeChange(Ot.Split)}},"Split"),r.createElement("button",{className:"button",style:{background:e.mode!==Ot.Editor?"#444":void 0},onClick:function(){return e.onModeChange(Ot.Editor)}},"Editor"),r.createElement("button",{className:"button",style:{background:e.mode!==Ot.Preview?"#444":void 0},onClick:function(){return e.onModeChange(Ot.Preview)}},"Preview"))},Lt=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=this,t={};this.props.expand&&(t.width="100%",t.height="100%",t.zIndex=100,t.display="flex",t.maxHeight="100%");var n="1px solid #666",a=[],c={flexGrow:1,minWidth:"50%",borderTop:n,height:"100%"},i={flexGrow:1,minWidth:"50%",background:"transparent",padding:"1rem",borderTop:n};return this.props.mode===Ot.Split&&(c.borderRight=n,i.overflowY="scroll"),this.props.mode!==Ot.Editor&&this.props.mode!==Ot.Split||a.push(r.createElement(Nt.a,{key:"editor",value:this.props.text,fontSize:18,style:c,onChange:function(t){return e.props.onTextChanged(t)},mode:"markdown",theme:"monokai",showGutter:!1,showPrintMargin:!1,wrapEnabled:!0,enableBasicAutocompletion:[Dt.snippetCompleter,Dt.textCompleter,Dt.keyWordCompleter],enableLiveAutocompletion:!0,enableSnippets:!0})),this.props.mode!==Ot.Preview&&this.props.mode!==Ot.Split||a.push(r.createElement("div",{key:"2",style:i},r.createElement(Ct,{markdown:this.props.text,contextId:this.props.contextId}))),r.createElement("div",{style:t},a)}}]),n}(r.Component),Pt=function(e){var t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!1),s=Object(d.a)(i,2),o=s[0],u=s[1];if(r.useEffect((function(){try{var t=[];e.json&&(t=JSON.parse(e.json)),c(t)}catch(n){u(!0)}}),[e.json]),o)return r.createElement("div",null,"Invalid json");if(!a)return r.createElement(ve,null);var l=e.referenceTitle?jt(e.referenceTitle):null;return r.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}},r.createElement("div",{style:{width:"100%"}},a.map((function(t,n){return function t(n,a,c,i){var s=[];if(i){if(!i.test(n.text))return r.createElement(r.Fragment,{key:"".concat(c,"-").concat(a)},n.nodes.map((function(e,n){return t(e,n,c+1,i)})));i=null,c>0&&s.push(r.createElement("div",{key:"extra-".concat(a,"-").concat(c),style:{paddingTop:8,color:"#aaa"}},"... > ".repeat(c)))}return r.createElement(r.Fragment,{key:"".concat(c,"-").concat(a)},s,r.createElement("div",{style:{display:"flex",padding:".6rem .8rem"}},r.createElement("div",{style:{letterSpacing:".5rem",color:"#777",lineHeight:1.5}},"\u2022"),r.createElement(Ct,{markdown:n.text,contextId:e.contextId})),r.createElement("div",{style:{borderLeft:"1px solid #555",paddingLeft:16,marginLeft:16}},n.nodes.map((function(e,n){return t(e,n,c+1,i)}))))}(t,n,0,l)}))))},Kt=function(e){var t=be().data,n=Object(r.useState)((function(){if(!e.text||""===e.text)return!1;try{return JSON.parse(e.text),!1}catch(t){return!0}})),a=Object(d.a)(n,1)[0],c=Object(r.useState)((function(){return a?[]:e.text&&""!==e.text?JSON.parse(e.text):[{text:"",nodes:[]}]})),i=Object(d.a)(c,2),s=i[0],o=i[1],u=Object(r.useRef)(null),l=Object(r.useState)(s[0]),f=Object(d.a)(l,2),m=f[0],h=f[1],v=r.useState((function(){return t.notes.map((function(n){if(!n.title||!n.title.length)return null;if(n.contextId===e.contextId)return n.title;var r=t.contexts.find((function(e){return e.id===n.contextId}));return r?"".concat(r.title,"/").concat(n.title):null})).filter((function(e){return null!==e}))})),g=Object(d.a)(v,1)[0];if(a)return r.createElement("div",null,"Invalid tree content (not valid JSON).");var y=function(t,n){t.text=n,o(Object(C.a)(s)),e.onTextChanged(JSON.stringify(s))},x=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=Object(w.a)(r);try{for(c.s();!(n=c.n()).done;){var i=n.value;if(i===t)return a;var o=e(t,i.nodes,i);if(o)return o}}catch(u){c.e(u)}finally{c.f()}return null},b=function(){for(var e=[],t=Object(C.a)(s).reverse();t.length;){var n=t.pop();if(!n)return e;e.push(n);var r,a=Object(w.a)(Object(C.a)(n.nodes).reverse());try{for(a.s();!(r=a.n()).done;){var c=r.value;t.push(c)}}catch(i){a.e(i)}finally{a.f()}}return e},k=function(e){e.text.length||e.nodes.length||function(e){var t=x(e),n=t?t.nodes:s,r=n.findIndex((function(t){return t===e}));n.splice(r,1),o(Object(C.a)(s))}(e)},j=function(e){var t=x(e),n=t?t.nodes:s,r=n.findIndex((function(t){return t===e}));0!==r&&(n.splice(r,1),n[r-1].nodes.push(e),o(Object(C.a)(s)))},O=function(e){var t=x(e);if(null!==t){var n=x(t),r=n?n.nodes:s,a=r.findIndex((function(e){return e===t}));r.splice(a+1,0,e);var c=t.nodes.findIndex((function(t){return t===e}));t.nodes.splice(c,1),o(Object(C.a)(s))}},S=[{name:"indent",bindKey:{win:"tab",mac:"tab"},exec:function(){return setTimeout((function(){j(m)}),0),!0}},{name:"unindent",bindKey:{win:"shift+tab",mac:"shift+tab"},exec:function(){return setTimeout((function(){O(m)}),0),!0}},{name:"enter",bindKey:{win:"enter",mac:"enter"},exec:function(){if(""!==m.text){var e=u.current&&0===u.current.editor.getCursorPosition().row&&0===u.current.editor.getCursorPosition().column;return setTimeout((function(){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=x(e),r=n?n.nodes:s,a=r.findIndex((function(t){return t===e})),c={text:"",nodes:[]};return r.splice(a+(t?0:1),0,c),o(Object(C.a)(s)),c}(m,!!e);h(t)}),0),!0}}},{name:"up",bindKey:{win:"up",mac:"up"},exec:function(){var e=b(),t=e.findIndex((function(e){return e===m}));return t=Math.max(0,t-1),setTimeout((function(){h(e[t]),k(m)}),0),!0}},{name:"down",bindKey:{win:"down",mac:"down"},exec:function(){var e=b(),t=e.findIndex((function(e){return e===m}));return t=Math.min(e.length-1,t+1),setTimeout((function(){h(e[t]),k(m)}),0),!0}},{name:"space",bindKey:{win:"space",mac:"space"},exec:function(){return!(!u.current||0!==u.current.editor.getCursorPosition().row||0!==u.current.editor.getCursorPosition().column)&&(setTimeout((function(){j(m)}),0),!0)}},{name:"backspace",bindKey:{win:"backspace",mac:"backspace"},exec:function(){return!(!u.current||0!==u.current.editor.getCursorPosition().row||0!==u.current.editor.getCursorPosition().column)&&(setTimeout((function(){O(m)}),0),!0)}}],I={getCompletions:function(e,t,n,r,a){var c=t.getTokenAt(n.row,n.column);if(c){if(c.value.substring(n.column-r.length-"[[".length).startsWith("[["))a(null,g.map((function(e){return{caption:e,snippet:e,meta:"note"}})))}}};return r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",background:"#444",position:"fixed",height:36,bottom:0,left:0,right:0},className:Object(p.a)(E(".5rem"))},r.createElement("div",{className:"button",onClick:function(e){O(m),u.current&&u.current.editor.focus()}},"\u2190"),r.createElement("div",{className:"button",onClick:function(e){j(m),u.current&&u.current.editor.focus()}},"\u2192"),r.createElement("div",{className:"button",onClick:function(e){u.current&&(u.current.editor.session.insert(u.current.editor.getCursorPosition(),"[["),u.current.editor.focus())}},"[["),r.createElement("div",{className:"button",onClick:function(e){u.current&&(u.current.editor.session.insert(u.current.editor.getCursorPosition(),"]]"),u.current.editor.focus())}},"]]")),r.createElement("div",{style:{height:"100%",marginBottom:36}},s.map((function(t,n){return function t(n,a,c){var i=n===m;return r.createElement(r.Fragment,{key:"".concat(c,"-").concat(a)},r.createElement("div",{style:{display:"flex",background:i?"#292929":void 0,padding:".6rem .8rem"},onClick:function(){i||h(n)}},r.createElement("div",{style:{letterSpacing:".5rem",color:i?"#078263":"#777",lineHeight:1.5}},"\u2022"),i?r.createElement(Nt.a,{key:"editor",ref:u,value:n.text,fontSize:16,style:{background:"transparent",width:"100%"},onChange:function(e){return y(n,e)},mode:"markdown",theme:"monokai",focus:!0,highlightActiveLine:!1,showGutter:!1,showPrintMargin:!1,wrapEnabled:!0,maxLines:1/0,commands:S,enableBasicAutocompletion:[I,Dt.snippetCompleter,Dt.textCompleter,Dt.keyWordCompleter],enableLiveAutocompletion:!0,enableSnippets:!0}):r.createElement(Ct,{markdown:n.text,contextId:e.contextId})),r.createElement("div",{style:{borderLeft:"1px solid #555",marginLeft:16,paddingLeft:16}},n.nodes.map((function(e,n){return t(e,n,c+1)}))))}(t,n,0)}))))},Ft=(n(78),function(e){var t=A.a.orderBy(e.data.contexts.filter((function(e){return e.state===_e.Active})),(function(e){return e.title})),n=A.a.orderBy(e.data.contexts.filter((function(e){return e.state!==_e.Active})),(function(e){return e.title}));return r.createElement("select",{className:"input is-large",value:e.contextId||"",onChange:function(t){return e.onChange(t.target.value)}},r.createElement("option",{value:""},"Not set"),t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)})),r.createElement("option",{value:"--inactive--",disabled:!0},"-- Inactive"),n.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)})))}),Mt=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={loaded:!1,title:"",text:"",tags:"",tagState:new gt([],[]),splitMode:Ge()?Ot.Editor:Ot.Split,noteMode:"tree",contextId:null,dailyDate:null},r.onTextChanged=r.onTextChanged.bind(Object(st.a)(r)),r.onSave=r.onSave.bind(Object(st.a)(r)),r}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n,r,a,c,i,s,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt(this.props.id);case 2:t=e.sent,n=this.props.title,r=this.props.text,a=this.props.tags,c=this.props.noteMode,i=this.props.contextId,s=this.props.dailyDate,o={},null!==t&&t!==r&&t.length>0&&(r=t),void 0!==n&&(o.title=n),void 0!==r&&(o.text=r),void 0!==c&&(o.noteMode=c),void 0!==i&&(o.contextId=i),void 0!==s&&(o.dailyDate=s),o.tagState=this.state.tagState.withAvailableTags(this.props.availableTags),a&&a.length>0&&(o.tagState=o.tagState.withSelectedTags(a.split(" "))),o.loaded=!0,this.setState(o);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(e){this.setState({tagState:this.state.tagState.withAvailableTags(e.availableTags)})}},{key:"onTitleChanged",value:function(e){this.setState({title:e.target.value})}},{key:"onTextChanged",value:function(e){e!==this.props.text&&function(e,t){ft.apply(this,arguments)}(this.props.id,e),this.setState({text:e})}},{key:"onSave",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.id||null)){e.next=17;break}return e.next=4,me.notes.get(t);case 4:if(null!==(n=e.sent)){e.next=7;break}throw new Error("Note is null?");case 7:return n.title=this.state.title,n.content=this.state.text,n.tags=this.state.tagState.getTags(),n.mode=this.state.noteMode,n.contextId=this.state.contextId,n.dailyDate=this.state.dailyDate,e.next=15,me.notes.save(n);case 15:e.next=19;break;case 17:return e.next=19,me.notes.create({title:this.state.title,content:this.state.text,tags:this.state.tagState.getTags(),noteFor:null,mode:this.state.noteMode,contextId:this.state.contextId,dailyDate:this.state.dailyDate});case 19:return e.next=21,mt(this.props.id);case 21:this.props.onNoteAdded();case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.loaded?r.createElement("div",{style:{width:"100%",flex:1,display:"flex",flexDirection:"column"}},r.createElement(ze,{verticalAround:!1},r.createElement(nt,{wideStyle:{justifyContent:"space-between"},alwaysVisible:function(){return r.createElement(r.Fragment,null,void 0===e.props.id?r.createElement("button",{className:"button is-primary",onClick:e.onSave},"Add note"):r.createElement("button",{className:"button is-primary",onClick:e.onSave},"Update note"),r.createElement(Ft,{contextId:e.state.contextId,data:e.props.data,onChange:function(t){return e.setState({contextId:t})}}),r.createElement("input",{type:"date",className:"input",value:e.state.dailyDate&&Xe()(e.state.dailyDate).format("YYYY-MM-DD")||"",onChange:function(t){var n;""===(n=t.target.value)?e.setState({dailyDate:null}):e.setState({dailyDate:new Date(n).toISOString()})}}))}},r.createElement(At,{mode:this.state.noteMode,onModeChange:function(t){return e.setState({noteMode:t})}}),r.createElement(Tt,{mode:this.state.splitMode,onModeChange:function(t){return e.setState({splitMode:t})}}))),r.createElement(ze,null,!this.props.noteFor&&!this.state.dailyDate&&r.createElement(r.Fragment,null,r.createElement("input",{type:"text",placeholder:"Title",className:"input is-large is-wide",value:this.state.title,onChange:this.onTitleChanged.bind(this)}),r.createElement(vt,{tagState:this.state.tagState,onChange:function(t){return e.setState({tagState:t})}})),this.state.dailyDate&&r.createElement("h1",null,kt({dailyDate:this.state.dailyDate,title:this.state.title,content:this.state.text}))),r.createElement("div",{style:{flex:1}},"markdown"===this.state.noteMode?r.createElement(Lt,{text:this.state.text,expand:!0,onTextChanged:this.onTextChanged,mode:this.state.splitMode,data:this.props.data,contextId:this.state.contextId}):r.createElement(Kt,{text:this.state.text,onTextChanged:this.onTextChanged,contextId:this.state.contextId}))):r.createElement(ve,null)}}]),n}(r.Component),Ut=function(e){var t=be(),n=t.data,a=t.refreshData,c={},i=r.useState(!1),s=Object(d.a)(i,2),o=s[0],f=s[1],m=et(null,"source"),h=Object(d.a)(m,1)[0];if(o)return r.createElement(l.a,{to:h?decodeURIComponent(h):"/"});var v,g=Object(w.a)(n.notes||[]);try{for(g.s();!(v=g.n()).done;){var y=v.value;if(y.tags&&y.tags.length){var x,b=Object(w.a)(y.tags.split(" "));try{for(b.s();!(x=b.n()).done;){var k=x.value;c[k]||(c[k]=0),c[k]+=1}}catch(N){b.e(N)}finally{b.f()}}}}catch(N){g.e(N)}finally{g.f()}var j=Object.keys(c).sort((function(e,t){return c[t]-c[e]}));if(e.id){var O=n.notes.find((function(t){return t.id==e.id}));return O?r.createElement(r.Fragment,null,r.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.createElement(ze,null,r.createElement("div",{className:Object(p.a)(E(".5rem"))},r.createElement(u.c,{to:h?decodeURIComponent(h):"/",className:"button"},"Back"),!O.noteFor&&r.createElement(u.c,{to:"/notes/".concat(O.id),className:"button"},"Show"))),r.createElement(Mt,Object.assign({},O,{data:n,text:O.content,availableTags:j,noteMode:O.mode||"tree",dailyDate:O.dailyDate,onNoteAdded:function(){a(),f(!0)}})))):r.createElement("div",null,"Note not found.")}var S=new URLSearchParams(window.location.search),C=S.get("title"),I=S.get("context");return r.createElement(r.Fragment,null,r.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.createElement(ze,null,r.createElement(u.c,{to:"/",className:"button"},"Back")),r.createElement(Mt,{title:C||void 0,contextId:I,availableTags:j,data:n,noteFor:null,dailyDate:null,noteMode:"tree",onNoteAdded:function(){a(),f(!0)}})))},Rt=function(e){var t=be().data,n=jt(e.title),a=t.notes.filter((function(t){return t.contextId===e.contextId&&n.test(t.content)}));return 0===a.length?null:r.createElement("div",{style:{paddingTop:32}},r.createElement("div",{style:{fontWeight:"bold"}},a.length,' linked references for "',e.title,'"'),a.map((function(t){return r.createElement("div",{key:t.id,style:{marginTop:16}},r.createElement(u.b,{to:"/notes/".concat(t.id),style:{color:"#078263"}},kt(t)),r.createElement("div",{style:{paddingLeft:16,background:"#222",marginTop:8}},"markdown"===t.mode?r.createElement(Ct,{markdown:t.content,contextId:t.contextId}):r.createElement(Pt,{json:t.content,contextId:t.contextId,referenceTitle:e.title})))})))},Bt=function(e){var t=be().data,n=et(null,"source"),a=Object(d.a)(n,1)[0],c=t.notes.find((function(t){return t.id===e.id}));if(!c)return r.createElement("div",null,"Note not found.");var i=null;return i=c.mode&&"markdown"!==c.mode?r.createElement(Pt,{json:c.content,contextId:c.contextId}):r.createElement(Ct,{markdown:c.content,contextId:c.contextId}),r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement(u.c,{to:a?decodeURIComponent(a):"/",className:"button"},"Back"),r.createElement(u.c,{to:"/notes/".concat(c.id,"/edit"),className:"button"},"Edit")),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,kt(c)),r.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.createElement(xt,{tags:c.tags}),r.createElement(rt,{contextId:c.contextId})),i,r.createElement(Rt,{title:kt(c),contextId:c.contextId}))))},Vt=n(52),Wt=n.n(Vt),Yt=n(53),Ht=function(e){var t,n=be(),a=n.data,c=n.refreshData,i=et(null,"search"),s=Object(d.a)(i,2),o=s[0],l=s[1],f=tt([],"tags",(function(e){return null!==e?e.split("|"):[]}),(function(e){return e.join("|")})),m=Object(d.a)(f,2),h=m[0],v=m[1],g=r.useState(!Ge()),y=Object(d.a)(g,2),b=y[0],E=y[1],k=r.useState(null),j=Object(d.a)(k,2),O=j[0],S=j[1],C=r.useState(null),I=Object(d.a)(C,2),N=I[0],D=I[1],A=r.useState(!1),T=Object(d.a)(A,2),L=T[0],P=T[1],K=r.useState([]),F=Object(d.a)(K,2),M=F[0],U=F[1],R=tt(t=!1,"no-context",(function(e){return"true"===e}),(function(e){return e===t?null:e.toString()})),B=Object(d.a)(R,2),V=B[0],W=B[1];r.useEffect((function(){(function(){return lt.apply(this,arguments)})().then(U)}),[]);var Y,H=Object(Yt.a)(100,(function(e){if(e&&e.length)if(null!==N){var t=N.search(e);S(t.map((function(e){return{id:e.ref,score:e.score}})))}else{var n=Wt()((function(){this.field("title"),this.field("text");var e,t=Object(w.a)(a.notes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.add({id:n.id,title:n.title,text:n.content})}}catch(r){t.e(r)}finally{t.f()}}));D(n);var r=n.search(e);S(r.map((function(e){return{id:e.ref,score:e.score}})))}else S(null)})),J=a.notes||[],G={},_=Object(w.a)(h);try{var q=function(){var e=Y.value;J=J.filter((function(t){return-1!==t.tags.split(" ").indexOf(e)}))};for(_.s();!(Y=_.n()).done;)q()}catch(ae){_.e(ae)}finally{_.f()}L||(J=J.filter((function(e){return!e.noteFor}))),V&&(J=J.filter((function(e){return!e.contextId}))),O&&(J=O.map((function(e){var t=J.findIndex((function(t){return t.id===e.id}));return J[t]})).filter((function(e){return e})));var $,z=Object(w.a)(J);try{for(z.s();!($=z.n()).done;){var Q=$.value;if(Q.tags){var Z,X=Object(w.a)(Q.tags.split(" "));try{for(X.s();!(Z=X.n()).done;){var ee=Z.value;G[ee]||(G[ee]=0),G[ee]+=1}}catch(ae){X.e(ae)}finally{X.f()}}}}catch(ae){z.e(ae)}finally{z.f()}var te=Object.keys(G).map((function(e){return{key:e,count:G[e],active:-1!==h.indexOf(e)}})).sort((function(e,t){return t.count-e.count})),ne=null;if(window.location.search.length){var re=new URLSearchParams(window.location.search);ne="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(re.toString())))}return r.createElement("div",{style:{display:"flex",height:"100%"}},b&&r.createElement("div",{style:{borderRight:"1px solid #666",width:200}},r.createElement(Qe,{items:te,renderItem:function(e){return r.createElement("div",{key:e.key,style:{background:e.active?"#444":void 0},onClick:function(){return function(e){-1===h.indexOf(e)?v(h.concat([e])):v(h.filter((function(t){return t!==e})))}(e.key)},className:Object(p.a)("item",x)},e.key," ",r.createElement("span",{style:{color:"#999"}},e.count))}})),r.createElement("div",{style:{width:"100%"}},r.createElement(ze,null,r.createElement(nt,{alwaysVisible:function(){return r.createElement(r.Fragment,null,r.createElement(u.c,{to:"/notes/new",className:"button"},"New Note"))}},r.createElement("div",null,r.createElement("input",{id:"tags-box",type:"checkbox",checked:b,onChange:function(){return E(!b)}}),r.createElement("label",{htmlFor:"tags-box"},"Show tags bar")),r.createElement("div",null,r.createElement("input",{id:"show-notes-for-box",type:"checkbox",checked:L,onChange:function(){return P(!L)}}),r.createElement("label",{htmlFor:"show-notes-for-box"},"Show notes for")),r.createElement("div",null,r.createElement("input",{id:"show-no-context-box",type:"checkbox",checked:V,onChange:function(){return W(!V)}}),r.createElement("label",{htmlFor:"show-no-context-box"},"Show no context"))),r.createElement("input",{style:{fontSize:16,padding:".3rem",width:"100%"},placeholder:"Search...",type:"text",value:o||"",onChange:function(e){l(e.target.value),H(e.target.value)}})),r.createElement("div",{className:"list"},J.slice(0).reverse().map((function(e,t){return r.createElement(r.Fragment,{key:t},r.createElement(u.c,{to:"/notes/".concat(e.id).concat(ne||""),className:Object(p.a)("item","note",x)},r.createElement("div",{className:"note-title"},r.createElement("div",null,kt(e))),r.createElement("div",{className:"note-details"},r.createElement(xt,{tags:e.tags}),r.createElement("div",{className:"tags"},r.createElement(rt,{contextId:e.contextId})),-1!==M.indexOf(e.id)&&r.createElement("div",{className:"button is-danger",onClick:function(t){t.preventDefault(),mt(e.id),c()}},"Clear draft"),r.createElement("div",{className:"note-date"},Xe()(e.updatedAt).format("ddd MMM Do HH:mm")))))})))))},Jt=function(e){var t=be(),n=t.data,a=t.refreshData,c=r.useState(""),i=Object(d.a)(c,2),s=i[0],o=i[1];function l(){return(l=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=5;break}return e.next=3,me.contexts.create({title:s,state:_e.Active,contextId:null});case 3:o(""),a();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return r.createElement(u.c,{key:e.id,to:"/contexts/".concat(e.id),className:Object(y.classes)("item",x)},r.createElement("div",null,e.title))}return r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add context...",value:s,onChange:function(e){return o(e.target.value)},onKeyPress:function(e){return l.apply(this,arguments)}})),r.createElement("div",{className:"list"},r.createElement("div",{className:"header"},"Active"),n.contexts.filter((function(e){return!e.state||e.state==_e.Active})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(e){return p(e)})),r.createElement("div",{className:"header"},"Not Active"),n.contexts.filter((function(e){return e.state===_e.Inactive})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(e){return p(e)}))))},Gt=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={text:""},r}return Object(m.a)(n,[{key:"onKeyPress",value:function(){var e=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return e.next=3,me.projects.create({title:this.state.text,state:qe.Active,contextId:null});case 3:this.setState({text:""},this.props.refreshData);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderProject",value:function(e){return r.createElement(u.c,{to:"/projects/".concat(e.id),className:Object(y.classes)("item",x)},r.createElement("div",null,e.title),r.createElement("div",{className:"tags"},r.createElement("div",{className:"tag"},e.state),r.createElement(rt,{contextId:e.contextId})))}},{key:"render",value:function(){var e=this;return r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add project...",value:this.state.text,onChange:function(t){return e.setState({text:t.target.value})},onKeyPress:this.onKeyPress.bind(this)})),r.createElement("div",{className:"list"},r.createElement("div",{className:"header"},"Active"),this.props.data.projects.filter((function(e){return!e.state||e.state==qe.Active})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)})),r.createElement("div",{className:"header"},"Incubated"),this.props.data.projects.filter((function(e){return!e.state||e.state==qe.Incubated})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)})),r.createElement("div",{className:"header"},"Not Active"),this.props.data.projects.filter((function(e){return e.state!=qe.Active&&e.state!=qe.Incubated})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)}))))}}]),n}(r.Component),_t=function(e){var t=be(),n=t.data,a=t.refreshData;if(!e.targetEntity)return null;var c=e.targetEntity.noteId,i=function(){var t=Object(S.a)(O.a.mark((function t(){var n;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.targetEntity){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,me.notes.create({title:"",content:"",tags:"",contextId:null,noteFor:{type:e.targetEntity.type,id:e.targetEntity.id},mode:"tree",dailyDate:null});case 4:if(n=t.sent,"person"!==e.targetEntity.type){t.next=9;break}return e.targetEntity.noteId=n.id,t.next=9,me.people.save(e.targetEntity);case 9:if("task"!==e.targetEntity.type){t.next=13;break}return e.targetEntity.noteId=n.id,t.next=13,me.tasks.save(e.targetEntity);case 13:a();case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(!c)return r.createElement("div",null,r.createElement("div",{className:"button",onClick:i},"Add note"));var s=n.notes.find((function(e){return e.id===c}));return s?r.createElement("div",null,r.createElement(u.c,{to:"/notes/".concat(s.id,"/edit?source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:"button"},"Edit note"),s.mode&&"markdown"!==s.mode?r.createElement(Pt,{json:s.content,contextId:s.contextId}):r.createElement(Ct,{markdown:s.content,contextId:s.contextId})):null},qt=function(e){var t=be().data;if(!e.targetEntity)return null;var n=e.targetEntity.noteId;if(!n)return null;var a=t.notes.find((function(e){return e.id===n}));return a?r.createElement("div",null,a.mode&&"markdown"!==a.mode?r.createElement(Pt,{json:a.content,contextId:a.contextId}):r.createElement(Ct,{markdown:a.content,contextId:a.contextId})):null},$t=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={title:"",source:"/tasks"},r}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=new URLSearchParams(window.location.search),n=this.props.data.tasks.find((function(t){return t.id===e.props.id}));this.setState({title:n.title},(function(){t.has("source")&&e.setState({source:decodeURIComponent(t.get("source"))})}))}},{key:"setContext",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(r=n.target.value)&&(r=null),t.contextId=r,e.next=5,me.tasks.save(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setProject",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(r=n.target.value)&&(r=null),t.projectId=r,e.next=5,me.tasks.save(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setDefer",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.value,t.deferredUntil=""===r?null:new Date(r).toISOString(),e.next=4,me.tasks.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onKeyDown",value:function(){var e=Object(S.a)(O.a.mark((function e(t){var n,r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.tasks.find((function(e){return e.id===r.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,me.tasks.save(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setTaskState",value:function(){var e=Object(S.a)(O.a.mark((function e(t){var n,r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.data.tasks.find((function(e){return e.id===r.props.id}))){e.next=3;break}return e.abrupt("return");case 3:if(n.state!==t){e.next=5;break}return e.abrupt("return");case 5:return n.state=t,n.stateChangedAt=(new Date).toISOString(),e.next=9,me.tasks.save(n);case 9:this.props.refreshData();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.data.tasks.find((function(t){return t.id===e.props.id}));if(!t)return r.createElement("div",null,"Task not found.");var n=!1;return t.title!==this.state.title&&(n=!0),r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement(u.c,{to:this.state.source,className:"button"},"Back")),r.createElement(ze,null,r.createElement("div",null,"Task"),r.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),r.createElement("div",null,"State"),r.createElement("div",{className:Object(p.a)(E(".5rem"))},r.createElement("div",{className:Object(p.a)("button","active"!==t.state?"inactive":null),onClick:function(){return e.setTaskState("active")}},"Active"),r.createElement("div",{className:Object(p.a)("button","incubated"!==t.state?"inactive":null),onClick:function(){return e.setTaskState("incubated")}},"Incubated"),r.createElement("div",{className:Object(p.a)("button","completed"!==t.state?"inactive":null),onClick:function(){return e.setTaskState("completed")}},"Completed")),r.createElement("div",null,"Context"),r.createElement("select",{className:"input is-large",value:t.contextId||"",onChange:function(n){return e.setContext(t,n)}},r.createElement("option",{value:""},"Not set"),this.props.data.contexts.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,"Project"),r.createElement("select",{className:"input is-large",value:t.projectId||"",onChange:function(n){return e.setProject(t,n)}},r.createElement("option",{value:""},"Not set"),this.props.data.projects.filter((function(e){return e.state===qe.Active||e.id===t.projectId})).map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,"Defer"),r.createElement("input",{type:"date",className:"input is-large",value:t.deferredUntil&&Xe()(t.deferredUntil).format("YYYY-MM-DD")||"",onChange:function(n){return e.setDefer(t,n)}})),r.createElement(ze,null,r.createElement(_t,Object.assign({targetEntity:t},this.props))))}}]),n}(r.Component),zt=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={title:""},r}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.data.projects.find((function(t){return t.id===e.props.id}));this.setState({title:t.title})}},{key:"setContext",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===n&&(n=null),t.contextId=n,e.next=4,me.projects.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setProjectState",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.value,t.state=r,e.next=4,me.projects.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onKeyDown",value:function(){var e=Object(S.a)(O.a.mark((function e(t){var n,r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.projects.find((function(e){return e.id===r.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,me.projects.save(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(null===this.props.data)return r.createElement(ve,null);var t=this.props.data.projects.find((function(t){return t.id===e.props.id}));if(!t)return r.createElement("div",null,"Project not found.");var n=!1;return t.title!==this.state.title&&(n=!0),r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement(u.c,{to:"/projects",className:"button"},"Back")),r.createElement(ze,null,r.createElement("div",null,"Project"),r.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),r.createElement("div",null,"Context"),r.createElement(Ft,{contextId:t.contextId,onChange:function(n){return e.setContext(t,n)},data:this.props.data}),r.createElement("div",null,"State"),r.createElement("select",{className:"input is-large",value:t.state||qe.Active,onChange:function(n){return e.setProjectState(t,n)}},Object.keys(qe).map((function(e){return r.createElement("option",{key:e,value:e},e)})))))}}]),n}(r.Component),Qt=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={title:""},r}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.data.contexts.find((function(t){return t.id===e.props.id}));this.setState({title:t.title})}},{key:"onKeyDown",value:function(){var e=Object(S.a)(O.a.mark((function e(t){var n,r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.contexts.find((function(e){return e.id===r.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,me.contexts.save(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setContext",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(r=n.target.value)&&(r=null),t.contextId=r,e.next=5,me.contexts.save(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setContextState",value:function(){var e=Object(S.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.target.value,t.state=r,e.next=4,me.contexts.save(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.data.contexts.find((function(t){return t.id===e.props.id}));if(!t)return r.createElement("div",null,"Context not found.");var n=!1;return t.title!==this.state.title&&(n=!0),r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement(u.c,{to:"/contexts",className:"button"},"Back")),r.createElement(ze,null,r.createElement("div",null,"Context"),r.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),r.createElement("div",null,"Parent Context"),r.createElement("select",{className:"input is-large",value:t.contextId||"",onChange:function(n){return e.setContext(t,n)}},r.createElement("option",{value:""},"Not set"),this.props.data.contexts.filter((function(e){return e.id!==t.id})).map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.title)}))),r.createElement("div",null,"State"),r.createElement("select",{className:"input is-large",value:t.state||_e.Active,onChange:function(n){return e.setContextState(t,n)}},Object.keys(_e).map((function(e){return r.createElement("option",{key:e,value:e},e)})))))}}]),n}(r.Component),Zt=function(e){Object(v.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={error:null,data:null},r.refreshData=r.refreshData.bind(Object(st.a)(r)),r}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=Object(S.a)(O.a.mark((function e(){var t=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Je.registerDataListener((function(e){return t.setState({data:e})})),e.t0=this,e.next=4,Je.getData();case 4:e.t1=e.sent,e.t2={data:e.t1},e.t3=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je.startServerSync();case 2:return e.next=4,Je.ensureServerSyncEnqueued();case 4:case"end":return e.stop()}}),e)}))),e.t0.setState.call(e.t0,e.t2,e.t3);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshData",value:function(){var e=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Je.getData();case 3:e.t1=e.sent,e.t2={data:e.t1},e.t3=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Je.startServerSync();case 1:case"end":return e.stop()}}),e)}))),e.t0.setState.call(e.t0,e.t2,e.t3);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.error?r.createElement(r.Fragment,null,r.createElement("div",null,this.state.error),r.createElement(ze,null,r.createElement("div",{className:"button",onClick:function(){return e.refreshData()}},"Retry"),r.createElement("div",{className:"button",onClick:function(){return window.location.reload()}},"Reload"),r.createElement("div",{className:"button",onClick:function(){return window.location.reload(!0)}},"Force Reload"),r.createElement("a",{className:"button",href:"/login"},"Login"))):this.state.data?this.props.render({data:this.state.data,refreshData:this.refreshData}):r.createElement(ve,null)}}]),n}(r.Component),Xt=function(e){var t=be().data;return r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement(u.c,{to:"/people/new",className:"button"},"New Person")),r.createElement("div",{className:"list"},t.people.sort((function(e,t){return t.name<e.name?-1:t.name>e.name?1:0})).map((function(e){return t=e,r.createElement(u.c,{key:t.id,to:"/people/".concat(t.id),className:Object(y.classes)("item",x)},r.createElement("div",null,t.name));var t}))))},en=n(29),tn=function(e){var t=be(),n=t.data,a=t.refreshData,c=Object(r.useState)(null),i=Object(d.a)(c,2),s=i[0],o=i[1],p=function(e){var t=Object(r.useState)(e),n=Object(d.a)(t,2),a=n[0],c=n[1];return{values:a,handleChange:function(e){e.persist(),c((function(t){return Object(I.a)({},t,Object(en.a)({},e.target.name,e.target.value))}))}}}((function(){var t=e.id?n.people.find((function(t){return t.id===e.id})):null;return{name:t?t.name:"",birthday:t?t.birthday:null}})),f=p.values,m=p.handleChange,h=function(){var t=Object(S.a)(O.a.mark((function t(){var n,r,c;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.id||null)){t.next=15;break}return t.next=4,me.people.get(n);case 4:if(null!==(r=t.sent)){t.next=7;break}throw"Person is null?";case 7:return r.name=f.name,r.birthday=f.birthday,t.next=11,me.people.save(r);case 11:a(),o(r.id),t.next=20;break;case 15:return t.next=17,me.people.create({name:f.name,birthday:f.birthday,noteId:null});case 17:c=t.sent,a(),o(c.id);case 20:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),v=e.id&&n.people.find((function(t){return t.id===e.id}))||null;return r.createElement(r.Fragment,null,s&&r.createElement(l.a,{to:"/people/".concat(s)}),r.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.createElement(ze,null,r.createElement(u.c,{to:"/people",className:"button"},"Back"),e.id&&r.createElement(u.c,{to:"/people/".concat(e.id),className:"button"},"Show")),r.createElement(ze,null,void 0===e.id?r.createElement("a",{type:"button",className:"button is-primary",onClick:h},"Add person"):r.createElement("a",{type:"button",className:"button is-primary",onClick:h},"Update person")),r.createElement(ze,null,r.createElement("div",null,"Name"),r.createElement("input",{type:"text",name:"name",className:"input is-large is-wide",value:f.name,onChange:m}),r.createElement("div",null,"Birthday"),r.createElement("input",{type:"date",name:"birthday",className:"input is-large",value:f.birthday||"",onChange:m})),r.createElement(ze,null,r.createElement(_t,{targetEntity:v}))))},nn=function(e){var t=be().data.people.find((function(t){return t.id===e.id}));return t?r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement(u.c,{to:"/people",className:"button"},"Back"),r.createElement(u.c,{to:"/people/".concat(t.id,"/edit"),className:"button"},"Edit")),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,t.name),t.birthday&&r.createElement("div",null,"Birthday: ",Xe()(t.birthday).format("YYYY-MM-DD")),r.createElement(qt,Object.assign({targetEntity:t},e))))):r.createElement("div",null,"Person not found.")},rn=function(e){var t=be().data,n=r.useState(null),a=Object(d.a)(n,2),c=a[0],i=a[1],s=r.useState(null),o=Object(d.a)(s,2),u=o[0],l=o[1],p=r.useState(null),f=Object(d.a)(p,2),m=f[0],h=f[1],v=r.useState(null),g=Object(d.a)(v,2),y=g[0],x=g[1],b=r.useState(null),E=Object(d.a)(b,2),k=E[0],w=E[1];return r.useEffect((function(){me.notes.getSyncKeys().then((function(e){return i(e.length)})),me.tasks.getSyncKeys().then((function(e){return l(e.length)})),me.people.getSyncKeys().then((function(e){return h(e.length)})),me.projects.getSyncKeys().then((function(e){return x(e.length)})),me.contexts.getSyncKeys().then((function(e){return w(e.length)}))})),r.createElement(r.Fragment,null,r.createElement(ze,null),r.createElement("div",{className:"panel"},r.createElement("div",{className:"content",style:{padding:"1rem"}},r.createElement("h1",null,"Stats"),r.createElement("ul",null,r.createElement("li",null,"Notes: ",t.notes.length,", versions: ",c||"..."),r.createElement("li",null,"Tasks: ",t.tasks.length,", versions: ",u||"..."),r.createElement("li",null,"People: ",t.people.length,", versions: ",m||"..."),r.createElement("li",null,"Projects: ",t.projects.length,", versions: ",y||"..."),r.createElement("li",null,"Contexts: ",t.contexts.length,", versions: ",k||"...")))))},an=r.createElement($e,null,r.createElement(xe,null,r.createElement(l.d,null,r.createElement(l.b,{exact:!0,path:"/",render:function(e){return r.createElement(Ht,null)}}),r.createElement(l.b,{exact:!0,path:"/notes/new",render:function(e){return r.createElement(Ut,null)}}),r.createElement(l.b,{exact:!0,path:"/notes/:id",render:function(e){return r.createElement(Bt,{id:e.match.params.id})}}),r.createElement(l.b,{exact:!0,path:"/notes/:id/edit",render:function(e){return r.createElement(Ut,{id:e.match.params.id})}}),r.createElement(l.b,{exact:!0,path:"/tasks",render:function(e){return r.createElement(it,null)}}),r.createElement(l.b,{exact:!0,path:"/tasks/:id",render:function(e){return r.createElement(Zt,{render:function(t){return r.createElement($t,Object.assign({},t,{id:e.match.params.id}))}})}}),r.createElement(l.b,{exact:!0,path:"/contexts",render:function(e){return r.createElement(Jt,null)}}),r.createElement(l.b,{exact:!0,path:"/contexts/:id",render:function(e){return r.createElement(Zt,{render:function(t){return r.createElement(Qt,Object.assign({},t,{id:e.match.params.id}))}})}}),r.createElement(l.b,{exact:!0,path:"/projects",render:function(e){return r.createElement(Zt,{render:function(e){return r.createElement(Gt,e)}})}}),r.createElement(l.b,{exact:!0,path:"/projects/:id",render:function(e){return r.createElement(Zt,{render:function(t){return r.createElement(zt,Object.assign({},t,{id:e.match.params.id}))}})}}),r.createElement(l.b,{exact:!0,path:"/people",render:function(e){return r.createElement(Xt,null)}}),"} />",r.createElement(l.b,{exact:!0,path:"/people/new",render:function(e){return r.createElement(tn,null)}}),r.createElement(l.b,{exact:!0,path:"/people/:id",render:function(e){return r.createElement(nn,{id:e.match.params.id})}}),r.createElement(l.b,{exact:!0,path:"/people/:id/edit",render:function(e){return r.createElement(tn,{id:e.match.params.id})}}),r.createElement(l.b,{path:"/playground",component:function(){var e=r.useState(null),t=Object(d.a)(e,2),n=t[0],a=t[1];function c(){return(c=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=a,e.t1=C.a,e.next=4,Te();case 4:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.createElement("div",{style:{height:"100%"}},r.createElement(ze,null,r.createElement("div",{className:"button",onClick:function(){return c.apply(this,arguments)}},"List"),r.createElement("div",{className:"button",onClick:function(){return Fe("test1",'{ "name": "test" }')}},"Create Test"),r.createElement("div",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,Ue("test1");case 3:return e.t1=e.sent,e.abrupt("return",e.t0.log.call(e.t0,"getFile",e.t1));case 5:case"end":return e.stop()}}),e)})))},"Get Test"),r.createElement("div",{className:"button",onClick:Je.startDropboxServerSync},"Sync")),n&&n.map((function(e){return r.createElement("div",{key:e},e)})))}}),r.createElement(l.b,{path:"/sync",component:function(e){var t=a.a.useState(0),n=Object(d.a)(t,2),r=(n[0],n[1]);return a.a.useEffect((function(){Je.registerSyncListener((function(){r((function(e){return e+1}))}))}),[]),a.a.createElement(a.a.Fragment,null,a.a.createElement(ze,null,a.a.createElement("div",null,"Status: ",We[Je.status]),a.a.createElement("div",{className:"button",onClick:function(){return Je.startServerSync()}},"Sync Now")),a.a.createElement("div",{className:"list"},Je.getResults().slice(0).reverse().map((function(e,t){return a.a.createElement(a.a.Fragment,{key:t},a.a.createElement("div",{className:"item"},e.endAt.getTime()-e.startAt.getTime()," ms - start: ",Xe()(e.startAt).format("HH:mm:ss"),", end: ",Xe()(e.endAt).format("HH:mm:ss"),", fetch: ",e.fetch,", send: ",e.send,e.error?", error: ".concat(e.error):null))}))))}}),r.createElement(l.b,{path:"/stats",render:function(e){return r.createElement(rn,null)}}),r.createElement(l.b,{path:"/settings",component:function(){var e=r.useState(null),t=Object(d.a)(e,2),n=t[0],a=t[1],c=r.useState(null),i=Object(d.a)(c,2),s=i[0],o=i[1],u=r.useState("no-update"),l=Object(d.a)(u,2),p=l[0],f=l[1],m=r.useState(null),h=Object(d.a)(m,2),v=h[0],g=h[1],y=r.useState(null),x=Object(d.a)(y,2),b=x[0],E=x[1];function k(){return w.apply(this,arguments)}function w(){return(w=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Clear all local data?")){e.next=2;break}return e.abrupt("return");case 2:me.contexts.dropInstance(),me.tasks.dropInstance(),me.notes.dropInstance(),me.projects.dropInstance(),me.people.dropInstance();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=r.useState(null),C=Object(d.a)(j,2),I=C[0],N=C[1];function D(){return A.apply(this,arguments)}function A(){return(A=Object(S.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$();case 3:t=e.sent,o(t),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}return r.useEffect((function(){Se().then((function(e){N(e)}))}),[]),r.useEffect((function(){function e(){return(e=Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return navigator.serviceWorker.ready.then(function(){var e=Object(S.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pushManager.getSubscription();case 2:n=e.sent,a(!!n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),navigator.serviceWorker.ready.then((function(e){e.addEventListener("updatefound",(function(){var t=e.installing;t?t.addEventListener("statechange",(function(){"installed"===t.state?navigator.serviceWorker.controller?(console.log("New content is available; please refresh."),f("content-ready")):(console.log("Content is cached for offline use."),f("cached")):f("state-not-installed")})):f("not-installing")}))})),e.next=4,D();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),r.createElement(r.Fragment,null,r.createElement(ze,null,r.createElement("div",{className:"button",onClick:function(){return window.location.reload()}},"Reload"),r.createElement("div",{className:"button",onClick:function(){return window.location.reload(!0)}},"Force Reload"),r.createElement("a",{className:"button",href:"/login"},"Login")),r.createElement(ze,null,r.createElement("div",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe();case 2:return e.t0=N,e.next=5,Se();case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})))},"Connect Dropbox"),r.createElement("div",{style:{display:"inline-block",background:"#222",padding:".5rem"}},"Status: ",null===I?"unknown":I?"connected":"not connected"),we&&r.createElement("div",{style:{display:"inline-block",background:"#222",padding:".5rem"}},"Local [ ",window.location.host," ]")),r.createElement(ze,null,r.createElement("div",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},"Clear Entities"),r.createElement("div",{className:"button",onClick:function(){navigator.serviceWorker.ready.then(function(){var e=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.update();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},"Update SW"),r.createElement("div",{className:"button",onClick:function(){navigator.serviceWorker.ready.then(function(){var e=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.unregister();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},"Unregister SW"),r.createElement("div",null,"ServiceWorker state: ",p)),r.createElement(ze,null,!0===n&&r.createElement("div",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,void navigator.serviceWorker.ready.then(function(){var e=Object(S.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pushManager.getSubscription();case 2:if(!(n=e.sent)){e.next=11;break}return e.next=6,n.unsubscribe();case 6:return e.t0=a,e.next=9,t.pushManager.getSubscription();case 9:e.t1=!!e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},"Unsubscribe Push"),!1===n&&r.createElement("div",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,void navigator.serviceWorker.ready.then(function(){var e=Object(S.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={applicationServerKey:"BEl6vcKrENjrQk-LikFlZ5hy6VuVgSUUZ2uCYOQsuYjMP_WbigIOfDITEkF6JhEbd9MVw9RKiMODYxmpONuYsqY",userVisibleOnly:!0},e.next=4,t.pushManager.subscribe(n);case 4:r=e.sent,console.log(JSON.stringify(r)),a(!!r),he.testPush(r),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("Error",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},"Subscribe Push")),r.createElement(ze,null,r.createElement("h2",null,"Encryption"),!s&&r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement("textarea",{style:{width:"100%"},onChange:function(e){return E(e.target.value)}})),r.createElement("a",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(b);case 2:return e.next=4,D();case 4:case"end":return e.stop()}}),e)})))},"Set private key"),r.createElement("h4",null,"Generate key"),r.createElement("div",{className:"button",onClick:Object(S.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=g,e.next=3,M();case 3:return e.t1=e.sent.privateKey,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))},"Generate"),r.createElement("textarea",{style:{width:"100%",background:"#555",color:"#ddd"},readOnly:!0,value:v||""})),r.createElement("h4",null,"Keys"),r.createElement("div",{className:"list"},!s&&r.createElement("div",null,"No keys"),s&&r.createElement("div",{className:"item"},s.fingerprint))),r.createElement(ze,null))}}))));window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js").then(function(){var e=Object(S.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"function"==typeof t.update&&t.update();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(u.a,{children:an})),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");s?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):o(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):o(t,e)}))}}()}},[[54,1,2]]]);
//# sourceMappingURL=main.6ee3cbd0.chunk.js.map