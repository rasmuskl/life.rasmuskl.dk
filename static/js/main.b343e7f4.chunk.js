(this.webpackJsonplife=this.webpackJsonplife||[]).push([[0],{48:function(e,t,n){e.exports=n(69)},53:function(e,t,n){},59:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t),n.d(t,"history",(function(){return Vt}));var a=n(0),r=n.n(a),c=n(41),o=n.n(c),i=n(18),l=n(2),s=(n(53),n(4)),u=n(5),d="hover-glow",m=Object(u.a)({cursor:"pointer"});Object(u.a)({display:"flex",alignItems:"center"});function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".3rem",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(u.a)({paddingLeft:t?e:void 0,paddingRight:t?e:void 0,"&":{"& > *:first-child":{marginLeft:0},"& > *":{marginRight:e},"& > *:last-child":{marginRight:0}}})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".3rem",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(u.a)({paddingTop:t?e:void 0,paddingBottom:t?e:void 0,"&":{"& > *":{marginBottom:e},"& > *:last-child":{marginBottom:0}}})}var v=n(1),h=n.n(v),b=n(3),g=n(9),x=n(10),E=n(8),y=n.n(E),k=function(e){return a.createElement("div",{style:{display:"flex",height:"100%",justifyContent:"center",alignItems:"center"}},a.createElement("div",{style:{border:"1px solid #555",padding:"1rem 2rem",background:"#2e2e2e"}},"Loading..."))},w=function e(t,n,a,r,c,o){Object(g.a)(this,e),this.notes=void 0,this.tasks=void 0,this.virtualTasks=void 0,this.contexts=void 0,this.projects=void 0,this.people=void 0,this.notes=t,this.tasks=n,this.contexts=a,this.projects=r,this.people=c,this.virtualTasks=o},j=r.a.createContext({data:null,refresh:function(){}}),O=function(e){var t=r.a.useState(null),n=Object(l.a)(t,2),c=n[0],o=n[1];Object(a.useEffect)((function(){function e(){return(e=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q.registerDataListener(function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=o,e.next=4,q.getData();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),e.next=8,q.startServerSync();case 8:return e.next=10,q.ensureServerSyncEnqueued();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var i={data:c,refresh:function(){q.getData(!0)}};return c?r.a.createElement(j.Provider,{value:i},e.children):r.a.createElement(k,null)},C=function(){return Object(a.useContext)(j)},N=n(6),I=function(){function e(){Object(g.a)(this,e),this.listeners=[]}return Object(x.a)(e,[{key:"register",value:function(e){var t=this;return this.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))}}},{key:"trigger",value:function(e){var t,n=Object(N.a)(this.listeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(a){n.e(a)}finally{n.f()}}}]),e}();function S(){var e,t,n,a=null===(e=window.chrome)||void 0===e||null===(t=e.webview)||void 0===t||null===(n=t.hostObjects)||void 0===n?void 0:n.dotnet,r=window.AndroidBridge;return a||r||null}function T(){return(T=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getContext(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getContexts();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().saveContext(JSON.stringify(t));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getPeople();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return(R=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().savePerson(JSON.stringify(t));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getProjects();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().saveProject(JSON.stringify(t));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return(L=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getTasks();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return(M=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getVirtualTasks();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().saveTask(JSON.stringify(t));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getNotes();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return(Y=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().getNote(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return(K=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,S().saveNote(JSON.stringify(t));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return(H=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S().syncRemote();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S().syncRemoteConnected();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S().disconnectBlobStorage();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(){return(G=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S().connectBlobStorage(t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z,_={hasBridge:function(){return!!S()},getNotes:function(){return J.apply(this,arguments)},getNote:function(e){return Y.apply(this,arguments)},saveNote:function(e){return K.apply(this,arguments)},getContexts:function(){return D.apply(this,arguments)},getContext:function(e){return T.apply(this,arguments)},saveContext:function(e){return A.apply(this,arguments)},getProjects:function(){return F.apply(this,arguments)},saveProject:function(e){return B.apply(this,arguments)},getPeople:function(){return P.apply(this,arguments)},savePerson:function(e){return R.apply(this,arguments)},getTasks:function(){return L.apply(this,arguments)},getVirtualTasks:function(){return M.apply(this,arguments)},saveTask:function(e){return U.apply(this,arguments)},syncRemote:function(){return H.apply(this,arguments)},syncRemoteConnected:function(){return V.apply(this,arguments)},connectBlobStorage:function(e){return G.apply(this,arguments)},disconnectBlobStorage:function(){return W.apply(this,arguments)}};!function(e){e[e.Idle=0]="Idle",e[e.Syncing=1]="Syncing",e[e.Failed=2]="Failed"}(z||(z={}));var q=new(function(){function e(){Object(g.a)(this,e),this.status=z.Idle,this.results=[],this.data=null,this.intervalHandle=null,this.syncListener=new I,this.dataListener=new I}return Object(x.a)(e,[{key:"registerSyncListener",value:function(e){this.syncListener.register(e)}},{key:"registerDataListener",value:function(e){this.dataListener.register(e)}},{key:"getResults",value:function(){return this.results}},{key:"getData",value:function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data&&!t){e.next=5;break}return e.next=3,this.loadData();case 3:this.data=e.sent,this.dataListener.trigger(this.data);case 5:return e.abrupt("return",this.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ensureServerSyncEnqueued",value:function(){var e=Object(b.a)(h.a.mark((function e(){var t=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.intervalHandle){e.next=2;break}return e.abrupt("return");case 2:this.intervalHandle=setInterval(Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startServerSync();case 2:case"end":return e.stop()}}),e)}))),6e4);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startServerSync",value:function(){var e=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status!==z.Syncing){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.runBridgeSync();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runBridgeSync",value:function(){var e=Object(b.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.hasBridge()){e.next=2;break}return e.abrupt("return");case 2:return t=new Date,e.prev=3,e.next=6,_.syncRemote();case 6:this.results.push({type:"desktop",startAt:t,endAt:new Date,error:null,fetch:0,send:0}),this.status=z.Idle,this.syncListener.trigger(this.status),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(3),this.status=z.Failed,this.results.push({type:"desktop",startAt:t,endAt:new Date,error:e.t0&&e.t0.message?e.t0.message:e.t0,fetch:0,send:0}),this.syncListener.trigger(this.status);case 16:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=Object(b.a)(h.a.mark((function e(){var t,n,a,r,c,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_.getContexts(),n=_.getTasks(),a=_.getProjects(),r=_.getPeople(),c=_.getVirtualTasks(),e.t0=E,e.next=8,_.getNotes();case 8:return e.t1=e.sent,e.t2=function(e){return e.updatedAt},o=e.t0.orderBy.call(e.t0,e.t1,e.t2),e.t3=w,e.t4=o,e.next=15,n;case 15:return e.t5=e.sent,e.next=18,t;case 18:return e.t6=e.sent,e.next=21,a;case 21:return e.t7=e.sent,e.next=24,r;case 24:return e.t8=e.sent,e.next=27,c;case 27:return e.t9=e.sent,e.abrupt("return",new e.t3(e.t4,e.t5,e.t6,e.t7,e.t8,e.t9));case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}()),$=n(24),X=Object($.createInstance)({name:"theme"}),Q=new I,Z="dark-theme";function ee(){return(ee=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("theme");case 2:Z=(Z=e.sent)||"dark-theme",Q.trigger(Z);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z=t,e.next=3,X.setItem("theme",Z);case 3:Q.trigger(Z);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return getComputedStyle(document.documentElement).getPropertyValue(e)}function re(){return"dark-theme"===Z}function ce(){return window.matchMedia("(max-width: 768px)").matches}!function(){ee.apply(this,arguments)}();var oe,ie,le=function(e){var t=a.useState((function(){return!ce()})),n=Object(l.a)(t,2),r=n[0],c=n[1],o=a.useState(0),i=Object(l.a)(o,2),m=i[0],p=i[1],v=a.useState(null),h=Object(l.a)(v,2),b=h[0],g=h[1];function x(){ce()&&c(!1)}return a.useEffect((function(){q.registerSyncListener((function(){return p((function(e){return e+1}))}))}),[]),a.useEffect((function(){var e;e=function(e){document.documentElement.className=e,g(e)},Q.register(e)}),[]),null==b?a.createElement(a.Fragment,null):a.createElement(a.Fragment,null,a.createElement("section",{style:{display:"flex",overflow:"hidden",height:"100%"},className:b},a.createElement(a.Fragment,{key:m}),a.createElement("div",{className:Object(u.b)("navbar")},a.createElement("div",{className:Object(u.b)(f("1rem"))},!r&&a.createElement(a.Fragment,null,a.createElement(s.b,{className:Object(u.b)("button","hover-glow"),to:"/",onClick:x,exact:!0,activeClassName:"is-active"},"Notes"),a.createElement(s.b,{className:Object(u.b)("button","hover-glow"),to:"/tasks",onClick:x,exact:!0,activeClassName:"is-active"},"Tasks"))),a.createElement("div",{className:Object(u.b)(f("1rem"))},q.status!==z.Idle&&a.createElement(s.b,{className:"button",to:"/sync"},"Sync: ",z[q.status]),a.createElement("button",{className:"button",onClick:function(){return c(!r)}},"Menu"))),a.createElement("div",{className:Object(u.b)("sidebar","list"),style:{overflowY:"auto",paddingTop:52,height:"100%",width:r?void 0:0,overflowX:"hidden"}},a.createElement(s.b,{className:Object(u.b)("item","hover-glow"),to:"/",onClick:x,exact:!0,activeClassName:"is-active"},"Notes"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/notes/daily",onClick:x,exact:!0,activeClassName:"is-active"},"Daily Notes"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/tasks",onClick:x,exact:!0,activeClassName:"is-active"},"Tasks"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/projects",onClick:x,exact:!0,activeClassName:"is-active"},"Projects"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/contexts",onClick:x,exact:!0,activeClassName:"is-active"},"Contexts"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/people",onClick:x,exact:!0,activeClassName:"is-active"},"People"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/playground",onClick:x,exact:!0,activeClassName:"is-active"},"Playground"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/stats",onClick:x,exact:!0,activeClassName:"is-active"},"Stats"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/settings",onClick:x,exact:!0,activeClassName:"is-active"},"Settings"),a.createElement(s.b,{className:Object(u.b)("item",d),to:"/sync",onClick:x,exact:!0,activeClassName:"is-active"},"Sync Status")),a.createElement("div",{className:"main",style:{paddingTop:52}},e.children)))},se=n(11),ue=function(e){var t=e.verticalAround;return void 0===t&&(t=!0),a.createElement("div",{className:Object(u.b)(f("8px",!0),p("8px",t))},e.children)};function de(e){var t=E.groupBy(e.contexts,(function(e){return e.contextId})),n=E.countBy(e.tasks.filter((function(e){return e.state===oe.Active})),(function(e){return e.contextId}));return{topContexts:e.contexts.filter((function(e){return!e.contextId})),nestedContexts:t,taskCounts:n}}function me(e,t){var n=de(t);if(e){for(var a=[e],r=[e];r.length;){var c=r.pop();if(!c)break;var o,i=Object(N.a)(n.nestedContexts[c]||[]);try{for(i.s();!(o=i.n()).done;){var l=o.value;a.push(l.id),r.push(l.id)}}catch(s){i.e(s)}finally{i.f()}}return a}return t.contexts.map((function(e){return e.id}))}!function(e){e[e.Active=0]="Active",e[e.Incubated=1]="Incubated",e[e.Completed=2]="Completed"}(oe||(oe={})),function(e){e[e.Active=0]="Active",e[e.Incubated=1]="Incubated",e[e.Completed=2]="Completed",e[e.Dropped=3]="Dropped"}(ie||(ie={}));var fe,pe=n(7),ve=n.n(pe),he=function(e,t){var n=a.useState((function(){return new URLSearchParams(window.location.search).get(t)||e})),r=Object(l.a)(n,2),c=r[0],o=r[1];return[c,function(n){var a=new URLSearchParams(window.location.search);o(n),n&&n!==e?a.set(t,n):a.delete(t);var r=a.toString();r.length?window.history.replaceState(null,"","?".concat(r)):window.history.replaceState(null,"",window.location.pathname),window.dispatchEvent(new window.CustomEvent("popstate"))}]},be=function(e,t,n,r){var c=a.useState((function(){var a=new URLSearchParams(window.location.search);return n(a.get(t))||e})),o=Object(l.a)(c,2),i=o[0],s=o[1];return[i,function(n){var a=new URLSearchParams(window.location.search);if(s(n),n&&n!==e){var c=r(n);c?a.set(t,c):a.delete(t)}else a.delete(t);var o=a.toString();o.length?window.history.replaceState(null,"","?".concat(o)):window.history.replaceState(null,"",window.location.pathname),window.dispatchEvent(new window.CustomEvent("popstate"))}]},ge=function(e){var t=a.useState(!1),n=Object(l.a)(t,2),r=n[0],c=n[1],o=e.alwaysVisible?e.alwaysVisible():null;if(!ce())return a.createElement("div",{style:Object(se.a)({display:"flex",alignItems:"center"},e.wideStyle),className:f(".3rem")},o,e.children);var i=e.mobileOnly?e.mobileOnly():null;return r?a.createElement("div",{style:{display:"flex",flexDirection:"column"},className:p(".3rem")},a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},o,a.createElement("div",{className:"button",onClick:function(){return c(!1)}},"S")),a.createElement("div",{className:Object(u.b)(p(".3rem"),e.className)},e.children)):a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},o,i,a.createElement("div",{className:"button",onClick:function(){return c(!0)}},"S"))},xe=function(e){var t=C().data;if(!e.contextId)return null;var n=t.contexts.find((function(t){return t.id===e.contextId}));return n?a.createElement("div",{className:"tag is-context"},n.title):null};!function(e){e[e.Active=0]="Active",e[e.Inactive=1]="Inactive"}(fe||(fe={}));var Ee,ye=function(e){var t=de(C().data);return a.createElement("div",{style:{borderRight:"1px solid #666",width:200}},a.createElement("div",{className:"list"},a.createElement("div",{className:Object(u.b)("item",d,m),style:{paddingLeft:10,background:null===e.contextId?ae("--active-context-background"):void 0},onClick:function(){return e.onChange(null)}},"All"),t.topContexts.map((function(n){return function t(n,r){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.state&&n.state===fe.Inactive?a.createElement(a.Fragment,{key:n.id}):a.createElement(a.Fragment,{key:n.id},a.createElement("div",{onClick:function(){return e.onChange(n.id)},style:{paddingLeft:10+10*c,background:e.contextId===n.id?ae("--active-context-background"):void 0},className:Object(u.b)("item",d,m)},n.title," ",e.showTaskCount&&a.createElement("span",{style:{color:"#999"}},r.taskCounts[n.id])),r.nestedContexts[n.id]&&r.nestedContexts[n.id].map((function(e){return t(e,r,c+1)})))}(n,t)}))))},ke=[{id:"1",title:"All",groupedProject:!1,groupedContext:!1},{id:"2",title:"Grouped",groupedProject:!1,groupedContext:!0},{id:"3",title:"Grouped Project",groupedProject:!0,groupedContext:!1}],we=ke[1],je=function(e){var t=C(),n=t.data,r=t.refresh,c=a.useState(""),o=Object(l.a)(c,2),i=o[0],m=o[1],f=a.useState({showCompleted:!1,showDeferred:!1,showIncubated:!1,showContextBar:!ce(),includeNested:!0}),p=Object(l.a)(f,2),v=p[0],g=p[1],x=he(null,"context"),E=Object(l.a)(x,2),k=E[0],w=E[1],j=he(null,"project"),O=Object(l.a)(j,2),I=O[0],S=O[1],T=he("2","perspective"),D=Object(l.a)(T,2),A=D[0],P=D[1],R=function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=5;break}return e.next=3,_.saveTask({title:i,contextId:k,projectId:I,content:null,state:oe.Active,stateChangedAt:(new Date).toISOString(),noteId:null});case 3:m(""),r();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(b.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state=t.state===oe.Completed?oe.Active:oe.Completed,t.stateChangedAt=(new Date).toISOString(),e.next=4,_.saveTask(t);case 4:r();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),B=function(e){var t=n.projects.find((function(t){return t.id===e.projectId}));return t?a.createElement("div",{className:"tag is-info"},t.title):null},L=function(e){return e.deferredUntil&&new Date(e.deferredUntil)>new Date?a.createElement("div",{className:"tag is-primary",title:"".concat(ve()(e.deferredUntil).format("YYYY-MM-DD"))},"deferred ",ve()(e.deferredUntil).fromNow(!0)):null},M=function(e){return e.noteId?a.createElement("div",{className:"tag is-primary"},"N"):null},U=function(e){var t=/(https?:\/\/[^\s]+)/;return e.split(t).map((function(e,n){if(e.match(t)){var r=e.replace(/https?:\/\//,"");return r=r.replace(/\/.*/,"/..."),a.createElement("a",{key:n,href:e,onClick:function(e){e.stopPropagation()},target:"_blank",rel:"noopener noreferrer",className:"button is-small is-link",style:{display:"inline-block",marginLeft:"5px",marginRight:"5px"}},r)}return a.createElement("span",{key:n},e)}))},J=function(e,t){var a=n.tasks;if(a=e?a.filter((function(e){return e.state===oe.Completed})):a.filter((function(e){return e.state!==oe.Completed})),I&&(a=a.filter((function(e){return e.projectId===I}))),v.showDeferred||(a=a.filter((function(e){return null==e.deferredUntil||new Date(e.deferredUntil)<new Date}))),!v.showIncubated){a=a.filter((function(e){return e.state!==oe.Incubated}));var r=n.projects.filter((function(e){return e.state===ie.Incubated})).map((function(e){return e.id}));a=a.filter((function(e){return!e.projectId||-1===r.indexOf(e.projectId)}))}if(k){var c=me(k,n);a=a.filter((function(e){return e.contextId&&-1!==c.indexOf(e.contextId)}))}return a.sort((function(e,t){return t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:0}))},Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(window.location.search.length){var r=new URLSearchParams(window.location.search);n="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(r.toString())))}return a.createElement(s.b,{key:e.id,to:"/tasks/".concat(e.id).concat(n||""),className:Object(u.b)("item","task",d)},a.createElement("div",{className:"task-checkbox"},a.createElement("input",{type:"checkbox",style:{display:"block",padding:10},checked:e.state===oe.Completed,onClick:function(e){return e.preventDefault()},onChange:function(t){return F(e,t)}})),a.createElement("div",{className:"task-title",style:{color:e.state===oe.Incubated?"#999":void 0}},e.state===oe.Completed?a.createElement("span",{style:{textDecoration:"line-through"}},U(e.title)):U(e.title),e.state===oe.Incubated?a.createElement("span",null," [Incubated]"):null),a.createElement("div",{className:"task-details"},a.createElement("div",{className:"tags"},M(e),L(e),!t&&a.createElement(xe,{contextId:e.contextId}),!t&&B(e))))},K=ke.find((function(e){return e.id===A}))||we,H=(de(n),[]);if(K.groupedContext)!function(){var e=me(k,n);k||e.push(null);var t,r=Object(N.a)(e);try{var c=function(){var r=t.value,c=n.contexts.find((function(e){return e.id===r})),o=J(!1);if(r){if(!c)return"continue";if(!(o=o.filter((function(e){return e.contextId===r}))).length)return"continue";H.push(a.createElement("div",{key:r,style:{display:"flex",justifyContent:"space-between",padding:".6rem",background:ae("--task-context-background"),cursor:"pointer"},onClick:function(){return w(c.id)}},c.title,a.createElement(s.b,{className:"button small",to:"/contexts/".concat(c.id)},"Edit")))}else{if(!(o=o.filter((function(e){return e.contextId===r}))).length)return"continue";H.push(a.createElement("div",{key:"no-context",style:{padding:".6rem",background:ae("--task-context-background")}},"No Context"))}var i=[ie.Active,ie.Incubated,ie.Completed,ie.Dropped],l=[],u=n.projects;null!==I&&(u=u.filter((function(e){return e.id===I}))),u.sort((function(e,t){return i.indexOf(e.state)-i.indexOf(t.state)})).forEach((function(t){var n=o.filter((function(e){return e.projectId===t.id}));n.length?H.push(a.createElement(a.Fragment,{key:"p-".concat(t.id)},a.createElement("div",{className:"header link",onClick:function(){S(t.id),w(t.contextId)},style:{background:ae("--task-project-background")}},t.title," ",t.state!==ie.Active?"[".concat(t.state,"]"):"",a.createElement("div",{style:{display:"flex"}},a.createElement(s.b,{className:"button small",to:"/projects/".concat(t.id)},"Edit"))),n.map((function(e){return Y(e,!0)})))):t.state===ie.Active&&(r?t.contextId&&-1!==e.indexOf(t.contextId)&&l.push(t):l.push(t))}));var d=o.filter((function(e){return null===e.projectId}));d.length&&H.push(a.createElement(a.Fragment,{key:"no-p-".concat(r)},a.createElement("div",{className:"header",style:{background:ae("--task-project-background")}},"No Project"),d.map((function(e){return Y(e,!0)}))));for(var m=function(){var e=p[f];if(e.contextId!==r)return"continue";H.push(a.createElement("div",{key:e.id,className:"header link",style:{background:ae("--task-project-background")},onClick:function(){S(e.id),w(e.contextId)}},e.title," ",e.state!==ie.Active?"[".concat(e.state,"]"):""," [Empty]",a.createElement("div",{style:{display:"flex"}},a.createElement("div",{className:"tags"},a.createElement(xe,{contextId:e.contextId})),a.createElement(s.b,{className:"button small",to:"/projects/".concat(e.id)},"Edit"))))},f=0,p=l;f<p.length;f++)m()};for(r.s();!(t=r.n()).done;)c()}catch(o){r.e(o)}finally{r.f()}v.showCompleted&&H.push(a.createElement(a.Fragment,{key:"completed"},a.createElement("div",{className:"header"},"Completed"),y.a.orderBy(J(!0),(function(e){return e.stateChangedAt}),"desc").map((function(e){return Y(e)}))))}();else if(K.groupedProject){var V=J(!1),W=[ie.Active,ie.Incubated,ie.Completed,ie.Dropped],G=[],z=n.projects;null!==I&&(z=z.filter((function(e){return e.id===I})));var q=me(k,n);z.sort((function(e,t){return W.indexOf(e.state)-W.indexOf(t.state)})).forEach((function(e){var t=V.filter((function(t){return t.projectId===e.id}));t.length?H.push(a.createElement(a.Fragment,{key:"p-".concat(e.id)},a.createElement("div",{className:"header link",onClick:function(){S(e.id),w(e.contextId)}},e.title," ",e.state!==ie.Active?"[".concat(e.state,"]"):"",a.createElement("div",{style:{display:"flex"}},a.createElement("div",{className:"tags"},a.createElement(xe,{contextId:e.contextId})),a.createElement(s.b,{className:"button small",to:"/projects/".concat(e.id)},"Edit"))),t.map((function(e){return Y(e)})))):e.state===ie.Active&&(k?e.contextId&&-1!==q.indexOf(e.contextId)&&G.push(e):G.push(e))}));var $=V.filter((function(e){return null===e.projectId}));$.length&&H.push(a.createElement(a.Fragment,{key:"no-p"},a.createElement("div",{className:"header"},"No Project"),$.map((function(e){return Y(e)}))));for(var X=function(){var e=Z[Q];H.push(a.createElement(a.Fragment,{key:"p-".concat(e.id)},a.createElement("div",{className:"header link",onClick:function(){S(e.id),w(e.contextId)}},e.title," ",e.state!==ie.Active?"[".concat(e.state,"]"):""," [Empty]",a.createElement("div",{style:{display:"flex"}},a.createElement("div",{className:"tags"},a.createElement(xe,{contextId:e.contextId})),a.createElement(s.b,{className:"button small",to:"/projects/".concat(e.id)},"Edit")))))},Q=0,Z=G;Q<Z.length;Q++)X();v.showCompleted&&H.push(a.createElement(a.Fragment,{key:"completed"},a.createElement("div",{className:"header"},"Completed"),J(!0).map((function(e){return Y(e)}))))}else H.push(a.createElement(a.Fragment,{key:"tasks"},J(!1).map((function(e){return Y(e)})),v.showCompleted&&a.createElement(a.Fragment,null,a.createElement("div",{className:"header"},"Completed"),J(!0).map((function(e){return Y(e)})))));var ee=n.virtualTasks;return v.showCompleted||(ee=ee.filter((function(e){return e.state===oe.Active}))),ee.length&&H.push(a.createElement(a.Fragment,{key:"virtualtasks"},a.createElement("div",{className:"header",style:{background:ae("--task-context-background")}},"Virtual Tasks"),ee.map((function(e){return function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=null;if(window.location.search.length){var n=new URLSearchParams(window.location.search);t="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(n.toString())))}return a.createElement(s.b,{key:e.noteId,to:"/notes/".concat(e.noteId).concat(t||""),className:Object(u.b)("item","task",d)},a.createElement("div",{className:"task-checkbox"},a.createElement("input",{type:"checkbox",style:{display:"block",padding:10},checked:e.state===oe.Completed,onClick:function(e){return e.preventDefault()},readOnly:!0})),a.createElement("div",{className:"task-title",style:{color:e.state===oe.Incubated?"#999":void 0}},e.state===oe.Completed?a.createElement("span",{style:{textDecoration:"line-through"}},U(e.title)):U(e.title),e.state===oe.Incubated?a.createElement("span",null," [Incubated]"):null),a.createElement("div",{className:"task-details"},a.createElement("div",{className:"tags"})))}(e)})))),a.createElement("div",{style:{display:"flex",height:"100%"}},v.showContextBar&&a.createElement(ye,{contextId:k,onChange:w,showTaskCount:!0}),a.createElement("div",{style:{width:"100%"}},a.createElement(ue,null,a.createElement(ge,{alwaysVisible:function(){return a.createElement("div",{className:"button",onClick:function(){w(null),S(null)}},"R")},mobileOnly:function(){return a.createElement("div",{className:"button",style:{marginLeft:"auto",marginRight:8},onClick:function(){return g(Object(se.a)({},v,{showContextBar:!v.showContextBar}))}},"C")}},a.createElement("select",{style:{padding:"0.3rem",display:"block"},value:k||"",onChange:function(e){return w(""===e.target.value?null:e.target.value)}},a.createElement("option",{value:""},"All contexts"),n.contexts.map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)}))),a.createElement("select",{style:{padding:"0.3rem",display:"block"},value:I||"",onChange:function(e){return S(""===e.target.value?null:e.target.value)}},a.createElement("option",{value:""},"All projects"),n.projects.filter((function(e){return e.state===ie.Active})).map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)}))),a.createElement("select",{style:{padding:"0.3rem",display:"block"},value:A||"",onChange:function(e){return P(""===e.target.value?null:e.target.value)}},a.createElement("option",{value:""},"Select Perspective"),ke.map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)}))),a.createElement("div",null,a.createElement("input",{id:"completed-box",type:"checkbox",checked:v.showCompleted,onChange:function(){return g(Object(se.a)({},v,{showCompleted:!v.showCompleted}))}}),a.createElement("label",{htmlFor:"completed-box"},"Show completed")),a.createElement("div",null,a.createElement("input",{id:"deferred-box",type:"checkbox",checked:v.showDeferred,onChange:function(){return g(Object(se.a)({},v,{showDeferred:!v.showDeferred}))}}),a.createElement("label",{htmlFor:"deferred-box"},"Show deferred")),a.createElement("div",null,a.createElement("input",{id:"incubated-box",type:"checkbox",checked:v.showIncubated,onChange:function(){return g(Object(se.a)({},v,{showIncubated:!v.showIncubated}))}}),a.createElement("label",{htmlFor:"incubated-box"},"Show incubated")),a.createElement("div",null,a.createElement("input",{id:"context-box",type:"checkbox",checked:v.showContextBar,onChange:function(){return g(Object(se.a)({},v,{showContextBar:!v.showContextBar}))}}),a.createElement("label",{htmlFor:"context-box"},"Show context bar")),a.createElement("div",null,a.createElement("input",{id:"include-nested-box",type:"checkbox",checked:v.includeNested,onChange:function(){return g(Object(se.a)({},v,{includeNested:!v.includeNested}))}}),a.createElement("label",{htmlFor:"include-nested-box"},"Include nested contexts"))),a.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add task...",value:i,onChange:function(e){return m(e.target.value)},onKeyPress:R})),a.createElement("div",{className:"list"},H)))},Oe=n(14),Ce=n(15),Ne=n(44),Ie=n.n(Ne);n(59);function Se(e){if(e.dailyDate)return"Daily - ".concat(ve()(e.dailyDate).format("MMMM Do, YYYY"));if(e.title&&e.title.length)return e.title;var t=/# (.+)/.exec(e.content);return t&&t.length>1?t[1]:""}!function(e){e[e.Tree=0]="Tree",e[e.Markdown=1]="Markdown"}(Ee||(Ee={}));var Te=/\[\[([^\]]+)\]\]/gi;function De(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ae(e){return new RegExp("\\[\\[".concat(De(e),"\\]\\]"),"i")}function Pe(e){return new RegExp("\\B@".concat(De(e)),"i")}function Re(e){if(!e)return[];var t,n=[],a=Object(N.a)(e.matchAll(/\[\[([^\]]+)\]\]/gi));try{for(a.s();!(t=a.n()).done;){var r=t.value;n.push(r[1])}}catch(c){a.e(c)}finally{a.f()}return n}function Fe(e){var t={};function n(e,t){return"".concat(t,"-").concat(e.toLowerCase())}var a,r=new Set(e.filter((function(e){return e.title})).map((function(e){return n(e.title,e.contextId)}))),c=Object(N.a)(e);try{for(c.s();!(a=c.n()).done;){var o,i=a.value,l=Re(i.content),s=Object(N.a)(l);try{for(s.s();!(o=s.n()).done;){var u=o.value,d=n(u,i.contextId);if(!r.has(d)){var m=t[d];m&&m.updatedAt>new Date(i.updatedAt)||(t[d]={title:u,contextId:i.contextId,updatedAt:new Date(i.updatedAt)})}}}catch(f){s.e(f)}finally{s.f()}}}catch(f){c.e(f)}finally{c.f()}return Object.values(t)}var Be=/(?:^|\s)(@[^\s()[\].,!:'/"=]+)/g;function Le(e){return"@"===e[0]&&(e=e.substring(1)),(e=e[0].toUpperCase()+e.substring(1)).replace(/([-_]\w)/g,(function(e){return" ".concat(e[1].toUpperCase())}))}function Me(e){return"".concat(e.alias||((t=e.name)?t.toLowerCase().replace(/ /g,"_"):null));var t}function Ue(e){if(!e)return[];var t,n=[],a=Object(N.a)(e.matchAll(Be));try{for(a.s();!(t=a.n()).done;){var r=t.value;n.push(r[1].substring(1))}}catch(c){a.e(c)}finally{a.f()}return n}function Je(e,t){var n,a=function(e){var t,n=new Set,a=Object(N.a)(e);try{for(a.s();!(t=a.n()).done;){var r,c=Ue(t.value.content),o=Object(N.a)(c);try{for(o.s();!(r=o.n()).done;){var i=r.value;n.add(i)}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}return n}(t),r=Object(N.a)(e);try{for(r.s();!(n=r.n()).done;){var c=n.value;a.delete(Me(c))}}catch(o){r.e(o)}finally{r.f()}return Array.from(a)}var Ye,Ke=function(e){var t=Object(i.g)(),n=C().data;window.lifeNavigate=function(e){return t.push(e),!1};var r=e.markdown.replace(Te,(function(t,a){var r=e.contextId,c=a,o=n.contexts.find((function(e){return(t=e.title,new RegExp("^".concat(De(t),"/"),"i")).test(a);var t}));o&&(c=c.substring(o.title.length+1),r=o.id);var i=new RegExp("^".concat(De(c),"$"),"i"),l=n.notes.find((function(e){return e.contextId===r&&i.test(e.title)}));if(l){var s="/notes/".concat(l.id);return'<span style="color: #444">[[ </span><a onclick="return lifeNavigate(\''.concat(s,'\')" href="').concat(s,'">').concat(a,'</a><span style="color: #444"> ]]</span>')}var u="/notes/virtual?title=".concat(encodeURIComponent(a)).concat(e.contextId?"&context=".concat(e.contextId):"","&source=").concat(encodeURIComponent("".concat(window.location.pathname)));return'<span style="color: #444">[[ </span><a onclick="return lifeNavigate(\''.concat(u,'\')" href="').concat(u,'">').concat(a,'</a><span style="color: #444"> ? ]]</span>')}));r=r.replace(Be,(function(e,t){var a=e.replace(t,""),r=n.people.find((function(e){return"@".concat(Me(e))===t}));if(r){var c="/people/".concat(r.id,"?source=").concat(encodeURIComponent("".concat(window.location.pathname)));return"".concat(a,"<a onclick=\"return lifeNavigate('").concat(c,'\')" href="').concat(c,'" style="background: #333; padding: 0px 4px; border-radius: 4px">').concat(r.name,"</a>")}var o="/people/virtual?alias=".concat(encodeURIComponent(t),"&source=").concat(encodeURIComponent("".concat(window.location.pathname)));return"".concat(a,"<a onclick=\"return lifeNavigate('").concat(o,'\')" href="').concat(o,'" style="background: #333; padding: 0px 4px; border-radius: 4px">').concat(Le(t),'</a><span style="color: #444"> ?</span>')}));var c=Ie()(r);return a.createElement("div",{className:"marked-viewer note markdown-body",dangerouslySetInnerHTML:{__html:c}})},He=n(27),Ve=n.n(He),We=n(19);n(29),n(30),n(40);!function(e){e[e.Split=0]="Split",e[e.Editor=1]="Editor",e[e.Preview=2]="Preview"}(Ye||(Ye={}));var Ge=function(e){return a.createElement("div",{className:Object(u.b)(f(".5rem"))},a.createElement("button",{className:"button",style:{background:e.mode!==Ee.Markdown?"#444":void 0},onClick:function(){return e.onModeChange(Ee.Markdown)}},"Markdown"),a.createElement("button",{className:"button",style:{background:e.mode!==Ee.Tree?"#444":void 0},onClick:function(){return e.onModeChange(Ee.Tree)}},"Tree"))},ze=function(e){return a.createElement("div",{className:Object(u.b)(f(".5rem"))},a.createElement("button",{className:"button",style:{background:e.mode!==Ye.Split?"#444":void 0},onClick:function(){return e.onModeChange(Ye.Split)}},"Split"),a.createElement("button",{className:"button",style:{background:e.mode!==Ye.Editor?"#444":void 0},onClick:function(){return e.onModeChange(Ye.Editor)}},"Editor"),a.createElement("button",{className:"button",style:{background:e.mode!==Ye.Preview?"#444":void 0},onClick:function(){return e.onModeChange(Ye.Preview)}},"Preview"))},_e=function(e){Object(Ce.a)(n,e);var t=Object(Oe.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(x.a)(n,[{key:"render",value:function(){var e=this,t={};this.props.expand&&(t.width="100%",t.height="100%",t.zIndex=100,t.display="flex",t.maxHeight="100%");var n="1px solid #666",r=[],c={flexGrow:1,minWidth:"50%",borderTop:n,height:"100%"},o={flexGrow:1,minWidth:"50%",background:"transparent",padding:"1rem",borderTop:n};return this.props.mode===Ye.Split&&(c.borderRight=n,o.overflowY="scroll"),this.props.mode!==Ye.Editor&&this.props.mode!==Ye.Split||r.push(a.createElement(Ve.a,{key:"editor",value:this.props.text,fontSize:18,style:c,onChange:function(t){return e.props.onTextChanged(t)},mode:"markdown",theme:re()?"monokai":"textmate",showGutter:!1,showPrintMargin:!1,wrapEnabled:!0,enableBasicAutocompletion:[We.snippetCompleter,We.textCompleter,We.keyWordCompleter],enableLiveAutocompletion:!0,enableSnippets:!0})),this.props.mode!==Ye.Preview&&this.props.mode!==Ye.Split||r.push(a.createElement("div",{key:"2",style:o},a.createElement(Ke,{markdown:this.props.text,contextId:this.props.contextId}))),a.createElement("div",{style:t},r)}}]),n}(a.Component),qe=n(20),$e=n(45),Xe=n.n($e),Qe=function(e){var t=C().data,n=Object(a.useState)((function(){if(!e.text||""===e.text)return!1;try{return JSON.parse(e.text),!1}catch(t){return!0}})),r=Object(l.a)(n,1)[0],c=Object(a.useState)(!1),o=Object(l.a)(c,2),i=o[0],s=o[1],m=Object(a.useState)([]),p=Object(l.a)(m,2),v=p[0],h=p[1],b=Object(a.useState)((function(){return r?[]:e.text&&""!==e.text?JSON.parse(e.text):[{text:"",nodes:[]}]})),g=Object(l.a)(b,2),x=g[0],E=g[1],y=Object(a.useRef)(null),w=Object(a.useState)(x[0]),j=Object(l.a)(w,2),O=j[0],I=j[1],S=a.useState(),T=Object(l.a)(S,2),D=T[0],A=T[1];a.useEffect((function(){var e=t.notes.map((function(e){var n,a=Re(e.content);e.title&&e.title.length&&a.push(e.title);var r=(null===(n=t.contexts.find((function(t){return t.id===e.contextId})))||void 0===n?void 0:n.title)||null;return a.map((function(e){return{title:e,context:r}}))})).flat().filter((function(e){return null!==e.title}));A(e)}),[e.contextId,t.contexts,t.notes]);var P=a.useState(),R=Object(l.a)(P,2),F=R[0],B=R[1];if(a.useEffect((function(){var e=t.people.map((function(e){return Me(e)})).concat(Je(t.people,t.notes)).filter((function(e){return null!==e}));B(e)}),[t.people,t.notes]),r)return a.createElement("div",null,"Invalid tree content (not valid JSON).");if(!D||!F)return a.createElement(k,null);var L=function(t,n){t.text=n,E(Object(qe.a)(x)),e.onTextChanged(JSON.stringify(x))},M=function e(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=Object(N.a)(a);try{for(c.s();!(n=c.n()).done;){var o=n.value;if(o===t)return r;var i=e(t,o.nodes,o);if(i)return i}}catch(l){c.e(l)}finally{c.f()}return null},U=function(){for(var e=[],t=Object(qe.a)(x).reverse();t.length;){var n=t.pop();if(!n)return e;e.push(n);var a,r=Object(N.a)(Object(qe.a)(n.nodes).reverse());try{for(r.s();!(a=r.n()).done;){var c=a.value;t.push(c)}}catch(o){r.e(o)}finally{r.f()}}return e};var J=function(e){e.text.length||e.nodes.length||function(e){var t=M(e),n=t?t.nodes:x,a=n.findIndex((function(t){return t===e}));n.splice(a,1),E(Object(qe.a)(x))}(e)},Y=function(e){var t=M(e),n=t?t.nodes:x,a=n.findIndex((function(t){return t===e}));0!==a&&(n.splice(a,1),n[a-1].nodes.push(e),E(Object(qe.a)(x)))},K=function(e){var t=M(e);if(null!==t){var n=M(t),a=n?n.nodes:x,r=a.findIndex((function(e){return e===t}));a.splice(r+1,0,e);var c=t.nodes.findIndex((function(t){return t===e}));t.nodes.splice(c,1),E(Object(qe.a)(x))}},H=[{name:"indent",bindKey:{win:"tab",mac:"tab"},exec:function(){return setTimeout((function(){Y(O)}),0),!0}},{name:"unindent",bindKey:{win:"shift+tab",mac:"shift+tab"},exec:function(){return setTimeout((function(){K(O)}),0),!0}},{name:"enter",bindKey:{win:"enter",mac:"enter"},exec:function(){if(""!==O.text){var e=y.current&&0===y.current.editor.getCursorPosition().row&&0===y.current.editor.getCursorPosition().column;return setTimeout((function(){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=M(e),a=n?n.nodes:x,r=a.findIndex((function(t){return t===e})),c={text:"",nodes:[]};return a.splice(r+(t?0:1),0,c),E(Object(qe.a)(x)),c}(O,!!e);I(t)}),0),!0}}},{name:"up",bindKey:{win:"up",mac:"up"},exec:function(){if(!(y.current&&0===y.current.editor.getCursorPosition().row))return!1;var e=U(),t=e.findIndex((function(e){return e===O}));return t=Math.max(0,t-1),setTimeout((function(){I(e[t]),J(O)}),0),!0}},{name:"down",bindKey:{win:"down",mac:"down"},exec:function(){if(!(y.current&&y.current.editor.getCursorPosition().row+1===y.current.editor.getSession().doc.getLength()))return!1;var e=U(),t=e.findIndex((function(e){return e===O}));return t=Math.min(e.length-1,t+1),setTimeout((function(){I(e[t]),J(O)}),0),!0}},{name:"space",bindKey:{win:"space",mac:"space"},exec:function(){return!(!y.current||0!==y.current.editor.getCursorPosition().row||0!==y.current.editor.getCursorPosition().column)&&(setTimeout((function(){Y(O)}),0),!0)}},{name:"backspace",bindKey:{win:"backspace",mac:"backspace"},exec:function(){return!(!y.current||0!==y.current.editor.getCursorPosition().row||0!==y.current.editor.getCursorPosition().column)&&(setTimeout((function(){K(O)}),0),!0)}}],V={getCompletions:function(e,t,n,a,r){var c=t.getLine(n.row);if(c)if(o("[["))r(null,D.map((function(e){return{caption:e.title,snippet:e.title,meta:e.context||"note"}})));else if(o("@")){r(null,F.map((function(e){return{caption:e,snippet:e,meta:"person"}})))}else o("::");function o(e){return function(e){for(var t="",n=e.column-1;n>=0&&" "!==c[n];n--)t=c[n]+t;return t}(n).startsWith(e)}}};function W(e){v.includes(e)?h(v.filter((function(t){return t!==e}))):h(v.concat(e))}var G=function t(n,r,c,o){var l=n===O,s=o.includes(n);return a.createElement(a.Fragment,{key:"".concat(c,"-").concat(r)},a.createElement("div",{style:{display:"flex",background:s?"#003838":!i&&l?ae("--active-tree-editor-background"):void 0,padding:".6rem .8rem"},className:d,onClick:function(){return function(e){i?W(e):e!==O&&I(e)}(n)}},i&&a.createElement("div",{style:{lineHeight:1.5,marginRight:8}},a.createElement("input",{type:"checkbox",checked:s,onChange:function(){return W(n)}})),!i&&a.createElement("div",{style:{letterSpacing:".5rem",color:l?"#078263":"#777",lineHeight:1.5}},"\u2022"),!i&&l?a.createElement(Ve.a,{key:"editor",ref:y,value:n.text,fontSize:16,style:{background:"transparent",width:"100%",lineHeight:1.5,marginLeft:-4},onChange:function(e){return L(n,e)},mode:"markdown",theme:re()?"monokai":"textmate",focus:!0,highlightActiveLine:!1,showGutter:!1,showPrintMargin:!1,wrapEnabled:!0,maxLines:1/0,commands:H,enableBasicAutocompletion:[V,We.snippetCompleter,We.textCompleter,We.keyWordCompleter],enableLiveAutocompletion:!0,enableSnippets:!0}):a.createElement(Ke,{markdown:n.text,contextId:e.contextId})),a.createElement("div",{style:{borderLeft:"1px solid #555",marginLeft:16,paddingLeft:16}},n.nodes.map((function(e,n){return t(e,n,c+1,o)}))))};return a.createElement(a.Fragment,null,a.createElement("div",{style:{display:"flex",background:"#444",position:"fixed",height:36,bottom:0,left:0,right:0,zIndex:100},className:Object(u.b)(f(".5rem"))},a.createElement("div",{className:"button",onClick:function(){i?(s(!1),h([])):s(!0)}},"Select"),i?a.createElement(a.Fragment,null,a.createElement("div",{className:"button",onClick:function(){return h(U())}},"All"),a.createElement("div",{className:"button",onClick:function(){var e="";!function(e){for(var t=x.map((function(e,t){return{node:e,depth:0,index:t}})).reverse(),n=function(){var n=t.pop();if(!n)return{v:void 0};e(n.node,n.depth,n.index);var a,r=n.depth,c=Object(N.a)(n.node.nodes.map((function(e,t){return{node:e,depth:r+1,index:t}})).reverse());try{for(c.s();!(a=c.n()).done;){var o=a.value;t.push(o)}}catch(i){c.e(i)}finally{c.f()}};t.length;){var a=n();if("object"===typeof a)return a.v}}((function(t,n,a){v.includes(t)&&(console.log(t,n),e+="".concat("  ".repeat(n),"- ").concat(t.text,"\n"))})),Xe()(e)}},"Copy")):a.createElement(a.Fragment,null,a.createElement("div",{className:"button",onClick:function(e){K(O),y.current&&y.current.editor.focus()}},"\u2190"),a.createElement("div",{className:"button",onClick:function(e){Y(O),y.current&&y.current.editor.focus()}},"\u2192"),a.createElement("div",{className:"button",onClick:function(e){y.current&&(y.current.editor.session.insert(y.current.editor.getCursorPosition(),"[["),y.current.editor.focus())}},"[["),a.createElement("div",{className:"button",onClick:function(e){y.current&&(y.current.editor.session.insert(y.current.editor.getCursorPosition(),"]]"),y.current.editor.focus())}},"]]"))),a.createElement("div",{style:{height:"100%",marginBottom:36}},x.map((function(e,t){return G(e,t,0,v)}))))},Ze=(n(66),function(e){var t=y.a.orderBy(e.data.contexts.filter((function(e){return e.state===fe.Active})),(function(e){return e.title})),n=y.a.orderBy(e.data.contexts.filter((function(e){return e.state!==fe.Active})),(function(e){return e.title}));return a.createElement("select",{className:"input is-large",value:e.contextId||"",onChange:function(t){return e.onChange(t.target.value)}},a.createElement("option",{value:""},"Not set"),t.map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)})),a.createElement("option",{value:"--inactive--",disabled:!0},"-- Inactive"),n.map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)})))});function et(e){var t=a.useState(!1),n=Object(l.a)(t,2),r=n[0],c=n[1],o=a.useState(new tt(e.availableTags,e.tags&&e.tags.length>0?e.tags.split(" "):[])),i=Object(l.a)(o,2),s=i[0],u=i[1],d=a.useRef(void 0),m=a.useRef();function f(e){p(s.withText(e.target.value))}function p(t){u(t),e.onChange(t.getTags())}return a.createElement("div",{className:"tag-input",onFocus:function(){return clearTimeout(d.current),void(r||c(!0))},onBlur:function(){r&&(d.current=setTimeout((function(){c(!1)}),100))}},a.createElement("div",{className:"tags"},s.selectedTags.map((function(e,t){return a.createElement(nt,{key:"tag-".concat(e,"-").concat(t),name:e})})),a.createElement("input",{ref:m,placeholder:"Tag",type:"text",className:"",onChange:function(e){return f(e)},onKeyDown:function(e){return function(e){"ArrowUp"===e.key?p(s.decrementIndex()):"ArrowDown"===e.key?p(s.incrementIndex()):"Enter"===e.key?""===s.text?p(s.addSelectedTag()):p(s.addText()):"Tab"===e.key?(p(s.addSelectedTag()),e.preventDefault()):"Backspace"===e.key&&""===s.text&&p(s.reopenLastTag())}(e)},value:s.text})),r&&s.getFilteredAvailableTags().length>0&&a.createElement("div",{className:"panel"},s.getFilteredAvailableTags().slice(0,10).map((function(e,t){return a.createElement("div",{key:"available-tag-".concat(e),style:s.index===t?{background:"#078263"}:{},onClick:function(){return t=e,p(s.addTag(t)),void m.current.focus();var t}},e)}))))}var tt=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(g.a)(this,e),this.availableTags=void 0,this.selectedTags=void 0,this.text=void 0,this.index=void 0,this.availableTags=t,this.selectedTags=n,this.text=a,this.index=r}return Object(x.a)(e,[{key:"withText",value:function(t){return new e(this.availableTags,this.selectedTags,t,this.index)}},{key:"withAvailableTags",value:function(t){return new e(t,this.selectedTags,this.text,this.index)}},{key:"withSelectedTags",value:function(t){return new e(this.availableTags,t,this.text,this.index)}},{key:"decrementIndex",value:function(){return new e(this.availableTags,this.selectedTags,this.text,Math.max(0,this.index-1))}},{key:"incrementIndex",value:function(){return new e(this.availableTags,this.selectedTags,this.text,Math.max(0,Math.min(this.availableTags.length-1,this.index+1)))}},{key:"addSelectedTag",value:function(){return new e(this.availableTags,this.selectedTags.concat([this.getFilteredAvailableTags()[this.index]]),"",0)}},{key:"addTag",value:function(t){return new e(this.availableTags,this.selectedTags.concat([t]),"",0)}},{key:"addText",value:function(){return new e(this.availableTags,this.selectedTags.concat([this.text]),"",0)}},{key:"reopenLastTag",value:function(){var t=this.selectedTags[this.selectedTags.length-1];return new e(this.availableTags,this.selectedTags.slice(0,this.selectedTags.length-1),t,0)}},{key:"getFilteredAvailableTags",value:function(){var e=this;return this.availableTags.filter((function(t){return-1===e.selectedTags.indexOf(t)})).filter((function(t){return-1!==t.toLowerCase().indexOf(e.text)}))}},{key:"getTags",value:function(){return this.selectedTags.join(" ")}}]),e}(),nt=function(e){return a.createElement("div",{className:"tag is-dark"},e.name)},at=function(e){return a.createElement("div",{className:"tags",style:{marginBottom:0}},e.tags&&e.tags.split(" ").map((function(e,t){return a.createElement(nt,{key:t,name:e})})))};function rt(e){var t=a.useState(ce()?Ye.Editor:Ye.Split),n=Object(l.a)(t,2),r=n[0],c=n[1];return a.createElement("div",{style:{width:"100%",flex:1,display:"flex",flexDirection:"column"}},a.createElement(ue,{verticalAround:!1},a.createElement(ge,{wideStyle:{justifyContent:"space-between"},alwaysVisible:function(){return a.createElement(a.Fragment,null,a.createElement(Ze,{contextId:e.note.contextId,data:e.data,onChange:function(t){return e.updateNote({contextId:t})}}),a.createElement("input",{type:"date",className:"input is-large",value:e.note.dailyDate&&ve()(e.note.dailyDate).format("YYYY-MM-DD")||"",onChange:function(t){var n;""===(n=t.target.value)?e.updateNote({dailyDate:null}):e.updateNote({dailyDate:new Date(n).toISOString()})}}))}},a.createElement(Ge,{mode:e.note.mode||Ee.Tree,onModeChange:function(t){return e.updateNote({mode:t})}}),a.createElement(ze,{mode:r,onModeChange:function(e){return c(e)}}))),a.createElement(ue,null,!e.note.noteFor&&!e.note.dailyDate&&a.createElement(a.Fragment,null,a.createElement("input",{type:"text",placeholder:"Title",className:"input is-large is-wide",value:e.note.title,onChange:function(t){return e.updateNote({title:t.target.value})}}),a.createElement(et,{availableTags:e.availableTags,tags:e.note.tags,onChange:function(t){return e.updateNote({tags:t})}})),e.note.dailyDate&&a.createElement("h1",null,Se({dailyDate:e.note.dailyDate,title:e.note.title,content:e.note.content}))),a.createElement("div",{style:{flex:1}},e.note.mode===Ee.Markdown?a.createElement(_e,{text:e.note.content,expand:!0,onTextChanged:function(t){return e.updateNote({content:t})},mode:r,data:e.data,contextId:e.note.contextId}):a.createElement(Qe,{text:e.note.content,onTextChanged:function(t){return e.updateNote({content:t})},contextId:e.note.contextId})))}var ct=!1;function ot(){ct||(Vt.listen(dt),ct=!0)}var it=Object($.createInstance)({name:"staging-note"});function lt(){return(lt=Object(b.a)(h.a.mark((function e(){var t,n,a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=N.a,e.next=3,it.keys();case 3:e.t1=e.sent,t=(0,e.t0)(e.t1),e.prev=5,t.s();case 7:if((n=t.n()).done){e.next=19;break}return a=n.value,e.next=11,it.getItem(a);case 11:return r=e.sent,e.next=14,_.saveNote(r);case 14:return q.getData(!0),e.next=17,it.removeItem(r.id);case 17:e.next=7;break;case 19:e.next=24;break;case 21:e.prev=21,e.t2=e.catch(5),t.e(e.t2);case 24:return e.prev=24,t.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[5,21,24,27]])})))).apply(this,arguments)}!function(){lt.apply(this,arguments)}();var st=null,ut=null;function dt(e,t){return mt.apply(this,arguments)}function mt(){return(mt=Object(b.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut){e.next=2;break}return e.abrupt("return");case 2:if(st!==t.pathname){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,_.saveNote(ut);case 6:return q.getData(!0),e.next=9,it.removeItem(ut.id);case 9:ut=null;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ft(){return(ft=Object(b.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ot(),!n){e.next=8;break}return ut=t,st=window.location.pathname,e.next=6,it.setItem(t.id,t);case 6:e.next=12;break;case 8:return ut=null,st=null,e.next=12,it.removeItem(t.id);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pt(e){var t=a.useState(e),n=Object(l.a)(t,1)[0],r=a.useState(Object(se.a)({},e)),c=Object(l.a)(r,2),o=c[0],i=c[1],s=a.useState(!1),u=Object(l.a)(s,2),d=u[0],m=u[1];return[o,function(e){var t=Object(se.a)({},o,{},e),a=JSON.stringify(n)!==JSON.stringify(t);m(a),i(t),function(e,t){ft.apply(this,arguments)}(t,a)},d]}var vt=function(e){var t=C().data,n={},r=a.useState(!1),c=Object(l.a)(r,2),o=c[0],d=c[1],m=he(null,"source"),p=Object(l.a)(m,1)[0],v=new URLSearchParams(window.location.search),h=v.get("title"),b=v.get("context"),g=v.has("daily"),x=pt(t.notes.find((function(t){return t.id===e.id}))||{title:h||"",content:"",mode:Ee.Tree,contextId:b,dailyDate:g&&ve()().format("YYYY-MM-DD")||null,noteFor:null,tags:""}),E=Object(l.a)(x,2),y=E[0],k=E[1];if(o)return a.createElement(i.a,{to:p?decodeURIComponent(p):"/"});var w,j=Object(N.a)(t.notes||[]);try{for(j.s();!(w=j.n()).done;){var O=w.value;if(O.tags&&O.tags.length){var I,S=Object(N.a)(O.tags.split(" "));try{for(S.s();!(I=S.n()).done;){var T=I.value;n[T]||(n[T]=0),n[T]+=1}}catch(A){S.e(A)}finally{S.f()}}}}catch(A){j.e(A)}finally{j.f()}var D=Object.keys(n).sort((function(e,t){return n[t]-n[e]}));return e.id?a.createElement(a.Fragment,null,a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},a.createElement(ue,null,a.createElement("div",{className:Object(u.b)(f(".5rem"))},a.createElement(s.b,{to:p?decodeURIComponent(p):"/",className:"button"},"Back"),!y.noteFor&&a.createElement(s.b,{to:"/notes/".concat(y.id),className:"button"},"Show"))),a.createElement(rt,Object.assign({note:y,updateNote:k},y,{data:t,availableTags:D,onNoteAdded:function(){d(!0)}})))):a.createElement(a.Fragment,null,a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},a.createElement(ue,null,a.createElement(s.b,{to:"/",className:"button"},"Back")),a.createElement(rt,{note:y,updateNote:k,availableTags:D,data:t,onNoteAdded:function(){d(!0)}})))},ht=function(e){var t=Object(a.useState)(null),n=Object(l.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)(!1),i=Object(l.a)(o,2),s=i[0],u=i[1];if(a.useEffect((function(){try{var t=[];e.json&&(t=JSON.parse(e.json)),c(t)}catch(n){u(!0)}}),[e.json]),s)return a.createElement("div",null,"Invalid json");if(!r)return a.createElement(k,null);var d=e.referenceTitle?Ae(e.referenceTitle):null;return e.personAlias&&(d=Pe(e.personAlias)),a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}},a.createElement("div",{style:{width:"100%"}},r.map((function(t,n){return function t(n,r,c,o){var i=[];if(o){if(!o.test(n.text))return a.createElement(a.Fragment,{key:"".concat(c,"-").concat(r)},n.nodes.map((function(e,n){return t(e,n,c+1,o)})));o=null,c>0&&i.push(a.createElement("div",{key:"extra-".concat(r,"-").concat(c),style:{paddingTop:8,color:"#aaa"}},"... > ".repeat(c)))}return a.createElement(a.Fragment,{key:"".concat(c,"-").concat(r)},i,a.createElement("div",{style:{display:"flex",padding:".6rem .8rem"}},a.createElement("div",{style:{letterSpacing:".5rem",color:"#777",lineHeight:1.5}},"\u2022"),a.createElement(Ke,{markdown:n.text,contextId:e.contextId})),a.createElement("div",{style:{borderLeft:"1px solid #555",paddingLeft:16,marginLeft:16}},n.nodes.map((function(e,n){return t(e,n,c+1,o)}))))}(t,n,0,d)}))))},bt=function(e){var t=C().data,n=Ae(e.title),r=E.orderBy(t.notes.filter((function(t){return t.contextId===e.contextId&&n.test(t.content)})),(function(e){return e.updatedAt}),"desc");return 0===r.length?null:a.createElement("div",{style:{paddingTop:32}},a.createElement("div",{style:{fontWeight:"bold"}},r.length,' linked references for "',e.title,'"'),r.map((function(t){return a.createElement("div",{key:t.id,style:{marginTop:16}},a.createElement(s.a,{to:"/notes/".concat(t.id),style:{color:"#078263"}},Se(t)),a.createElement("div",{style:{paddingLeft:16,background:"#222",marginTop:8}},t.mode===Ee.Markdown?a.createElement(Ke,{markdown:t.content,contextId:t.contextId}):a.createElement(ht,{json:t.content,contextId:t.contextId,referenceTitle:e.title})))})))},gt=function(e){var t=C().data,n=Pe(e.alias),r=E.orderBy(t.notes.filter((function(e){return n.test(e.content)})),(function(e){return e.updatedAt}),"desc");return 0===r.length?null:a.createElement("div",{style:{paddingTop:32}},a.createElement("div",{style:{fontWeight:"bold"}},r.length,' linked references for "',e.alias,'"'),r.map((function(t){return a.createElement("div",{key:t.id,style:{marginTop:16}},a.createElement(s.a,{to:"/notes/".concat(t.id),style:{color:"#078263"}},Se(t)),a.createElement("div",{style:{paddingLeft:16,background:"#222",marginTop:8}},t.mode===Ee.Markdown?a.createElement(Ke,{markdown:t.content,contextId:t.contextId}):a.createElement(ht,{json:t.content,contextId:t.contextId,personAlias:e.alias})))})))},xt=function(e){var t=C().data,n=he(null,"source"),r=Object(l.a)(n,1)[0],c=t.notes.find((function(t){return t.id===e.id}));if(!c)return a.createElement("div",null,"Note not found.");var o=null;return o=c.mode===Ee.Markdown?a.createElement(Ke,{markdown:c.content,contextId:c.contextId}):a.createElement(ht,{json:c.content,contextId:c.contextId}),a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:r?decodeURIComponent(r):"/",className:"button"},"Back"),a.createElement(s.b,{to:"/notes/".concat(c.id,"/edit"),className:"button"},"Edit")),a.createElement("div",{className:"panel"},a.createElement("div",{className:"content",style:{padding:"1rem"}},a.createElement("h1",null,Se(c)),a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},a.createElement(at,{tags:c.tags}),a.createElement(xe,{contextId:c.contextId})),o,a.createElement(bt,{title:Se(c),contextId:c.contextId}))))},Et=function(e){var t=he(null,"source"),n=Object(l.a)(t,1)[0],r=new URLSearchParams(window.location.search),c=r.get("title"),o=r.get("context");return c?a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:n?decodeURIComponent(n):"/",className:"button"},"Back"),a.createElement(s.b,{to:"/notes/new?title=".concat(encodeURIComponent(c)).concat(o?"&context=".concat(o):"","&source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:"button"},"Create")),a.createElement("div",{className:"panel"},a.createElement("div",{className:"content",style:{padding:"1rem"}},a.createElement("h1",null,c),a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},a.createElement(xe,{contextId:o})),a.createElement(bt,{title:c,contextId:o})))):a.createElement("div",null,"Note not found.")},yt=n(46),kt=n.n(yt),wt=n(47);function jt(e){return a.createElement("div",{className:"list"},e.items.map(e.renderItem))}function Ot(){var e,t=C().data,n=he(null,"search"),r=Object(l.a)(n,2),c=r[0],o=r[1],i=be([],"tags",(function(e){return null!==e?e.split("|"):[]}),(function(e){return e.join("|")})),m=Object(l.a)(i,2),f=m[0],p=m[1],v=a.useState(!ce()),h=Object(l.a)(v,2),b=h[0],g=h[1],x=a.useState(null),E=Object(l.a)(x,2),w=E[0],j=E[1],O=a.useState(null),I=Object(l.a)(O,2),S=I[0],T=I[1],D=a.useState(!1),A=Object(l.a)(D,2),P=A[0],R=A[1],F=be(e=!1,"no-context",(function(e){return"true"===e}),(function(t){return t===e?null:t.toString()})),B=Object(l.a)(F,2),L=B[0],M=B[1],U=a.useState(),J=Object(l.a)(U,2),Y=J[0],K=J[1],H=a.useState([]),V=Object(l.a)(H,2),W=V[0],G=V[1];a.useEffect((function(){var e=Fe(t.notes);K(e)}),[t.notes]),a.useEffect((function(){G(t.contexts.filter((function(e){return e.state===fe.Inactive})).map((function(e){return e.id})))}),[t.contexts]);var z,_=Object(wt.a)(100,(function(e){if(e&&e.length)if(null!==S){var n=S.search(e);j(n.map((function(e){return{id:e.ref,score:e.score}})))}else{var a=kt()((function(){this.field("title"),this.field("text");var e,n=Object(N.a)(t.notes);try{for(n.s();!(e=n.n()).done;){var a=e.value;this.add({id:a.id,title:a.title,text:a.content})}}catch(r){n.e(r)}finally{n.f()}}));T(a);var r=a.search(e);j(r.map((function(e){return{id:e.ref,score:e.score}})))}else j(null)})),q=t.notes||[],$={},X=Object(N.a)(f);try{var Q=function(){var e=z.value;q=q.filter((function(t){return-1!==t.tags.split(" ").indexOf(e)}))};for(X.s();!(z=X.n()).done;)Q()}catch(pe){X.e(pe)}finally{X.f()}P||(q=q.filter((function(e){return!e.noteFor}))),L&&(q=q.filter((function(e){return!e.contextId}))),q=q.filter((function(e){return!e.contextId||-1===W.indexOf(e.contextId)})),w&&(q=w.map((function(e){var t=q.findIndex((function(t){return t.id===e.id}));return q[t]})).filter((function(e){return e})));var Z,ee=Object(N.a)(q);try{for(ee.s();!(Z=ee.n()).done;){var te=Z.value;if(te.tags){var ne,ae=Object(N.a)(te.tags.split(" "));try{for(ae.s();!(ne=ae.n()).done;){var re=ne.value;$[re]||($[re]=0),$[re]+=1}}catch(pe){ae.e(pe)}finally{ae.f()}}}}catch(pe){ee.e(pe)}finally{ee.f()}var oe=Object.keys($).map((function(e){return{key:e,count:$[e],active:-1!==f.indexOf(e)}})).sort((function(e,t){return t.count-e.count})),ie=null;if(window.location.search.length){var le=new URLSearchParams(window.location.search);ie="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(le.toString())))}if(!Y)return a.createElement(k,null);var se=q.map((function(e){return{id:e.id,title:Se(e),tags:e.tags,contextId:e.contextId,updatedAt:new Date(e.updatedAt),url:"/notes/".concat(e.id).concat(ie||""),isRef:!1}})),de=[];w||(de=Y.map((function(e){return{id:null,title:e.title,tags:null,contextId:e.contextId,updatedAt:e.updatedAt,url:"/notes/virtual?title=".concat(encodeURIComponent(e.title)).concat(e.contextId?"&context=".concat(e.contextId):"","&source=").concat(encodeURIComponent("".concat(window.location.pathname))),isRef:!0}}))),de=de.filter((function(e){return!e.contextId||-1===W.indexOf(e.contextId)}));var me=y.a.orderBy(se.concat(de),(function(e){return e.updatedAt}),"desc");return a.createElement("div",{style:{display:"flex",height:"100%"}},b&&a.createElement("div",{style:{borderRight:"1px solid #666",width:200}},a.createElement(jt,{items:oe,renderItem:function(e){return a.createElement("div",{key:e.key,style:{background:e.active?"#444":void 0},onClick:function(){return function(e){-1===f.indexOf(e)?p(f.concat([e])):p(f.filter((function(t){return t!==e})))}(e.key)},className:Object(u.b)("item",d)},e.key," ",a.createElement("span",{style:{color:"#999"}},e.count))}})),a.createElement("div",{style:{width:"100%"}},a.createElement(ue,null,a.createElement(ge,{alwaysVisible:function(){return a.createElement(a.Fragment,null,a.createElement(s.b,{to:"/notes/new",className:"button"},"New Note"))}},a.createElement("div",null,a.createElement("input",{id:"tags-box",type:"checkbox",checked:b,onChange:function(){return g(!b)}}),a.createElement("label",{htmlFor:"tags-box"},"Show tags bar")),a.createElement("div",null,a.createElement("input",{id:"show-notes-for-box",type:"checkbox",checked:P,onChange:function(){return R(!P)}}),a.createElement("label",{htmlFor:"show-notes-for-box"},"Show notes for")),a.createElement("div",null,a.createElement("input",{id:"show-no-context-box",type:"checkbox",checked:L,onChange:function(){return M(!L)}}),a.createElement("label",{htmlFor:"show-no-context-box"},"Show no context"))),a.createElement("input",{style:{fontSize:16,padding:".3rem",width:"100%"},placeholder:"Search...",type:"text",value:c||"",onChange:function(e){o(e.target.value),_(e.target.value)}})),a.createElement("div",{className:"list"},me.map((function(e,t){return a.createElement(a.Fragment,{key:t},a.createElement(s.b,{to:e.url,className:Object(u.b)("item","note",d),style:{color:e.isRef?"#aaa":void 0}},a.createElement("div",{className:"note-title"},a.createElement("div",null,e.title)),a.createElement("div",{className:"note-details"},a.createElement(at,{tags:e.tags||""}),a.createElement("div",{className:"tags"},a.createElement(xe,{contextId:e.contextId})),a.createElement("div",{className:"note-date"},ve()(e.updatedAt).format("ddd MMM Do HH:mm")))))})))))}var Ct=function(e){var t=C().data,n=a.useState(""),r=Object(l.a)(n,2),c=r[0],o=r[1];function i(){return(i=Object(b.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Enter"!==n.key){t.next=5;break}return t.next=3,_.saveContext({title:c,state:fe.Active,contextId:null});case 3:e.refreshData(),o("");case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(e){return a.createElement(s.b,{key:e.id,to:"/contexts/".concat(e.id),className:Object(u.b)("item",d)},a.createElement("div",null,e.title))}return a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add context...",value:c,onChange:function(e){return o(e.target.value)},onKeyPress:function(e){return i.apply(this,arguments)}})),a.createElement("div",{className:"list"},a.createElement("div",{className:"header",style:{background:ae("--task-context-background")}},"Active"),t.contexts.filter((function(e){return e.state===fe.Active})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(e){return m(e)})),a.createElement("div",{className:"header",style:{background:ae("--task-context-background")}},"Not Active"),t.contexts.filter((function(e){return e.state===fe.Inactive})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(e){return m(e)}))))},Nt=function(e){Object(Ce.a)(n,e);var t=Object(Oe.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={text:""},a}return Object(x.a)(n,[{key:"onKeyPress",value:function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=4;break}return e.next=3,_.saveProject({title:this.state.text,state:ie.Active,contextId:null});case 3:this.setState({text:""},this.props.refreshData);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderProject",value:function(e){return a.createElement(s.b,{key:e.id,to:"/projects/".concat(e.id),className:Object(u.b)("item",d)},a.createElement("div",null,e.title),a.createElement("div",{className:"tags"},a.createElement("div",{className:"tag"},e.state),a.createElement(xe,{contextId:e.contextId})))}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement("input",{type:"text",className:"input is-large is-wide",placeholder:"Add project...",value:this.state.text,onChange:function(t){return e.setState({text:t.target.value})},onKeyPress:this.onKeyPress.bind(this)})),a.createElement("div",{className:"list"},a.createElement("div",{className:"header",style:{background:ae("--task-project-background")}},"Active"),this.props.data.projects.filter((function(e){return e.state===ie.Active})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)})),a.createElement("div",{className:"header",style:{background:ae("--task-project-background")}},"Incubated"),this.props.data.projects.filter((function(e){return!e.state||e.state===ie.Incubated})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)})),a.createElement("div",{className:"header",style:{background:ae("--task-project-background")}},"Not Active"),this.props.data.projects.filter((function(e){return e.state!==ie.Active&&e.state!==ie.Incubated})).sort((function(e,t){return t.title<e.title?-1:t.title>e.title?1:0})).map((function(t){return e.renderProject(t)}))))}}]),n}(a.Component);function It(e){var t=C(),n=t.data,r=t.refresh;if(!e.targetEntity)return null;var c=e.targetEntity.noteId,o=function(){var t=Object(b.a)(h.a.mark((function t(){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.targetEntity){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,_.saveNote({title:"",content:"",tags:"",contextId:null,noteFor:e.targetEntity.id,mode:Ee.Tree,dailyDate:null});case 4:if(n=t.sent,"person"!==e.type){t.next=9;break}return e.targetEntity.noteId=n.id,t.next=9,_.savePerson(e.targetEntity);case 9:if("task"!==e.type){t.next=13;break}return e.targetEntity.noteId=n.id,t.next=13,_.saveTask(e.targetEntity);case 13:r();case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(!c)return a.createElement("div",null,a.createElement("div",{className:"button",onClick:o},"Add note"));var i=n.notes.find((function(e){return e.id===c}));return i?a.createElement("div",null,a.createElement(s.b,{to:"/notes/".concat(i.id,"/edit?source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:"button"},"Edit note"),i.mode===Ee.Markdown?a.createElement(Ke,{markdown:i.content,contextId:i.contextId}):a.createElement(ht,{json:i.content,contextId:i.contextId})):null}var St=function(e){var t=C().data;if(!e.targetEntity)return null;var n=e.targetEntity.noteId;if(!n)return null;var r=t.notes.find((function(e){return e.id===n}));return r?a.createElement("div",null,r.mode===Ee.Markdown?a.createElement(Ke,{markdown:r.content,contextId:r.contextId}):a.createElement(ht,{json:r.content,contextId:r.contextId})):null};function Tt(e){var t=C(),n=t.data,r=t.refresh,c=a.useState(""),o=Object(l.a)(c,2),i=o[0],d=o[1],m=a.useState("/tasks"),p=Object(l.a)(m,2),v=p[0],g=p[1];function x(){return(x=Object(b.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(a=n.target.value)&&(a=null),t.contextId=a,e.next=5,_.saveTask(t);case 5:r();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=Object(b.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(a=n.target.value)&&(a=null),t.projectId=a,e.next=5,_.saveTask(t);case 5:r();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(b.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.target.value,t.deferredUntil=""===a?null:new Date(a).toISOString(),e.next=4,_.saveTask(t);case 4:r();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(b.a)(h.a.mark((function t(a){var c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Enter"!==a.key){t.next=9;break}if(c=n.tasks.find((function(t){return t.id===e.id}))){t.next=4;break}return t.abrupt("return");case 4:if(c.title===i){t.next=9;break}return c.title=i,t.next=8,_.saveTask(c);case 8:r();case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(e){return j.apply(this,arguments)}function j(){return(j=Object(b.a)(h.a.mark((function t(a){var c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=n.tasks.find((function(t){return t.id===e.id}))){t.next=3;break}return t.abrupt("return");case 3:if(c.state!==a){t.next=5;break}return t.abrupt("return");case 5:return c.state=a,c.stateChangedAt=(new Date).toISOString(),t.next=9,_.saveTask(c);case 9:r();case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}a.useEffect((function(){var t=new URLSearchParams(window.location.search),a=n.tasks.find((function(t){return t.id===e.id}));d(a.title),t.has("source")&&g(decodeURIComponent(t.get("source")))}),[n.tasks,e.id]);var O=n.tasks.find((function(t){return t.id===e.id}));if(!O)return a.createElement("div",null,"Task not found.");var N=!1;return O.title!==i&&(N=!0),a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:v,className:"button"},"Back")),a.createElement(ue,null,a.createElement("div",null,"Task"),a.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:N?"2px solid orange":void 0},value:i,onKeyDown:function(e){return function(e){return k.apply(this,arguments)}(e)},onChange:function(e){return d(e.target.value)}}),a.createElement("div",null,"State"),a.createElement("div",{className:Object(u.b)(f(".5rem"))},a.createElement("div",{className:Object(u.b)("button",O.state!==oe.Active?"inactive":null),onClick:function(){return w(oe.Active)}},"Active"),a.createElement("div",{className:Object(u.b)("button",O.state!==oe.Incubated?"inactive":null),onClick:function(){return w(oe.Incubated)}},"Incubated"),a.createElement("div",{className:Object(u.b)("button",O.state!==oe.Completed?"inactive":null),onClick:function(){return w(oe.Completed)}},"Completed")),a.createElement("div",null,"Context"),a.createElement("select",{className:"input is-large",value:O.contextId||"",onChange:function(e){return function(e,t){return x.apply(this,arguments)}(O,e)}},a.createElement("option",{value:""},"Not set"),n.contexts.map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)}))),a.createElement("div",null,"Project"),a.createElement("select",{className:"input is-large",value:O.projectId||"",onChange:function(e){return function(e,t){return E.apply(this,arguments)}(O,e)}},a.createElement("option",{value:""},"Not set"),n.projects.filter((function(e){return e.state===ie.Active||e.id===O.projectId})).map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)}))),a.createElement("div",null,"Defer"),a.createElement("input",{type:"date",className:"input is-large",value:O.deferredUntil&&ve()(O.deferredUntil).format("YYYY-MM-DD")||"",onChange:function(e){return function(e,t){return y.apply(this,arguments)}(O,e)}})),a.createElement(ue,null,a.createElement(It,Object.assign({targetEntity:O,type:"task"},e))))}var Dt=function(e){Object(Ce.a)(n,e);var t=Object(Oe.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={title:""},a}return Object(x.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.data.projects.find((function(t){return t.id===e.props.id}));this.setState({title:t.title})}},{key:"setContext",value:function(){var e=Object(b.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===n&&(n=null),t.contextId=n,e.next=4,_.saveProject(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setProjectState",value:function(){var e=Object(b.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.target.value,t.state=a,e.next=4,_.saveProject(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onKeyDown",value:function(){var e=Object(b.a)(h.a.mark((function e(t){var n,a=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.projects.find((function(e){return e.id===a.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,_.saveProject(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(null===this.props.data)return a.createElement(k,null);var t=this.props.data.projects.find((function(t){return t.id===e.props.id}));if(!t)return a.createElement("div",null,"Project not found.");var n=!1;return t.title!==this.state.title&&(n=!0),a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:"/projects",className:"button"},"Back")),a.createElement(ue,null,a.createElement("div",null,"Project"),a.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),a.createElement("div",null,"Context"),a.createElement(Ze,{contextId:t.contextId,onChange:function(n){return e.setContext(t,n)},data:this.props.data}),a.createElement("div",null,"State"),a.createElement("select",{className:"input is-large",value:t.state||ie.Active,onChange:function(n){return e.setProjectState(t,n)}},Object.keys(ie).map((function(e){return a.createElement("option",{key:e,value:e},ie[e])})))))}}]),n}(a.Component),At=function(e){Object(Ce.a)(n,e);var t=Object(Oe.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={title:""},a}return Object(x.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.data.contexts.find((function(t){return t.id===e.props.id}));this.setState({title:t.title})}},{key:"onKeyDown",value:function(){var e=Object(b.a)(h.a.mark((function e(t){var n,a=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(n=this.props.data.contexts.find((function(e){return e.id===a.props.id}))){e.next=4;break}return e.abrupt("return");case 4:if(n.title===this.state.title){e.next=9;break}return n.title=this.state.title,e.next=8,_.saveContext(n);case 8:this.props.refreshData();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setContext",value:function(){var e=Object(b.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return""===(a=n.target.value)&&(a=null),t.contextId=a,e.next=5,_.saveContext(t);case 5:this.props.refreshData();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setContextState",value:function(){var e=Object(b.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.target.value,t.state=a,e.next=4,_.saveContext(t);case 4:this.props.refreshData();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.data.contexts.find((function(t){return t.id===e.props.id}));if(!t)return a.createElement("div",null,"Context not found.");var n=!1;return t.title!==this.state.title&&(n=!0),a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:"/contexts",className:"button"},"Back")),a.createElement(ue,null,a.createElement("div",null,"Context"),a.createElement("input",{type:"text",className:"input is-large is-wide",style:{border:n?"2px solid orange":void 0},value:this.state.title,onKeyDown:function(t){return e.onKeyDown(t)},onChange:function(t){return e.setState({title:t.target.value})}}),a.createElement("div",null,"Parent Context"),a.createElement("select",{className:"input is-large",value:t.contextId||"",onChange:function(n){return e.setContext(t,n)}},a.createElement("option",{value:""},"Not set"),this.props.data.contexts.filter((function(e){return e.id!==t.id})).map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.title)}))),a.createElement("div",null,"State"),a.createElement("select",{className:"input is-large",value:t.state||fe.Active,onChange:function(n){return e.setContextState(t,n)}},Object.keys(fe).filter((function(e){return!isNaN(e)})).map((function(e){return a.createElement("option",{key:e,value:e},fe[e])})))))}}]),n}(a.Component),Pt=n(26),Rt=function(e){Object(Ce.a)(n,e);var t=Object(Oe.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={error:null,data:null},a.refreshData=a.refreshData.bind(Object(Pt.a)(a)),a}return Object(x.a)(n,[{key:"componentDidMount",value:function(){var e=Object(b.a)(h.a.mark((function e(){var t=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q.registerDataListener((function(e){return t.setState({data:e})})),e.t0=this,e.next=4,q.getData();case 4:e.t1=e.sent,e.t2={data:e.t1},e.t3=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q.startServerSync();case 2:return e.next=4,q.ensureServerSyncEnqueued();case 4:case"end":return e.stop()}}),e)}))),e.t0.setState.call(e.t0,e.t2,e.t3);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshData",value:function(){var e=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,q.getData(!0);case 3:e.t1=e.sent,e.t2={data:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.error?a.createElement(a.Fragment,null,a.createElement("div",null,this.state.error),a.createElement(ue,null,a.createElement("div",{className:"button",onClick:function(){return e.refreshData()}},"Retry"),a.createElement("div",{className:"button",onClick:function(){return window.location.reload()}},"Reload"),a.createElement("div",{className:"button",onClick:function(){return window.location.reload(!0)}},"Force Reload"),a.createElement("a",{className:"button",href:"/login"},"Login"))):this.state.data?this.props.render({data:this.state.data,refreshData:this.refreshData}):a.createElement(k,null)}}]),n}(a.Component),Ft=function(e){var t=C().data,n=a.useState(),r=Object(l.a)(n,2),c=r[0],o=r[1];a.useEffect((function(){o(Je(t.people,t.notes))}),[t.people,t.notes]);var i=t.people.map((function(e){return{id:e.id,name:e.name,isRef:!1}})),m=c?c.map((function(e){return{name:Le(e),alias:e,isRef:!0}})):[],f=i.concat(m);return a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:"/people/new",className:"button"},"New Person")),a.createElement("div",{className:"list"},f.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return(t=e).isRef?a.createElement(s.b,{key:t.alias,to:"/people/virtual?alias=".concat(t.alias,"&source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:Object(u.b)("item",d),style:{color:"#aaa"}},a.createElement("div",null,t.name)):a.createElement(s.b,{key:t.id,to:"/people/".concat(t.id),className:Object(u.b)("item",d)},a.createElement("div",null,t.name));var t}))))},Bt=n(25),Lt=function(e){var t=C().data,n=Object(a.useState)(null),r=Object(l.a)(n,2),c=r[0],o=r[1],u=function(e){var t=Object(a.useState)(e),n=Object(l.a)(t,2),r=n[0],c=n[1];return{values:r,handleChange:function(e){e.persist(),c((function(t){return Object(se.a)({},t,Object(Bt.a)({},e.target.name,e.target.value))}))}}}((function(){var n=e.id?t.people.find((function(t){return t.id===e.id})):null;return{name:n?n.name:"",alias:n?n.alias:"",birthday:n?n.birthday:null}})),d=u.values,m=u.handleChange,f=function(){var n=Object(b.a)(h.a.mark((function n(){var a,r,c,i;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(a=e.id||null)){n.next=13;break}if(null!==(c=t.people.find((function(e){return e.id===a})))){n.next=5;break}throw new Error("Person is null?");case 5:return c.name=d.name,c.alias=(null===(r=d.alias)||void 0===r?void 0:r.length)&&d.alias||null,c.birthday=d.birthday,n.next=10,_.savePerson(c);case 10:o(c.id),n.next=15;break;case 13:return n.next=15,_.savePerson({name:d.name,alias:(null===(i=d.alias)||void 0===i?void 0:i.length)&&d.alias||null,birthday:d.birthday,noteId:null});case 15:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),p=e.id&&t.people.find((function(t){return t.id===e.id}))||null;return a.createElement(a.Fragment,null,c&&a.createElement(i.a,{to:"/people/".concat(c)}),a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},a.createElement(ue,null,a.createElement(s.b,{to:"/people",className:"button"},"Back"),e.id&&a.createElement(s.b,{to:"/people/".concat(e.id),className:"button"},"Show")),a.createElement(ue,null,void 0===e.id?a.createElement("button",{type:"button",className:"button is-primary",onClick:f},"Add person"):a.createElement("button",{type:"button",className:"button is-primary",onClick:f},"Update person")),a.createElement(ue,null,a.createElement("div",null,"Name"),a.createElement("input",{type:"text",name:"name",className:"input is-large is-wide",value:d.name,onChange:m}),a.createElement("div",null,"Alias"),a.createElement("input",{type:"text",name:"alias",className:"input is-large is-wide",value:d.alias||"",onChange:m}),a.createElement("div",null,"Birthday"),a.createElement("input",{type:"date",name:"birthday",className:"input is-large",value:d.birthday||"",onChange:m})),a.createElement(ue,null,a.createElement(It,{targetEntity:p,type:"person"}))))},Mt=function(e){var t=C().data.people.find((function(t){return t.id===e.id}));return t?a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:"/people",className:"button"},"Back"),a.createElement(s.b,{to:"/people/".concat(t.id,"/edit"),className:"button"},"Edit")),a.createElement("div",{className:"panel"},a.createElement("div",{className:"content",style:{padding:"1rem"}},a.createElement("h1",null,t.name," (@",Me(t),")"),t.birthday&&a.createElement("div",null,"Birthday: ",ve()(t.birthday).format("YYYY-MM-DD")),a.createElement(St,Object.assign({targetEntity:t},e)),a.createElement(gt,{alias:Me(t)})))):a.createElement("div",null,"Person not found.")},Ut=function(e){var t=he(null,"source"),n=Object(l.a)(t,1)[0],r=new URLSearchParams(window.location.search).get("alias");return r?a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement(s.b,{to:n?decodeURIComponent(n):"/",className:"button"},"Back"),a.createElement(s.b,{to:"/notes/new?alias=".concat(r,"&source=").concat(encodeURIComponent("".concat(window.location.pathname))),className:"button"},"Create")),a.createElement("div",{className:"panel"},a.createElement("div",{className:"content",style:{padding:"1rem"}},a.createElement("h1",null,r),a.createElement(gt,{alias:r})))):a.createElement("div",null,"Person not found.")},Jt=function(e){var t=C().data,n=a.useState(null),r=Object(l.a)(n,1)[0],c=a.useState(null),o=Object(l.a)(c,1)[0],i=a.useState(null),s=Object(l.a)(i,1)[0],u=a.useState(null),d=Object(l.a)(u,1)[0],m=a.useState(null),f=Object(l.a)(m,1)[0];return a.useEffect((function(){})),a.createElement(a.Fragment,null,a.createElement(ue,null),a.createElement("div",{className:"panel"},a.createElement("div",{className:"content",style:{padding:"1rem"}},a.createElement("h1",null,"Stats"),a.createElement("ul",null,a.createElement("li",null,"Notes: ",t.notes.length,", versions: ",r||"..."),a.createElement("li",null,"Tasks: ",t.tasks.length,", versions: ",o||"..."),a.createElement("li",null,"People: ",t.people.length,", versions: ",s||"..."),a.createElement("li",null,"Projects: ",t.projects.length,", versions: ",d||"..."),a.createElement("li",null,"Contexts: ",t.contexts.length,", versions: ",f||"...")))))},Yt=function(e){var t=he(null,"context"),n=Object(l.a)(t,2),r=n[0],c=n[1],o=C().data,i=ve()().add(-30,"d"),u=me(r,o),d=y.a.orderBy(o.notes.filter((function(e){return e.dailyDate&&ve()(e.dailyDate)>i&&(!r||-1!==u.indexOf(e.contextId))})),(function(e){return e.dailyDate}),"desc");var m=y.a.countBy(o.notes.filter((function(e){return e.dailyDate})),(function(e){return e.contextId})),p=y.a.orderBy(Object.keys(m).map((function(e){return{contextId:e,count:m[e],context:o.contexts.find((function(t){return t.id===e}))}})),(function(e){return e.count}),"desc"),v=new URLSearchParams(window.location.search),h="?source=".concat(encodeURIComponent("".concat(window.location.pathname,"?").concat(v.toString())));return a.createElement("div",{style:{display:"flex",height:"100%"}},a.createElement(ye,{contextId:r,onChange:c}),a.createElement("div",{style:{width:"100%"}},a.createElement(ue,null,p.map((function(e){return a.createElement(s.b,{key:e.contextId,to:"/notes/new?context=".concat(e.contextId,"&daily"),className:"button"},"New Note",e.context?" - ".concat(e.context.title):"")}))),a.createElement("div",{className:"panel"},d.map((function(e){return a.createElement("div",{key:e.id,className:"content",style:{padding:"1rem"}},a.createElement("h1",null,Se(e)),a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},a.createElement("div",{className:f("8px")},a.createElement("a",{className:"button small",href:"/notes/".concat(e.id).concat(h)},"Show"),a.createElement("a",{className:"button small",href:"/notes/".concat(e.id,"/edit").concat(h)},"Edit")),a.createElement(xe,{contextId:e.contextId})),(t=e).mode===Ee.Markdown?a.createElement(Ke,{markdown:t.content,contextId:t.contextId}):a.createElement(ht,{json:t.content,contextId:t.contextId}));var t})))))},Kt=(n(67),a.createElement(le,null,a.createElement(O,null,a.createElement(i.d,null,a.createElement(i.b,{exact:!0,path:"/",render:function(e){return a.createElement(Ot,null)}}),a.createElement(i.b,{exact:!0,path:"/notes/new",render:function(e){return a.createElement(vt,null)}}),a.createElement(i.b,{exact:!0,path:"/notes/daily",render:function(e){return a.createElement(Yt,null)}}),a.createElement(i.b,{exact:!0,path:"/notes/virtual",render:function(e){return a.createElement(Et,null)}}),a.createElement(i.b,{exact:!0,path:"/notes/:id",render:function(e){return a.createElement(xt,{id:e.match.params.id})}}),a.createElement(i.b,{exact:!0,path:"/notes/:id/edit",render:function(e){return a.createElement(vt,{id:e.match.params.id})}}),a.createElement(i.b,{exact:!0,path:"/tasks",render:function(e){return a.createElement(je,null)}}),a.createElement(i.b,{exact:!0,path:"/tasks/:id",render:function(e){return a.createElement(Rt,{render:function(t){return a.createElement(Tt,Object.assign({},t,{id:e.match.params.id}))}})}}),a.createElement(i.b,{exact:!0,path:"/contexts",render:function(e){return a.createElement(Rt,{render:function(e){return a.createElement(Ct,e)}})}}),a.createElement(i.b,{exact:!0,path:"/contexts/:id",render:function(e){return a.createElement(Rt,{render:function(t){return a.createElement(At,Object.assign({},t,{id:e.match.params.id}))}})}}),a.createElement(i.b,{exact:!0,path:"/projects",render:function(e){return a.createElement(Rt,{render:function(e){return a.createElement(Nt,e)}})}}),a.createElement(i.b,{exact:!0,path:"/projects/:id",render:function(e){return a.createElement(Rt,{render:function(t){return a.createElement(Dt,Object.assign({},t,{id:e.match.params.id}))}})}}),a.createElement(i.b,{exact:!0,path:"/people",render:function(e){return a.createElement(Ft,null)}}),a.createElement(i.b,{exact:!0,path:"/people/virtual",render:function(e){return a.createElement(Ut,null)}}),a.createElement(i.b,{exact:!0,path:"/people/new",render:function(e){return a.createElement(Lt,null)}}),a.createElement(i.b,{exact:!0,path:"/people/:id",render:function(e){return a.createElement(Mt,{id:e.match.params.id})}}),a.createElement(i.b,{exact:!0,path:"/people/:id/edit",render:function(e){return a.createElement(Lt,{id:e.match.params.id})}}),a.createElement(i.b,{path:"/playground",component:function(){var e=C().data;return console.log(Fe(e.notes)),a.createElement("div",{style:{height:"100%"}},a.createElement(ue,null))}}),a.createElement(i.b,{path:"/sync",component:function(e){var t=r.a.useState(0),n=Object(l.a)(t,2),a=n[0],c=n[1];return r.a.useEffect((function(){q.registerSyncListener((function(){c((function(e){return e+1}))}))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(r.a.Fragment,{key:a}),r.a.createElement(ue,null,r.a.createElement("div",null,"Status: ",z[q.status]),r.a.createElement("div",{className:"button",onClick:function(){return q.startServerSync()}},"Sync Now")),r.a.createElement("div",{className:"list"},q.getResults().slice(0).reverse().map((function(e,t){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement("div",{className:"item"},e.type," - ",e.endAt.getTime()-e.startAt.getTime()," ms - start: ",ve()(e.startAt).format("HH:mm:ss"),", end: ",ve()(e.endAt).format("HH:mm:ss"),", fetch: ",e.fetch,", send: ",e.send,e.error?", error: ".concat(e.error):null))}))))}}),a.createElement(i.b,{path:"/stats",render:function(e){return a.createElement(Jt,null)}}),a.createElement(i.b,{path:"/settings",component:function(){var e=a.useState(null),t=Object(l.a)(e,2),n=t[0],r=t[1],c=a.useState(""),o=Object(l.a)(c,2),i=o[0],s=o[1];return a.useEffect((function(){function e(){return(e=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,_.syncRemoteConnected();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),a.createElement(a.Fragment,null,a.createElement(ue,null,a.createElement("div",{className:"button",onClick:function(){return te("dark-theme")}},"Dark theme"),a.createElement("div",{className:"button",onClick:function(){return te("light-theme")}},"Light theme")),a.createElement(ue,null,a.createElement("div",{className:"button",onClick:function(){return window.location.reload()}},"Reload"),a.createElement("div",{className:"button",onClick:function(){return window.location.reload(!0)}},"Force Reload")),a.createElement(ue,null,n?a.createElement("div",{className:"button",onClick:function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.disconnectBlobStorage(),e.t0=r,e.next=4,_.syncRemoteConnected();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Disconnect Blob Storage"):a.createElement(a.Fragment,null,a.createElement("div",{className:"button",onClick:function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.connectBlobStorage(i),e.t0=r,e.next=4,_.syncRemoteConnected();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Connect Blob Storage"),a.createElement("input",{type:"text",value:i,onChange:function(e){return s(e.target.value)}}))))}}))))),Ht=n(12),Vt=(n(68),Object(Ht.a)());o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.c,{children:Kt,history:Vt})),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.b343e7f4.chunk.js.map