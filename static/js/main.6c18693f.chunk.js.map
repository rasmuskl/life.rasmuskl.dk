{"version":3,"sources":["serviceWorker.ts","components/ServiceWorkerInstall.tsx","layout/styles.ts","db/EventListener.ts","db/db.ts","components/Loader.tsx","model.tsx","lib/dropboxApi.ts","bridge/HostBridge.ts","db/syncer.ts","components/ServiceWorkerUpdate.tsx","layout/theme.ts","components/Layout.tsx","db/project.ts","framework/ToolSection.tsx","lib/contextActions.ts","db/context.ts","lib/UseQueryState.ts","components/SettingsCompactor.tsx","components/ContextTag.tsx","components/ContextBar.tsx","pages/TaskPage.tsx","db/note.ts","db/person.ts","components/MarkedViewer.tsx","components/SimpleSplitEditor.tsx","components/TreeEditor.tsx","components/ContextSelector.tsx","components/TagInput.tsx","components/NoteEditor.tsx","db/stagingArea.ts","pages/notes/EditNotePage.tsx","components/TreeViewer.tsx","components/ReferenceViewer.tsx","pages/notes/ShowNotePage.tsx","framework/List.tsx","pages/notes/NotePage.tsx","pages/PlaygroundPage.tsx","pages/ContextPage.tsx","pages/ProjectPage.tsx","components/EmbeddedNote.tsx","pages/ShowTaskPage.tsx","pages/ShowProjectPage.tsx","pages/ShowContextPage.tsx","pages/DataPage.tsx","db/crypt.ts","pages/SettingsPage.tsx","pages/people/PeoplePage.tsx","pages/people/EditPersonPage.tsx","pages/people/ShowPersonPage.tsx","pages/StatsPage.tsx","pages/notes/DailyNotes.tsx","routes.tsx","pages/SyncPage.tsx","index.tsx"],"names":["isLocalhost","Boolean","window","location","hostname","match","config","a","navigator","URL","process","href","origin","addEventListener","swUrl","checkValidServiceWorker","serviceWorker","ready","console","log","registerValidSW","self","event","data","type","skipWaiting","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","fetch","headers","response","contentType","get","status","indexOf","unregister","reload","ServiceWorkerInstall","props","installEvent","e","preventDefault","setState","this","prompt","userChoice","then","choiceResult","outcome","className","onClick","onInstallClick","React","hoverGlow","cursorPointer","css","cursor","display","alignItems","horizontalSpace","width","around","paddingLeft","undefined","paddingRight","marginLeft","marginRight","verticalSpace","height","paddingTop","paddingBottom","marginBottom","EventListener","listeners","listener","push","filter","x","arg","LocalForageStore","store","changeListener","createInstance","name","entityProps","now","Date","toISOString","id","uuid","versionId","parentVersionIds","createdAt","updatedAt","entity","setItem","getKey","trigger","Error","parentVersionId1","suppressChangeListener","getLeafNodes","leafNodes","length","warn","map","node","_","getKeysPrefixed","keys","getItem","prefix","k","startsWith","split","objs","parts","parentVersionId2","groups","o","leafNodeArrays","Object","group","parents","result","leafObjs","dropInstance","join","replace","c","r","Math","random","toString","contexts","tasks","notes","projects","people","getSyncKeys","getBySyncKey","syncKey","entities","import","serverEntities","serverEntity","unencryptedData","JSON","parse","syncKeys","entityData","stringify","db","importEntites","importServerEntites","exportServerEntities","Loader","style","justifyContent","border","padding","background","Data","DataContext","createContext","DataProvider","useState","setData","useEffect","syncer","registerDataListener","getData","startServerSync","ensureServerSyncEnqueued","init","value","Provider","children","useData","useContext","isLocalMode","host","clientId","tryStoreAccessKey","localFetch","isSignedIn","getStateSnapshot","snapshot","files","Set","setStateSnapshot","removeItem","disconnect","refreshDropbox","listFiles","useSnapshot","Dropbox","getAccessToken","accessToken","dropbox","hasMore","filesListFolderContinue","fileListResult","results","entries","path_lower","substring","p","file","add","has_more","filesListFolder","path","recursive","getAccessTokenFromUrl","str","ret","trim","forEach","param","key","shift","val","decodeURIComponent","retVal","Array","isArray","parseAuthFromHash","hash","access_token","uploadFile","contents","filesUpload","getFile","filesDownload","Promise","resolve","blob","fileBlob","reader","FileReader","json","readAsText","getBridge","desktop","chrome","webview","hostObjects","dotnet","android","AndroidBridge","getNotes","getNote","getContext","syncRemote","syncRemoteConnected","disconnectBlobStorage","connectionString","connectBlobStorage","SyncStatus","Api","hasBridge","getEntity","sendEntity","Idle","intervalHandle","syncListener","dataListener","note","concat","task","context","project","person","loadData","setInterval","Syncing","dropboxApi","runDropboxSync","runBridgeSync","difference","setA","setB","_difference","delete","startAt","serverKeys","toSend","toFetch","size","endAt","error","send","Failed","message","limit","pLimit","promises","all","getAll","orderBy","ServiceWorkerUpdate","waitingServiceWorker","setWaitingServiceWorker","waiting","target","update","componentDidMount","postMessage","themeStore","themeListener","currentTheme","setTheme","theme","getVariable","variable","getComputedStyle","document","documentElement","getPropertyValue","isDark","isMobile","matchMedia","matches","ProjectState","Layout","sidebar","setSidebar","count","setCount","onNavClick","registerSyncListener","overflow","cx","styles","to","exact","activeClassName","overflowY","overflowX","ToolSection","verticalAround","getNestedContexts","grouped","contextId","taskCounts","topContexts","nestedContexts","getFilteredContextIds","contextIds","queue","next","pop","nested","ContextState","useQueryState","initialValue","queryParam","URLSearchParams","search","rawValue","setRawValue","urlParams","set","queryString","history","replaceState","pathname","dispatchEvent","CustomEvent","useQueryStateT","convertTo","convertFrom","strValue","SettingsCompactor","expanded","setExpanded","alwaysVisible","wideStyle","mobileOnly","flexDirection","ContextTag","find","title","ContextBar","ContextActions","borderRight","onChange","i","renderListContext","depth","Inactive","showTaskCount","color","perspectives","groupedProject","groupedContext","defaultPerspective","TaskPage","text","setText","showCompleted","showDeferred","showIncubated","showContextBar","includeNested","options","setOptions","setContextId","projectId","setProjectId","perspectiveId","setPerspectiveId","onKeyPress","create","content","stateChangedAt","noteId","onCompleteChange","save","renderProject","renderDeferred","deferredUntil","moment","format","fromNow","renderNote","renderTitle","pattern","stopPropagation","rel","filterTasks","complete","t","incubatedProjectIds","Incubated","sort","b","renderTask","skipProjectContext","source","encodeURIComponent","checked","textDecoration","perspective","taskBlock","filteredContextIds","stateOrder","Active","Completed","Dropped","emptyActiveProjects","filteredProjects","projectTasks","noProjectTasks","htmlFor","placeholder","getNoteTitle","dailyDate","parsedTitle","exec","getNoteTitleType","noteReferenceRegex","escapeRegExp","getNoteReferenceMatchRegExp","reference","RegExp","getNoteAliasReferenceMatchRegExp","alias","extractReferences","matchAll","extractAllReferences","toLowerCase","existing","n","references","has","existingResult","values","mentionRegex","getAlias","SplitMode","MarkedViewer","useHistory","lifeNavigate","url","markdown","group1","matchContextId","matchTitle","prefixContext","contextTitle","test","referenceRegExp","html","marked","dangerouslySetInnerHTML","__html","NoteModeSelector","mode","onModeChange","SplitModeSelector","Split","Editor","Preview","SimpleSplitEditor","expand","zIndex","maxHeight","components","textAreaStyle","flexGrow","minWidth","borderTop","markedStyle","fontSize","onTextChanged","showGutter","showPrintMargin","wrapEnabled","enableBasicAutocompletion","snippetCompleter","textCompleter","keyWordCompleter","enableLiveAutocompletion","enableSnippets","TreeEditor","invalid","selectMode","setSelectMode","selectedNodes","setSelectedNodes","nodes","setNodes","inputRef","useRef","active","setActive","noteTitles","setNoteTitles","noteCompletions","titles","flat","peopleAliases","setPeopleAliases","aliases","onInputChanged","getParentNode","targetNode","searchNodes","parentNode","childResult","preorderTraversal","stack","reverse","childNode","removeNodeIfEmpty","nodeIndex","findIndex","splice","removeNode","indentNode","unindentNode","parentParentNode","targetNodes","parentNodeIndex","commands","bindKey","win","mac","setTimeout","above","current","editor","getCursorPosition","row","column","newNode","afterNode","insertNode","activeIndex","max","getSession","doc","getLength","min","completions","getCompletions","session","pos","editorPrefix","callback","line","getLine","hasPrefix","caption","snippet","meta","requiredPrefix","position","getPrefix","toggleSelected","includes","renderNode","index","level","isActive","isSelected","clickNode","lineHeight","letterSpacing","ref","focus","highlightActiveLine","maxLines","Infinity","borderLeft","bottom","left","right","visit","visitNodes","repeat","copy","insert","ContextSelector","activeContexts","inactiveContexts","disabled","TagInput","setFocus","TagState","availableTags","tags","tagState","setTagState","timeoutId","tagInput","onTextChange","withText","newTagState","getTags","onFocus","clearTimeout","onBlur","selectedTags","onKeyDown","decrementIndex","incrementIndex","addSelectedTag","addText","reopenLastTag","getFilteredAvailableTags","slice","tag","addTag","lastTag","Tag","TagList","NoteEditor","splitMode","setSplitMode","flex","updateNote","noteFor","registered","ensureRegister","listen","onNavigate","processQueue","queuedPath","queuedNote","action","hasChanges","useNote","pristineNote","pristine","setNote","setHasChanges","newNote","newHasChanges","EditNotePage","goBack","setGoBack","daily","createUnsaved","onNoteAdded","TreeViewer","setInvalid","referenceTitle","personAlias","extra","ReferenceViewer","contextNotes","fontWeight","marginTop","PersonReferenceViewer","matchingNotes","ShowNotePage","viewer","ShowVirtualNotePage","List","items","renderItem","NotePage","s","filterTags","setFilterTags","showTagsBar","setShowTagsBar","searchResult","setSearchResult","searchIndex","setSearchIndex","showNotesFor","setShowNotesFor","showNoContext","setShowNoContext","virtualReferences","setVirtualReferences","setInactiveContexts","refs","debouncedSearch","debounce","score","idx","lunr","field","tagCounts","notesOutput","isRef","virtualReferencesOutput","v","output","toggleTag","ContextPage","renderTarget","ProjectPage","refreshData","bind","EmbeddedNoteEdit","targetEntity","addNode","EmbeddedNoteShow","ShowTaskPage","isDirty","setTaskState","setContext","setProject","setDefer","ShowProjectPage","projectState","setProjectState","ShowContextPage","contextState","setContextState","DataPage","render","lifeKeyStore","Uint8Array","getCurrentKey","fileSystemInstance","dirHandle","perms","permissionStatus","fileHandle","readWrite","queryPermission","h","PeoplePage","localeCompare","EditPersonPage","initialState","setValues","handleChange","persist","useForm","birthday","onSave","ShowPersonPage","StatsPage","noteTotalCount","setNoteTotalCount","taskTotalCount","setTaskTotalCount","peopleTotalCount","setPeopleTotalCount","projectTotalCount","setProjectTotalCount","contextTotalCount","setContextTotalCount","DailyNotePage","oneMonthAgo","filteredContexts","dailyNotes","contextCounts","countBy","routes","routeProps","params","component","Fragment","getResults","getTime","setCurrentKey","serviceWorkerState","setServiceWorkerState","remoteConnected","setRemoteConnected","blobConnectionString","setBlobConnectionString","clearEntities","confirm","dropboxConnected","setDropboxConnected","refreshKeys","newCurrentKey","writeNode","indent","formatContent","showDirectoryPicker","verifyPermission","getDirectoryHandle","vaultHandle","fileName","dir","getFileHandle","createWritable","keepExistingData","writable","metadata","write","close","peopleHandle","requestPermission","check","assign","createBrowserHistory","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.6c18693f.chunk.js","sourcesContent":["declare var self: ServiceWorkerGlobalScope;\n\nconst isLocalhost = Boolean(window.location.hostname === 'localhost' || window.location.hostname === '[::1]' || window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));\n\ntype Config = {\n    onSuccess?: (registration: ServiceWorkerRegistration) => void;\n    onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport async function register(config?: Config) {\n    if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n        \n        // The URL constructor is available in all browsers that support SW.\n        const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n        \n        if (publicUrl.origin !== window.location.origin) {\n            // Our service worker won't work if PUBLIC_URL is on a different origin\n            // from what our page is served on. This might happen if a CDN is used to\n            // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n            return;\n        }\n        \n        window.addEventListener('load', async () => {\n            const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n            \n            if (isLocalhost) {\n                // This is running on localhost. Let's check if a service worker still exists or not.\n                checkValidServiceWorker(swUrl, config);\n                \n                // Add some additional logging to localhost, pointing developers to the\n                // service worker/PWA documentation.\n                await navigator.serviceWorker.ready;\n                console.log('This web app is being served cache-first by a service worker.'\n                );\n            } else {\n                // Is not localhost. Just register service worker\n                await registerValidSW(swUrl, config);\n            }\n        });\n\n        self.addEventListener('message', event => {\n            if (event.data && event.data.type === 'SKIP_WAITING') {\n                self.skipWaiting();\n              }\n        });\n    }\n}\n\nasync function registerValidSW(swUrl: string, config?: Config) {\n    const registration = await navigator.serviceWorker.register(swUrl);\n    \n    registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        \n        if (installingWorker == null) {\n            return;\n        }\n        \n        installingWorker.onstatechange = () => {\n            if (installingWorker.state === 'installed') {\n                if (navigator.serviceWorker.controller) {\n                    // At this point, the updated precached content has been fetched,\n                    // but the previous service worker will still serve the older\n                    // content until all client tabs are closed.\n                    console.log('New content is available and will be used when all tabs for this page are closed.');\n                    \n                    // Execute callback\n                    if (config && config.onUpdate) {\n                        config.onUpdate(registration);\n                    }\n                } else {\n                    // At this point, everything has been precached.\n                    // It's the perfect time to display a\n                    // \"Content is cached for offline use.\" message.\n                    console.log('Content is cached for offline use.');\n                    \n                    // Execute callback\n                    if (config && config.onSuccess) {\n                        config.onSuccess(registration);\n                    }\n                }\n            }\n        };\n    };\n}\n\nasync function checkValidServiceWorker(swUrl: string, config?: Config) {\n    // Check if the service worker can be found. If it can't reload the page.\n    const response = await fetch(swUrl, {\n        headers: { 'Service-Worker': 'script' }\n    });\n    \n    // Ensure service worker exists, and that we really are getting a JS file.\n    const contentType = response.headers.get('content-type');\n    if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        const registration = await navigator.serviceWorker.ready;\n        await registration.unregister()\n        window.location.reload();\n    } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n    }\n}\n\nexport async function unregister() {\n    if ('serviceWorker' in navigator) {\n        const registration = await navigator.serviceWorker.ready;\n        registration.unregister();\n    }\n}\n","import * as React from 'react';\n\nexport class ServiceWorkerInstall extends React.Component<{ }, { installEvent: any }> {\n\n    constructor(props: any) {\n        super(props);\n        this.state = {\n            installEvent: null\n        };\n    }\n\n    componentDidMount() {\n        window.addEventListener('beforeinstallprompt', (e: any) => {\n            // Prevent Chrome 67 and earlier from automatically showing the prompt\n            e.preventDefault();\n            this.setState({ installEvent: e });\n        });\n    }\n\n    onInstallClick() {\n        if (this.state.installEvent === null) {\n            return;\n        }\n        \n        this.state.installEvent.prompt();\n    \n        // Wait for the user to respond to the prompt\n        this.state.installEvent.userChoice.then((choiceResult: any) => {\n            if (choiceResult.outcome === 'accepted') {\n                console.log('User accepted the A2HS prompt');\n            } else {\n                console.log('User dismissed the A2HS prompt');\n            }\n        });\n    }\n\n    render() {\n        if (!this.state.installEvent) {\n            return null;\n        }\n\n        return (\n            <div className=\"button\" onClick={() => this.onInstallClick()}>Install app</div>\n        );\n    }\n}","import {css} from 'emotion';\n\nexport const hoverGlow = 'hover-glow';\n\nexport const cursorPointer = css({\n    cursor: 'pointer'\n});\n\nexport const verticalCenter = css({\n    display: 'flex',\n    alignItems: 'center'\n});\n\nexport function horizontalSpace(width = '.3rem', around = false) {\n    return css({\n        paddingLeft: around ? width : undefined,\n        paddingRight: around ? width : undefined,\n        '&': {\n            '& > *:first-child': {\n                marginLeft: 0\n            },\n            '& > *': {\n                marginRight: width\n            },\n            '& > *:last-child': {\n                marginRight: 0\n            }\n        }\n    });\n}\n\nexport function verticalSpace(height = '.3rem', around = false) {\n    return css({\n        paddingTop: around ? height : undefined,\n        paddingBottom: around ? height : undefined,\n        '&': {\n            '& > *': {\n                marginBottom: height\n            },\n            '& > *:last-child': {\n                marginBottom: 0\n            }\n        }\n    });\n}","export class EventListener<T> {\n    listeners: ((arg: T) => void)[] = [];\n\n    register(listener: (arg: T) => void) {\n        this.listeners.push(listener);\n        return () =>  {\n            this.listeners = this.listeners.filter(x => x !== listener);\n        };\n    }\n\n    trigger(arg: T) {\n        for(const listener of this.listeners) {\n            listener(arg);\n        }\n    }\n}","import {createInstance} from 'localforage';\nimport {Context} from './context';\nimport { Project } from './project';\nimport { Task } from './task';\nimport { Note } from './note';\nimport * as _ from 'lodash';\nimport { Person } from './person';\nimport { EventListener } from './EventListener';\n\ninterface Store<T extends Entity> {\n    getAll(): Promise<T[]>;\n    get(id: string, revision?: string): Promise<T|null>;\n    save(entity: T): void;\n}\n\nexport type EntityType = 'note' | 'task' | 'project' | 'context' | 'person';\n\nexport interface Entity {\n    id: string;\n    versionId: string;\n    parentVersionId1: string|null;\n    parentVersionId2: string|null;\n    type: EntityType;\n    createdAt: string;\n    updatedAt: string;\n    deferredUntil: string|null;\n}\n\n// type EntityProperty = keyof Entity;\n\n// const sampleEntity: Entity = {\n//     id: 'test',\n//     versionId: 'test',\n//     parentVersionId1: null,\n//     parentVersionId2: null,\n//     type: 'task',\n//     createdAt: 'now',\n//     updatedAt: 'now',\n//     deferredUntil: null\n// };\n\n// const entityProperties: EntityProperty[] = Object.keys(sampleEntity) as EntityProperty[];\n\nexport interface ServerEntity {\n    id: string;\n    versionId: string;\n    data: string;\n    // encryption: string;\n    parentVersionId1: string|null;\n    parentVersionId2: string|null;\n    type: EntityType;\n    createdAt: string;\n    updatedAt: string;\n}\n\nexport interface ServerEntityEncryption {\n    key: string;\n    fingerprint: string;\n    iv: string;\n}\n\ntype Omit<T, K extends keyof T> = Pick<T, Exclude<keyof T, K>>\n\nclass LocalForageStore<T extends Entity> implements Store<T> {\n    store: LocalForage;\n    type: EntityType;\n    changeListener: EventListener<T>;\n\n    constructor(type: EntityType) {\n        this.type = type;\n        this.store = createInstance({\n            name: `store-${type}`\n        });\n        this.changeListener = new EventListener<T>();\n    }\n\n    createUnsaved(entityProps: Omit<T, keyof Entity>): T {\n        const now = new Date().toISOString();\n        let entity = {\n            id: this.uuid(),\n            versionId: this.uuid(),\n            type: this.type,\n            parentVersionIds: [] as string[],\n            createdAt: now,\n            updatedAt: now,\n            ...entityProps as any,\n        } as T;\n        return entity;\n    }\n\n    async create(entityProps: Omit<T, keyof Entity>): Promise<T> {\n        const now = new Date().toISOString();\n        let entity = {\n            id: this.uuid(),\n            versionId: this.uuid(),\n            type: this.type,\n            parentVersionIds: [] as string[],\n            createdAt: now,\n            updatedAt: now,\n            ...entityProps as any,\n        } as T;\n        await this.store.setItem(this.getKey(entity), entity);\n        this.changeListener && this.changeListener.trigger(entity);\n        return entity;\n    }\n\n    save(entity: T): void {\n        if (!entity.id) {\n            entity.id = this.uuid();\n        }\n\n        if (entity.type !== this.type) {\n            throw new Error(`Invalid type: ${entity.type} - expected ${this.type}`);\n        }\n\n        const now = new Date().toISOString();\n\n        if (!entity.createdAt) {\n            entity.createdAt = now;\n        }\n\n        entity.updatedAt = now;\n\n        if(entity.versionId) {\n            entity.parentVersionId1 = entity.versionId;\n        }\n\n        entity.versionId = this.uuid();\n        this.store.setItem(this.getKey(entity), entity);\n        this.changeListener && this.changeListener.trigger(entity);\n    }\n\n    import(entity: T, suppressChangeListener = false) {\n        if (entity.type !== this.type) {\n            throw new Error(`Invalid type ${entity.type} - expected ${this.type}`);\n        }\n\n        this.store.setItem(this.getKey(entity), entity);\n        !suppressChangeListener && this.changeListener && this.changeListener.trigger(entity);\n    }\n\n    async get(id: string, versionId?: string): Promise<T|null> {\n        if (versionId === undefined) {\n            const leafNodes = await this.getLeafNodes(`${id}/`);\n\n            if (leafNodes.length > 1) {\n                console.warn(`Found ${leafNodes.length} leaf nodes for entity ${this.type}/${id} - expected 1: ${leafNodes.map(x => x.versionId)}`);\n\n                for(const node of leafNodes) {\n                    console.log('leaf node', node);\n                }\n                \n                // throw `Found ${leafNodes.length} leaf nodes for entity ${this.type}/${id} - expected 1: ${leafNodes.map(x => x.versionId)}`;\n                return _.orderBy(leafNodes, x => x.updatedAt, 'desc')[0];\n            }\n\n            if (leafNodes.length === 0) {\n                return null;\n            }\n\n            return leafNodes[0];\n        } else {\n            const keys = await this.getKeysPrefixed(`${id}/${versionId}`);\n            return await this.store.getItem(keys[0]) as T;\n        }\n    }\n\n    async getAll(): Promise<T[]> {\n        return await this.getLeafNodes();\n    }\n\n    async getKeysPrefixed(prefix: string) {\n        const keys = await this.store.keys();\n        return keys.filter(k => k.startsWith(prefix));\n    }\n\n    async getSyncKeys(): Promise<string[]> {\n        const keys = await this.store.keys();\n        return keys.map(x => `${this.type}/${x.split('/')[0]}/${x.split('/')[1]}`)\n    }\n\n    private async getLeafNodes(prefix = '') {\n        const keys = await this.getKeysPrefixed(prefix);\n\n        const objs = keys.map(k => {\n            const parts = k.split('/');\n\n            let parentVersionId1 = null;\n            let parentVersionId2 = null;\n\n            if (parts[2].length > 0) {\n                const parentVersionIds = parts[2].split('+');\n\n                if (parentVersionIds.length > 2) {\n                    throw new Error(\"ParentVersionIds length > 2\");\n                }\n\n                parentVersionId1 = parentVersionIds[0];\n                parentVersionId2 = parentVersionIds.length > 1 ? parentVersionIds[1] : null;\n            }\n\n            return {\n                id: parts[0],\n                versionId: parts[1],\n                parentVersionId1: parentVersionId1,\n                parentVersionId2: parentVersionId2,\n            }\n        });\n\n        const groups = _.groupBy(objs, o => o.id);\n\n        const leafNodeArrays = Object.keys(groups).map(k => {\n            const group = groups[k];\n            const parents: { [key: string]: boolean } = {};\n\n            for(const o of group) {\n                if (o.parentVersionId1) {\n                    parents[o.parentVersionId1] = true;\n                }\n                if (o.parentVersionId2) {\n                    parents[o.parentVersionId2] = true;\n                }\n            }\n\n            const leafNodes = group.filter(o => {\n                const isLeaf = !parents[o.versionId];\n                return isLeaf;\n            });\n\n            return leafNodes;\n        });\n\n        const result: T[] = [];\n\n        for(let leafNodes of leafNodeArrays) {\n            const leafObjs: T[] = [];\n            for(let node of leafNodes) {\n                leafObjs.push(await (this.store.getItem(this.getKey(node))) as T);\n            }\n\n            if(leafObjs.length !== 1) {\n                console.warn(`Found ${leafObjs.length} leaf nodes for entity ${this.type}/${leafNodes[0].id} - expected 1: ${leafObjs.map(x => x.versionId)}`);\n    \n                for(const node of leafObjs) {\n                    console.log('leaf node', node);\n                }\n    \n                result.push(_.orderBy(leafObjs, x => x.updatedAt, 'desc')[0])\n            } else {\n                result.push(leafObjs[0]);\n            }\n        }\n\n        return result;\n    }\n\n    registerChangeListener(listener: (status: T) => void) {\n        this.changeListener.register(listener)\n    }\n\n    dropInstance() {\n        this.store.dropInstance();\n    }\n\n    private getKey(entity: { id: string, versionId: string, parentVersionId1: string|null, parentVersionId2: string|null }) {\n        let parentVersionIds = [];\n\n        if (entity.parentVersionId1) {\n            parentVersionIds.push(entity.parentVersionId1);\n        }\n\n        if (entity.parentVersionId2) {\n            parentVersionIds.push(entity.parentVersionId2);\n        }\n\n\n        return `${entity.id}/${entity.versionId}/${parentVersionIds.join('+')}`;\n    }\n\n    private uuid() {\n        return 'xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            const r = Math.random() * 16 | 0, v = c === 'x' ? r : ((r & 0x3) | 0x8);\n            return v.toString(16);\n        });\n    }\n}\n\nconst contexts = new LocalForageStore<Context>(\"context\");\nconst tasks = new LocalForageStore<Task>(\"task\");\nconst notes = new LocalForageStore<Note>(\"note\");\nconst projects = new LocalForageStore<Project>(\"project\");\nconst people = new LocalForageStore<Person>(\"person\");\n\nasync function getSyncKeys() {\n    const keys: string[] = [\n        ...(await contexts.getSyncKeys()),\n        ...(await tasks.getSyncKeys()),\n        ...(await notes.getSyncKeys()),\n        ...(await projects.getSyncKeys()),\n        ...(await people.getSyncKeys()),\n    ];\n\n    return keys;\n}\n\nasync function getBySyncKey(syncKey: string): Promise<Entity|null> {\n    const [type, id, versionId] = syncKey.split('/');\n\n    switch(type) {\n        case 'context':\n            return contexts.get(id, versionId);\n        case 'task':\n            return tasks.get(id, versionId);\n        case 'note':\n            return notes.get(id, versionId);\n        case 'project':\n            return projects.get(id, versionId);\n        case 'person':\n            return people.get(id, versionId);\n        default:\n            throw new Error('Unknown type: ' + type);\n    }\n}\n\nasync function importEntites(entities: Entity[]) {\n    for(const entity of entities) {\n        switch(entity.type) {\n            case 'context':\n                contexts.import(entity as Context);\n                break;\n            case 'task':\n                tasks.import(entity as Task);\n                break;\n            case 'note':\n                notes.import(entity as Note);\n                break;\n            case 'project':\n                projects.import(entity as Project);\n                break;\n            case 'person':\n                people.import(entity as Person);\n                break;\n            default:\n                throw new Error('Unknown type: ' + entity.type);\n        }\n    }\n}\n\nasync function importServerEntites(serverEntities: ServerEntity[]) {\n    for(const serverEntity of serverEntities) {\n        // const encryption = JSON.parse(serverEntity.encryption) as ServerEntityEncryption;\n        // const unencryptedData = await unwrapAndDecrypt(encryption.fingerprint, encryption.key, serverEntity.data, encryption.iv);\n        const unencryptedData = serverEntity.data;\n        let entity = JSON.parse(unencryptedData) as Entity;\n\n        entity.id = serverEntity.id;\n        entity.versionId = serverEntity.versionId;\n        entity.type = serverEntity.type;\n        entity.parentVersionId1 = serverEntity.parentVersionId1;\n        entity.parentVersionId2 = serverEntity.parentVersionId2;\n        entity.createdAt = serverEntity.createdAt;\n        entity.updatedAt = serverEntity.updatedAt;\n\n        switch(serverEntity.type) {\n            case 'context':\n                contexts.import(entity as Context, true);\n                break;\n            case 'task':\n                tasks.import(entity as Task, true);\n                break;\n            case 'note':\n                notes.import(entity as Note, true);\n                break;\n            case 'project':\n                projects.import(entity as Project, true);\n                break;\n            case 'person':\n                people.import(entity as Person, true);\n                break;\n            default:\n                throw new Error('Unknown type: ' + entity.type);\n        }\n    }\n}\n\nasync function exportServerEntities(syncKeys: string[]): Promise<ServerEntity[]> {\n    const result: ServerEntity[] = [];\n\n    for (const syncKey of syncKeys) {\n        const entity = await getBySyncKey(syncKey);\n\n        if (entity === null) {\n            console.warn(\"Entity with key not found: \" + syncKey)\n            continue;\n        }\n\n        const entityData = {...entity};\n\n        delete entityData.createdAt;\n        delete entityData.updatedAt;\n        delete entityData.id;\n        delete entityData.versionId;\n        delete entityData.type;\n        delete entityData.parentVersionId1;\n        delete entityData.parentVersionId2;\n\n        const unencryptedData = JSON.stringify(entityData);\n        // const encryptionResult = await encryptAndWrap((await getCurrentKey()).fingerprint, unencryptedData);\n        // const encryption: ServerEntityEncryption = { \n        //     fingerprint: encryptionResult.fingerprint, \n        //     key: encryptionResult.key,\n        //     iv: encryptionResult.iv\n        // };\n        // const encryptionJson = JSON.stringify(encryption);\n\n        const serverEntity: ServerEntity = {\n            id: entity.id,\n            versionId: entity.versionId,\n            type: entity.type,\n            parentVersionId1: entity.parentVersionId1,\n            parentVersionId2: entity.parentVersionId2,\n            createdAt: entity.createdAt,\n            updatedAt: entity.updatedAt,\n            data: unencryptedData,\n            // encryption: encryptionJson\n        };\n\n        result.push(serverEntity);\n    }\n\n    return result;\n}\n\nexport const db = {\n    contexts,\n    tasks,\n    notes,\n    projects,\n    people,\n    getSyncKeys,\n    importEntites,\n    importServerEntites,\n    exportServerEntities\n};","import * as React from 'react';\n\nexport const Loader: React.FC = (props) => {\n    return (\n        <div style={{display: 'flex', height: '100%', justifyContent: 'center', alignItems: 'center'}}>\n            <div style={{border: '1px solid #555', padding: '1rem 2rem', background: '#2e2e2e'}}>Loading...</div>\n        </div>\n    );\n}","import { Note } from \"./db/note\";\nimport { Task } from \"./db/task\";\nimport { Context } from \"./db/context\";\nimport { Project } from \"./db/project\";\nimport { Person } from \"./db/person\";\nimport React, { useContext, useEffect } from \"react\";\nimport { syncer } from \"./db/syncer\";\nimport { Loader } from \"./components/Loader\";\n\nexport class Data {\n    constructor(notes: Note[], tasks: Task[], contexts: Context[], projects: Project[], people: Person[]) {\n        this.notes = notes;\n        this.tasks = tasks;\n        this.contexts = contexts;\n        this.projects = projects;\n        this.people = people;\n    }\n\n    notes: Note[];\n    readonly tasks: Task[];\n    readonly contexts: Context[];\n    readonly projects: Project[];\n    readonly people: Person[];\n};\n\ninterface DataContextState {\n    data: Data;\n}\n\nconst DataContext = React.createContext<DataContextState>({\n    data: null as any,\n});\n\nexport const DataProvider: React.FC = props => {\n    const [data, setData] = React.useState<Data>(null as any);\n\n    useEffect(() => {\n        async function init() {\n            syncer.registerDataListener(async data => setData(data));\n            setData(await syncer.getData());\n            await syncer.startServerSync();\n            await syncer.ensureServerSyncEnqueued();\n        };\n        init();\n    }, []);\n\n    const value: DataContextState = {\n        data,\n    };\n\n    if (!data) {\n        return <Loader />;\n    }\n\n    return (\n      <DataContext.Provider value={value}>\n        {props.children}\n      </DataContext.Provider>\n    );\n};\n\nexport const useData = () => {\n    const value = useContext(DataContext);\n    return value;\n};","import { Dropbox } from 'dropbox';\nimport {createInstance} from 'localforage';\nimport 'whatwg-fetch';\n\nconst store = createInstance({name: 'store-dropbox'})\n\nconst localClientId = 'jh9cnt92wi5e5my';\nconst prodClientId = 'li12ai4q2cs3dkc';\n\nexport const isLocalMode = window.location.host !== 'life.rasmuskl.dk';\n\nconst clientId = isLocalMode ? localClientId : prodClientId;\n\ntryStoreAccessKey();\n\nconst localFetch = window.fetch;\n\nexport function signIn() {\n    window.location.assign(`https://www.dropbox.com/oauth2/authorize?client_id=${clientId}&response_type=token&redirect_uri=${window.location.toString()}`);\n}\n\nexport async function isSignedIn() {\n    return !!(await store.getItem('token'));\n}\n\ninterface DropboxSnapshot {\n    cursor: string|null;\n    files: Set<string>;\n}\n\nasync function getStateSnapshot() {\n    const snapshot = await store.getItem('snapshot') as DropboxSnapshot|null;\n    return snapshot || { cursor: null, files: new Set<string>() };\n}\n\nasync function setStateSnapshot(snapshot: DropboxSnapshot|null) {\n    if (!snapshot) {\n        await store.removeItem('snapshot');\n    } else {\n        await store.setItem('snapshot', snapshot);\n    }\n}\nexport async function disconnect() {\n    await store.removeItem('token');\n}\n\nexport async function refreshDropbox() {\n    await setStateSnapshot(null);\n}\n\nexport async function listFiles(useSnapshot = true) {\n    if(!await isSignedIn()) {\n        throw new Error('Not authenticated');\n    }\n\n    const dropbox = new Dropbox({ accessToken: await getAccessToken(), fetch: localFetch });\n    let snapshot: DropboxSnapshot = { cursor: null, files: new Set<string>() };\n\n    if (useSnapshot) {\n        snapshot = await getStateSnapshot();\n    }\n\n    let hasMore = true;\n\n    while(hasMore) {\n        if (snapshot.cursor) {\n            const fileListResult = await dropbox.filesListFolderContinue({ cursor: snapshot.cursor });\n            const results = fileListResult.entries.filter(e => e['.tag'] === 'file').map(e => e.path_lower?.substring(1)).filter(p => p) as string[];\n            snapshot.cursor = fileListResult.cursor;\n            for(const file of results) {\n                snapshot.files.add(file);\n            }\n            hasMore = fileListResult.has_more;\n        } else {\n            const fileListResult = await dropbox.filesListFolder({path: '', recursive: true});\n            const results = fileListResult.entries.filter(e => e['.tag'] === 'file').map(e => e.path_lower?.substring(1)).filter(p => p) as string[];\n            snapshot.cursor = fileListResult.cursor;    \n            for(const file of results) {\n                snapshot.files.add(file);\n            }\n            hasMore = fileListResult.has_more;\n        }\n\n        await setStateSnapshot(snapshot);\n    }\n\n    return snapshot.files;\n}\n\nexport function getAccessTokenFromUrl() {\n    const results = parseAuthFromHash(window.location.hash);\n    return results.access_token;\n}\n\nexport async function tryStoreAccessKey() {\n    const accessToken = getAccessTokenFromUrl();\n\n    if (accessToken) {\n        await store.setItem('token', accessToken);\n    }\n}\n\nexport async function uploadFile(path: string, contents: string) {\n    if(!await isSignedIn()) {\n        throw new Error('Not authenticated');\n    }\n\n    const dropbox = new Dropbox({ accessToken: await getAccessToken(), fetch: localFetch });\n    await dropbox.filesUpload({\n        path: `/${path}`,\n        contents\n    });\n}\n\nexport async function getFile<T>(path: string) {\n    if(!await isSignedIn()) {\n        throw new Error('Not authenticated');\n    }\n\n    const dropbox = new Dropbox({ accessToken: await getAccessToken(), fetch: localFetch });\n    const response = await dropbox.filesDownload({path: `/${path}` })\n    return new Promise<T>((resolve) => {\n        const blob: Blob = (response as any).fileBlob;\n        const reader = new FileReader();\n        reader.addEventListener(\"loadend\", function() {\n            const json = reader.result as string;\n            resolve(JSON.parse(json) as T);\n        });\n        reader.readAsText(blob);\n    });\n}\n\n\nasync function getAccessToken() {\n    return await store.getItem('token') as string;\n}\n\nfunction parseAuthFromHash(str: string) {\n    const ret: { [k: string]: string[] | string } = {};\n\n    if (typeof str !== 'string') {\n        return ret;\n    }\n\n    str = str.trim().replace(/^(\\?|#|&)/, '');\n\n    if (!str) {\n        return ret;\n    }\n\n    str.split('&').forEach(function (param) {\n        const parts = param.replace(/\\+/g, ' ').split('=');\n        let key = parts.shift();\n        let val = parts.length > 0 ? parts.join('=') : null;\n\n        key = decodeURIComponent(key!);\n        val = val ? decodeURIComponent(val) : null;\n\n        var retVal = ret[key];\n        if (ret[key] === undefined) {\n            ret[key] = val!;\n        } else if (Array.isArray(retVal)) {\n            retVal.push(val!);\n        } else {\n            ret[key] = [ret[key] as string, val!];\n        }\n    });\n\n    return ret;\n}","import React from \"react\";\nimport { Context } from \"../db/context\";\nimport { Note } from \"../db/note\";\n\nfunction getBridge() {\n    const desktop: HostBridge = (window as any).chrome?.webview?.hostObjects?.dotnet;\n    const android: HostBridge = (window as any).AndroidBridge;\n    return desktop || android || null;\n}\n\nfunction hasBridge() {\n    return !!getBridge();\n}\n\ninterface HostBridge {\n    getNote(id: string): Promise<string>;\n    getContext(id: string): Promise<string>;\n    getEntity(key: string): Promise<string>;\n    sendEntity(key: string, contents: string): Promise<void>;\n    getSyncKeys(): Promise<string>;\n    getNotes(): Promise<string>\n    syncRemote(): Promise<void>\n    syncRemoteConnected(): Promise<boolean>\n    disconnectBlobStorage(): Promise<void>\n    connectBlobStorage(connectionString: String): Promise<void>\n}\n\nfunction getEntity(key: string) {\n    return getBridge().getEntity(key);\n}\n\nfunction sendEntity(key: string, contents: string) {\n    return getBridge().sendEntity(key, contents);\n}\n\nasync function getSyncKeys() {\n    return JSON.parse(await getBridge().getSyncKeys()) as string[];\n}\n\nasync function getNotes() {\n    return JSON.parse(await getBridge().getNotes()) as Note[];\n}\n\nasync function getNote(id: string) {\n    return JSON.parse(await getBridge().getNote(id)) as Note;\n}\n\nasync function getContext(id: string) {\n    return JSON.parse(await getBridge().getContext(id)) as Context;\n}\n\nasync function syncRemote() {\n    await getBridge().syncRemote();\n}\n\nasync function syncRemoteConnected() {\n    return await getBridge().syncRemoteConnected();\n}\n\nasync function disconnectBlobStorage() {\n    await getBridge().disconnectBlobStorage();\n}\n\nasync function connectBlobStorage(connectionString: string) {\n    await getBridge().connectBlobStorage(connectionString);\n}\n\nexport const useNotes = () => {\n    const [data, setData] = React.useState<Note[]|null>(null);\n  \n    async function fetchData() {\n        console.time('getNotes');\n        const response = await Api.getNotes();\n        console.timeEnd('getNotes');\n        setData(response);\n    }\n  \n    React.useEffect(() => {fetchData()}, []);\n    return data;\n};\n\nexport const useNote = (id: string|null) => {\n    const [data, setData] = React.useState<Note|null>(null);\n  \n    async function fetchData(id: string|null) {\n        if(!id) {\n            return;\n        }\n\n        console.time('getNote');\n        const response = await Api.getNote(id);\n        console.timeEnd('getNote');\n        setData(response);\n    }\n  \n    React.useEffect(() => {fetchData(id)}, [id]);\n    return data;\n};\n\nexport const useContext = (id: string|null) => {\n    const [data, setData] = React.useState<Context|null>(null);\n  \n    async function fetchData(id: string|null) {\n        if(!id) {\n            return;\n        }\n\n        const response = await Api.getContext(id);\n        setData(response);\n    }\n  \n    React.useEffect(() => {fetchData(id)}, [id]);\n    return data;\n};\n\nexport const Api = {\n    hasBridge,\n    getEntity,\n    sendEntity,\n    getSyncKeys,\n    getNotes,\n    getNote,\n    getContext,\n    syncRemote,\n    syncRemoteConnected,\n    connectBlobStorage,\n    disconnectBlobStorage,\n};\n\n","import { db, ServerEntity } from \"./db\";\nimport * as _ from \"lodash\";\nimport { Data } from \"../model\";\nimport {EventListener} from './EventListener';\nimport * as dropboxApi from '../lib/dropboxApi';\nimport pLimit from 'p-limit';\nimport { Api } from \"../bridge/HostBridge\";\n\nexport enum SyncStatus {\n    Idle,\n    Syncing,\n    Failed,\n};\n\nexport interface SyncResult {\n    startAt: Date;\n    endAt: Date;\n    type: 'desktop'|'dropbox';\n    fetch: number;\n    send: number;\n    error: Error|null;\n}\n\nclass Syncer {\n    status = SyncStatus.Idle;\n    results: SyncResult[] = [];\n    data: Data|null = null;\n    intervalHandle: number|null = null;\n\n    syncListener = new EventListener<SyncStatus>();\n    dataListener = new EventListener<Data>();\n\n    constructor() {\n        db.notes.changeListener.register(note => {\n            if(!this.data) {\n                return;\n            }\n\n            const notes = _.orderBy(this.data.notes.filter(x => x.id !== note.id).concat(note), x => x.updatedAt);\n            this.data = new Data(notes, this.data.tasks, this.data.contexts, this.data.projects, this.data.people);\n            this.dataListener.trigger(this.data);\n            this.startServerSync();\n        });\n\n        db.tasks.changeListener.register(task => {\n            if(!this.data) {\n                return;\n            }\n\n            const tasks = this.data.tasks.filter(x => x.id !== task.id).concat(task);\n            this.data = new Data(this.data.notes, tasks, this.data.contexts, this.data.projects, this.data.people);\n            this.dataListener.trigger(this.data);\n            this.startServerSync();\n        });\n\n        db.contexts.changeListener.register(context => {\n            if(!this.data) {\n                return;\n            }\n\n            const contexts = this.data.contexts.filter(x => x.id !== context.id).concat(context);\n            this.data = new Data(this.data.notes, this.data.tasks, contexts, this.data.projects, this.data.people);\n            this.dataListener.trigger(this.data);\n            this.startServerSync();\n        });\n\n        db.projects.changeListener.register(project => {\n            if(!this.data) {\n                return;\n            }\n\n            const projects = this.data.projects.filter(x => x.id !== project.id).concat(project);\n            this.data = new Data(this.data.notes, this.data.tasks, this.data.contexts, projects, this.data.people);\n            this.dataListener.trigger(this.data);\n            this.startServerSync();\n        });\n\n        db.people.changeListener.register(person => {\n            if(!this.data) {\n                return;\n            }\n\n            const people = this.data.people.filter(x => x.id !== person.id).concat(person);\n            this.data = new Data(this.data.notes, this.data.tasks, this.data.contexts, this.data.projects, people);\n            this.dataListener.trigger(this.data);\n            this.startServerSync();\n        });\n    }\n\n    registerSyncListener(listener: (status: SyncStatus) => void) {\n        this.syncListener.register(listener)\n    }\n\n    registerDataListener(listener: (status: Data) => void) {\n        this.dataListener.register(listener)\n    }\n\n    getResults() {\n        return this.results;\n    }\n\n    async getData() {\n        if (!this.data) {\n            this.data = await this.loadData();\n        }\n\n        return this.data;\n    }\n\n    async ensureServerSyncEnqueued() {\n        if (this.intervalHandle !== null) {\n            return;\n        }\n\n        this.intervalHandle = setInterval(async () => {\n            await this.startServerSync();\n        }, 60000) as any;\n    }\n\n    async startServerSync() {\n        // console.trace('sync');\n\n        if (this.status === SyncStatus.Syncing) {\n            return;\n        }\n\n        if(await dropboxApi.isSignedIn()) {\n            await this.runDropboxSync();\n        }\n\n        await this.runBridgeSync();\n    }\n    \n    async runBridgeSync() {\n        if(!Api.hasBridge()) {\n            return;\n        }\n\n        const startAt = new Date();\n\n        function difference<T>(setA: Set<T>, setB: Set<T>): Set<T> {\n            let _difference = new Set(setA);\n            for (const key of setB) {\n                _difference.delete(key);\n            }\n            return _difference;\n        }\n\n        try {\n            await Api.syncRemote();\n\n            const serverKeys = await Api.getSyncKeys();\n            const syncKeys = new Set(await db.getSyncKeys());\n            \n            const toSend = difference(syncKeys, new Set(serverKeys));\n            const toFetch = difference(new Set(serverKeys), syncKeys);\n\n            if (toSend.size || toFetch.size) {\n                this.status = SyncStatus.Syncing;\n                this.syncListener.trigger(this.status);\n            }\n    \n            for(const key of toSend) {\n                const entities = await db.exportServerEntities([key]);\n                await Api.sendEntity(key, JSON.stringify(entities[0]));\n            }\n    \n            for(const key of toFetch) {\n                const contents = await Api.getEntity(key);\n                const entity: ServerEntity = JSON.parse(contents);\n                await db.importServerEntites([entity]);\n            }\n\n            if(toFetch.size > 0) {\n                const data = await this.loadData();\n                this.dataListener.trigger(data);\n            }\n\n            if (toSend.size > 0) {\n                await Api.syncRemote();\n            }\n\n            this.results.push({ type: 'desktop', startAt, endAt: new Date(), error: null, fetch: toFetch.size, send: toSend.size })\n            this.status = SyncStatus.Idle;\n            this.syncListener.trigger(this.status);            \n        } catch (e) {\n            this.status = SyncStatus.Failed;\n            this.results.push({ type: 'desktop', startAt, endAt: new Date(), error: e && e.message ? e.message : e, fetch: 0, send: 0 });\n            this.syncListener.trigger(this.status);\n        }\n    }\n\n    async runDropboxSync() {\n        const startAt = new Date();\n    \n        function difference<T>(setA: Set<T>, setB: Set<T>): Set<T> {\n            let _difference = new Set(setA);\n            for (const key of setB) {\n                _difference.delete(key);\n            }\n            return _difference;\n        }\n    \n        try {\n            const files = await dropboxApi.listFiles();\n            const syncKeys = new Set(await db.getSyncKeys());\n    \n            const toSend = difference(syncKeys, files);\n            const toFetch = difference(files, syncKeys);\n\n            if (toSend.size || toFetch.size) {\n                this.status = SyncStatus.Syncing;\n                this.syncListener.trigger(this.status);\n            }            \n    \n            for(const key of toSend) {\n                const entities = await db.exportServerEntities([key]);\n                await dropboxApi.uploadFile(key, JSON.stringify(entities[0]));\n            }\n    \n            const limit = pLimit(10);\n            const promises = [];\n    \n            for(const key of toFetch) {\n                promises.push(limit(async () => {\n                    const entity = await dropboxApi.getFile<ServerEntity>(key);\n                    await db.importServerEntites([entity]);\n                }));\n            }\n    \n            await Promise.all(promises);\n    \n            if(toFetch.size > 0) {\n                const data = await this.loadData();\n                this.dataListener.trigger(data);\n            }\n    \n            this.results.push({ type: 'dropbox', startAt, endAt: new Date(), error: null, fetch: toFetch.size, send: toSend.size })\n            this.status = SyncStatus.Idle;\n            this.syncListener.trigger(this.status);\n        } catch (e) {\n            this.status = SyncStatus.Failed;\n            this.results.push({ type: 'dropbox', startAt, endAt: new Date(), error: e && e.message ? e.message : e, fetch: 0, send: 0 });\n            this.syncListener.trigger(this.status);\n        }\n    }\n\n    private async loadData(): Promise<Data> {\n        const contexts = db.contexts.getAll();\n        const tasks = await db.tasks.getAll();\n        const projects = db.projects.getAll();\n        const people = db.people.getAll();\n        const notes = _.orderBy(await db.notes.getAll(), x => x.updatedAt);\n        \n        return new Data(notes, await tasks, await contexts, await projects, await people);\n    }\n}\n\nexport const syncer = new Syncer();\n\n\n\n","import * as React from 'react';\n\nexport function ServiceWorkerUpdate() {\n    const [waitingServiceWorker, setWaitingServiceWorker] = React.useState<ServiceWorker|null>(null);\n\n    React.useEffect(() => {\n        if (!navigator.serviceWorker) {\n            return;\n        }\n\n        async function componentDidMount() {\n            const registration = await navigator.serviceWorker.ready;\n            setWaitingServiceWorker(registration.waiting);\n            registration.addEventListener('updatefound', () => {\n                registration.installing?.addEventListener('statechange', (event: any) => {\n                    if (event.target.state === 'installed') {\n                        setWaitingServiceWorker(event.target);\n                    }\n                })\n            });\n            registration.update();\n        }\n        \n        componentDidMount();\n\n        setInterval(async () => {\n            const registration = await navigator.serviceWorker.ready;\n            registration.update();\n        }, 60 * 60 * 1000)\n    }, [])\n\n    if (!waitingServiceWorker) {\n        return null;\n    }\n\n    const updateServiceWorker = () => {\n        if (!navigator.serviceWorker) {\n            return;\n        }\n\n        waitingServiceWorker.addEventListener('statechange', (event: any) => {\n            if (event.target.state === 'activated') {\n                window.location.reload()\n              }\n        })\n        waitingServiceWorker.postMessage({ type: 'SKIP_WAITING' })\n    };\n\n    return (\n        <div className=\"button\" onClick={updateServiceWorker}>Update</div>\n    );\n}","import {createInstance} from 'localforage';\nimport { EventListener } from '../db/EventListener';\n\nconst themeStore = createInstance({ name: 'theme' });\nconst themeListener = new EventListener<string>();\n\nconst defaultTheme = 'dark-theme';\nlet currentTheme = defaultTheme;\n\nasync function init() {\n    currentTheme = await themeStore.getItem<string>('theme');\n    currentTheme = currentTheme || defaultTheme;\n    themeListener.trigger(currentTheme);\n}\n\ninit();\n\nexport async function setTheme(theme: string) {\n    currentTheme = theme;\n    await themeStore.setItem('theme', currentTheme);\n    themeListener.trigger(currentTheme);\n}\n\nexport function registerThemeListener(listener: (theme: string) => void) {\n    themeListener.register(listener)\n}\n\nexport function getVariable(variable: string) {\n    return getComputedStyle(document.documentElement).getPropertyValue(variable);\n}\n\nexport function isDark() {\n    return currentTheme === defaultTheme;\n}\n\n","import * as React from 'react';\nimport './Layout.scss';\nimport { NavLink } from 'react-router-dom';\nimport { ServiceWorkerInstall } from './ServiceWorkerInstall';\nimport * as styles from '../layout/styles';\nimport { syncer, SyncStatus } from '../db/syncer';\nimport { cx } from 'emotion';\nimport { ServiceWorkerUpdate } from './ServiceWorkerUpdate';\nimport { registerThemeListener } from '../layout/theme';\n\nexport function isMobile() {\n    return window.matchMedia(\"(max-width: 768px)\").matches;\n}\n\nexport const Layout: React.FC<{}> = (props) => {\n    const [sidebar, setSidebar] = React.useState(() => !isMobile())\n    const [count, setCount] = React.useState(0);\n    const [theme, setTheme] = React.useState<string|null>(null);\n\n    React.useEffect(() => {\n        syncer.registerSyncListener(() => setCount(c => c +  1));\n    }, []);\n\n    React.useEffect(() => {\n        registerThemeListener(x => {\n            document.documentElement.className = x;\n            setTheme(x)\n        });\n    }, []);\n\n    function onNavClick() {\n        if(isMobile()) {\n            setSidebar(false);\n        }\n    }\n\n    if (theme == null)\n    {\n        return <></>;\n    }\n\n    return <>\n        <section style={{display: 'flex', overflow: 'hidden', height: '100%'}} className={theme}>\n            <React.Fragment key={count} />\n            <div className={cx('navbar')}>\n                <div className={cx(styles.horizontalSpace('1rem'))}>\n                    {!sidebar && (\n                        <>\n                            <NavLink className={cx('button', 'hover-glow')} to={ '/' } onClick={onNavClick} exact activeClassName='is-active'>Notes</NavLink>\n                            <NavLink className={cx('button', 'hover-glow')} to={ '/tasks' } onClick={onNavClick} exact activeClassName='is-active'>Tasks</NavLink>\n                        </>\n                    )}\n                </div>\n                <div className={cx(styles.horizontalSpace('1rem'))}>\n                    {syncer.status !== SyncStatus.Idle && <NavLink className=\"button\" to=\"/sync\">Sync: {SyncStatus[syncer.status]}</NavLink>}\n                    <ServiceWorkerUpdate />\n                    <ServiceWorkerInstall />\n                    <button className=\"button\" onClick={() => setSidebar(!sidebar)}>\n                        Menu\n                    </button>\n                </div>\n            </div>\n\n            <div className={cx('sidebar', 'list')} style={{overflowY: 'auto', paddingTop: 52, height: '100%', width: sidebar ? undefined : 0, overflowX: 'hidden'}}>\n                <NavLink className={cx('item', 'hover-glow')} to={ '/' } onClick={onNavClick} exact activeClassName='is-active'>Notes</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/notes/daily' } onClick={onNavClick} exact activeClassName='is-active'>Daily Notes</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/tasks' } onClick={onNavClick} exact activeClassName='is-active'>Tasks</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/projects' } onClick={onNavClick} exact activeClassName='is-active'>Projects</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/contexts' } onClick={onNavClick} exact activeClassName='is-active'>Contexts</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/people' } onClick={onNavClick} exact activeClassName='is-active'>People</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/playground' } onClick={onNavClick} exact activeClassName='is-active'>Playground</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/stats' } onClick={onNavClick} exact activeClassName='is-active'>Stats</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/settings' } onClick={onNavClick} exact activeClassName='is-active'>Settings</NavLink>\n                <NavLink className={cx('item', styles.hoverGlow)} to={ '/sync' } onClick={onNavClick} exact activeClassName='is-active'>Sync Status</NavLink>\n            </div>\n\n            <div className=\"main\" style={{paddingTop: 52}}>\n                { props.children }\n            </div>\n        </section>\n    </>;\n}\n","import { Entity } from \"./db\";\n\nexport enum ProjectState {\n    Active = 'Active',\n    Incubated = 'Incubated',\n    Completed = 'Completed',\n    Dropped = 'Dropped',\n}\n\nexport interface Project extends Entity {\n    type: 'project',\n    title: string;\n    contextId: string|null;\n    state: ProjectState;\n}","import * as React from 'react';\nimport * as styles from '../layout/styles';\nimport { cx } from 'emotion';\n\nexport const ToolSection: React.SFC<{ verticalAround?: boolean }> = (props) => {\n    let verticalAround = props.verticalAround;\n\n    if (verticalAround === undefined) {\n        verticalAround = true;\n    }\n\n    return (\n        <div className={cx(styles.horizontalSpace('8px', true), styles.verticalSpace('8px', verticalAround))}>{props.children}</div>\n    );\n}","import { Data } from \"../model\";\nimport * as _ from 'lodash';\nimport { Context } from \"../db/context\";\n\nexport interface NestedContexts {\n    topContexts: Context[];\n    nestedContexts: {[id: string]: Context[]};\n    taskCounts: {[id: string]: number};\n}\n\nexport function getNestedContexts(data: Data): NestedContexts {\n    const grouped = _.groupBy(data.contexts, x => x.contextId);\n    const taskCounts = _.countBy(data.tasks.filter(x => x.state === 'active'), x => x.contextId);\n\n    return {\n        topContexts: data.contexts.filter(x => !x.contextId),\n        nestedContexts: grouped,\n        taskCounts\n    };\n}\n\nexport function getFilteredContextIds(contextId: string|null, data: Data) {\n    const contexts = getNestedContexts(data);\n\n    if (contextId) {\n        const contextIds = [contextId];\n        const queue = [contextId];\n\n        while (queue.length) {\n            const next = queue.pop();\n\n            if (!next) {\n                break;\n            }\n\n            for(const nested of contexts.nestedContexts[next] || []) {\n                contextIds.push(nested.id);\n                queue.push(nested.id);\n            }\n        }\n\n        return contextIds;\n    } else {\n        return data.contexts.map(c => c.id);\n    }\n};","import { Entity } from \"./db\";\n\nexport enum ContextState {\n    Active = 'Active',\n    Inactive = 'Inactive',\n}\n\nexport interface Context extends Entity {\n    type: 'context';\n    title: string;\n    contextId: string|null;\n    state: ContextState;\n}","import * as React from \"react\";\n\nexport const useQueryState = (initialValue: string|null, queryParam: string): [string|null, (value: string|null) => void] => {\n    const [rawValue, setRawValue] = React.useState(() => {\n        const urlParams = new URLSearchParams(window.location.search);\n        return urlParams.get(queryParam) || initialValue;\n    });\n\n    const setValue = (value: string|null) => {\n        const urlParams = new URLSearchParams(window.location.search);\n        setRawValue(value);\n        if (!value || value === initialValue) {\n            urlParams.delete(queryParam);\n        } else {\n            urlParams.set(queryParam, value);\n        }\n\n        const queryString = urlParams.toString();\n\n        if (queryString.length) {\n            window.history.replaceState(null, '', `?${queryString}`);\n        } else {\n            window.history.replaceState(null, '', window.location.pathname);\n        }\n\n        window.dispatchEvent(new (window as any).CustomEvent('popstate'));\n    };\n\n    return [rawValue, setValue];\n};\n\nexport const useQueryStateT = <T extends {}>(initialValue: T, queryParam: string, convertTo: (value: string|null) => T, convertFrom: (value: T) => string|null): [T, (value: T) => void] => {\n    const [rawValue, setRawValue] = React.useState<T>(() => {\n        const urlParams = new URLSearchParams(window.location.search);\n        return convertTo(urlParams.get(queryParam)) || initialValue;\n    });\n\n    const setValue = (value: T) => {\n        const urlParams = new URLSearchParams(window.location.search);\n        setRawValue(value);\n        if (!value || value === initialValue) {\n            urlParams.delete(queryParam);\n        } else {\n            const strValue = convertFrom(value);\n            if (strValue) {\n                urlParams.set(queryParam, strValue);\n            } else {\n                urlParams.delete(queryParam);\n            }\n        }\n\n        const queryString = urlParams.toString();\n\n        if (queryString.length) {\n            window.history.replaceState(null, '', `?${queryString}`);\n        } else {\n            window.history.replaceState(null, '', window.location.pathname);\n        }\n\n        window.dispatchEvent(new (window as any).CustomEvent('popstate'));\n    };\n\n    return [rawValue, setValue];\n};\n\nexport const useQueryStateBoolean = (initialValue: boolean, queryParam: string) => {\n    return useQueryStateT<boolean>(initialValue, queryParam, x => x === 'true', x => x === initialValue ? null : x.toString());\n};","import * as React from 'react';\nimport { isMobile } from './Layout';\nimport * as styles from '../layout/styles';\nimport { cx } from 'emotion';\n\nexport const SettingsCompactor : React.FC<{className?: string, alwaysVisible?: () => JSX.Element, mobileOnly?: () => JSX.Element, wideStyle?:React.CSSProperties}> = props => {\n    const [expanded, setExpanded] = React.useState(false);\n\n    const alwaysVisible = props.alwaysVisible ? props.alwaysVisible() : null;\n\n    if(!isMobile()) {\n        return (\n            <div style={{display: 'flex', alignItems: 'center', ...props.wideStyle}} className={styles.horizontalSpace('.3rem')}>\n                {alwaysVisible}\n                {props.children}\n            </div>\n        );\n    }\n\n    const mobileOnly = props.mobileOnly ? props.mobileOnly() : null;\n\n    if(!expanded) {\n        return (\n            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>\n                {alwaysVisible}\n                {mobileOnly}\n                <div className=\"button\" onClick={() => setExpanded(true)}>S</div>\n            </div>\n        );\n    }\n\n    return (\n        <div style={{display: 'flex', flexDirection: 'column'}} className={styles.verticalSpace('.3rem')}>\n            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>\n                {alwaysVisible}\n                <div className=\"button\" onClick={() => setExpanded(false)}>S</div>\n            </div>\n            <div className={cx(styles.verticalSpace('.3rem'), props.className)}>\n                {props.children}\n            </div>\n        </div>\n    );\n};","import * as React from 'react';\nimport { useData } from '../model';\n\nexport const ContextTag: React.FC<{contextId: string|null}> = (props) => {\n    const {data} = useData();\n\n    if (!props.contextId) {\n        return null;\n    }\n\n    const context = data.contexts.find(p => p.id === props.contextId);\n\n    if (!context) {\n        return null;\n    }\n\n    return <div className=\"tag is-context\">{context.title}</div>;\n}","import * as React from 'react';\nimport { useData } from '../model';\nimport { ContextState, Context } from '../db/context';\nimport * as styles from '../layout/styles';\nimport * as ContextActions from '../lib/contextActions';\nimport { cx } from 'emotion';\nimport { getVariable } from '../layout/theme';\n\nexport const ContextBar: React.FC<{contextId: string|null, onChange: (contextId: string|null) => void, showTaskCount?: boolean}> = (props) => {\n    const {data} = useData();\n\n    const nestedContexts = ContextActions.getNestedContexts(data);\n\n    const renderListContext = (context: Context, contexts: ContextActions.NestedContexts, depth = 0) => {\n        if (context.state && context.state === ContextState.Inactive) {\n            return <React.Fragment key={context.id}></React.Fragment>;\n        }\n\n        return (\n            <React.Fragment key={context.id}>\n                <div onClick={() => props.onChange(context.id)} style={{paddingLeft: 10 + depth * 10, background: props.contextId === context.id ? getVariable('--active-context-background') : undefined}} className={cx('item', styles.hoverGlow, styles.cursorPointer)}>\n                    {context.title} {props.showTaskCount && <span style={{color: '#999'}}>{contexts.taskCounts[context.id]}</span>}\n                </div>\n                {contexts.nestedContexts[context.id] && contexts.nestedContexts[context.id].map(c => (\n                    renderListContext(c, contexts, depth + 1)\n                ))}\n            </React.Fragment>\n        );\n    }\n\n    return (\n        <div style={{borderRight: '1px solid #666', width: 200}}>\n            <div className=\"list\">\n                <div className={cx('item', styles.hoverGlow, styles.cursorPointer)} style={{paddingLeft: 10, background: props.contextId === null ? getVariable('--active-context-background') : undefined}} onClick={() => props.onChange(null)}>All</div>\n                {nestedContexts.topContexts.map(i => renderListContext(i, nestedContexts))}\n            </div>\n        </div>\n    )\n}","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport * as styles from '../layout/styles';\nimport { useData } from '../model';\nimport { ToolSection } from '../framework/ToolSection';\nimport * as ContextActions from '../lib/contextActions';\nimport { isMobile } from '../components/Layout';\nimport { Task } from '../db/task';\nimport { ProjectState, Project } from '../db/project';\nimport { db } from '../db/db';\nimport moment from 'moment';\nimport { useQueryState } from '../lib/UseQueryState';\nimport { SettingsCompactor } from '../components/SettingsCompactor';\nimport { ContextTag } from '../components/ContextTag';\nimport { ContextBar } from '../components/ContextBar';\nimport { cx } from 'emotion';\nimport _ from 'lodash';\nimport { getVariable } from '../layout/theme';\n\ninterface Perspective {\n    id: string;\n    title: string;\n    groupedProject: boolean;\n    groupedContext: boolean;\n}\n\nlet perspectives: Perspective[] = [\n    { id: '1', title: 'All', groupedProject: false, groupedContext: false },\n    { id: '2', title: 'Grouped', groupedProject: false, groupedContext: true },\n    { id: '3', title: 'Grouped Project', groupedProject: true, groupedContext: false }\n]\n\nlet defaultPerspective = perspectives[1];\n\ninterface TaskFilters {\n    showCompleted: boolean;\n    showContextBar: boolean;\n    includeNested: boolean;\n    showDeferred: boolean;\n    showIncubated: boolean;\n}\n\nexport const TaskPage: React.FC<{}> = (props) => {\n    const {data} = useData();\n    const [text, setText] = React.useState('');\n    const [options, setOptions] = React.useState<TaskFilters>({\n        showCompleted: false,\n        showDeferred: false,\n        showIncubated: false,\n        showContextBar: isMobile() ? false : true,\n        includeNested: true,\n    });\n\n    const [contextId, setContextId] = useQueryState(null, 'context');\n    const [projectId, setProjectId] = useQueryState(null, 'project');\n    const [perspectiveId, setPerspectiveId] = useQueryState('2', 'perspective');\n\n    const onKeyPress = async (e: React.KeyboardEvent<HTMLInputElement>) => {\n        if (e.key === 'Enter') {\n            await db.tasks.create({\n                title: text,\n                contextId: contextId,\n                projectId: projectId,\n                content: null,\n                state: 'active',\n                stateChangedAt: new Date().toISOString(),\n                noteId: null,\n            });\n\n            setText('');\n        }\n    }\n\n    const onCompleteChange = async (task: Task, e: React.ChangeEvent<HTMLInputElement>) => {\n        task.state = task.state === 'completed' ? 'active' : 'completed';\n        task.stateChangedAt = new Date().toISOString();\n        await db.tasks.save(task);\n    }\n\n    const renderProject = (task: Task) => {\n        const project = data.projects.find(p => p.id === task.projectId);\n\n        if (project) {\n            return <div className=\"tag is-info\">{project.title}</div>;\n        }\n\n        return null;\n    };\n\n    const renderDeferred = (task: Task) => {\n        if (task.deferredUntil && new Date(task.deferredUntil) > new Date()) {\n            return <div className=\"tag is-primary\" title={`${moment(task.deferredUntil).format('YYYY-MM-DD')}`}>deferred {moment(task.deferredUntil).fromNow(true)}</div>;\n        }\n        return null;\n    };\n\n    const renderNote = (task: Task) => {\n        if (task.noteId) {\n            return <div className=\"tag is-primary\" >N</div>;\n        }\n        return null;\n    };\n\n    const renderTitle = (title: string) => {\n        const pattern = /(https?:\\/\\/[^\\s]+)/;\n        return title.split(pattern).map((c, i) => {\n            if (c.match(pattern)) {\n                let title = c.replace(/https?:\\/\\//, '');\n                title = title.replace(/\\/.*/, '/...');\n                return <a key={i} href={c} onClick={e => { e.stopPropagation(); }} target=\"_blank\"  rel=\"noopener noreferrer\" className=\"button is-small is-link\" style={{display: 'inline-block', marginLeft: '5px', marginRight: '5px'}}>{title}</a>;\n            }\n\n            return <span key={i}>{c}</span>;\n        });\n    };\n\n    const filterTasks = (complete: boolean, contexts: ContextActions.NestedContexts) => {\n        let tasks = data.tasks;\n\n        if (complete) {\n            tasks = tasks.filter(t => t.state === 'completed')\n        } else {\n            tasks = tasks.filter(t => t.state !== 'completed')\n        }\n\n        if (projectId) {\n            tasks = tasks.filter(t => t.projectId === projectId);\n        }\n\n        if (!options.showDeferred) {\n            tasks = tasks.filter(t => t.deferredUntil == null || new Date(t.deferredUntil) < new Date());\n        }\n\n        if (!options.showIncubated) {\n            tasks = tasks.filter(t => t.state !== 'incubated');\n\n            const incubatedProjectIds = data.projects.filter(p => p.state === ProjectState.Incubated).map(p => p.id);\n            tasks = tasks.filter(t => !t.projectId || incubatedProjectIds.indexOf(t.projectId) === -1);\n        }\n\n        if (contextId) {\n            const contextIds = ContextActions.getFilteredContextIds(contextId, data);\n            tasks = tasks.filter(t => t.contextId && contextIds.indexOf(t.contextId) !== -1);\n        }\n\n        return tasks.sort((a, b) =>  b.createdAt! < a.createdAt! ?  -1 : b.createdAt! > a.createdAt! ? 1 : 0);\n    }\n\n    const renderTask = (task: Task, skipProjectContext = false) => {\n        let source: string|null = null;\n        if (window.location.search.length) {\n            const urlParams = new URLSearchParams(window.location.search);\n            source = `?source=${encodeURIComponent(`${window.location.pathname}?${urlParams.toString()}`)}`\n        }\n\n        return (\n            <NavLink key={task.id} to={`/tasks/${task.id}${source ? source : ''}`} className={cx('item', 'task', styles.hoverGlow)}>\n                <div className=\"task-checkbox\">\n                    <input type=\"checkbox\" style={{display: 'block', padding: 10}} checked={task.state === 'completed'} onClick={e => e.preventDefault()} onChange={e => onCompleteChange(task, e)}/>\n                </div>\n                <div className=\"task-title\" style={{color: task.state === 'incubated' ? '#999' : undefined}}>\n                    {task.state === 'completed' ? <span style={{textDecoration: 'line-through'}}>{renderTitle(task.title)}</span> : renderTitle(task.title)}\n                    {task.state === 'incubated' ? <span> [Incubated]</span> : null}\n                </div>\n                <div className=\"task-details\">\n                    <div className=\"tags\">\n                        {renderNote(task)}\n                        {renderDeferred(task)}\n                        {!skipProjectContext && <ContextTag contextId={task.contextId} /> }\n                        {!skipProjectContext && renderProject(task)}\n                    </div>\n                </div>\n            </NavLink>\n        );\n    };\n\n    const perspective = perspectives.find(x => x.id === perspectiveId) || defaultPerspective;\n    const nestedContexts = ContextActions.getNestedContexts(data);\n\n    let taskBlock: JSX.Element[] = [];\n\n    if (perspective.groupedContext) {\n        const filteredContextIds: (string|null)[] = ContextActions.getFilteredContextIds(contextId, data);\n\n        if (!contextId) {\n            filteredContextIds.push(null);\n        }\n\n        for (const contextId of filteredContextIds) {\n            const context = data.contexts.find(p => p.id === contextId);\n\n            let tasks = filterTasks(false, nestedContexts);\n\n            if (contextId) {\n                if (!context) {\n                    continue;\n                }\n\n                tasks = tasks.filter(t => t.contextId === contextId);\n\n                if (!tasks.length) {\n                    continue;\n                }\n\n                taskBlock.push(\n                    <div key={contextId} style={{display: 'flex', justifyContent: 'space-between', padding: '.6rem', background: getVariable('--task-context-background'), cursor: 'pointer'}} onClick={() => setContextId(context.id)}>\n                        {context.title}\n                        <NavLink className=\"button small\" to={`/contexts/${context.id}`}>Edit</NavLink>\n                    </div>\n                )\n            } else {\n                tasks = tasks.filter(t => t.contextId === contextId);\n\n                if (!tasks.length) {\n                    continue;\n                }\n\n                taskBlock.push(<div key={'no-context'} style={{padding: '.6rem', background: getVariable('--task-context-background')}}>No Context</div>)\n            }\n\n            let stateOrder = [ProjectState.Active, ProjectState.Incubated, ProjectState.Completed, ProjectState.Dropped];\n    \n            const emptyActiveProjects: Project[] = [];\n    \n            let filteredProjects = data.projects;\n    \n            if (projectId !== null) {\n                filteredProjects = filteredProjects.filter(p => p.id === projectId);\n            }\n    \n            filteredProjects.sort((a, b) => stateOrder.indexOf(a.state) - stateOrder.indexOf(b.state)).forEach(p => {\n                let projectTasks = tasks.filter(t => t.projectId === p.id);\n    \n                if (!projectTasks.length) {\n                    if (p.state === ProjectState.Active) {\n                        if (contextId) {\n                            if (p.contextId && filteredContextIds.indexOf(p.contextId) !== -1) {\n                                emptyActiveProjects.push(p);\n                            }\n                        } else {\n                            emptyActiveProjects.push(p);\n                        }\n                    }\n                    return;\n                }\n    \n                taskBlock.push(\n                    <React.Fragment key={`p-${p.id}`}>\n                        <div className=\"header link\" onClick={() => { setProjectId(p.id); setContextId(p.contextId); }} style={{background: getVariable('--task-project-background')}}>\n                            {p.title} {p.state !== ProjectState.Active ? `[${p.state}]` : ''}\n                            <div style={{display: 'flex'}}>\n                                <NavLink className=\"button small\" to={`/projects/${p.id}`}>Edit</NavLink>\n                            </div>\n                        </div>\n                        {projectTasks.map(t => renderTask(t, true))}\n                    </React.Fragment>\n                );\n            });\n    \n            const noProjectTasks = tasks.filter(t => t.projectId === null);\n    \n            if (noProjectTasks.length) {\n                taskBlock.push(\n                    <React.Fragment key={`no-p-${contextId}`}>\n                        <div className=\"header\" style={{background: getVariable('--task-project-background')}}>No Project</div>\n                        {noProjectTasks.map(t => renderTask(t, true))}\n                    </React.Fragment>\n                );\n            }\n    \n            for(const p of emptyActiveProjects) {\n                if (p.contextId !== contextId) {\n                    continue;\n                }\n\n                taskBlock.push(\n                    <div key={p.id} className=\"header link\" style={{background: getVariable('--task-project-background')}} onClick={() => { setProjectId(p.id); setContextId(p.contextId); }}>\n                        {p.title} {p.state !== ProjectState.Active ? `[${p.state}]` : ''} [Empty]\n                        <div style={{display: 'flex'}}>\n                            <div className=\"tags\">\n                                <ContextTag contextId={p.contextId} />\n                            </div>\n                            <NavLink className=\"button small\" to={`/projects/${p.id}`}>Edit</NavLink>\n                        </div>\n                    </div>\n                );\n            }\n        }\n\n        if (options.showCompleted) {\n            taskBlock.push(\n                <React.Fragment key=\"completed\">\n                    <div className=\"header\">Completed</div>\n                    {_.orderBy(filterTasks(true, nestedContexts), x => x.stateChangedAt, 'desc').map(t => renderTask(t))}\n                </React.Fragment>\n            );\n        }\n\n    } else if (perspective.groupedProject) {\n        let tasks = filterTasks(false, nestedContexts);\n\n        let stateOrder = [ProjectState.Active, ProjectState.Incubated, ProjectState.Completed, ProjectState.Dropped];\n\n        const emptyActiveProjects: Project[] = [];\n\n        let filteredProjects = data.projects;\n\n        if (projectId !== null) {\n            filteredProjects = filteredProjects.filter(p => p.id === projectId);\n        }\n\n        const filteredContextIds = ContextActions.getFilteredContextIds(contextId, data);\n\n        filteredProjects.sort((a, b) => stateOrder.indexOf(a.state) - stateOrder.indexOf(b.state)).forEach(p => {\n            let projectTasks = tasks.filter(t => t.projectId === p.id);\n\n            if (!projectTasks.length) {\n                if (p.state === ProjectState.Active) {\n                    if (contextId) {\n                        if (p.contextId && filteredContextIds.indexOf(p.contextId) !== -1) {\n                            emptyActiveProjects.push(p);\n                        }\n                    } else {\n                        emptyActiveProjects.push(p);\n                    }\n                }\n                return;\n            }\n\n            taskBlock.push(\n                <React.Fragment key={`p-${p.id}`}>\n                    <div className=\"header link\" onClick={() => { setProjectId(p.id); setContextId(p.contextId); }}>\n                        {p.title} {p.state !== ProjectState.Active ? `[${p.state}]` : ''}\n                        <div style={{display: 'flex'}}>\n                            <div className=\"tags\">\n                                <ContextTag contextId={p.contextId} />\n                            </div>\n                            <NavLink className=\"button small\" to={`/projects/${p.id}`}>Edit</NavLink>\n                        </div>\n                    </div>\n                    {projectTasks.map(t => renderTask(t))}\n                </React.Fragment>\n            );\n        });\n\n        const noProjectTasks = tasks.filter(t => t.projectId === null);\n\n        if (noProjectTasks.length) {\n            taskBlock.push(\n                <React.Fragment key=\"no-p\">\n                    <div className=\"header\">No Project</div>\n                    {noProjectTasks.map(t => renderTask(t))}\n                </React.Fragment>\n            );\n        }\n\n        for(const p of emptyActiveProjects) {\n            taskBlock.push(\n                <React.Fragment key={`p-${p.id}`}>\n                    <div className=\"header link\" onClick={() => { setProjectId(p.id); setContextId(p.contextId); }}>\n                        {p.title} {p.state !== ProjectState.Active ? `[${p.state}]` : ''} [Empty]\n                        <div style={{display: 'flex'}}>\n                            <div className=\"tags\">\n                                <ContextTag contextId={p.contextId} />\n                            </div>\n                            <NavLink className=\"button small\" to={`/projects/${p.id}`}>Edit</NavLink>\n                        </div>\n                    </div>\n                </React.Fragment>\n            );\n        }\n\n        if (options.showCompleted) {\n            taskBlock.push(\n                <React.Fragment key=\"completed\">\n                    <div className=\"header\">Completed</div>\n                    {filterTasks(true, nestedContexts).map(t => renderTask(t))}\n                </React.Fragment>\n            );\n        }\n    } else {\n        taskBlock.push(\n            <React.Fragment key=\"tasks\">\n                {filterTasks(false, nestedContexts).map(t => renderTask(t))}\n                {options.showCompleted && <>\n                    <div className=\"header\">Completed</div>\n                    {filterTasks(true, nestedContexts).map(t => renderTask(t))}\n                </>}\n            </React.Fragment>\n        );\n    }\n\n    return (\n        <div style={{display: 'flex', height: '100%'}}>\n            {options.showContextBar && <ContextBar contextId={contextId} onChange={setContextId} showTaskCount={true} />}\n            <div style={{width: '100%'}}>\n                <ToolSection>\n                    <SettingsCompactor alwaysVisible={() => (\n                        <div className=\"button\" onClick={() => { setContextId(null); setProjectId(null); }}>R</div>\n                    )} mobileOnly={() => (\n                        <div className=\"button\" style={{marginLeft: 'auto', marginRight: 8}} onClick={() => setOptions({ ...options, showContextBar: !options.showContextBar })}>C</div>\n                    )}>\n                        <select style={{padding: '0.3rem', display: 'block'}} value={contextId || ''} onChange={e => setContextId(e.target.value === '' ? null : e.target.value) }>\n                            <option value=\"\">All contexts</option>\n                            {data.contexts.map(c => (\n                                <option key={c.id} value={c.id}>{c.title}</option>\n                            ))}\n                        </select>\n                        <select style={{padding: '0.3rem', display: 'block'}} value={projectId || ''} onChange={e => setProjectId(e.target.value === '' ? null : e.target.value)}>\n                            <option value=\"\">All projects</option>\n                            {data.projects.filter(c => c.state === ProjectState.Active).map(c => (\n                                <option key={c.id} value={c.id}>{c.title}</option>\n                            ))}\n                        </select>\n                        <select style={{padding: '0.3rem', display: 'block'}} value={perspectiveId || ''} onChange={e => setPerspectiveId(e.target.value === '' ? null : e.target.value)}>\n                            <option value=\"\">Select Perspective</option>\n                            {perspectives.map(c => (\n                                <option key={c.id} value={c.id}>{c.title}</option>\n                            ))}\n                        </select>\n                        <div>\n                            <input id=\"completed-box\" type=\"checkbox\" checked={options.showCompleted} onChange={() => setOptions({ ...options, showCompleted: !options.showCompleted })} />\n                            <label htmlFor=\"completed-box\">Show completed</label>\n                        </div>\n                        <div>\n                            <input id=\"deferred-box\" type=\"checkbox\" checked={options.showDeferred} onChange={() => setOptions({ ...options, showDeferred: !options.showDeferred })} />\n                            <label htmlFor=\"deferred-box\">Show deferred</label>\n                        </div>\n                        <div>\n                            <input id=\"incubated-box\" type=\"checkbox\" checked={options.showIncubated} onChange={() => setOptions({ ...options, showIncubated: !options.showIncubated })} />\n                            <label htmlFor=\"incubated-box\">Show incubated</label>\n                        </div>\n                        <div>\n                            <input id=\"context-box\" type=\"checkbox\" checked={options.showContextBar} onChange={() => setOptions({ ...options, showContextBar: !options.showContextBar })} />\n                            <label htmlFor=\"context-box\">Show context bar</label>\n                        </div>\n                        <div>\n                            <input id=\"include-nested-box\" type=\"checkbox\" checked={options.includeNested} onChange={() => setOptions({ ...options, includeNested: !options.includeNested })} />\n                            <label htmlFor=\"include-nested-box\">Include nested contexts</label>\n                        </div>\n                    </SettingsCompactor>\n                    <input type=\"text\" className=\"input is-large is-wide\" placeholder=\"Add task...\" value={text} onChange={e => setText(e.target.value)} onKeyPress={onKeyPress} />\n                </ToolSection>\n                <div className=\"list\">\n                    {taskBlock}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import { Entity } from \"./db\";\nimport moment from \"moment\";\n\nexport type NoteMode = 'markdown'|'tree';\n\nexport interface Note extends Entity {\n    type: 'note',\n    mode: NoteMode|null;\n    title: string;\n    tags: string;\n    content: string;\n    contextId: string|null;\n    noteFor: Reference|null;\n    dailyDate: string|null;\n};\n\nexport interface Reference {\n    type: string;\n    id: string;\n};\n\nexport interface HasNote extends Entity {\n    noteId: string|null;\n}\n\nexport function getNoteTitle(note: Pick<Note, 'dailyDate'|'title'|'content'>) {\n    if (note.dailyDate) {\n        return `Daily - ${moment(note.dailyDate).format('MMMM Do, YYYY')}`;\n    }\n\n    if (note.title && note.title.length) {\n        return note.title;\n    }\n\n    const parsedTitle = /# (.+)/.exec(note.content);\n\n    if (parsedTitle && parsedTitle.length > 1) {\n        return parsedTitle[1];\n    }\n\n    return '';\n}\n\nexport function getNoteTitleType(note: Note): 'daily'|'title'|'parsed'|'none' {\n    if (note.dailyDate) {\n        return 'daily';\n    }\n\n    if (note.title && note.title.length) {\n        return 'title';\n    }\n\n    const parsedTitle = /# (.+)/.exec(note.content);\n\n    if (parsedTitle && parsedTitle.length > 1) {\n        return 'parsed';\n    }\n\n    return 'none';\n}\n\nexport const noteReferenceRegex = /\\[\\[([^\\]]+)\\]\\]/ig;\n\nfunction escapeRegExp(str: string) {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nexport function getNoteContextTitlePrefixRegExp(contextTitle: string) {\n    return new RegExp(`^${escapeRegExp(contextTitle)}/`, 'i')\n}\n\nexport function getNoteTitleMatchRegExp(reference: string) {\n    return new RegExp(`^${escapeRegExp(reference)}$`, 'i')\n}\n\nexport function getNoteReferenceMatchRegExp(reference: string) {\n    return new RegExp(`\\\\[\\\\[${escapeRegExp(reference)}\\\\]\\\\]`, 'i')\n}\n\nexport function getNoteAliasReferenceMatchRegExp(alias: string) {\n    return new RegExp(`\\\\B@${escapeRegExp(alias)}`, 'i')\n}\n\nexport function extractReferences(text: string) {\n    if(!text) {\n        return [];\n    }\n\n    const regex = /\\[\\[([^\\]]+)\\]\\]/ig;\n    const results = [];\n    for(const match of text.matchAll(regex)) {\n        results.push(match[1])\n    }\n\n    return results;\n}\n\nexport function extractAllReferences(notes: Note[]) {\n    const results: { [reference: string]: { title: string, contextId: string|null, updatedAt: Date } } = {};\n\n    function getKey(title: string, contextId: string|null) {\n        return `${contextId}-${title.toLowerCase()}`\n    }\n\n    const existing = new Set<string>(notes.filter(n => n.title).map(n => getKey(n.title, n.contextId)));\n\n    for(const note of notes) {\n        const references = extractReferences(note.content);\n\n        for(const reference of references) {\n            const key = getKey(reference, note.contextId);\n            \n            if (existing.has(key)) {\n                continue;\n            }\n            \n            const existingResult = results[key];\n\n            if (existingResult && existingResult.updatedAt > new Date(note.updatedAt)) {\n                continue;\n            }\n\n            results[key] = {\n                title: reference,\n                contextId: note.contextId,\n                updatedAt: new Date(note.updatedAt)\n            };\n        }\n    }\n\n    return Object.values(results);\n}","import { Entity } from \"./db\";\nimport { HasNote } from \"./note\";\n\nexport interface Person extends Entity, HasNote {\n    type: 'person';\n    name: string;\n    alias: string|null;\n    birthday: string|null;\n}\n\nexport const mentionRegex = /\\B(@[^\\s()[\\].,!:]+)/g;\n\nexport function convertNameToAlias(name: string) {\n    if(!name) {\n        return null;\n    }\n\n    return name.toLowerCase().replace(/ /g, '_');\n}\n\nexport function getAlias(person: Person) {\n    return `${person.alias || convertNameToAlias(person.name)}`;\n}","import * as React from 'react';\nimport marked from 'marked';\nimport '../github-markdown.css';\nimport { useData } from '../model';\nimport { getNoteTitleMatchRegExp, getNoteContextTitlePrefixRegExp, noteReferenceRegex } from '../db/note';\nimport {useHistory} from 'react-router-dom';\nimport { mentionRegex, getAlias } from '../db/person';\n\n\nexport const MarkedViewer: React.FC<{ markdown: string; contextId: string|null }> = props => {\n    const history = useHistory();\n    const {data} = useData();\n\n    (window as any).lifeNavigate = function(url: string) {\n        history.push(url);\n        return false;\n    };\n\n    let markdown = props.markdown.replace(noteReferenceRegex, (_, group1) => {\n        let matchContextId = props.contextId;\n        let matchTitle = group1;\n\n        const prefixContext = data.contexts.find(x => getNoteContextTitlePrefixRegExp(x.title).test(group1));\n        if (prefixContext) {\n            matchTitle = matchTitle.substring(prefixContext.title.length + 1);\n            matchContextId = prefixContext.id;\n        }\n\n        const referenceRegExp = getNoteTitleMatchRegExp(matchTitle);\n        const note = data.notes.find(x => x.contextId === matchContextId && referenceRegExp.test(x.title));\n\n        if (note) {\n            const url = `/notes/${note.id}`;\n            return `<span style=\"color: #444\">[[ </span><a onclick=\"return lifeNavigate('${url}')\" href=\"${url}\">${group1}</a><span style=\"color: #444\"> ]]</span>`;\n        }\n\n        const url = `/notes/virtual?title=${encodeURIComponent(group1)}${props.contextId ? `&context=${props.contextId}` : ''}&source=${encodeURIComponent(`${window.location.pathname}`)}`;\n        return `<span style=\"color: #444\">[[ </span><a onclick=\"return lifeNavigate('${url}')\" href=\"${url}\">${group1}</a><span style=\"color: #444\"> ? ]]</span>`;\n    });\n\n    markdown = markdown.replace(mentionRegex, (_, group1) => {\n        const person = data.people.find(x => `@${getAlias(x)}` === group1);\n\n        if (person) {\n            const url = `/people/${person.id}?source=${encodeURIComponent(`${window.location.pathname}`)}`;\n            return `<a onclick=\"return lifeNavigate('${url}')\" href=\"${url}\" style=\"background: #333; padding: 0px 4px; border-radius: 4px\">${person.name}</a>`;\n        }\n\n        const url = `/people/virtual?alias=${encodeURIComponent(group1)}&source=${encodeURIComponent(`${window.location.pathname}`)}`;\n        return `<a onclick=\"return lifeNavigate('${url}')\" href=\"${url}\" style=\"background: #333; padding: 0px 4px; border-radius: 4px\">${group1}</a><span style=\"color: #444\"> ?</span>`;\n    });\n\n    const html = marked(markdown);\n    return (\n        <div className=\"marked-viewer note markdown-body\" dangerouslySetInnerHTML={{ __html: html }}></div>\n    );\n};","import * as React from 'react';\nimport { MarkedViewer } from './MarkedViewer';\nimport * as styles from '../layout/styles';\nimport { NoteMode } from '../db/note';\n\nimport AceEditor from \"react-ace\";\nimport {textCompleter, snippetCompleter, keyWordCompleter} from \"ace-builds/src-noconflict/ext-language_tools\";\nimport \"ace-builds/src-noconflict/mode-markdown\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport \"ace-builds/src-noconflict/theme-textmate\";\nimport { Data } from '../model';\nimport { cx } from 'emotion';\nimport { isDark } from '../layout/theme';\n\nexport enum SplitMode {\n    Split,\n    Editor,\n    Preview\n}\n\nexport const NoteModeSelector: React.SFC<{mode: NoteMode, onModeChange: (mode: NoteMode) => void}> = props => (\n    <div className={cx(styles.horizontalSpace('.5rem'))}>\n        <button className=\"button\" style={{background: !props.mode || props.mode !== 'markdown' ? '#444' : undefined}} onClick={() => props.onModeChange('markdown')}>Markdown</button>\n        <button className=\"button\" style={{background: props.mode !== 'tree' ? '#444' : undefined}} onClick={() => props.onModeChange('tree')}>Tree</button>\n    </div>\n);\n\n\nexport const SplitModeSelector: React.SFC<{mode: SplitMode, onModeChange: (mode: SplitMode) => void}> = props => (\n    <div className={cx(styles.horizontalSpace('.5rem'))}>\n        <button className=\"button\" style={{background: props.mode !== SplitMode.Split ? '#444' : undefined}} onClick={() => props.onModeChange(SplitMode.Split)}>Split</button>\n        <button className=\"button\" style={{background: props.mode !== SplitMode.Editor ? '#444' : undefined}} onClick={() => props.onModeChange(SplitMode.Editor)}>Editor</button>\n        <button className=\"button\" style={{background: props.mode !== SplitMode.Preview ? '#444' : undefined}} onClick={() => props.onModeChange(SplitMode.Preview)}>Preview</button>\n    </div>\n);\n\nexport class SimpleSplitEditor extends React.Component<{ text: string, onTextChanged: (text: string) => void, expand?: boolean, mode: SplitMode, data: Data, contextId: string|null }, {}> {\n\n    render() {\n        const style: React.CSSProperties = {};\n\n        if(this.props.expand) {\n            style.width = '100%';\n            style.height = '100%';\n            style.zIndex = 100;\n            style.display = 'flex';\n            style.maxHeight = '100%';\n        }\n\n        const border = '1px solid #666';\n        const components = [];\n\n        let textAreaStyle: React.CSSProperties = {\n            flexGrow: 1, \n            minWidth: '50%', \n            borderTop: border, \n            height: '100%'\n        };\n\n        let markedStyle: React.CSSProperties = {\n            flexGrow: 1, \n            minWidth: '50%', \n            background: 'transparent', \n            padding: '1rem', \n            borderTop: border\n        };\n\n        if (this.props.mode === SplitMode.Split) {\n            textAreaStyle.borderRight = border;\n            markedStyle.overflowY = 'scroll';\n        }\n\n        if (this.props.mode === SplitMode.Editor || this.props.mode === SplitMode.Split) {\n            components.push(\n                    <AceEditor \n                        key=\"editor\"\n                        value={this.props.text} \n                        fontSize={18}\n                        style={textAreaStyle}\n                        onChange={e => this.props.onTextChanged(e)} \n                        mode=\"markdown\"\n                        theme={isDark() ? \"monokai\" : 'textmate'}\n                        showGutter={false} \n                        showPrintMargin={false}\n                        wrapEnabled={true}\n                        enableBasicAutocompletion={[snippetCompleter, textCompleter, keyWordCompleter] as any}\n                        enableLiveAutocompletion={true}\n                        enableSnippets={true}\n                    />\n            );\n        }\n\n        if (this.props.mode === SplitMode.Preview || this.props.mode === SplitMode.Split) {\n            components.push(\n                <div key=\"2\" style={markedStyle}>\n                    <MarkedViewer markdown={this.props.text} contextId={this.props.contextId} />\n                </div>\n            );\n        }\n\n        return (\n            <div style={style}>\n                {components}\n            </div>\n        );\n    }\n}","import * as React from 'react';\nimport { useState, useRef } from 'react';\nimport { horizontalSpace, hoverGlow } from '../layout/styles';\nimport { MarkedViewer } from './MarkedViewer';\nimport AceEditor, { ICommand } from \"react-ace\";\nimport copy from 'copy-to-clipboard';\nimport {textCompleter, snippetCompleter, keyWordCompleter} from \"ace-builds/src-noconflict/ext-language_tools\";\nimport \"ace-builds/src-noconflict/mode-markdown\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport \"ace-builds/src-noconflict/theme-textmate\";\nimport ReactAce from 'react-ace/lib/ace';\nimport { Loader } from './Loader';\nimport { extractReferences } from '../db/note';\nimport { useData } from '../model';\nimport { cx } from 'emotion';\nimport { getAlias } from '../db/person';\nimport { isDark, getVariable } from '../layout/theme';\n\nexport interface Node {\n    text: string;\n    nodes: Node[];\n}\n\nexport const TreeEditor: React.FC<{text: string, onTextChanged: (text: string) => void, contextId: string|null}> = (props) => {\n    const {data} = useData();\n    const [invalid] = useState(() => {\n        if (!props.text || props.text === '') {\n            return false;\n        }\n        try {\n            JSON.parse(props.text);\n            return false;\n        } catch {\n            return true;\n        }\n    })\n\n    // const [mouseDown, setMouseDown] = useState<Node|null>();\n    // const [mouseOver, setMouseOver] = useState<Node|null>();\n    const [selectMode, setSelectMode] = useState(false);\n    const [selectedNodes, setSelectedNodes] = useState<Node[]>([]);\n\n    const [nodes, setNodes] = useState<Node[]>(() => {\n        if (invalid) {\n            return [];\n        }\n\n        if (!props.text || props.text === '') {\n            return [\n                { text: '', nodes: [] }\n            ];\n        }\n\n        return JSON.parse(props.text);\n    });\n\n    const inputRef = useRef<ReactAce>(null);\n    const [active, setActive] = useState(nodes[0]);\n\n    const [noteTitles, setNoteTitles] = React.useState<{ title: string; context: string|null }[]>();\n\n    React.useEffect(() => {\n        const noteCompletions  = data.notes.map(n => {\n            let titles = extractReferences(n.content);\n\n            if (n.title && n.title.length) {\n                titles.push(n.title);\n            }\n\n            const context = data.contexts.find(c => c.id === n.contextId)?.title || null;\n\n            return titles.map(t => ({ title: t, context }));\n        }).flat().filter(t => t.title !== null);\n\n        setNoteTitles(noteCompletions);\n    }, [props.contextId, data.contexts, data.notes]);\n\n    const [peopleAliases, setPeopleAliases] = React.useState<string[]>();\n\n    React.useEffect(() => {\n        const aliases  = data.people.map(n => getAlias(n)).filter(t => t !== null);\n        setPeopleAliases(aliases);\n    }, [data.people]);\n\n    if (invalid) {\n        return (\n            <div>Invalid tree content (not valid JSON).</div>\n        )\n    }\n\n    if (!noteTitles || !peopleAliases) {\n        return <Loader />;\n    }\n\n    const updateText = () => {\n        props.onTextChanged(JSON.stringify(nodes));\n    }\n\n    const onInputChanged = (node: Node, value: string) => {\n        node.text = value;\n        setNodes([...nodes]);\n        updateText();\n    };\n\n    const getParentNode = (targetNode: Node, searchNodes: Node[] = nodes, parentNode: Node|null = null): Node|null => {\n      for(const node of searchNodes) {\n          if (node === targetNode) {\n              return parentNode;\n          }\n\n          const childResult = getParentNode(targetNode, node.nodes, node);\n          if (childResult) {\n              return childResult;\n          }\n      }\n\n      return null;\n    };\n\n    const preorderTraversal = () => {\n        const result: Node[] = [];\n        const stack = [...nodes].reverse();\n\n        while(stack.length) {\n            let node = stack.pop();\n\n            if (!node) {\n                return result;\n            }\n\n            result.push(node);\n\n            for(let childNode of [...node.nodes].reverse()) {\n                stack.push(childNode);\n            }\n\n        }\n\n        return result;\n    };\n\n    \n    function visitNodes(visit: (n: Node, depth: number, index: number) => void) {\n        const stack = nodes.map((node, index) => ({ node, depth: 0, index })).reverse();\n\n        while(stack.length) {\n            let next = stack.pop();\n\n            if (!next) {\n                return;\n            }\n\n            visit(next.node, next.depth, next.index)\n\n            const depth = next.depth;\n            for(const childNode of next.node.nodes.map((node, index) => ({ node, depth: depth + 1, index })).reverse()) {\n                stack.push(childNode);\n            }\n        }\n    }\n\n    const insertNode = (afterNode: Node, above = false) => {\n        const parentNode = getParentNode(afterNode);\n        const searchNodes = parentNode ? parentNode.nodes : nodes;\n        const nodeIndex = searchNodes.findIndex(x => x === afterNode);\n        const node: Node = { text: '', nodes: [] };\n        searchNodes.splice(nodeIndex + (above ? 0 : 1), 0, node);\n        setNodes([...nodes]);\n        return node;\n    };\n\n    const removeNode = (node: Node) => {\n        const parentNode = getParentNode(node);\n        const searchNodes = parentNode ? parentNode.nodes : nodes;\n        const nodeIndex = searchNodes.findIndex(x => x === node);\n        searchNodes.splice(nodeIndex, 1);\n        setNodes([...nodes]);\n        return node;\n    };\n\n    const removeNodeIfEmpty = (node: Node) => {\n        if (node.text.length || node.nodes.length) {\n            return;\n        }\n        removeNode(node);\n    };\n\n    const indentNode = (node: Node) => {\n        const parentNode = getParentNode(node);\n        const searchNodes = parentNode ? parentNode.nodes : nodes;\n        const nodeIndex = searchNodes.findIndex(x => x === node);\n\n        if (nodeIndex === 0) {\n            return;\n        } else {\n            searchNodes.splice(nodeIndex, 1);\n            searchNodes[nodeIndex - 1].nodes.push(node);\n            setNodes([...nodes]);\n        }\n    };\n\n    const unindentNode = (node: Node) => {\n        const parentNode = getParentNode(node);\n\n        if(parentNode === null) {\n            return;\n        }\n\n        const parentParentNode = getParentNode(parentNode);\n        const targetNodes = parentParentNode ? parentParentNode.nodes : nodes;\n        const parentNodeIndex = targetNodes.findIndex(x => x === parentNode);\n        targetNodes.splice(parentNodeIndex + 1, 0, node);\n        const nodeIndex = parentNode.nodes.findIndex(x => x === node);\n        parentNode.nodes.splice(nodeIndex, 1);\n\n        setNodes([...nodes]);\n    };\n\n    const commands: ICommand[] = [\n        { name: 'indent', bindKey: { win: 'tab', mac: 'tab' }, exec: () => {\n            setTimeout(() => {\n                indentNode(active);\n            }, 0);\n            return true;\n        }},\n        { name: 'unindent', bindKey: { win: 'shift+tab', mac: 'shift+tab' }, exec: () => {\n            setTimeout(() => {\n                unindentNode(active);\n            }, 0);\n            return true;\n        }},\n        { name: 'enter', bindKey: { win: 'enter', mac: 'enter' }, exec: () => {\n            if (active.text === '') {\n                return;\n            }\n            const above = inputRef.current && inputRef.current.editor.getCursorPosition().row === 0 && inputRef.current.editor.getCursorPosition().column === 0;\n            setTimeout(() => {\n                const newNode = insertNode(active, !!above);\n                setActive(newNode);\n            }, 0);\n            return true;\n        }},\n        { name: 'up', bindKey: { win: 'up', mac: 'up' }, exec: () => {\n            const onFirstRow = inputRef.current && inputRef.current.editor.getCursorPosition().row === 0;\n            if (!onFirstRow) {\n                return false;\n            }\n            const searchNodes = preorderTraversal();\n            let activeIndex = searchNodes.findIndex(x => x === active);\n            activeIndex = Math.max(0, activeIndex - 1);\n            setTimeout(() => {\n                setActive(searchNodes[activeIndex]);\n                removeNodeIfEmpty(active);\n            }, 0);\n            return true;\n        }},\n        { name: 'down', bindKey: { win: 'down', mac: 'down' }, exec: () => {\n            const onLastRow = inputRef.current && inputRef.current.editor.getCursorPosition().row + 1 === inputRef.current.editor.getSession().doc.getLength();\n            if(!onLastRow) {\n                return false;\n            }\n            const searchNodes = preorderTraversal();\n            let activeIndex = searchNodes.findIndex(x => x === active);\n            activeIndex = Math.min(searchNodes.length - 1, activeIndex + 1);\n            setTimeout(() => {\n                setActive(searchNodes[activeIndex]);\n                removeNodeIfEmpty(active);\n            }, 0);\n            return true;\n        }},\n        { name: 'space', bindKey: { win: 'space', mac: 'space' }, exec: () => {\n            const atStart = inputRef.current && inputRef.current.editor.getCursorPosition().row === 0 && inputRef.current.editor.getCursorPosition().column === 0;\n            if (atStart) {\n                setTimeout(() => {\n                    indentNode(active);\n                }, 0);\n                return true;\n            }\n            return false;\n        }},\n        { name: 'backspace', bindKey: { win: 'backspace', mac: 'backspace' }, exec: () => {\n            const atStart = inputRef.current && inputRef.current.editor.getCursorPosition().row === 0 && inputRef.current.editor.getCursorPosition().column === 0;\n            if (atStart) {\n                setTimeout(() => {\n                    unindentNode(active);\n                }, 0);\n                return true;\n            }\n            return false;\n        }}\n    ];\n\n    // Look at https://github.com/ajaxorg/ace/blob/41ac47ec9e26f65fe0ffedeedf14b525a22f5462/lib/ace/ext/language_tools.js#L42-L48\n    const completions = {\n        getCompletions: (editor: any, session: any, pos: any, editorPrefix: string, callback: CompletionCallback) => {\n            const line: string = session.getLine(pos.row);\n\n            if (!line) {\n                return;\n            }\n\n            function getPrefix(position: any) {\n                let prefix = '';\n\n                for(let i=position.column - 1;i>=0;i--) {\n                    if (line[i] === ' ') {\n                        break;\n                    }\n                    \n                    prefix = line[i] + prefix;\n                }\n\n                return prefix;    \n            }\n\n            function hasPrefix(requiredPrefix: string) {\n                return getPrefix(pos).startsWith(requiredPrefix);\n            }\n\n            if (hasPrefix('[[')) {\n                const completions = noteTitles.map(n => ({\n                    caption: n.title,\n                    snippet: n.title,\n                    meta: n.context || 'note',\n                }))\n\n                callback(null, completions);\n            } else if (hasPrefix('@')) {\n                const completions = peopleAliases.map(n => ({\n                    caption: n,\n                    snippet: n,\n                    meta: 'person',\n                }))\n\n                callback(null, completions);\n            } else if (hasPrefix('::')) {\n                // To use for properties\n                //\n                // const completions = peopleAliases.map(n => ({\n                //     caption: n+'::',\n                //     snippet: n+'::',\n                //     meta: 'person',\n                //     completer: {\n                //         insertMatch: function (insertEditor: any, data: any) {\n                //             var insertValue = data.snippet;\n                //             var position = editor.selection.getCursor();\n\n                //             insertEditor.session.replace({\n                //                 start: { row: position.row, column: position.column - getPrefix(position).length },\n                //                 end: { row: position.row, column: position.column }\n                //             }, insertValue);\n                //         }\n                //     }\n                // }))\n\n                // callback(null, completions);\n            }\n        }\n    }\n\n    function toggleSelected(node: Node) {\n        if(selectedNodes.includes(node)) {\n            setSelectedNodes(selectedNodes.filter(n => n !== node));\n        } else {\n            setSelectedNodes(selectedNodes.concat(node))\n        }\n    }\n\n    function clickNode(node: Node) {\n        if (selectMode) {\n            toggleSelected(node);\n            return;\n        }\n        \n        if(node !== active) {\n            setActive(node);\n        }\n    }\n\n    const renderNode = (node: Node, index: number, level: number, selectedNodes: Node[]) => {\n        const isActive = node === active;\n        const isSelected = selectedNodes.includes(node);\n        return (\n            <React.Fragment key={`${level}-${index}`}>\n                <div style={{display: 'flex', background: isSelected ? '#003838' : !selectMode && isActive ? getVariable('--active-tree-editor-background') : undefined, padding: '.6rem .8rem'}} className={hoverGlow} onClick={() => clickNode(node)}>\n                    {selectMode && <div style={{lineHeight: 1.5, marginRight: 8}}><input type=\"checkbox\" checked={isSelected} onChange={() => toggleSelected(node)} /></div>}\n                    {!selectMode && <div style={{letterSpacing: '.5rem', color: isActive ? '#078263' : '#777', lineHeight: 1.5}}></div>}\n                    {!selectMode && isActive\n                        ? <AceEditor\n                            key=\"editor\"\n                            ref={inputRef}\n                            value={node.text}\n                            fontSize={16}\n                            style={{background: 'transparent', width: '100%', lineHeight: 1.5, marginLeft: -4}}\n                            onChange={e => onInputChanged(node, e)}\n                            mode=\"markdown\"\n                            theme={isDark() ? \"monokai\" : 'textmate'}\n                            focus\n                            highlightActiveLine={false}\n                            showGutter={false}\n                            showPrintMargin={false}\n                            wrapEnabled={true}\n                            maxLines={Infinity}\n                            commands={commands}\n                            enableBasicAutocompletion={[completions, snippetCompleter, textCompleter, keyWordCompleter] as any}\n                            enableLiveAutocompletion={true}\n                            enableSnippets={true}\n                            />\n                        : <MarkedViewer markdown={node.text} contextId={props.contextId} />}\n                </div>\n                <div style={{borderLeft: '1px solid #555', marginLeft: 16, paddingLeft: 16}}>\n                    {node.nodes.map((n, i) => renderNode(n, i, level + 1, selectedNodes))}\n                </div>\n            </React.Fragment>\n        );\n    };\n\n    // function onMouseDown(node: Node) {\n    //     console.log('mouseDown', node);\n    //     setMouseDown(node);\n    // }\n\n    // function onMouseUp(node: Node) {\n    //     console.log('mouseUp', node);\n    //     setMouseDown(null);\n    //     setMouseOver(null);\n    // }\n\n    // function onMouseOver(node: Node) {\n    //     if(mouseDown) {\n    //         console.log('mouseOver', node);\n    //         setMouseOver(node);\n\n    //         const newSelection: Node[] = [];\n\n    //         if (mouseDown && mouseOver && mouseDown !== mouseOver) {\n    //             let count = 0;\n        \n    //             const stack: Node[] = [];\n        \n    //             for(let i=nodes.length-1;i>=0;i--) {\n    //                 stack.push(nodes[i]);\n    //             }\n        \n    //             while (stack.length) {\n    //                 const node = stack.pop();\n        \n    //                 if (!node) {\n    //                     continue;\n    //                 }\n        \n    //                 for(let i=node.nodes.length-1;i>=0;i--) {\n    //                     stack.push(node.nodes[i]);\n    //                 }\n        \n    //                 if (node === mouseDown || node === mouseOver) {\n    //                     count += 1;\n    //                     newSelection.push(node);\n    //                 } else if (count === 1) {\n    //                     newSelection.push(node);\n    //                 }\n    //             }\n\n    //             setSelectedNodes(newSelection);\n    //         }\n    //     }\n    // }\n\n    function toggleSelectMode() {\n        if(selectMode) {\n            setSelectMode(false);\n            setSelectedNodes([]);\n        } else {\n            setSelectMode(true);\n        }\n    }\n\n    function copySelected() {\n        let result = \"\";\n\n        visitNodes((node, depth, index) => {\n            if(!selectedNodes.includes(node)) {\n                return;\n            }\n\n            console.log(node, depth);\n\n            result += `${'  '.repeat(depth)}- ${node.text}\\n`;\n        });\n\n        copy(result);\n    }\n\n    return (\n        <>\n            <div style={{display: 'flex', background: '#444', position: 'fixed', height: 36, bottom: 0, left: 0, right: 0, zIndex: 100}} className={cx(horizontalSpace('.5rem'))}>\n                    <div className=\"button\" onClick={toggleSelectMode}>Select</div>\n                    {selectMode ? <>\n                        <div className=\"button\" onClick={() => setSelectedNodes(preorderTraversal())}>All</div>\n                        <div className=\"button\" onClick={copySelected}>Copy</div>\n                    </> : <>\n                        <div className=\"button\" onClick={e => { unindentNode(active); inputRef.current && inputRef.current.editor.focus(); }}>&larr;</div>\n                        <div className=\"button\" onClick={e => { indentNode(active); inputRef.current && inputRef.current.editor.focus(); }}>&rarr;</div>\n                        <div className=\"button\" onClick={e => {\n                            if (!inputRef.current) {\n                                return;\n                            }\n                            inputRef.current.editor.session.insert(inputRef.current.editor.getCursorPosition(), '[[');\n                            inputRef.current.editor.focus();\n                        }}>[[</div>\n                        <div className=\"button\" onClick={e => {\n                            if (!inputRef.current) {\n                                return;\n                            }\n                            inputRef.current.editor.session.insert(inputRef.current.editor.getCursorPosition(), ']]');\n                            inputRef.current.editor.focus();\n                        }}>]]</div>\n                    </>}\n\n            </div>\n            <div style={{height: '100%', marginBottom: 36}}>\n                {nodes.map((n, i) => renderNode(n, i, 0, selectedNodes))}\n            </div>\n        </>\n    );\n};\n\ninterface Completion {\n    value?: string;\n    meta: string;\n    type?: string;\n    caption?: string;\n    snippet?: any;\n    score?: number;\n    exactMatch?: number;\n    docHTML?: string;\n}\n\ntype CompletionCallback = (error: Error|null, results: Completion[]) => void;","import * as React from 'react';\nimport { Data } from '../model';\nimport { ContextState } from '../db/context';\nimport _ from 'lodash';\n\nexport const ContextSelector: React.FC<{contextId: string|null, data: Data, onChange: (contextId: string|null) => void}> = (props) => {\n    const activeContexts = _.orderBy(props.data.contexts.filter(x => x.state === ContextState.Active), x => x.title);\n    const inactiveContexts = _.orderBy(props.data.contexts.filter(x => x.state !== ContextState.Active), x => x.title);\n\n    return (\n        <select className=\"input is-large\" value={props.contextId || ''} onChange={e => props.onChange(e.target.value)}>\n            <option value=\"\">Not set</option>\n            {activeContexts.map(c => (<option key={c.id} value={c.id}>{c.title}</option>))}\n            <option value=\"--inactive--\" disabled>-- Inactive</option>\n            {inactiveContexts.map(c => (<option key={c.id} value={c.id}>{c.title}</option>))}\n        </select>\n    );\n}","import * as React from 'react';\n\nexport function TagInput(props: { tags: string; availableTags: string[]; onChange: (tags: string) => void }) {\n    const [focus, setFocus] = React.useState(false)\n\n    const [tagState, setTagState] = React.useState(new TagState(props.availableTags, props.tags && props.tags.length > 0 ? props.tags.split(' ') : []))\n\n    const timeoutId = React.useRef<number|undefined>(undefined);\n    const tagInput = React.useRef<any>();\n\n    function onTextChange(e: React.ChangeEvent<HTMLInputElement>) {\n        onChange(tagState.withText(e.target.value))\n    }\n\n    function onChange(newTagState: TagState) {\n        setTagState(newTagState);\n        props.onChange(newTagState.getTags());\n    }\n\n    function onKeyPress(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'ArrowUp') {\n            onChange(tagState.decrementIndex());\n        } else if (e.key === 'ArrowDown') {\n            onChange(tagState.incrementIndex());\n        } else if (e.key === 'Enter') {\n            if (tagState.text === '') {\n                onChange(tagState.addSelectedTag());\n            } else {\n                onChange(tagState.addText());\n            }\n        } else if (e.key === 'Tab') {\n            onChange(tagState.addSelectedTag());\n            e.preventDefault();\n        } else if (e.key === 'Backspace') {\n            if (tagState.text === '') {\n                onChange(tagState.reopenLastTag());\n            }\n        }\n    }\n\n    function onClickTag(tag: string) {\n        onChange(tagState.addTag(tag));\n        tagInput.current.focus();\n    }\n\n    function onFocus() {\n        clearTimeout(timeoutId.current);\n\n        if(focus) {\n            return;\n        }\n\n        setFocus(true);\n    }\n\n    function onBlur() {\n        if(!focus) {\n            return;\n        }\n\n        timeoutId.current = setTimeout(() => {\n            setFocus(false);\n        }, 100) as any;\n    }\n\n    return (\n        <div className=\"tag-input\" onFocus={() => onFocus()} onBlur={() => onBlur()}>\n            <div className=\"tags\">\n                {tagState.selectedTags.map((t, i) => <Tag key={`tag-${t}-${i}`} name={t} />)}\n                <input ref={tagInput} placeholder=\"Tag\" type=\"text\" className=\"\" onChange={e => onTextChange(e)} onKeyDown={e => onKeyPress(e)} value={tagState.text} />\n            </div>\n            {focus && tagState.getFilteredAvailableTags().length > 0 &&\n                <div className=\"panel\">\n                    {tagState.getFilteredAvailableTags().slice(0, 10).map((t, i) => <div key={`available-tag-${t}`} style={tagState.index === i ? { background: '#078263'} : {}} onClick={() => onClickTag(t)}>{t}</div>)}\n                </div>\n            }\n        </div>\n    );\n}\n\nexport class TagState {\n    availableTags: string[];\n    selectedTags: string[];\n    text: string;\n    index: number;\n\n    constructor(availableTags: string[], selectedTags: string[], text = \"\", index = 0) {\n        this.availableTags = availableTags;\n        this.selectedTags = selectedTags;\n        this.text = text;\n        this.index = index;\n    }\n\n    withText(text: string) {\n        return new TagState(this.availableTags, this.selectedTags, text, this.index);\n    }\n\n    withAvailableTags(availableTags: string[]) {\n        return new TagState(availableTags, this.selectedTags, this.text, this.index);\n    }\n\n    withSelectedTags(selectedTags: string[]) {\n        return new TagState(this.availableTags, selectedTags, this.text, this.index);\n    }\n\n    decrementIndex() {\n        return new TagState(this.availableTags, this.selectedTags, this.text, Math.max(0, this.index - 1));\n    }\n\n    incrementIndex() {\n        return new TagState(this.availableTags, this.selectedTags, this.text, Math.max(0, Math.min(this.availableTags.length - 1, this.index + 1)));\n    }\n\n    addSelectedTag() {\n        return new TagState(this.availableTags, this.selectedTags.concat([this.getFilteredAvailableTags()[this.index]]), '', 0);\n    }\n\n    addTag(tag: string) {\n        return new TagState(this.availableTags, this.selectedTags.concat([tag]), '', 0);\n    }\n\n    addText() {\n        return new TagState(this.availableTags, this.selectedTags.concat([this.text]), '', 0);\n    }\n\n    reopenLastTag() {\n        const lastTag = this.selectedTags[this.selectedTags.length - 1];\n        return new TagState(this.availableTags, this.selectedTags.slice(0, this.selectedTags.length - 1), lastTag, 0);\n    }\n\n    getFilteredAvailableTags() {\n        return this.availableTags.filter(t => this.selectedTags.indexOf(t) === -1).filter(t => t.toLowerCase().indexOf(this.text) !== -1);\n    }\n\n    getTags() {\n        return this.selectedTags.join(' ');\n    }\n}\n\nexport const Tag: React.FC<{ name: string }> = props => {\n    return (\n        <div className=\"tag is-dark\">{props.name}</div>\n    );\n}\n\nexport const TagList: React.FC<{tags: string}> = props => {\n    return (\n        <div className=\"tags\" style={{marginBottom: 0}}>{props.tags && props.tags.split(' ').map((t, i) => <Tag key={i} name={t} />)}</div>\n    );\n}","import * as React from 'react';\nimport { ToolSection } from '../framework/ToolSection';\nimport { SimpleSplitEditor, SplitMode, SplitModeSelector, NoteModeSelector } from './SimpleSplitEditor';\nimport { isMobile } from './Layout';\nimport { getNoteTitle, Note } from '../db/note';\nimport { TreeEditor } from './TreeEditor';\nimport { SettingsCompactor } from './SettingsCompactor';\nimport './NoteEditor.scss';\nimport { ContextSelector } from '../components/ContextSelector';\nimport { Data } from '../model';\nimport moment from 'moment';\nimport { TagInput } from './TagInput';\n\nexport function NoteEditor(props: {note: Note, updateNote: (props: Partial<Note>) => void, onNoteAdded: () => void, availableTags: string[], data: Data}) {\n    const [splitMode, setSplitMode] = React.useState(isMobile() ? SplitMode.Editor : SplitMode.Split)\n\n    const updateDailyDate = (value: string) => {\n        if (value === '') {\n            props.updateNote({ dailyDate: null });\n        } else {\n            props.updateNote({ dailyDate: new Date(value).toISOString() });\n        }\n    }\n\n    return (\n        <div style={{width: '100%', flex: 1, display: 'flex', flexDirection: 'column'}}>\n            <ToolSection verticalAround={false}>\n                <SettingsCompactor wideStyle={{justifyContent: 'space-between'}} alwaysVisible={() => (\n                    <>\n                        <ContextSelector contextId={props.note.contextId} data={props.data} onChange={contextId => props.updateNote({ contextId })} />\n                        <input type=\"date\" className=\"input is-large\" value={(props.note.dailyDate && moment(props.note.dailyDate).format('YYYY-MM-DD')) || ''} onChange={e => updateDailyDate(e.target.value)} />\n                    </>\n                )}>\n                    <NoteModeSelector mode={props.note.mode || 'tree'} onModeChange={mode => props.updateNote({ mode })} />\n                    <SplitModeSelector mode={splitMode} onModeChange={splitMode => setSplitMode(splitMode)} />\n                </SettingsCompactor>\n            </ToolSection>\n            <ToolSection>\n                {!props.note.noteFor && !props.note.dailyDate && (\n                    <>\n                        <input type=\"text\" placeholder=\"Title\" className=\"input is-large is-wide\" value={props.note.title} onChange={e => props.updateNote({ title: e.target.value })} />\n                        <TagInput availableTags={props.availableTags} tags={props.note.tags} onChange={tags => props.updateNote({ tags })} />\n                    </>\n                )}\n                {props.note.dailyDate && (\n                    <h1>{getNoteTitle({ dailyDate: props.note.dailyDate, title: props.note.title, content: props.note.content })}</h1>\n                )}\n            </ToolSection>\n            <div style={{flex: 1}}>\n                {props.note.mode === 'markdown' ? (\n                    <SimpleSplitEditor text={props.note.content} expand={true} onTextChanged={content => props.updateNote({ content })} mode={splitMode} data={props.data} contextId={props.note.contextId} />\n                ) : (\n                    <TreeEditor text={props.note.content} onTextChanged={content => props.updateNote({ content })} contextId={props.note.contextId} />\n                )}\n            </div>\n        </div>\n    );\n}","import {history} from '../index';\nimport { Note } from './note';\nimport { db } from './db';\nimport {createInstance} from 'localforage';\n\nlet registered = false;\n\nfunction ensureRegister() {\n    if (registered) {\n        return;\n    }\n\n    history.listen(onNavigate);\n    registered = true;\n}\n\nconst store = createInstance({ name: `staging-note` });\n\nasync function processQueue() {\n    for(const key of await store.keys()) {\n        const note = await store.getItem<Note>(key);\n        await db.notes.save(note);\n        await store.removeItem(note.id);\n    }\n}\n\nprocessQueue();\n\nlet queuedPath: string|null = null;\nlet queuedNote: Note|null = null;\n\nasync function onNavigate(location: { pathname: string }, action: string) {\n    if (!queuedNote) {\n        return;\n    }\n\n    if (queuedPath === location.pathname) {\n        return;\n    }\n\n    await db.notes.save(queuedNote);\n    await store.removeItem(queuedNote.id);\n    queuedNote = null;\n}\n\nexport async function register(note: Note, hasChanges: boolean) {\n    ensureRegister();\n    if(hasChanges) {\n        queuedNote = note;\n        queuedPath = window.location.pathname;\n        await store.setItem(note.id, note);\n    } else {\n        queuedNote = null;\n        queuedPath = null;\n        await store.removeItem(note.id);\n    }\n};","import * as React from 'react';\nimport { NavLink, Redirect } from 'react-router-dom';\nimport { NoteEditor } from '../../components/NoteEditor';\nimport { useData } from '../../model';\nimport { ToolSection } from '../../framework/ToolSection';\nimport { useQueryState } from '../../lib/UseQueryState';\nimport * as styles from '../../layout/styles';\nimport { cx } from 'emotion';\nimport { Note } from '../../db/note';\nimport { db } from '../../db/db';\nimport { register } from '../../db/stagingArea';\nimport moment from 'moment';\n\nfunction useNote(pristineNote: Note): [Note, (props: Partial<Note>) => void, boolean] {\n    const [pristine] = React.useState(pristineNote);\n    const [note, setNote] = React.useState<Note>({...pristineNote});\n    const [hasChanges, setHasChanges] = React.useState(false);\n\n    function updateNote(props: Partial<Note>) {\n        const newNote = {...note, ...props};\n        const newHasChanges = JSON.stringify(pristine) !== JSON.stringify(newNote);\n        setHasChanges(newHasChanges);\n        setNote(newNote);\n        register(newNote, newHasChanges);\n    }\n\n    return [note, updateNote, hasChanges];\n}\n\nexport const EditNotePage: React.FC<{id?: string }> = props => {\n    const {data} = useData();\n    let tags: {[key: string]: number} = {};\n    const [goBack, setGoBack] = React.useState(false);\n    const [source] = useQueryState(null, 'source');\n\n    const urlParams = new URLSearchParams(window.location.search);\n    const title = urlParams.get('title');\n    const contextId = urlParams.get('context');\n    const daily = urlParams.has('daily');\n\n    const [note, updateNote] = useNote(data.notes.find(x => x.id === props.id) || db.notes.createUnsaved({ title: title || '', content: '', mode: 'tree', contextId, dailyDate: (daily && moment().format('YYYY-MM-DD')) || null, noteFor: null, tags: '' }));\n\n    if (goBack) {\n        return <Redirect to={source ? decodeURIComponent(source) : '/'} />;\n    }\n\n    for (const note of data.notes || []) {\n        if(!note.tags || !note.tags.length) {\n            continue;\n        }\n\n        for(const tag of note.tags.split(' ')) {\n            if(!tags[tag]) {\n                tags[tag] = 0;\n            }\n\n            tags[tag] += 1;\n        }\n    }\n\n    const availableTags = Object.keys(tags).sort((a, b) => tags[b] - tags[a]);\n\n    if (props.id) {\n        return (\n            <>\n                <div style={{height: '100%', display: 'flex', flexDirection: 'column'}}>\n                    <ToolSection>\n                        <div className={cx(styles.horizontalSpace('.5rem'))}>\n                            <NavLink to={source ? decodeURIComponent(source) : '/'} className=\"button\">Back</NavLink>\n                            {!note.noteFor && <NavLink to={`/notes/${note.id}`} className=\"button\">Show</NavLink>}\n                        </div>\n                    </ToolSection>\n                    <NoteEditor note={note} updateNote={updateNote} {...note} data={data} availableTags={availableTags} onNoteAdded={() => { setGoBack(true); }} />\n                </div>\n            </>\n        );\n    }\n\n    return (\n        <>\n            <div style={{height: '100%', display: 'flex', flexDirection: 'column'}} >\n                <ToolSection>\n                    <NavLink to={`/`} className=\"button\">Back</NavLink>\n                </ToolSection>\n                <NoteEditor note={note} updateNote={updateNote} availableTags={availableTags} data={data} onNoteAdded={() => { setGoBack(true); }} />\n            </div>\n        </>\n    );\n}","import * as React from 'react';\nimport { useState } from 'react';\nimport { MarkedViewer } from './MarkedViewer';\n\nimport \"ace-builds/src-noconflict/mode-markdown\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport { Loader } from './Loader';\nimport { getNoteReferenceMatchRegExp, getNoteAliasReferenceMatchRegExp } from '../db/note';\n\ninterface Node {\n    text: string;\n    nodes: Node[];\n}\n\nexport const TreeViewer: React.FC<{ json: string, contextId: string|null, referenceTitle?: string, personAlias?: string }> = (props) => {\n    const [nodes, setNodes] = useState<Node[]|null>(null);\n    const [invalid, setInvalid] = useState(false);\n\n    React.useEffect(() => {\n        try {\n            let nodes = [];\n            if (props.json) {\n                nodes = JSON.parse(props.json)\n            }\n            setNodes(nodes);\n        } catch {\n            setInvalid(true);\n        }\n    }, [props.json]);\n\n    if (invalid) {\n        return <div>Invalid json</div>;\n    }\n\n    if (!nodes) {\n        return <Loader />;\n    }\n\n    const renderNode = (node: Node, index: number, level: number, filter: RegExp|null) => {\n        const extra: JSX.Element[] = [];\n        if (filter) {\n            if (filter.test(node.text)) {\n                filter = null;\n                if (level > 0) {\n                    extra.push(<div key={`extra-${index}-${level}`} style={{paddingTop: 8, color: '#aaa'}}>{'... > '.repeat(level)}</div>)\n                }\n            } else {\n                return (\n                    <React.Fragment key={`${level}-${index}`}>\n                        {node.nodes.map((n, i) => renderNode(n, i, level + 1, filter))}\n                    </React.Fragment>\n                );\n            }\n        }\n\n        return (\n            <React.Fragment key={`${level}-${index}`}>\n                {extra}\n                <div style={{display: 'flex', padding: '.6rem .8rem'}}>\n                    <div style={{letterSpacing: '.5rem', color: '#777', lineHeight: 1.5}}></div>\n                    <MarkedViewer markdown={node.text} contextId={props.contextId} />\n                </div>\n                <div style={{borderLeft: '1px solid #555', paddingLeft: 16, marginLeft: 16}}>\n                    {node.nodes.map((n, i) => renderNode(n, i, level + 1, filter))}\n                </div>\n            </React.Fragment>\n        );\n    };\n\n    let referenceRegExp = props.referenceTitle ? getNoteReferenceMatchRegExp(props.referenceTitle) : null;\n\n    if (props.personAlias) {\n        referenceRegExp = getNoteAliasReferenceMatchRegExp(props.personAlias);\n    }\n\n    return (\n        <div style={{display: 'flex', flexDirection: 'column', justifyContent: 'space-between', height: '100%'}}>\n            <div style={{width: '100%'}}>\n                {nodes.map((n, i) => renderNode(n, i, 0, referenceRegExp))}\n            </div>\n        </div>\n    );\n};","import * as React from 'react';\nimport { useData } from '../model';\nimport { MarkedViewer } from './MarkedViewer';\nimport { getNoteTitle, getNoteReferenceMatchRegExp, getNoteAliasReferenceMatchRegExp } from '../db/note';\nimport { Link } from 'react-router-dom';\nimport * as _ from 'lodash';\nimport { TreeViewer } from './TreeViewer';\n\nexport const ReferenceViewer: React.FC<{ title: string, contextId: string|null }> = (props) => {\n    const {data} = useData();\n    const referenceRegExp = getNoteReferenceMatchRegExp(props.title);\n    const contextNotes = _.orderBy(data.notes.filter(x => x.contextId === props.contextId && referenceRegExp.test(x.content)), x => x.updatedAt, 'desc');\n\n    if (contextNotes.length === 0) {\n        return null;\n    }\n\n    return (\n        <div style={{paddingTop: 32}}>\n            <div style={{fontWeight: 'bold'}}>{contextNotes.length} linked references for \"{props.title}\"</div>\n            {contextNotes.map(note => (\n                <div key={note.id} style={{marginTop: 16}}>\n                    <Link to={`/notes/${note.id}`} style={{color: '#078263'}}>{getNoteTitle(note)}</Link>\n                    <div style={{paddingLeft: 16, background: '#222', marginTop: 8}}>\n                        {note.mode === 'markdown' \n                        ? <MarkedViewer markdown={note.content} contextId={note.contextId} /> \n                        : <TreeViewer json={note.content} contextId={note.contextId} referenceTitle={props.title} />}\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n};\n\nexport const PersonReferenceViewer: React.FC<{ alias: string }> = (props) => {\n    const {data} = useData();\n    const referenceRegExp = getNoteAliasReferenceMatchRegExp(props.alias);\n    const matchingNotes = _.orderBy(data.notes.filter(x => referenceRegExp.test(x.content)), x => x.updatedAt, 'desc');\n\n    if (matchingNotes.length === 0) {\n        return null;\n    }\n\n    return (\n        <div style={{paddingTop: 32}}>\n            <div style={{fontWeight: 'bold'}}>{matchingNotes.length} linked references for \"{props.alias}\"</div>\n            {matchingNotes.map(note => (\n                <div key={note.id} style={{marginTop: 16}}>\n                    <Link to={`/notes/${note.id}`} style={{color: '#078263'}}>{getNoteTitle(note)}</Link>\n                    <div style={{paddingLeft: 16, background: '#222', marginTop: 8}}>\n                        {note.mode === 'markdown' \n                        ? <MarkedViewer markdown={note.content} contextId={note.contextId} /> \n                        : <TreeViewer json={note.content} contextId={note.contextId} personAlias={props.alias} />}\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n};","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { MarkedViewer } from '../../components/MarkedViewer';\nimport { ReferenceViewer } from '../../components/ReferenceViewer';\nimport { useData } from '../../model';\nimport { ToolSection } from '../../framework/ToolSection';\nimport { useQueryState } from '../../lib/UseQueryState';\nimport { TagList } from '../../components/TagInput';\nimport { ContextTag } from '../../components/ContextTag';\nimport { getNoteTitle } from '../../db/note';\nimport { TreeViewer } from '../../components/TreeViewer';\n\nexport const ShowNotePage: React.SFC<{id: string}> = (props) => {\n    const {data} = useData();\n    const [source] = useQueryState(null, 'source');\n    const note = data.notes.find(x => x.id === props.id);\n\n    if (!note) {\n        return <div>Note not found.</div>\n    }\n\n    let viewer = null;\n\n    if (!note.mode || note.mode === 'markdown') {\n        viewer = <MarkedViewer markdown={note.content} contextId={note.contextId} />;\n    } else {\n        viewer = <TreeViewer json={note.content} contextId={note.contextId} />;\n    }\n\n    return (\n        <>\n            <ToolSection>\n                <NavLink to={source ? decodeURIComponent(source) : '/'} className=\"button\">Back</NavLink>\n                <NavLink to={`/notes/${note.id}/edit`} className=\"button\">Edit</NavLink>\n            </ToolSection>\n            <div className=\"panel\">\n                <div className=\"content\" style={{padding: '1rem'}}>\n                    <h1>{getNoteTitle(note)}</h1>\n                    <div style={{display: 'flex', justifyContent: 'space-between'}}>\n                        <TagList tags={note.tags} />\n                        <ContextTag contextId={note.contextId} />\n                    </div>\n                    {viewer}\n                    <ReferenceViewer title={getNoteTitle(note)} contextId={note.contextId} />\n                </div>\n            </div>\n        </>\n    );\n}\n\nexport const ShowVirtualNotePage: React.SFC<{}> = (props) => {\n    const [source] = useQueryState(null, 'source');\n\n    const urlParams = new URLSearchParams(window.location.search);\n    const title = urlParams.get('title');\n    const contextId = urlParams.get('context');\n\n    if(!title) {\n        return <div>Note not found.</div>\n    }\n\n    return (\n        <>\n            <ToolSection>\n                <NavLink to={source ? decodeURIComponent(source) : '/'} className=\"button\">Back</NavLink>\n                <NavLink to={`/notes/new?title=${encodeURIComponent(title)}${contextId ? `&context=${contextId}` : ''}&source=${encodeURIComponent(`${window.location.pathname}`)}`} className=\"button\">Create</NavLink>\n            </ToolSection>\n            <div className=\"panel\">\n                <div className=\"content\" style={{padding: '1rem'}}>\n                    <h1>{title}</h1>\n                    <div style={{display: 'flex', justifyContent: 'space-between'}}>\n                        <ContextTag contextId={contextId} />\n                    </div>\n                    <ReferenceViewer title={title} contextId={contextId} />\n                </div>\n            </div>\n        </>\n    );\n}","import * as React from 'react';\n\ninterface ListProps<T> {\n    renderItem: (item: T) => JSX.Element;\n    items: T[];\n}\n\nexport function List<T>(props: ListProps<T>) {\n    return (\n        <div className=\"list\">\n            {props.items.map(props.renderItem)}\n        </div>\n    );\n}","import * as React from 'react';\nimport moment from 'moment';\nimport { TagList } from '../../components/TagInput';\nimport { NavLink } from 'react-router-dom';\nimport lunr from 'lunr';\nimport { debounce } from 'throttle-debounce';\nimport { useData } from '../../model';\nimport * as styles from '../../layout/styles';\nimport { ToolSection } from '../../framework/ToolSection';\nimport { getNoteTitle, extractAllReferences } from '../../db/note';\nimport { List } from '../../framework/List';\nimport { isMobile } from '../../components/Layout';\nimport { useQueryState, useQueryStateT, useQueryStateBoolean } from '../../lib/UseQueryState';\nimport { SettingsCompactor } from '../../components/SettingsCompactor';\nimport { ContextTag } from '../../components/ContextTag';\nimport _ from 'lodash';\nimport { Loader } from '../../components/Loader';\nimport { cx } from 'emotion';\nimport { ContextState } from '../../db/context';\n\nexport function NotePage() {\n    const {data} = useData();\n    const [text, setText] = useQueryState(null, 'search');\n    const [filterTags, setFilterTags] = useQueryStateT<string[]>([], 'tags', s => s !== null ? s.split('|') : [], a => a.join('|'));\n    const [showTagsBar, setShowTagsBar] = React.useState(!isMobile());\n    const [searchResult, setSearchResult] = React.useState<{ id: string, score: number }[]|null>(null);\n    const [searchIndex, setSearchIndex] = React.useState<lunr.Index|null>(null);\n    const [showNotesFor, setShowNotesFor] = React.useState(false);\n    const [showNoContext, setShowNoContext] = useQueryStateBoolean(false, 'no-context');\n    const [virtualReferences, setVirtualReferences] = React.useState<{ title: string, contextId: string|null, updatedAt: Date }[]>();\n    const [inactiveContexts, setInactiveContexts] = React.useState<string[]>([]);\n\n    React.useEffect(() => {\n        const refs = extractAllReferences(data.notes);\n        setVirtualReferences(refs);\n    }, [data.notes]);\n\n    React.useEffect(() => {\n        setInactiveContexts(data.contexts.filter(c => c.state === ContextState.Inactive).map(c => c.id));\n    }, [data.contexts]);\n\n    const onSearch = (text: string) => {\n        if (!text || !text.length) {\n            setSearchResult(null);\n            return;\n        }\n\n        if (searchIndex === null) {\n            const idx = lunr(function() {\n                this.field('title');\n                this.field('text');\n    \n                for(let note of data.notes) {\n                    this.add({\n                        id: note.id,\n                        title: note.title,\n                        text: note.content\n                    });\n                }\n            });\n\n            setSearchIndex(idx);\n            const result = idx.search(text);\n            setSearchResult(result.map(r => { return { id: r.ref, score: r.score }; }));\n            return;\n        }\n\n        const result = searchIndex.search(text);\n        setSearchResult(result.map(r => { return { id: r.ref, score: r.score }; }));\n    };\n\n    const debouncedSearch = debounce(100, onSearch);\n\n    const toggleTag = (tag: string) => {\n        if (filterTags.indexOf(tag) === -1) {\n            setFilterTags(filterTags.concat([ tag ]));\n        } else {\n            setFilterTags(filterTags.filter(x => x !== tag));\n        }\n    }\n\n    let notes = data.notes || [];\n    let tags: {[key: string]: number} = {};\n\n    for(const tag of filterTags) {\n        notes = notes.filter(x => x.tags.split(' ').indexOf(tag) !== -1);\n    }\n\n    if (!showNotesFor) {\n        notes = notes.filter(x => !x.noteFor);\n    }\n\n    if (showNoContext) {\n        notes = notes.filter(x => !x.contextId);\n    }\n\n    notes = notes.filter(x => !x.contextId || inactiveContexts.indexOf(x.contextId) === -1)\n\n    if (searchResult) {\n        notes = searchResult.map(r => {\n            let idx =  notes.findIndex(n => n.id === r.id);\n            return notes[idx];\n        }).filter(n => n);\n    }\n\n    for (const note of notes) {\n\n        if(!note.tags) {\n            continue;\n        }\n\n        for(const tag of note.tags.split(' ')) {\n            if(!tags[tag]) {\n                tags[tag] = 0;\n            }\n\n            tags[tag] += 1;\n        }\n    }\n\n    const tagCounts = Object.keys(tags).map(k => { return { key: k, count: tags[k], active: filterTags.indexOf(k) !== -1 }; }).sort((a, b) => b.count - a.count);\n\n    let source: string|null = null;\n    if (window.location.search.length) {\n        const urlParams = new URLSearchParams(window.location.search);\n        source = `?source=${encodeURIComponent(`${window.location.pathname}?${urlParams.toString()}`)}`\n    }\n\n    if(!virtualReferences) {\n        return <Loader />;\n    }\n\n    interface NoteOutput {\n        id: string|null;\n        title: string;\n        tags: string|null;\n        contextId: string|null;\n        updatedAt: Date;\n        url: string;\n        isRef: boolean;\n    }\n\n    const notesOutput: NoteOutput[] = notes.map(n => ({\n        id: n.id,\n        title: getNoteTitle(n),\n        tags: n.tags,\n        contextId: n.contextId,\n        updatedAt: new Date(n.updatedAt),\n        url: `/notes/${n.id}${source ? source : ''}`,\n        isRef: false\n    }));\n\n    let virtualReferencesOutput: NoteOutput[] = [];\n    \n    if(!searchResult) {\n        virtualReferencesOutput = virtualReferences.map(v => ({\n            id: null,\n            title: v.title,\n            tags: null,\n            contextId: v.contextId,\n            updatedAt: v.updatedAt,\n            url: `/notes/virtual?title=${encodeURIComponent(v.title)}${v.contextId ? `&context=${v.contextId}` : ''}&source=${encodeURIComponent(`${window.location.pathname}`)}`,\n            isRef: true\n        }));\n    }\n\n    virtualReferencesOutput = virtualReferencesOutput.filter(x => !x.contextId || inactiveContexts.indexOf(x.contextId) === -1)\n\n    const output = _.orderBy(notesOutput.concat(virtualReferencesOutput), o => o.updatedAt, 'desc');\n\n    return (\n        <div style={{display: 'flex', height: '100%'}}>\n            {showTagsBar && <div style={{borderRight: '1px solid #666', width: 200}}>\n                <List<{key: string, count: Number, active: boolean}> items={tagCounts} renderItem={i => {\n                    return (\n                        <div key={i.key} style={{background: i.active ? '#444' : undefined}} onClick={() => toggleTag(i.key)} className={cx('item', styles.hoverGlow)}>{i.key} <span style={{color: '#999'}}>{i.count}</span></div>\n                    );\n                }} />\n            </div>}\n            <div style={{width: '100%'}}>\n                <ToolSection>\n                    <SettingsCompactor alwaysVisible={() => (\n                        <>\n                            <NavLink to={`/notes/new`} className=\"button\">New Note</NavLink>\n                        </>\n                    )}>\n                        <div>\n                            <input id=\"tags-box\" type=\"checkbox\" checked={showTagsBar} onChange={() =>setShowTagsBar(!showTagsBar)} />\n                            <label htmlFor=\"tags-box\">Show tags bar</label>\n                        </div>\n                        <div>\n                            <input id=\"show-notes-for-box\" type=\"checkbox\" checked={showNotesFor} onChange={() =>setShowNotesFor(!showNotesFor)} />\n                            <label htmlFor=\"show-notes-for-box\">Show notes for</label>\n                        </div>\n                        <div>\n                            <input id=\"show-no-context-box\" type=\"checkbox\" checked={showNoContext} onChange={() =>setShowNoContext(!showNoContext)} />\n                            <label htmlFor=\"show-no-context-box\">Show no context</label>\n                        </div>\n                    </SettingsCompactor>\n                    <input style={{fontSize: 16, padding: '.3rem', width: '100%'}} placeholder=\"Search...\" type=\"text\" value={text || ''} onChange={e => { setText(e.target.value); debouncedSearch(e.target.value); }}/>\n                </ToolSection>\n                <div className=\"list\">\n                    {output.map((n, i) => (\n                        <React.Fragment key={i}>\n                            <NavLink to={n.url} className={cx('item', 'note', styles.hoverGlow)} style={{color: n.isRef ? '#aaa' : undefined}}>\n                                <div className=\"note-title\">\n                                    <div>{n.title}</div>\n                                </div> \n                                <div className=\"note-details\">\n                                    <TagList tags={n.tags || ''} />\n                                    <div className=\"tags\">\n                                        <ContextTag contextId={n.contextId} />\n                                    </div>\n                                    <div className=\"note-date\">{moment(n.updatedAt).format('ddd MMM Do HH:mm')}</div>\n                                </div>\n                            </NavLink>\n                        </React.Fragment>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import * as React from 'react';\nimport { ToolSection } from '../framework/ToolSection';\nimport { extractAllReferences } from '../db/note';\nimport { useData } from '../model';\n\nexport const PlaygroundPage: React.FC<{}> = () => {\n    \n    const {data} = useData();\n\n    console.log(extractAllReferences(data.notes));\n    \n    return (\n        <div style={{height: '100%'}}>\n            <ToolSection>\n            </ToolSection>\n        </div>\n    );\n}","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport * as styles from '../layout/styles';\nimport { ToolSection } from '../framework/ToolSection';\nimport { Context, ContextState } from '../db/context';\nimport { db } from '../db/db';\nimport { useData } from '../model';\nimport { cx } from 'emotion';\nimport { getVariable } from '../layout/theme';\n\nexport const ContextPage: React.FC<{ }> = props => {\n    const {data} = useData();\n\n    const [text, setText] = React.useState('');\n\n    async function onKeyPress(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'Enter') {\n            await db.contexts.create({\n                title: text,\n                state: ContextState.Active,\n                contextId: null\n            });\n\n            setText('');\n        }\n    }\n\n    function renderTarget(target: Context) {\n        return (\n            <NavLink key={target.id} to={`/contexts/${target.id}`} className={cx('item', styles.hoverGlow)}>\n                <div>\n                    {target.title}\n                </div>\n            </NavLink>\n        );\n    }\n\n    return (\n        <>\n            <ToolSection>\n                <input type=\"text\" className=\"input is-large is-wide\" placeholder=\"Add context...\" value={text} onChange={e => setText(e.target.value)} onKeyPress={onKeyPress} />\n            </ToolSection>\n\n            <div className=\"list\">\n                <div className=\"header\" style={{background: getVariable('--task-context-background')}}>Active</div>\n                {data.contexts.filter(p => !p.state || p.state === ContextState.Active).sort((a, b) =>  b.title! < a.title! ?  -1 : b.title! > a.title! ? 1 : 0).map(t => renderTarget(t))}\n                <div className=\"header\" style={{background: getVariable('--task-context-background')}}>Not Active</div>\n                {data.contexts.filter(p => p.state === ContextState.Inactive).sort((a, b) =>  b.title! < a.title! ?  -1 : b.title! > a.title! ? 1 : 0).map(t => renderTarget(t))}\n            </div>\n        </>\n    );\n}\n","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport * as styles from '../layout/styles';\nimport { Data } from '../model';\nimport { ToolSection } from '../framework/ToolSection';\nimport { ProjectState, Project } from '../db/project';\nimport { db } from '../db/db';\nimport { ContextTag } from '../components/ContextTag';\nimport { cx } from 'emotion';\nimport { getVariable } from '../layout/theme';\n\nexport class ProjectPage extends React.Component<{ data: Data, refreshData: () => void }, { text: string }> {\n    constructor(props: any) {\n        super(props);\n\n        this.state = {\n            text: ''\n        };\n    } \n    \n    async onKeyPress(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'Enter') {\n            await db.projects.create({\n                title: this.state.text,\n                state: ProjectState.Active,\n                contextId: null\n            });\n            this.setState({ text: '' }, this.props.refreshData);\n        }\n    }\n\n    renderProject(target: Project) {\n        return (\n            <NavLink key={target.id} to={`/projects/${target.id}`} className={cx('item', styles.hoverGlow)}>\n                <div>\n                    {target.title}\n                </div>\n                <div className=\"tags\">\n                    <div className=\"tag\">{target.state}</div>\n                    <ContextTag contextId={target.contextId} />\n                </div>\n            </NavLink>\n        );\n    }\n\n    render() {\n        return (\n            <>\n                <ToolSection>\n                    <input type=\"text\" className=\"input is-large is-wide\" placeholder=\"Add project...\" value={this.state.text} onChange={e => this.setState({ text: e.target.value })} onKeyPress={this.onKeyPress.bind(this)} />\n                </ToolSection>\n\n                <div className=\"list\">\n                    <div className=\"header\" style={{background: getVariable('--task-project-background')}}>Active</div>\n                    {this.props.data.projects.filter(p => !p.state || p.state === ProjectState.Active).sort((a, b) =>  b.title! < a.title! ?  -1 : b.title! > a.title! ? 1 : 0).map(t => this.renderProject(t))}\n                    <div className=\"header\"  style={{background: getVariable('--task-project-background')}}>Incubated</div>\n                    {this.props.data.projects.filter(p => !p.state || p.state === ProjectState.Incubated).sort((a, b) =>  b.title! < a.title! ?  -1 : b.title! > a.title! ? 1 : 0).map(t => this.renderProject(t))}\n                    <div className=\"header\"  style={{background: getVariable('--task-project-background')}}>Not Active</div>\n                    {this.props.data.projects.filter(p => p.state !== ProjectState.Active && p.state !== ProjectState.Incubated).sort((a, b) =>  b.title! < a.title! ?  -1 : b.title! > a.title! ? 1 : 0).map(t => this.renderProject(t))}\n                </div>\n            </>\n        );\n    }\n}\n","import * as React from 'react';\nimport { useData } from '../model';\nimport { db } from '../db/db';\nimport { Person } from '../db/person';\nimport { NavLink } from 'react-router-dom';\nimport { MarkedViewer } from './MarkedViewer';\nimport { Task } from '../db/task';\nimport { HasNote } from '../db/note';\nimport { TreeViewer } from './TreeViewer';\n\nexport const EmbeddedNoteEdit: React.FC<{ targetEntity: Person|Task|null }> = (props) => {\n    const {data} = useData();\n\n    if (!props.targetEntity) {\n        return null;\n    }\n\n    const {noteId} = props.targetEntity;\n\n    const addNode = async () => {\n        if (!props.targetEntity) {\n            return;\n        }\n\n        const note = await db.notes.create({\n            title: '',\n            content: '',\n            tags: '',\n            contextId: null,\n            noteFor: {\n                type: props.targetEntity.type,\n                id: props.targetEntity.id,\n            },\n            mode: 'tree',\n            dailyDate: null\n        });\n\n        if (props.targetEntity.type === 'person') {\n            props.targetEntity.noteId = note.id;\n            await db.people.save(props.targetEntity);\n        }\n\n        if (props.targetEntity.type === 'task') {\n            props.targetEntity.noteId = note.id;\n            await db.tasks.save(props.targetEntity);\n        }\n    };\n\n    if (!noteId) {\n        return (\n            <div>\n                <div className=\"button\" onClick={addNode}>Add note</div>\n            </div>\n        );\n    }\n\n    const note = data.notes.find(x => x.id === noteId);\n\n    if (!note) {\n        return null;\n    }\n\n    return (\n        <div>\n            <NavLink to={`/notes/${note.id}/edit?source=${encodeURIComponent(`${window.location.pathname}`)}`} className=\"button\">Edit note</NavLink>\n            {!note.mode || note.mode === 'markdown' ? (\n                <MarkedViewer markdown={note.content} contextId={note.contextId} />\n            ) : (\n                <TreeViewer json={note.content} contextId={note.contextId} />\n            )}\n        </div>\n    )\n};\n\nexport const EmbeddedNoteShow: React.FC<{ targetEntity: HasNote|null }> = (props) => {\n    const {data} = useData();\n\n    if (!props.targetEntity) {\n        return null;\n    }\n\n    const {noteId} = props.targetEntity;\n    if (!noteId) {\n        return null;\n    }\n\n    const note = data.notes.find(x => x.id === noteId);\n\n    if (!note) {\n        return null;\n    }\n\n    return (\n        <div>\n            {!note.mode || note.mode === 'markdown' ? (\n                <MarkedViewer markdown={note.content} contextId={note.contextId} />\n            ) : (\n                <TreeViewer json={note.content} contextId={note.contextId} />\n            )}\n        </div>\n    )\n};","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { Data } from '../model';\nimport { ToolSection } from '../framework/ToolSection';\nimport { Task, TaskState } from '../db/task';\nimport { db } from '../db/db';\nimport { ProjectState } from '../db/project';\nimport moment from 'moment';\nimport * as styles from '../layout/styles';\nimport { EmbeddedNoteEdit } from '../components/EmbeddedNote';\nimport { cx } from 'emotion';\n\nexport class ShowTaskPage extends React.Component<{ data: Data, id: string, refreshData(): void }, { title: string, source: string }> {\n\n    constructor(props: any) {\n        super(props);\n\n        this.state = {\n            title: '',\n            source: '/tasks'\n        }\n    }\n\n    componentDidMount() {\n        const urlParams = new URLSearchParams(window.location.search);\n\n        let task = this.props.data.tasks.find(x => x.id === this.props.id);\n        this.setState({ title: task!.title }, () => {\n            if (urlParams.has('source')) {\n                this.setState({ source: decodeURIComponent(urlParams.get('source')!)});\n            }\n        });\n    }\n\n    async setContext(task: Task, event: React.ChangeEvent<HTMLSelectElement>) {\n        let contextId: string|null = event.target.value;\n\n        if (contextId === '') {\n            contextId = null;\n        }\n\n        task.contextId = contextId;\n        await db.tasks.save(task);\n        this.props.refreshData();\n    }\n\n    async setProject(task: Task, event: React.ChangeEvent<HTMLSelectElement>) {\n        let projectId: string|null = event.target.value;\n\n        if (projectId === '') {\n            projectId = null;\n        }\n\n        task.projectId = projectId;\n        await db.tasks.save(task);\n        this.props.refreshData();\n    }\n\n    async setDefer(task: Task, event: React.ChangeEvent<HTMLInputElement>) {\n        let value: string|null = event.target.value;\n\n        if (value === '') {\n            task.deferredUntil = null;\n        } else {\n            task.deferredUntil = new Date(value).toISOString();\n        }\n\n        await db.tasks.save(task);\n        this.props.refreshData();\n    }\n\n    async onKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'Enter') {\n            let task = this.props.data.tasks.find(x => x.id === this.props.id);\n\n            if (!task) {\n                return;\n            }\n\n            if (task.title !== this.state.title) {\n                task.title = this.state.title;\n                await db.tasks.save(task);\n                this.props.refreshData();\n            }\n        }\n    }\n\n    async setTaskState(state: TaskState) {\n        const task = this.props.data.tasks.find(x => x.id === this.props.id);\n\n        if (!task) {\n            return;\n        }\n\n        if (task.state === state) {\n            return;\n        }\n\n        task.state = state;\n        task.stateChangedAt = new Date().toISOString();\n        await db.tasks.save(task);\n        this.props.refreshData();\n    }\n\n    render() {\n        let task = this.props.data.tasks.find(x => x.id === this.props.id);\n\n        if (!task) {\n            return <div>Task not found.</div>\n        }\n\n        let isDirty = false;\n\n        if (task.title !== this.state.title) {\n            isDirty = true;\n        }\n\n        return (\n            <>\n                <ToolSection>\n                    <NavLink to={this.state.source} className=\"button\">Back</NavLink>\n                    {/* <NavLink to={`/tasks/${task.id}/edit`} className=\"button\">Edit</NavLink> */}\n                </ToolSection>\n\n                <ToolSection>\n                    <div>Task</div>\n                    <input type=\"text\" className=\"input is-large is-wide\" style={{border: isDirty ? '2px solid orange' : undefined}} value={this.state.title} onKeyDown={e => this.onKeyDown(e)} onChange={e => this.setState({ title: e.target.value })} />\n\n                    <div>State</div>\n                    <div className={cx(styles.horizontalSpace('.5rem'))}>\n                        <div className={cx('button', task.state !== 'active' ? 'inactive' : null)} onClick={() => this.setTaskState('active')}>Active</div>\n                        <div className={cx('button', task.state !== 'incubated' ? 'inactive' : null)} onClick={() => this.setTaskState('incubated')}>Incubated</div>\n                        <div className={cx('button', task.state !== 'completed' ? 'inactive' : null)} onClick={() => this.setTaskState('completed')}>Completed</div>\n                    </div>\n\n                    <div>Context</div>\n                    <select className=\"input is-large\" value={task.contextId || ''} onChange={e => this.setContext(task!, e)}>\n                        <option value=\"\">Not set</option>\n                        {this.props.data.contexts.map(c => (\n                            <option key={c.id} value={c.id}>{c.title}</option>\n                        ))}\n                    </select>\n\n                    <div>Project</div>\n                    <select className=\"input is-large\" value={task.projectId || ''} onChange={e => this.setProject(task!, e)}>\n                        <option value=\"\">Not set</option>\n                        {this.props.data.projects.filter(p => p.state === ProjectState.Active || p.id === task!.projectId).map(c => (\n                            <option key={c.id} value={c.id}>{c.title}</option>\n                        ))}\n                    </select>\n\n                    <div>Defer</div>\n                    <input type=\"date\" className=\"input is-large\" value={(task.deferredUntil && moment(task.deferredUntil).format('YYYY-MM-DD')) || ''} onChange={e => this.setDefer(task!, e)} />\n                </ToolSection>\n\n                <ToolSection>\n                    <EmbeddedNoteEdit targetEntity={task} {...this.props} />\n                </ToolSection>\n            </>\n        );\n    }\n}","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { Data } from '../model';\nimport { ToolSection } from '../framework/ToolSection';\nimport { Project, ProjectState } from '../db/project';\nimport { db } from '../db/db';\nimport { Loader } from '../components/Loader';\nimport { ContextSelector } from '../components/ContextSelector';\n\nexport class ShowProjectPage extends React.Component<{ data: Data, refreshData: () => void, id: string }, { title: string }> {\n    constructor(props: any) {\n        super(props);\n\n        this.state = {\n            title: '',\n        }\n    }\n\n    componentDidMount() {\n        let target = this.props.data.projects.find(x => x.id === this.props.id);\n        this.setState({title: target!.title});\n    }\n\n    async setContext(target: Project, contextId: string|null) {\n        if (contextId === '') {\n            contextId = null;\n        }\n\n        target.contextId = contextId;\n        await db.projects.save(target);\n        this.props.refreshData();\n    }\n\n    async setProjectState(target: Project, event: React.ChangeEvent<HTMLSelectElement>) {\n        let projectState: ProjectState = event.target.value as ProjectState;\n\n        target.state = projectState;\n        await db.projects.save(target);\n        this.props.refreshData();\n    }\n\n    async onKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'Enter') {\n            let target = this.props.data!.projects.find(x => x.id === this.props.id);\n\n            if (!target) {\n                return;\n            }\n\n            if (target.title !== this.state.title) {\n                target.title = this.state.title;\n                await db.projects.save(target);\n                this.props.refreshData();\n            }\n        }\n    }\n\n    render() {\n        if (this.props.data === null) {\n            return <Loader />;\n        }\n\n        let target = this.props.data.projects.find(x => x.id === this.props.id);\n\n        if (!target) {\n            return <div>Project not found.</div>\n        }\n\n        let isDirty = false;\n\n        if (target.title !== this.state.title) {\n            isDirty = true;\n        }\n\n        return (\n            <>\n                <ToolSection>\n                    <NavLink to={`/projects`} className=\"button\">Back</NavLink>\n                </ToolSection>\n\n                <ToolSection>\n                    <div>Project</div>\n                    <input type=\"text\" className=\"input is-large is-wide\" style={{border: isDirty ? '2px solid orange' : undefined}} value={this.state.title} onKeyDown={e => this.onKeyDown(e)} onChange={e => this.setState({ title: e.target.value })} />\n                    \n                    <div>Context</div>\n                    <ContextSelector contextId={target.contextId} onChange={e => this.setContext(target!, e)} data={this.props.data} />\n                    <div>State</div>\n                    <select className=\"input is-large\" value={target.state || ProjectState.Active} onChange={e => this.setProjectState(target!, e)}>\n                        {Object.keys(ProjectState).map(c => (\n                            <option key={c} value={c}>{c}</option>\n                        ))}\n                    </select>\n\n                </ToolSection>\n\n            </>\n        );\n    }\n}","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { Data } from '../model';\nimport { ToolSection } from '../framework/ToolSection';\nimport { Context, ContextState } from '../db/context';\nimport { db } from '../db/db';\n\nexport class ShowContextPage extends React.Component<{id: string, data: Data, refreshData(): void }, { title: string }> {\n\n    constructor(props: any) {\n        super(props);\n\n        this.state = {\n            title: '',\n        }\n    }\n\n    componentDidMount() {\n        let target = this.props.data.contexts.find(x => x.id === this.props.id);\n        this.setState({ title: target!.title })\n    }\n\n    async onKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'Enter') {\n            const target = this.props.data.contexts.find(x => x.id === this.props.id);\n\n            if (!target) {\n                return;\n            }\n\n            if (target.title !== this.state.title) {\n                target.title = this.state.title;\n                await db.contexts.save(target);\n                this.props.refreshData();\n            }\n        }\n    }\n\n    async setContext(target: Context, event: React.ChangeEvent<HTMLSelectElement>) {\n        let contextId: string|null = event.target.value;\n\n        if (contextId === '') {\n            contextId = null;\n        }\n\n        target.contextId = contextId;\n        await db.contexts.save(target);\n        this.props.refreshData();\n    }\n\n    async setContextState(target: Context, event: React.ChangeEvent<HTMLSelectElement>) {\n        let contextState: ContextState = event.target.value as ContextState;\n\n        target.state = contextState;\n        await db.contexts.save(target);\n        this.props.refreshData();\n    }\n\n    render() {\n        let target = this.props.data.contexts.find(x => x.id === this.props.id);\n\n        if (!target) {\n            return <div>Context not found.</div>\n        }\n\n        let isDirty = false;\n\n        if (target.title !== this.state.title) {\n            isDirty = true;\n        }\n\n        return (\n            <>\n                <ToolSection>\n                    <NavLink to={`/contexts`} className=\"button\">Back</NavLink>\n                </ToolSection>\n\n                <ToolSection>\n                    <div>Context</div>\n                    <input type=\"text\" className=\"input is-large is-wide\" style={{border: isDirty ? '2px solid orange' : undefined}} value={this.state.title} onKeyDown={e => this.onKeyDown(e)} onChange={e => this.setState({ title: e.target.value })} />\n\n                    <div>Parent Context</div>\n                    <select className=\"input is-large\" value={target.contextId || ''} onChange={e => this.setContext(target!, e)}>\n                        <option value=\"\">Not set</option>\n                        {this.props.data.contexts.filter(c => c.id !== target!.id).map(c => (\n                            <option key={c.id} value={c.id}>{c.title}</option>\n                        ))}\n                    </select>\n\n                    <div>State</div>\n                    <select className=\"input is-large\" value={target.state || ContextState.Active} onChange={e => this.setContextState(target!, e)}>\n                        {Object.keys(ContextState).map(c => (\n                            <option key={c} value={c}>{c}</option>\n                        ))}\n                    </select>\n                </ToolSection>\n            </>\n        );\n    }\n}","import * as React from 'react';\nimport { Data } from '../model';\nimport { ToolSection } from '../framework/ToolSection';\nimport { syncer } from '../db/syncer';\nimport { Loader } from '../components/Loader';\n\ninterface DataPageProps {\n    data: Data;\n    refreshData(): void;\n}\n\nexport class DataPage extends React.Component<{ render: (props: DataPageProps)=>React.ReactNode }, { data: Data|null, error: string|null }> {\n\n    constructor(props: any) {\n        super(props);\n\n        this.state = {\n            error: null,\n            data: null\n        };\n\n        this.refreshData = this.refreshData.bind(this);\n    }\n\n    async componentDidMount() {\n        syncer.registerDataListener(data => this.setState({ data }));\n        this.setState({ data: await syncer.getData() }, async () => {\n            await syncer.startServerSync();\n            await syncer.ensureServerSyncEnqueued();\n        });\n    }\n\n    async refreshData() {\n        this.setState({ data: await syncer.getData() });\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <>\n                    <div>{this.state.error}</div>\n                    <ToolSection>\n                        <div className=\"button\" onClick={() => this.refreshData()}>Retry</div>\n                        <div className=\"button\" onClick={() => window.location.reload()}>Reload</div>\n                        <div className=\"button\" onClick={() => window.location.reload(true)}>Force Reload</div>\n                        <a className=\"button\" href=\"/login\" >Login</a>\n                    </ToolSection>\n                </>\n            );\n        }      \n        \n        if (!this.state.data) {\n            return <Loader />;\n        }\n\n        return this.props.render({ data: this.state.data, refreshData: this.refreshData });\n    }\n}","import {createInstance} from 'localforage';\nimport * as md5 from 'js-md5';\n\nconst lifeKeyStore = createInstance({ name: 'lifekeystore' });\nconst privateKeyStore = createInstance({ name: 'privatekeystore' });\n\nexport interface LifeKey {\n    fingerprint: string;\n    publicKey: string;\n    createdAt: string;\n}\n\nconst rsaSettings = {\n    name: \"RSA-OAEP\",\n    modulusLength: 2048,\n    publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n    hash: {name: \"SHA-256\"},\n};\n\nconst aesSettings = { name: 'AES-GCM', length: 256 };\n\nexport async function generateRsaKey() {\n    try {\n        const keyPair = await crypto.subtle.generateKey(\n            rsaSettings,\n            true,\n            ['encrypt', 'decrypt']\n        );\n\n        const rawPrivateKey = await crypto.subtle.exportKey('pkcs8', keyPair.privateKey);\n        const privateKeyBase64 = arrayBufferToBase64(rawPrivateKey);\n\n        const rawPublicKey = await crypto.subtle.exportKey('spki', keyPair.publicKey);\n        const publicKeyBase64 = arrayBufferToBase64(rawPublicKey);\n        const publicKeyFingerprint = md5.hex(rawPublicKey);\n\n        return { fingerprint: publicKeyFingerprint, privateKey: privateKeyBase64, publicKey: publicKeyBase64 };\n    } catch (error) {\n        console.error('generateKey', error, error.message)\n        throw error;\n    }\n}\n\nexport async function derivePublicRsaKey(privateKey: CryptoKey) {\n    const jwk = await crypto.subtle.exportKey(\"jwk\", privateKey);\n\n    delete jwk.d;\n    delete jwk.dp;\n    delete jwk.dq;\n    delete jwk.q;\n    delete jwk.qi;\n    jwk.key_ops = [\"encrypt\", \"wrapKey\"];\n    \n    const publicKey = await crypto.subtle.importKey(\"jwk\", jwk, rsaSettings, true, [\"encrypt\", \"wrapKey\"]);\n    return publicKey;\n}\n\nexport async function importLifeKey(privateKeyBase64: string) {\n    const importedPrivateKey = base64ToArrayBuffer(privateKeyBase64);\n    const extractablePrivateKey = await crypto.subtle.importKey('pkcs8', importedPrivateKey, rsaSettings, true, ['decrypt', 'unwrapKey']);\n    \n    const publicKey = await derivePublicRsaKey(extractablePrivateKey);\n    const rawPublicKey = await crypto.subtle.exportKey('spki', publicKey);\n    const publicKeyBase64 = arrayBufferToBase64(rawPublicKey);\n    const publicKeyFingerprint = md5.hex(rawPublicKey);\n\n    const privateKey = await crypto.subtle.importKey('pkcs8', importedPrivateKey, rsaSettings, false, ['decrypt', 'unwrapKey']);\n    privateKeyStore.setItem(publicKeyFingerprint, privateKey);\n\n    const lifeKey: LifeKey = {\n        fingerprint: publicKeyFingerprint,\n        publicKey: publicKeyBase64,\n        createdAt: new Date().toISOString(),\n    };\n\n    lifeKeyStore.setItem(lifeKey.fingerprint, lifeKey);\n}\n\nexport async function encryptAndWrap(fingerprint: string, data: string) {\n    try {\n        const lifeKey = await lifeKeyStore.getItem(fingerprint) as LifeKey;\n        if (!lifeKey) {\n            throw new Error(`Key with fingerprint ${fingerprint} not found`);\n        }        \n        const importedPublicKeyBuffer = base64ToArrayBuffer(lifeKey.publicKey);\n        const publicKey = await crypto.subtle.importKey('spki', importedPublicKeyBuffer, rsaSettings, true, ['encrypt', 'wrapKey']);\n    \n        const aesKey = await generateAesKey();\n        const iv = crypto.getRandomValues(new Uint8Array(12));\n    \n        const encryptedData = await crypto.subtle.encrypt({ \n            name: 'AES-GCM', \n            length: 256,\n            iv\n        }, aesKey, strToArrayBuffer(data));\n    \n        const encryptedDataBase64 = arrayBufferToBase64(encryptedData);\n    \n        const wrappedAesKey = await crypto.subtle.wrapKey('raw', aesKey, publicKey, rsaSettings);\n        const wrappedAesKeyBase64 = arrayBufferToBase64(wrappedAesKey);\n    \n        const ivBase64 = arrayBufferToBase64(iv);\n    \n        const result = {\n            payload: encryptedDataBase64,\n            key: wrappedAesKeyBase64,\n            fingerprint: fingerprint,\n            iv: ivBase64\n        };\n    \n        return result;\n    } catch (error) {\n        console.error('encryptAndWrap', error, error.message)\n        throw error;\n    }\n}\n\nexport async function unwrapAndDecrypt(fingerprint: string, wrappedKeyBase64: string, dataBase64: string, ivBase64: string) {\n    try {\n        const privateKey = await privateKeyStore.getItem(fingerprint) as CryptoKey;\n        if (!privateKey) {\n            throw new Error(`Key with fingerprint ${fingerprint} not found`);\n        }\n\n        const aesKey = await crypto.subtle.unwrapKey('raw', base64ToArrayBuffer(wrappedKeyBase64), privateKey, rsaSettings, aesSettings, false, ['decrypt'])\n        const unencryptedDataBuffer = await crypto.subtle.decrypt({ \n            name: 'AES-GCM', \n            length: 256,\n            iv: base64ToArrayBuffer(ivBase64)\n        }, aesKey, base64ToArrayBuffer(dataBase64));\n        return arrayBufferToString(unencryptedDataBuffer);\n    } catch (error) {\n        console.error('unwrapAndDecrypt', error, error.message)\n        throw error;\n    }\n}\n\nexport async function generateAesKey(): Promise<any> {\n    try {\n        const key = await crypto.subtle.generateKey(aesSettings, true, ['encrypt', 'decrypt']);\n        return key;\n    } catch (error) {\n        console.error('generateKey', error, error.message)\n        throw error;\n    }\n}\n\nexport async function getCurrentKey() {\n    const keys = await lifeKeyStore.keys();\n\n    if (keys.length === 0) {\n        throw new Error('No key found');\n    }\n\n    if (keys.length > 1) {\n        throw new Error('More than 1 key found!');\n    }\n\n    return (await lifeKeyStore.getItem(keys[0])) as LifeKey;\n}\n\n\nfunction arrayBufferToBase64( buffer: ArrayBuffer ) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n        binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa( binary );\n}\n\nfunction base64ToArrayBuffer(base64: string) {\n    var binary_string =  window.atob(base64);\n    var len = binary_string.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++)        {\n        bytes[i] = binary_string.charCodeAt(i);\n    }\n    return bytes.buffer;\n}\n\n// function webSafe64(base64: string) {\n//     return base64.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n// }\n\n// // Convert from web-safe to normal, add trailing \"=\"s\n// function normal64(base64: string) {\n//     return base64.replace(/\\-/g, '+').replace(/_/g, '/') + '=='.substring(0, (3*base64.length)%4);\n// }\n\nfunction strToArrayBuffer(str: string) {\n    var buf = new ArrayBuffer(str.length * 2);\n    var bufView = new Uint16Array(buf);\n    for (var i = 0, strLen = str.length; i < strLen; i++) {\n      bufView[i] = str.charCodeAt(i);\n    }\n    return buf;\n}\n\nfunction arrayBufferToString(buf: ArrayBuffer) {\n    return String.fromCharCode.apply(null, new Uint16Array(buf) as any);\n}","import * as React from 'react';\nimport { ToolSection } from '../framework/ToolSection';\nimport { db } from '../db/db';\nimport { getCurrentKey, generateRsaKey, importLifeKey, LifeKey } from '../db/crypt';\nimport * as dropboxApi from '../lib/dropboxApi';\nimport { setTheme, getVariable } from '../layout/theme';\nimport { getNoteTitle, getNoteTitleType, Note } from '../db/note';\nimport { Node } from '../components/TreeEditor'\nimport {createInstance} from 'localforage';\nimport moment from 'moment';\nimport { getAlias, mentionRegex } from '../db/person';\nimport { Api } from '../bridge/HostBridge';\n\nconst fileSystemInstance = createInstance({ name: 'filesystem' });\nlet dirHandle: FileSystemDirectoryHandle|null = null;\nlet perms: boolean|null = null;\n\nfileSystemInstance.getItem('directory').then(async h => {\n    dirHandle = h as FileSystemDirectoryHandle;\n    if (!dirHandle) {\n        return;\n    }\n    perms = await permissionStatus(dirHandle, true);\n});\n\nasync function permissionStatus(fileHandle: FileSystemDirectoryHandle, readWrite: boolean) {\n    const options: FileSystemHandlePermissionDescriptor = {};\n    if (readWrite) {\n        options.mode = 'readwrite';\n    }\n    // Check if permission was already granted. If so, return true.\n    if ((await fileHandle.queryPermission(options)) === 'granted') {\n        return true;\n    }\n    // The user didn't grant permission, so return false.\n    return false;\n}\n\nexport const SettingsPage: React.FC<{}> = () => {\n    // const [pushSubscribed, setPushSubscribed] = React.useState<boolean|null>(null);\n    const [currentKey, setCurrentKey] = React.useState<LifeKey|null>(null);\n\n    const [serviceWorkerState, setServiceWorkerState] = React.useState('none');\n    const [generatedKey, setGeneratedKey] = React.useState<string|null>(null);\n    const [privateKey, setPrivateKey] = React.useState<string|null>(null);\n    const [remoteConnected, setRemoteConnected] = React.useState<boolean|null>(null);\n    const [blobConnectionString, setBlobConnectionString] = React.useState('');\n\n    async function clearEntities() {\n        if(!window.confirm('Clear all local data?')) {\n            return;\n        }\n\n        db.contexts.dropInstance();\n        db.tasks.dropInstance();\n        db.notes.dropInstance();\n        db.projects.dropInstance();\n        db.people.dropInstance();\n    }\n\n    const [dropboxConnected, setDropboxConnected] = React.useState<boolean|null>(null);\n    React.useEffect(() => {\n        dropboxApi.isSignedIn().then(status => {\n            setDropboxConnected(status);\n        });\n    }, [])\n\n    React.useEffect(() => {\n        async function check() {\n            setRemoteConnected(await Api.syncRemoteConnected());\n        }\n        check();\n    }, []);\n\n    React.useEffect(() => {\n        async function componentDidMount() {\n            if(navigator.serviceWorker) {\n                const registration = await navigator.serviceWorker.ready;\n                const state = [registration.active ? 'active' : null, registration.waiting ? 'waiting' : null, registration.installing ? 'installing' : null];\n                setServiceWorkerState(state.filter(x => x != null).join(', '))\n            }\n    \n            await refreshKeys();\n        }\n        componentDidMount() \n    }, [])\n\n    async function refreshKeys() {\n        try {\n            const newCurrentKey = await getCurrentKey();\n            setCurrentKey(newCurrentKey)\n        } catch(err) {\n        }\n    }\n\n    function clearServiceWorker() {\n        if (!navigator.serviceWorker) {\n            return;\n        }\n        \n        navigator.serviceWorker.ready.then(async (registration) => {\n            await registration.update();\n        });\n    }\n\n\n    function writeNode(node: Node, output: string, indent = ''): string {\n        output += `${indent}- ${node.text}\\n`;\n\n        if (node.nodes) {\n            for(const childNode of node.nodes) {\n                output = writeNode(childNode, output, indent + '\\t');\n            }\n        }\n\n        return output;\n    }\n\n    async function formatContent(note: Note) {\n        const people = await db.people.getAll();\n\n\n        if(note.mode === 'tree' && note.content) {\n            const nodes = JSON.parse(note.content) as Node[];\n            let content = '';\n\n            for(const node of nodes) {\n                content = writeNode(node, content);\n            }\n\n            content = content.replace(mentionRegex, (_, group1) => {\n                const person = people.find(x => `@${getAlias(x)}` === group1);\n\n                if(person) {\n                    return `[[${person.name}]]`;\n                }\n\n                return `[[Missing Person]]: ${group1}`;\n            });\n\n            return content;\n        }\n\n        return note.content;\n    }\n    \n    async function exportToObsidian() {\n        if (!dirHandle) {\n            dirHandle = await window.showDirectoryPicker();\n            fileSystemInstance.setItem('directory', dirHandle);\n        }\n\n        if(!await verifyPermission(dirHandle, true)) {\n            perms = false;\n            console.error('permission denied');\n        }\n        perms = true;\n        \n        const vaultHandle = await dirHandle.getDirectoryHandle(\"dump-test\", { create: true });\n\n        for(const note of await db.notes.getAll()) {\n            if(note.noteFor) {\n                continue;\n            }\n\n            const title = getNoteTitle(note);\n            let fileName = `${title}.md`;\n            let dir = vaultHandle;\n\n            if (note.contextId) {\n                const context = await db.contexts.get(note.contextId);\n                if (context) {\n                    // metadata.push(`context: ${context.title}`);\n                    dir = await dir.getDirectoryHandle(context.title, { create: true });\n                }\n            }\n\n            if(note.dailyDate) {\n                dir = await dir.getDirectoryHandle('Daily', { create: true });\n                fileName = `${moment(note.dailyDate).format('YYYY-MM-DD')}.md`;\n            }\n\n            console.log('writing ', fileName);\n            const file = await dir.getFileHandle(fileName, { create: true });\n            const writable = await file.createWritable({ keepExistingData: false });\n\n            const metadata: string[] = [\n            //     `id: ${note.id}`,\n            //     `updated: ${note.updatedAt}`,\n            //     `created: ${note.createdAt}`\n            ];\n\n            // if(note.mode) {\n            //     metadata.push(`mode: ${note.mode}`);\n            // }\n\n            if (getNoteTitleType(note) === 'title') {\n                metadata.push(`# ${note.title}`);\n            }\n\n            if (note.tags && note.tags.length) {\n                metadata.push(`tags: ${note.tags.split(' ').map(t => `#${t}`).join(', ')}`);\n            }\n\n            if (metadata.length) {\n                metadata.push('');\n            }\n\n            await writable.write(\n`${metadata.join('\\n')}\n${await formatContent(note)}`);\n\n            await writable.close();\n        }\n\n        const peopleHandle = await vaultHandle.getDirectoryHandle(\"People\", { create: true });\n\n        for(const person of await db.people.getAll()) {\n            let fileName = `${person.name}.md`;\n\n            console.log('writing ', fileName);\n            const file = await peopleHandle.getFileHandle(fileName, { create: true });\n            const writable = await file.createWritable({ keepExistingData: false });\n\n            const metadata: string[] = [];\n\n            if (person.birthday) {\n                metadata.push(`birthday: ${moment(person.birthday).format(`YYYY-MM-DD`)}`);\n            }\n\n            if (metadata.length) {\n                metadata.push('');\n            }\n\n            if (person.noteId) {\n                const note = await db.notes.get(person.noteId);\n                if(note) {\n                    metadata.push(await formatContent(note))\n                }\n            }\n\n            await writable.write(metadata.join('\\n'));\n            await writable.close();\n        }\n    }\n\n    async function verifyPermission(fileHandle: FileSystemDirectoryHandle, readWrite: boolean) {\n        const options: FileSystemHandlePermissionDescriptor = {};\n        if (readWrite) {\n            options.mode = 'readwrite';\n        }\n        // Check if permission was already granted. If so, return true.\n        if ((await fileHandle.queryPermission(options)) === 'granted') {\n            return true;\n        }\n\n        // Request permission. If the user grants permission, return true.\n        if ((await fileHandle.requestPermission(options)) === 'granted') {\n            return true;\n        }\n        // The user didn't grant permission, so return false.\n        return false;\n    }\n\n    return (\n        <>\n            <ToolSection>\n                <div className=\"button\" onClick={() => setTheme('dark-theme')}>Dark theme</div>\n                <div className=\"button\" onClick={() => setTheme('light-theme')}>Light theme</div>\n            </ToolSection>\n\n            <ToolSection>\n                <div className=\"button\" onClick={() => window.location.reload()}>Reload</div>\n                <div className=\"button\" onClick={() => window.location.reload(true)}>Force Reload</div>\n            </ToolSection>\n            <ToolSection>\n                <div className=\"button\" onClick={exportToObsidian}>Export to Obsidian</div>\n                {dirHandle && \n                    <div style={{display: 'inline-block', background: getVariable('--settings-info-background'), padding: '.5rem'}}>{dirHandle.name} - Access Status: {perms ? 'granted' : 'not granted'}</div>\n                }\n            </ToolSection>\n            <ToolSection>\n                {remoteConnected ? (\n                    <div className=\"button\" onClick={async _ => { Api.disconnectBlobStorage(); setRemoteConnected(await Api.syncRemoteConnected()); }}>Disconnect Blob Storage</div>\n                ) : (\n                    <>\n                        <div className=\"button\" onClick={async _ => { Api.connectBlobStorage(blobConnectionString); setRemoteConnected(await Api.syncRemoteConnected()); }}>Connect Blob Storage</div>\n                        <input type=\"text\" value={blobConnectionString} onChange={e => setBlobConnectionString(e.target.value)} />\n                    </>\n                )}\n            </ToolSection>\n            <ToolSection>\n                {dropboxConnected ? (\n                    <>\n                        <div className=\"button\" onClick={async () => { await dropboxApi.disconnect(); }}>Disconnect Dropbox</div>\n                        <div className=\"button\" onClick={async () => { await dropboxApi.refreshDropbox(); }}>Refresh Dropbox</div>\n                    </>\n                ) : (\n                    <div className=\"button\" onClick={async () => { await dropboxApi.signIn(); setDropboxConnected(await dropboxApi.isSignedIn()) }}>Connect Dropbox</div>\n                )}\n                <div style={{display: 'inline-block', background: getVariable('--settings-info-background'), padding: '.5rem'}}>Status: {dropboxConnected === null ? 'unknown' : dropboxConnected ? 'connected' : 'not connected'}</div>\n                {dropboxApi.isLocalMode && <div style={{display: 'inline-block', background: getVariable('--settings-info-background'), padding: '.5rem'}}>Local [ {window.location.host} ]</div>}\n                \n            </ToolSection>\n            <ToolSection>\n                <div className=\"button\" onClick={async () => await clearEntities()}>Clear Entities</div>\n                <div className=\"button\" onClick={() => clearServiceWorker()}>Update Service Worker</div>\n                <div style={{display: 'inline-block', background: getVariable('--settings-info-background'), padding: '.5rem'}}>Service Workers [ {serviceWorkerState} ]</div>\n            </ToolSection>\n            {false && <ToolSection>\n                <h2>Encryption</h2>\n                {!currentKey && (\n                    <>\n                        <div>\n                            <textarea style={{width: '100%'}} onChange={e => setPrivateKey(e.target.value)} />\n                        </div>\n                        <button className=\"button\" onClick={async () => { await importLifeKey(privateKey!); await refreshKeys(); }}>Set private key</button>\n                        <h4>Generate key</h4>\n                        <div className=\"button\" onClick={async () => setGeneratedKey((await generateRsaKey()).privateKey)}>Generate</div>\n                        <textarea style={{width: '100%', background: '#555', color: '#ddd'}} readOnly value={generatedKey || ''} />\n                    </>\n                )}\n                <h4>Keys</h4>\n                <div className=\"list\">\n                    {!currentKey && <div>No keys</div>}\n                    {currentKey && (\n                        <div className=\"item\">\n                            {currentKey!.fingerprint}\n                        </div>\n                    )}\n                </div>\n            </ToolSection>}\n        </>\n    );\n}","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport * as styles from '../../layout/styles';\nimport { useData } from '../../model';\nimport { ToolSection } from '../../framework/ToolSection';\nimport { Person } from '../../db/person';\nimport { cx } from 'emotion';\n\nexport const PeoplePage: React.FC<{}> = props => {\n    const {data} = useData();\n\n    const renderTarget = (target: Person) => {\n        return (\n            <NavLink key={target.id} to={`/people/${target.id}`} className={cx('item', styles.hoverGlow)}>\n                <div>\n                    {target.name}\n                </div>\n            </NavLink>\n        );\n    };\n\n    return (\n        <>\n            <ToolSection>\n                <NavLink to={`/people/new`} className=\"button\">New Person</NavLink>\n            </ToolSection>\n\n            <div className=\"list\">\n                {data.people.sort((a, b) => a.name.localeCompare(b.name)).map(t => renderTarget(t))}\n            </div>\n        </>\n    );\n};\n","import * as React from 'react';\nimport { NavLink, Redirect } from 'react-router-dom';\nimport { ToolSection } from '../../framework/ToolSection';\nimport { db } from '../../db/db';\nimport { useState } from 'react';\nimport { EmbeddedNoteEdit } from '../../components/EmbeddedNote';\nimport { useData } from '../../model';\n\nconst useForm = <T extends {}>(initialState: ()=>T) => {\n    const [values, setValues] = useState<T>(initialState);\n    \n    const handleChange = (event: any) => {\n        event.persist();\n        setValues((values) => ({ ...values, [event.target.name]: event.target.value }));\n    };\n\n    return {\n        values,\n        handleChange\n    };\n};\n\nexport const EditPersonPage: React.FC<{id?: string }> = (props) => {\n    const {data} = useData();\n    const [goBack, setGoBack] = useState<string|null>(null);\n\n    const {values, handleChange} = useForm(() => {\n        const person = props.id ? data.people.find(x => x.id === props.id) : null;\n        return {\n            name:  person ? person.name : '',\n            alias: person ? person.alias : '',\n            birthday: person ? person.birthday : null\n        }\n    });\n\n    const onSave = async () => {\n        const id = props.id || null;\n\n        if (id) {\n            let person = await db.people.get(id)!;\n\n            if (person === null) {\n                throw new Error('Person is null?');\n            }\n\n            person.name = values.name;\n            person.alias = (values.alias?.length && values.alias) || null;\n            person.birthday = values.birthday;\n\n            await db.people.save(person);\n            setGoBack(person.id);\n        } else {\n            const person = await db.people.create({\n                name: values.name,\n                alias: (values.alias?.length && values.alias) || null,\n                birthday: values.birthday,\n                noteId: null,\n            });\n\n            setGoBack(person.id);\n        }\n    };\n\n    const person = props.id ? data.people.find(x => x.id === props.id) || null : null;\n\n    return (\n        <>\n            {goBack && <Redirect to={`/people/${goBack}`} />}\n            <div style={{height: '100%', display: 'flex', flexDirection: 'column'}} >\n                <ToolSection>\n                    <NavLink to={`/people`} className=\"button\">Back</NavLink>\n                    {props.id && <NavLink to={`/people/${props.id}`} className=\"button\">Show</NavLink>}\n                </ToolSection>\n                <ToolSection>\n                    {props.id === undefined ?\n                            <button type=\"button\" className=\"button is-primary\" onClick={onSave}>Add person</button> :\n                            <button type=\"button\" className=\"button is-primary\" onClick={onSave}>Update person</button>}\n                </ToolSection>\n                <ToolSection>\n                    <div>Name</div>\n                    <input type=\"text\" name=\"name\" className=\"input is-large is-wide\" value={values.name} onChange={handleChange} />\n                    <div>Alias</div>\n                    <input type=\"text\" name=\"alias\" className=\"input is-large is-wide\" value={values.alias || ''} onChange={handleChange} />\n                    <div>Birthday</div>\n                    <input type=\"date\" name=\"birthday\" className=\"input is-large\" value={values.birthday || ''} onChange={handleChange} />\n                </ToolSection>\n                <ToolSection>\n                    <EmbeddedNoteEdit targetEntity={person} />\n                </ToolSection>\n            </div>\n        </>\n    );\n};","import * as React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { useData } from '../../model';\nimport { ToolSection } from '../../framework/ToolSection';\nimport moment from 'moment';\nimport { EmbeddedNoteShow } from '../../components/EmbeddedNote';\nimport { getAlias } from '../../db/person';\nimport { PersonReferenceViewer } from '../../components/ReferenceViewer';\n\nexport const ShowPersonPage: React.FC<{id: string}> = (props) => {\n    const {data} = useData();\n    const person = data.people.find(x => x.id === props.id);\n\n    if (!person) {\n        return <div>Person not found.</div>\n    }\n\n    return (\n        <>\n            <ToolSection>\n                <NavLink to={`/people`} className=\"button\">Back</NavLink>\n                <NavLink to={`/people/${person.id}/edit`} className=\"button\">Edit</NavLink>\n            </ToolSection>\n            <div className=\"panel\">\n                <div className=\"content\" style={{padding: '1rem'}}>\n                    <h1>{person.name} (@{getAlias(person)})</h1>\n                    {person.birthday && <div>Birthday: {moment(person.birthday).format('YYYY-MM-DD')}</div>}\n                    <EmbeddedNoteShow targetEntity={person} {...props} />\n                    <PersonReferenceViewer alias={getAlias(person)} />\n                </div>\n            </div>\n        </>\n    );\n}; ","import * as React from 'react';\nimport { ToolSection } from '../framework/ToolSection';\nimport { db } from '../db/db';\nimport { useData } from '../model';\n\nexport const StatsPage: React.SFC<{}> = (props) => {\n    const {data} = useData();\n    const [noteTotalCount, setNoteTotalCount] = React.useState<number|null>(null);\n    const [taskTotalCount, setTaskTotalCount] = React.useState<number|null>(null);\n    const [peopleTotalCount, setPeopleTotalCount] = React.useState<number|null>(null);\n    const [projectTotalCount, setProjectTotalCount] = React.useState<number|null>(null);\n    const [contextTotalCount, setContextTotalCount] = React.useState<number|null>(null);\n    \n    React.useEffect(() => {\n        db.notes.getSyncKeys().then(c => setNoteTotalCount(c.length));\n        db.tasks.getSyncKeys().then(c => setTaskTotalCount(c.length));\n        db.people.getSyncKeys().then(c => setPeopleTotalCount(c.length));\n        db.projects.getSyncKeys().then(c => setProjectTotalCount(c.length));\n        db.contexts.getSyncKeys().then(c => setContextTotalCount(c.length));\n    });\n\n    return (\n        <>\n            <ToolSection>\n            </ToolSection>\n            <div className=\"panel\">\n                <div className=\"content\" style={{padding: '1rem'}}>\n                    <h1>Stats</h1>\n                    <ul>\n                        <li>Notes: {data.notes.length}, versions: {noteTotalCount ? noteTotalCount : '...'}</li>\n                        <li>Tasks: {data.tasks.length}, versions: {taskTotalCount ? taskTotalCount : '...'}</li>\n                        <li>People: {data.people.length}, versions: {peopleTotalCount ? peopleTotalCount : '...'}</li>\n                        <li>Projects: {data.projects.length}, versions: {projectTotalCount ? projectTotalCount : '...'}</li>\n                        <li>Contexts: {data.contexts.length}, versions: {contextTotalCount ? contextTotalCount : '...'}</li>\n                    </ul>\n                </div>\n            </div>\n        </>\n    );\n}","import * as React from 'react';\nimport { ContextBar } from '../../components/ContextBar';\nimport { useQueryState } from '../../lib/UseQueryState';\nimport { ToolSection } from '../../framework/ToolSection';\nimport { useData } from '../../model';\nimport moment from 'moment';\nimport { getNoteTitle, Note } from '../../db/note';\nimport { ContextTag } from '../../components/ContextTag';\nimport { MarkedViewer } from '../../components/MarkedViewer';\nimport _ from 'lodash';\nimport * as ContextActions from '../../lib/contextActions';\nimport { TreeViewer } from '../../components/TreeViewer';\nimport { NavLink } from 'react-router-dom';\nimport { horizontalSpace } from '../../layout/styles';\n\nexport const DailyNotePage: React.SFC<{ }> = (props) => {\n    const [contextId, setContextId] = useQueryState(null, 'context');\n    const {data} = useData();\n\n    const oneMonthAgo = moment().add(-30,'d');\n    \n    const filteredContexts = ContextActions.getFilteredContextIds(contextId, data);\n    const dailyNotes = _.orderBy(data.notes.filter(x => x.dailyDate && moment(x.dailyDate) > oneMonthAgo && (!contextId || filteredContexts.indexOf(x.contextId!) !== -1)), n => n.dailyDate,  'desc');\n\n    function renderViewer(note: Note) {\n        if (!note.mode || note.mode === 'markdown') {\n            return <MarkedViewer markdown={note.content} contextId={note.contextId} />;\n        } \n          \n        return <TreeViewer json={note.content} contextId={note.contextId} />;\n    }\n\n    const contextCounts = _.countBy(data.notes.filter(n => n.dailyDate), x  => x.contextId);\n    const contexts = _.orderBy(Object.keys(contextCounts).map(k => ({ contextId: k, count: contextCounts[k], context: data.contexts.find(x => x.id === k) })), x => x.count, 'desc');\n\n    const urlParams = new URLSearchParams(window.location.search);\n    const source = `?source=${encodeURIComponent(`${window.location.pathname}?${urlParams.toString()}`)}`\n\n    return (\n        <div style={{display: 'flex', height: '100%'}}>\n            <ContextBar contextId={contextId} onChange={setContextId} />\n            <div style={{width: '100%'}}>\n                <ToolSection>\n                    {contexts.map(c => (\n                        <NavLink key={c.contextId} to={`/notes/new?context=${c.contextId}&daily`} className=\"button\">New Note{c.context ? ` - ${c.context.title}` : ''}</NavLink>\n                    ))}\n                </ToolSection>\n                <div className=\"panel\">\n                    {dailyNotes.map(n => (\n                        <div key={n.id} className=\"content\" style={{padding: '1rem'}}>\n                            <h1>{getNoteTitle(n)}</h1>\n                            <div style={{display: 'flex', justifyContent: 'space-between'}}>\n                                <div className={horizontalSpace('8px')}>\n                                    <a className=\"button small\" href={`/notes/${n.id}${source}`}>Show</a>\n                                    <a className=\"button small\" href={`/notes/${n.id}/edit${source}`}>Edit</a>\n                                </div>\n                                <ContextTag contextId={n.contextId} />\n                            </div>\n                            {renderViewer(n)}\n                        </div>))}\n                </div>\n            </div>\n        </div>\n    )\n};\n","import * as React from 'react';\nimport { Route, Switch } from 'react-router-dom';\nimport { Layout } from './components/Layout';\nimport { TaskPage } from './pages/TaskPage';\nimport { EditNotePage } from './pages/notes/EditNotePage';\nimport { ShowNotePage, ShowVirtualNotePage } from './pages/notes/ShowNotePage';\nimport { NotePage } from './pages/notes/NotePage';\nimport { PlaygroundPage } from './pages/PlaygroundPage';\nimport { ContextPage } from './pages/ContextPage';\nimport { ProjectPage } from './pages/ProjectPage';\nimport { ShowTaskPage } from './pages/ShowTaskPage';\nimport { ShowProjectPage } from './pages/ShowProjectPage';\nimport { ShowContextPage } from './pages/ShowContextPage';\nimport { DataPage } from './pages/DataPage';\nimport { SyncPage } from './pages/SyncPage';\nimport { SettingsPage } from './pages/SettingsPage';\nimport { PeoplePage } from './pages/people/PeoplePage';\nimport { EditPersonPage } from './pages/people/EditPersonPage';\nimport { ShowPersonPage } from './pages/people/ShowPersonPage';\nimport { StatsPage } from './pages/StatsPage';\nimport {DataProvider} from './model';\nimport { DailyNotePage } from './pages/notes/DailyNotes';\nimport './theme.scss';\n\nexport const routes = <Layout>\n    <DataProvider>\n        <Switch>\n            <Route exact path='/' render={routeProps => <NotePage />} />\n            <Route exact path='/notes/new' render={routeProps => <EditNotePage />} />\n            <Route exact path='/notes/daily' render={routeProps => <DailyNotePage />} />\n            <Route exact path='/notes/virtual' render={routeProps => <ShowVirtualNotePage />} />\n            <Route exact path='/notes/:id' render={routeProps => <ShowNotePage id={routeProps.match.params.id} />} />\n            <Route exact path='/notes/:id/edit' render={routeProps => <EditNotePage id={routeProps.match.params.id} />} />\n            <Route exact path='/tasks' render={routeProps => <TaskPage />} />\n            <Route exact path='/tasks/:id' render={routeProps => <DataPage render={(props) => <ShowTaskPage {...props} id={routeProps.match.params.id} />} />} />\n            <Route exact path='/contexts' render={routeProps => <ContextPage />} />\n            <Route exact path='/contexts/:id' render={routeProps => <DataPage render={(props) => <ShowContextPage {...props} id={routeProps.match.params.id} />} />} />\n            <Route exact path='/projects' render={routeProps => <DataPage render={(props) => <ProjectPage {...props} />} />} />\n            <Route exact path='/projects/:id' render={routeProps => <DataPage render={(props) => <ShowProjectPage {...props} id={routeProps.match.params.id} />} />} />\n            <Route exact path='/people' render={routeProps => <PeoplePage />} />} />\n            <Route exact path='/people/new' render={routeProps => <EditPersonPage />} />\n            <Route exact path='/people/:id' render={routeProps => <ShowPersonPage id={routeProps.match.params.id} />} />\n            <Route exact path='/people/:id/edit' render={routeProps => <EditPersonPage id={routeProps.match.params.id} />} />\n            <Route path='/playground' component={PlaygroundPage} />\n            <Route path='/sync' component={SyncPage} />\n            <Route path='/stats' render={routeProps => <StatsPage />} />\n            <Route path='/settings' component={SettingsPage} />\n        </Switch>\n    </DataProvider>\n</Layout>;\n","import React from 'react';\nimport { ToolSection } from '../framework/ToolSection';\nimport { syncer, SyncStatus } from '../db/syncer';\nimport moment from 'moment';\n\nexport const SyncPage: React.FC<{}> = props => {\n    const [count, setCount] = React.useState(0);\n\n    React.useEffect(() => {\n        syncer.registerSyncListener(() => {\n            setCount(c => c + 1);\n        });\n    }, []);\n   \n    return (\n        <>\n            <React.Fragment key={count}></React.Fragment>\n            <ToolSection>\n                <div>Status: {SyncStatus[syncer.status]}</div>\n                <div className=\"button\" onClick={() => syncer.startServerSync()}>Sync Now</div>\n            </ToolSection>\n            <div className=\"list\">\n                {syncer.getResults().slice(0).reverse().map((result, i) =>\n                    <React.Fragment key={i}>\n                        <div className=\"item\">{result.type} - {result.endAt.getTime() - result.startAt.getTime()} ms - start: {moment(result.startAt).format('HH:mm:ss')}, end: {moment(result.endAt).format('HH:mm:ss')}, fetch: {result.fetch}, send: {result.send}{result.error ? `, error: ${result.error}` : null}</div>\n                    </React.Fragment>)}\n            </div>\n        </>\n    );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport * as serviceWorker from './serviceWorker';\nimport { Router } from 'react-router-dom';\nimport { routes } from './routes';\nimport {createBrowserHistory} from 'history';\nimport 'whatwg-fetch';\n\nexport const history = createBrowserHistory()\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router children={routes} history={history} />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\nserviceWorker.register();"],"sourceRoot":""}